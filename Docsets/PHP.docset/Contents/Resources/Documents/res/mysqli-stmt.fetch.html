<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Fetch results from a prepared statement into the bound variables</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="mysqli-stmt.execute.html">mysqli_stmt::execute</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="mysqli-stmt.field-count.html">mysqli_stmt::$field_count</a></div>
 <div class="up"><a href="class.mysqli-stmt.html">mysqli_stmt</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="mysqli-stmt.fetch" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysqli_stmt::fetch</h1>
  <h1 class="refname">mysqli_stmt_fetch</h1>
  <p class="verinfo">(PHP 5)</p><p class="refpurpose"><span class="refname">mysqli_stmt::fetch</span> -- <span class="refname">mysqli_stmt_fetch</span> &mdash; <span class="dc-title">Fetch results from a prepared statement into the bound variables</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-mysqli-stmt.fetch-description">
  <h3 class="title">Description</h3>
  <p class="para">Object oriented style</p>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><b>mysqli_stmt::fetch</b></span>
    ( <span class="methodparam">void</span>
   )</div>

  <p class="para rdfs-comment">Procedural style</p>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><b>mysqli_stmt_fetch</b></span>
    ( <span class="methodparam"><span class="type"><a href="class.mysqli-stmt.html" class="type mysqli_stmt">mysqli_stmt</a></span> <tt class="parameter">$stmt</tt></span>
   )</div>

  <p class="para rdfs-comment">
   Fetch the result from a prepared statement into the variables bound by
   <span class="function"><a href="mysqli-stmt.bind-result.html" class="function">mysqli_stmt_bind_result()</a></span>.
  </p>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    Note that all columns must be bound by the application before calling
    <span class="function"><b>mysqli_stmt_fetch()</b></span>.
   </p>
  </p></blockquote>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    Data are transferred unbuffered without calling
    <span class="function"><a href="mysqli-stmt.store-result.html" class="function">mysqli_stmt_store_result()</a></span> which can decrease
    performance (but reduces memory cost).
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 parameters" id="refsect1-mysqli-stmt.fetch-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>
<span class="term"><i><tt class="parameter">
stmt</tt></i></span><dd>
<p class="para">Procedural style only: A statement identifier
returned by <span class="function"><a href="mysqli.stmt-init.html" class="function">mysqli_stmt_init()</a></span>.</p></dd>
</dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-mysqli-stmt.fetch-returnvalues">
  <h3 class="title">Return Values</h3>
  <table class="doctable table">
   <caption><b>Return Values</b></caption>
   
    <thead valign="middle">
     <tr valign="middle">
      <th>Value</th>
      <th>Description</th>
     </tr>

    </thead>

    <tbody valign="middle" class="tbody">
     <tr valign="middle">
      <td align="left"><b><tt>TRUE</tt></b></td>
      <td align="left">Success. Data has been fetched</td>
     </tr>

     <tr valign="middle">
      <td align="left"><b><tt>FALSE</tt></b></td>
      <td align="left">Error occurred</td>
     </tr>

     <tr valign="middle">
      <td align="left"><b><tt>NULL</tt></b></td>
      <td align="left">No more rows/data exists or data truncation occurred</td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-mysqli-stmt.fetch-examples">
  <h3 class="title">Examples</h3>
  <div class="example" id="example-1635">
   <p><b>Example #1 Object oriented style</b></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"my_user"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"my_password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"world"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;check&nbsp;connection&nbsp;*/<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">mysqli_connect_errno</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Connect&nbsp;failed:&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">mysqli_connect_error</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;exit();<br />}<br /><br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;Name,&nbsp;CountryCode&nbsp;FROM&nbsp;City&nbsp;ORDER&nbsp;by&nbsp;ID&nbsp;DESC&nbsp;LIMIT&nbsp;150,5"</span><span style="color: #007700">;<br /><br />if&nbsp;(</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">))&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;execute&nbsp;statement&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;bind&nbsp;result&nbsp;variables&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bind_result</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$code</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;fetch&nbsp;values&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">while&nbsp;(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">"%s&nbsp;(%s)\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$code</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;close&nbsp;statement&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br />}<br /><br /></span><span style="color: #FF8000">/*&nbsp;close&nbsp;connection&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
  <div class="example" id="example-1636">
   <p><b>Example #2 Procedural style</b></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysqli_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"my_user"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"my_password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"world"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;check&nbsp;connection&nbsp;*/<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">mysqli_connect_errno</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Connect&nbsp;failed:&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">mysqli_connect_error</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;exit();<br />}<br /><br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;Name,&nbsp;CountryCode&nbsp;FROM&nbsp;City&nbsp;ORDER&nbsp;by&nbsp;ID&nbsp;DESC&nbsp;LIMIT&nbsp;150,5"</span><span style="color: #007700">;<br /><br />if&nbsp;(</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysqli_prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">))&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;execute&nbsp;statement&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysqli_stmt_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;bind&nbsp;result&nbsp;variables&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysqli_stmt_bind_result</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$code</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;fetch&nbsp;values&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">while&nbsp;(</span><span style="color: #0000BB">mysqli_stmt_fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">"%s&nbsp;(%s)\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$code</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;close&nbsp;statement&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysqli_stmt_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">/*&nbsp;close&nbsp;connection&nbsp;*/<br /></span><span style="color: #0000BB">mysqli_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>The above examples will output:</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
Rockford (USA)
Tallahassee (USA)
Salinas (USA)
Santa Clarita (USA)
Springfield (USA)
</pre></div>
   </div>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-mysqli-stmt.fetch-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="mysqli.prepare.html" class="function" rel="rdfs-seeAlso">mysqli_prepare()</a> - Prepare an SQL statement for execution</span></li>
    <li class="member"><span class="function"><a href="mysqli-stmt.errno.html" class="function" rel="rdfs-seeAlso">mysqli_stmt_errno()</a> - Returns the error code for the most recent statement call</span></li>
    <li class="member"><span class="function"><a href="mysqli-stmt.error.html" class="function" rel="rdfs-seeAlso">mysqli_stmt_error()</a> - Returns a string description for last statement error</span></li>
    <li class="member"><span class="function"><a href="mysqli-stmt.bind-result.html" class="function" rel="rdfs-seeAlso">mysqli_stmt_bind_result()</a> - Binds variables to a prepared statement for result storage</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="107034""></a>
  <div class="note">
   <strong class="user">Bruce Martin</strong>
   <a href="#107034" class="date">30-Dec-2011 09:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was trying to use a generic select * from table statment and have the results returned in an array. I finally came up with this solution, others have similar solutions, but they where not working for me. <br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Snip use normal methods to get to this point<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$metaResults </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">result_metadata</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= </span><span class="default">$metaResults</span><span class="keyword">-&gt;</span><span class="default">fetch_fields</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$statementParams</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">//build the bind_results statement dynamically so I can get the results in an array<br />
&nbsp;&nbsp; &nbsp; </span><span class="keyword">foreach(</span><span class="default">$fields </span><span class="keyword">as </span><span class="default">$field</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(empty(</span><span class="default">$statementParams</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$statementParams</span><span class="keyword">.=</span><span class="string">"\$column['"</span><span class="keyword">.</span><span class="default">$field</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">.</span><span class="string">"']"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$statementParams</span><span class="keyword">.=</span><span class="string">", \$column['"</span><span class="keyword">.</span><span class="default">$field</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">.</span><span class="string">"']"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$statment</span><span class="keyword">=</span><span class="string">"\$stmt-&gt;bind_result(</span><span class="default">$statementParams</span><span class="string">);"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; eval(</span><span class="default">$statment</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">()){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Now the data is contained in the assoc array $column. Useful if you need to do a foreach, or <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //if your lazy and didn't want to write out each param to bind.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Continue on as usual.<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83284""></a>
  <div class="note">
   <strong class="user">denath2 at yahoo dot com</strong>
   <a href="#83284" class="date">19-May-2008 12:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As php at johnbaldock dot co dot uk mentioned the problem is that the $row returned is reference and not data. So, when you write&nbsp; $array[] = $row, the $array will be filled up with the last element of the dataset. To come up with this you can write the following hack:<br />
<br />
// loop through all result rows<br />
while ($stmt-&gt;fetch()) {<br />
<br />
&nbsp;&nbsp;&nbsp; foreach( $row as $key=&gt;$value )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $row_tmb[ $key ] = $value;<br />
&nbsp;&nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; $array[] = $row_tmb;<br />
&nbsp;&nbsp;&nbsp; <br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83073""></a>
  <div class="note">
   <strong class="user">piedone at pyrocenter dot hu</strong>
   <a href="#83073" class="date">08-May-2008 12:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I tried the mentioned stmt_bind_assoc() function, but somehow, very strangely it doesn't allow the values to be written in an array! In the while loop, the row is fetched correctly, but if I write $array[] = $row;, the array will be filled up with the last element of the dataset... Unfortunately I couldn't find a solution.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82742""></a>
  <div class="note">
   <strong class="user">Lyndon</strong>
   <a href="#82742" class="date">23-Apr-2008 05:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function uses the same idea as the last, but instead binds the fields to a given array. <br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">stmt_bind_assoc </span><span class="keyword">(&amp;</span><span class="default">$stmt</span><span class="keyword">, &amp;</span><span class="default">$out</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">mysqli_stmt_result_metadata</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fields</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">$stmt</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">$field </span><span class="keyword">= </span><span class="default">mysqli_fetch_field</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">] = &amp;</span><span class="default">$out</span><span class="keyword">[</span><span class="default">$field</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">mysqli_stmt_bind_result</span><span class="keyword">, </span><span class="default">$fields</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// example<br />
<br />
</span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">"SELECT name, userid FROM somewhere"</span><span class="keyword">);<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
<br />
</span><span class="default">$row </span><span class="keyword">= array();<br />
</span><span class="default">stmt_bind_assoc</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">);<br />
<br />
</span><span class="comment">// loop through all result rows<br />
</span><span class="keyword">while (</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77141""></a>
  <div class="note">
   <strong class="user">dan dot latter at gmail dot com</strong>
   <a href="#77141" class="date">16-Aug-2007 12:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following function taken from PHP Cookbook 2, returns an associative array of a row in the resultset, place in while loop to iterate through whole result set.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">public function </span><span class="default">fetchArray </span><span class="keyword">() {<br />
&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">mysqli_stmt_result_metadata</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stmt</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stmt</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">$field </span><span class="keyword">= </span><span class="default">mysqli_fetch_field</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">] = &amp;</span><span class="default">$out</span><span class="keyword">[</span><span class="default">$field</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">mysqli_stmt_bind_result</span><span class="keyword">, </span><span class="default">$fields</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysqli_stmt_fetch</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stmt</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) ? </span><span class="default">false </span><span class="keyword">: </span><span class="default">$out</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72720""></a>
  <div class="note">
   <strong class="user">php at johnbaldock dot co dot uk</strong>
   <a href="#72720" class="date">30-Jan-2007 04:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Good point about the spaces in column names. I also had trouble with the fetch assoc returning references so when done multiple times all the data pointed to the last result set. I got around it by adding a foreach loop:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// creates an array of real values from an array of references<br />
</span><span class="keyword">foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">results </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$results</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">$v</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
To tidy all this up into a nice package I extended the mysqli and stmt classes. Here is the code to extend both, I also included 'Typer85 at gmail dot com's fix for column names that have spaces in them.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">mysqli_Extended </span><span class="keyword">extends </span><span class="default">mysqli<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$selfReference</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$dbHost</span><span class="keyword">, </span><span class="default">$dbUsername</span><span class="keyword">, </span><span class="default">$dbPassword</span><span class="keyword">, </span><span class="default">$dbDatabase</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$dbHost</span><span class="keyword">, </span><span class="default">$dbUsername</span><span class="keyword">, </span><span class="default">$dbPassword</span><span class="keyword">, </span><span class="default">$dbDatabase</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">= new </span><span class="default">stmt_Extended</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">, </span><span class="default">$query</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$stmt</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">stmt_Extended </span><span class="keyword">extends </span><span class="default">mysqli_stmt<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$varsBound </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$results</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">, </span><span class="default">$query</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">, </span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">fetch_assoc</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// checks to see if the variables have been bound, this is so that when<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //&nbsp; using a while ($row = $this-&gt;stmt-&gt;fetch_assoc()) loop the following<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // code is only executed the first time<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">varsBound</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$meta </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">result_metadata</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$column </span><span class="keyword">= </span><span class="default">$meta</span><span class="keyword">-&gt;</span><span class="default">fetch_field</span><span class="keyword">()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// this is to stop a syntax error if a column name has a space in<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // e.g. "This Column". 'Typer85 at gmail dot com' pointed this out<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$columnName </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="string">'_'</span><span class="keyword">, </span><span class="default">$column</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bindVarArray</span><span class="keyword">[] = &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">results</span><span class="keyword">[</span><span class="default">$columnName</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'bind_result'</span><span class="keyword">), </span><span class="default">$bindVarArray</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">varsBound </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">() != </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// this is a hack. The problem is that the array $this-&gt;results is full <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // of references not actual data, therefore when doing the following:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // while ($row = $this-&gt;stmt-&gt;fetch_assoc()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // $results[] = $row;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // $results[0], $results[1], etc, were all references and pointed to <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // the last dataset<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">results </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$results</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">$v</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$results</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// this is an example use of the extended mysqli.<br />
// the only difference is using "mysqli_Extended" instead of "mysqli"<br />
</span><span class="default">$db </span><span class="keyword">= new </span><span class="default">mysqli_Extended</span><span class="keyword">(</span><span class="default">$dbHost</span><span class="keyword">, </span><span class="default">$dbUsername</span><span class="keyword">, </span><span class="default">$dbPassword</span><span class="keyword">, </span><span class="default">$dbDatabase</span><span class="keyword">);<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="string">'SELECT foo FROM bar'</span><span class="keyword">;<br />
</span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">store_result</span><span class="keyword">();<br />
while (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch_assoc</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$foo</span><span class="keyword">[] = </span><span class="default">$row</span><span class="keyword">[</span><span class="string">'foo'</span><span class="keyword">];<br />
}<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71994""></a>
  <div class="note">
   <strong class="user">Typer85 at gmail dot com</strong>
   <a href="#71994" class="date">27-Dec-2006 05:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a side note,<br />
<br />
I see many people are contributing in ways to help return result sets for prepared statements in ASSOSITAVE arrays the same as the mysqli_fetch_assos function might return from a normal query issued via mysqli_query.<br />
<br />
This is done, in all the examples I have seen, by dynamically getting the field names in the prepared statement and binding them using 'variable' variables, which are variables that are created dynamically with the name of the field names.<br />
<br />
Some thing though you should take into consideration is illegal variable names in PHP. Assume that you have a field name in your database table named 'My Field' , notice the space between 'My' and 'Field'.<br />
<br />
To dynamically create this variable is illegal in PHP as variables can not have spaces in them. Furthermore, you won't be able to access the binded data as you can not reference a variable like so:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Syntax Error.<br />
<br />
</span><span class="keyword">echo </span><span class="default">$My Table</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The only suitable solution I find now is to replace all spaces in a field name with an underscore so that you can use the binded variable like so:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// This Works.<br />
<br />
</span><span class="keyword">echo </span><span class="default">$My_Table</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Notice the space is now replaced with an underscore.<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
All you simply have to do is before you dynamically bind the data, so a string search for any spaces in the table name, replace them with an underscore, THEN bind the variable.<br />
<br />
That way you should not run into problems.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71056""></a>
  <div class="note">
   <strong class="user">php at johnbaldock dot co dot uk</strong>
   <a href="#71056" class="date">09-Nov-2006 01:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Having just learned about call_user_func_array I reworked my fetch_assoc example. Swapping the following code makes for a more elegant (and faster) solution.<br />
<br />
Using:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">while (</span><span class="default">$columnName </span><span class="keyword">= </span><span class="default">$meta</span><span class="keyword">-&gt;</span><span class="default">fetch_field</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$columns</span><span class="keyword">[] = &amp;</span><span class="default">$results</span><span class="keyword">[</span><span class="default">$columnName</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">];<br />
}&nbsp; &nbsp; &nbsp; &nbsp; <br />
</span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">'bind_result'</span><span class="keyword">), </span><span class="default">$columns</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Instead of this code from my example below:<br />
<span class="default">&lt;?php<br />
$bindResult </span><span class="keyword">= </span><span class="string">'$stmt-&gt;bind_result('</span><span class="keyword">;<br />
while (</span><span class="default">$columnName </span><span class="keyword">= </span><span class="default">$meta</span><span class="keyword">-&gt;</span><span class="default">fetch_field</span><span class="keyword">()) {<br />
&nbsp;&nbsp; </span><span class="default">$bindResult </span><span class="keyword">.= </span><span class="string">'$results["'</span><span class="keyword">.</span><span class="default">$columnName</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">.</span><span class="string">'"],'</span><span class="keyword">;<br />
}<br />
</span><span class="default">$bindResult </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$bindResult</span><span class="keyword">, </span><span class="string">','</span><span class="keyword">) . </span><span class="string">');'</span><span class="keyword">;<br />
eval(</span><span class="default">$bindResult</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The full reworked fetch_assoc code for reference:<br />
<span class="default">&lt;?php<br />
$mysqli </span><span class="keyword">= new </span><span class="default">mysqli</span><span class="keyword">(</span><span class="default">$dbHost</span><span class="keyword">, </span><span class="default">$dbUsername</span><span class="keyword">, </span><span class="default">$dbPassword</span><span class="keyword">, </span><span class="default">$dbDatabase</span><span class="keyword">);<br />
</span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">'select * from foobar'</span><span class="keyword">);<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">store_result</span><span class="keyword">();<br />
</span><span class="default">$meta </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">result_metadata</span><span class="keyword">();<br />
<br />
while (</span><span class="default">$column </span><span class="keyword">= </span><span class="default">$meta</span><span class="keyword">-&gt;</span><span class="default">fetch_field</span><span class="keyword">()) {<br />
&nbsp;&nbsp; </span><span class="default">$bindVarsArray</span><span class="keyword">[] = &amp;</span><span class="default">$results</span><span class="keyword">[</span><span class="default">$column</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">];<br />
}&nbsp; &nbsp; &nbsp; &nbsp; <br />
</span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">'bind_result'</span><span class="keyword">), </span><span class="default">$bindVarsArray</span><span class="keyword">);<br />
<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">();<br />
<br />
echo </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$results</span><span class="keyword">);<br />
</span><span class="comment">// outputs:<br />
// <br />
// array(3) {<br />
//&nbsp; ["id"]=&gt;<br />
//&nbsp; &amp;int(1)<br />
//&nbsp; ["foo"]=&gt;<br />
//&nbsp; &amp;string(11) "This is Foo"<br />
//&nbsp; ["bar"]=&gt;<br />
//&nbsp; &amp;string(11) "This is Bar"<br />
// }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70673""></a>
  <div class="note">
   <strong class="user">php at johnbaldock dot co dot uk</strong>
   <a href="#70673" class="date">23-Oct-2006 01:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wanted a simple way to get the equivalent of fetch_assoc when using a prepared statement. I came up with the following:<br />
<br />
<span class="default">&lt;?php<br />
$mysqli </span><span class="keyword">= new </span><span class="default">mysqli</span><span class="keyword">(</span><span class="default">$dbHost</span><span class="keyword">, </span><span class="default">$dbUsername</span><span class="keyword">, </span><span class="default">$dbPassword</span><span class="keyword">, </span><span class="default">$dbDatabase</span><span class="keyword">);<br />
</span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">'select * from foobar'</span><span class="keyword">);<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">store_result</span><span class="keyword">();<br />
</span><span class="default">$meta </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">result_metadata</span><span class="keyword">();<br />
<br />
</span><span class="comment">// the following creates a bind_result string with an argument for each column in the query<br />
// e.g. $stmt-&gt;bind_result($results["id"], $results["foo"], $results["bar"]);<br />
</span><span class="default">$bindResult </span><span class="keyword">= </span><span class="string">'$stmt-&gt;bind_result('</span><span class="keyword">;<br />
while (</span><span class="default">$columnName </span><span class="keyword">= </span><span class="default">$meta</span><span class="keyword">-&gt;</span><span class="default">fetch_field</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bindResult </span><span class="keyword">.= </span><span class="string">'$results["'</span><span class="keyword">.</span><span class="default">$columnName</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">.</span><span class="string">'"],'</span><span class="keyword">;<br />
}<br />
</span><span class="default">$bindResult </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$bindResult</span><span class="keyword">, </span><span class="string">','</span><span class="keyword">) . </span><span class="string">');'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// executes the bind_result string<br />
</span><span class="keyword">eval(</span><span class="default">$bindResult</span><span class="keyword">);<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">();<br />
<br />
echo </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$results</span><span class="keyword">);<br />
</span><span class="comment">// outputs:<br />
// <br />
// array(3) {<br />
//&nbsp;&nbsp; ["id"]=&gt;<br />
//&nbsp;&nbsp; &amp;int(1)<br />
//&nbsp;&nbsp; ["foo"]=&gt;<br />
//&nbsp;&nbsp; &amp;string(11) "This is Foo"<br />
//&nbsp;&nbsp; ["bar"]=&gt;<br />
//&nbsp;&nbsp; &amp;string(11) "This is Bar"<br />
// }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52316""></a>
  <div class="note">
   <strong class="user">andrey at php dot net</strong>
   <a href="#52316" class="date">27-Apr-2005 11:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
IMPORTANT note: Be careful when you use this function with big result sets or with BLOB/TEXT columns. When one or more columns are of type (MEDIUM|LONG)(BLOB|TEXT) and ::store_result() was not called mysqli_stmt_fetch() will try to allocate at least 16MB for every such column. It _doesn't_ matter that the longest value in the result set is for example 30 bytes, 16MB will be allocated. Therefore it is not the best idea ot use binding of parameters whenever fetching big data. Why? Because once the data is in the mysql result set stored in memory and then second time in the PHP variable.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="mysqli-stmt.execute.html">mysqli_stmt::execute</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="mysqli-stmt.field-count.html">mysqli_stmt::$field_count</a></div>
 <div class="up"><a href="class.mysqli-stmt.html">mysqli_stmt</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
