<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Decrypts data</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mcrypt-ofb.html">mcrypt_ofb</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="book.mhash.html">Mhash</a></div>
 <div class="up"><a href="ref.mcrypt.html">Mcrypt Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.mdecrypt-generic" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mdecrypt_generic</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.2, PHP 5)</p><p class="refpurpose"><span class="refname">mdecrypt_generic</span> &mdash; <span class="dc-title">Decrypts data</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.mdecrypt-generic-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><b>mdecrypt_generic</b></span>
    ( <span class="methodparam"><span class="type">resource</span> <tt class="parameter">$td</tt></span>
   , <span class="methodparam"><span class="type">string</span> <tt class="parameter">$data</tt></span>
   )</div>

  <p class="para rdfs-comment">
   This function decrypts data. Note that the length of the returned string
   can in fact be longer than the unencrypted string, due to the padding of
   the data.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mdecrypt-generic-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">td</tt></i></span>
     <dd>

      <p class="para">
       An encryption descriptor returned by
       <span class="function"><a href="function.mcrypt-module-open.html" class="function">mcrypt_module_open()</a></span>
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">data</tt></i></span>
     <dd>

      <p class="para">
       Encrypted data.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mdecrypt-generic-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-896">
    <p><b>Example #1 <span class="function"><b>mdecrypt_generic()</b></span> Example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Data&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'this&nbsp;is&nbsp;a&nbsp;very&nbsp;long&nbsp;key,&nbsp;even&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;cipher'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$plain_text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'very&nbsp;important&nbsp;data'</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Open&nbsp;module,&nbsp;and&nbsp;create&nbsp;IV&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$td&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_module_open</span><span style="color: #007700">(</span><span style="color: #DD0000">'des'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'ecb'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">mcrypt_enc_get_key_size</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$iv_size&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_enc_get_iv_size</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$iv&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_create_iv</span><span style="color: #007700">(</span><span style="color: #0000BB">$iv_size</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">MCRYPT_RAND</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Initialize&nbsp;encryption&nbsp;handle&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">mcrypt_generic_init</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$iv</span><span style="color: #007700">)&nbsp;!=&nbsp;-</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Encrypt&nbsp;data&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$c_t&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_generic</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$plain_text</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_generic_deinit</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Reinitialize&nbsp;buffers&nbsp;for&nbsp;decryption&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_generic_init</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$iv</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$p_t&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mdecrypt_generic</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$c_t</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Clean&nbsp;up&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_generic_deinit</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_module_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">strncmp</span><span style="color: #007700">(</span><span style="color: #0000BB">$p_t</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$plain_text</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$plain_text</span><span style="color: #007700">))&nbsp;==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"ok\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"error\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   The example above shows how to check if the data before the encryption is
   the same as the data after the decryption. It is very important to
   reinitialize the encryption buffer with
   <span class="function"><a href="function.mcrypt-generic-init.html" class="function">mcrypt_generic_init()</a></span> before you try to decrypt the
   data.
  </p>
  <p class="para">
   The decryption handle should always be initialized with
   <span class="function"><a href="function.mcrypt-generic-init.html" class="function">mcrypt_generic_init()</a></span> with a key and an IV before
   calling this function. Where the encryption is done, you should free the
   encryption buffers by calling <span class="function"><a href="function.mcrypt-generic-deinit.html" class="function">mcrypt_generic_deinit()</a></span>.
   See <span class="function"><a href="function.mcrypt-module-open.html" class="function">mcrypt_module_open()</a></span> for an example.
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mdecrypt-generic-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mcrypt-generic.html" class="function" rel="rdfs-seeAlso">mcrypt_generic()</a> - This function encrypts data</span></li>
    <li class="member"><span class="function"><a href="function.mcrypt-generic-init.html" class="function" rel="rdfs-seeAlso">mcrypt_generic_init()</a> - This function initializes all buffers needed for encryption</span></li>
    <li class="member"><span class="function"><a href="function.mcrypt-generic-deinit.html" class="function" rel="rdfs-seeAlso">mcrypt_generic_deinit()</a> - This function deinitializes an encryption module</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="98199""></a>
  <div class="note">
   <strong class="user">trashmail dot hashishin at gmail dot com</strong>
   <a href="#98199" class="date">01-Jun-2010 12:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Whenever you need to decrypt files encrypted with dot.net (and others?) you can use the following settings:<br />
<br />
Encryption: 'rijndael-256'<br />
Mode: 'cbc'<br />
Padding-Mode: Zeros<br />
iv: "yes"<br />
<br />
encode the data with base64 to send them to your php script</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89763""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#89763" class="date">21-Mar-2009 07:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a quick snippet for removing PKCS7 padding:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">unpadPKCS7</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$blockSize</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$length </span><span class="keyword">= </span><span class="default">strlen </span><span class="keyword">( </span><span class="default">$data </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$length </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$first </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">( </span><span class="default">$data</span><span class="keyword">, - </span><span class="default">1 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">ord </span><span class="keyword">( </span><span class="default">$first </span><span class="keyword">) &lt;= </span><span class="default">$blockSize</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">$length </span><span class="keyword">- </span><span class="default">2</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">--)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">ord </span><span class="keyword">( </span><span class="default">$data </span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] != </span><span class="default">$first </span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">substr </span><span class="keyword">( </span><span class="default">$data</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$i </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88812""></a>
  <div class="note">
   <strong class="user">nytro_rst at yahoo dot com</strong>
   <a href="#88812" class="date">09-Feb-2009 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">// Parameters:<br />
// $text = The text that you want to encrypt.<br />
// $key = The key you're using to encrypt.<br />
// $alg = The algorithm.<br />
// $crypt = 1 if you want to crypt, or 0 if you want to decrypt.<br />
<br />
</span><span class="keyword">function </span><span class="default">cryptare</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$alg</span><span class="keyword">, </span><span class="default">$crypt</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$encrypted_data</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$alg</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"3des"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'tripledes'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"cast-128"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'cast-128'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"gost"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'gost'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"rijndael-128"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'rijndael-128'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"twofish"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'twofish'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"arcfour"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'arcfour'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"cast-256"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'cast-256'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"loki97"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'loki97'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"rijndael-192"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'rijndael-192'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"saferplus"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'saferplus'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"wake"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'wake'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"blowfish-compat"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'blowfish-compat'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"des"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'des'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"rijndael-256"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'rijndael-256'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"xtea"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'xtea'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"enigma"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'enigma'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"rc2"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'rc2'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'blowfish'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'ecb'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$iv </span><span class="keyword">= </span><span class="default">mcrypt_create_iv</span><span class="keyword">(</span><span class="default">mcrypt_enc_get_iv_size</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">), </span><span class="default">MCRYPT_RAND</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">mcrypt_enc_get_key_size</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mcrypt_generic_init</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$iv</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$crypt</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encrypted_data </span><span class="keyword">= </span><span class="default">mcrypt_generic</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encrypted_data </span><span class="keyword">= </span><span class="default">mdecrypt_generic</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mcrypt_generic_deinit</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mcrypt_module_close</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$encrypted_data</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77153""></a>
  <div class="note">
   <strong class="user">Silvan</strong>
   <a href="#77153" class="date">17-Aug-2007 12:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is generally not recommended to just use rtrim to remove the padding.<br />
<br />
Use rtrim($str, "\0") for strings that do not end in "\0" or store the data length during encryption. <br />
(Although data containing "\0" sometimes gets corrupted during encryption so these types of data actually should be packed.)<br />
<br />
For example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">encrypt</span><span class="keyword">(</span><span class="default">$original_data</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$original_data</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data_to_encrypt </span><span class="keyword">= </span><span class="default">$length</span><span class="keyword">.</span><span class="string">'|'</span><span class="keyword">.</span><span class="default">$original_data</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Encrypt the data including its length. <br />
&nbsp;&nbsp;&nbsp; // Do not save the length unencrypted, as this could be a (minor) security risk<br />
</span><span class="keyword">}<br />
<br />
function </span><span class="default">decrypt</span><span class="keyword">(</span><span class="default">$cypher</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Decrypt the cypher data first<br />
&nbsp;&nbsp;&nbsp; // Next retrieve the original data<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$length</span><span class="keyword">, </span><span class="default">$padded_data</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'|'</span><span class="keyword">, </span><span class="default">$decrypted_data</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$original_data </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$padded_data</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70360""></a>
  <div class="note">
   <strong class="user">php at pcwize dot com</strong>
   <a href="#70360" class="date">12-Oct-2006 02:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just confirming the .DLL issues. With 4.3.4 you need the older .DLL. I'm guessing any version of PHP4 needs the older .DLL. With PHP5 you need the newer one.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54472""></a>
  <div class="note">
   <strong class="user">drew at expressdynamics dot com</strong>
   <a href="#54472" class="date">05-Jul-2005 10:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On Win32 systems with PHP 5, you must use the newer libmcrypt.dll file, otherwise mdecrypt_generic will not work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51238""></a>
  <div class="note">
   <strong class="user">robbie [at] averill [dot] co [dot] nz</strong>
   <a href="#51238" class="date">24-Mar-2005 03:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have noticed that sometimes when the binary ciphertext is longer than the plaintext, the decrypted plaintext can have some little boxes/squares next to it as 'padding'. I also noticed that you can't cut and paste them to be able to edit them out, but i did find a solution.<br />
<br />
Just call rtrim() around the string and it removes them.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41374""></a>
  <div class="note">
   <strong class="user">jon@jonroig dot com</strong>
   <a href="#41374" class="date">07-Apr-2004 07:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a bit of encrypt/decrypt code.<br />
<br />
If you're using this on the win32 platform, BEWARE! The latest DLL (19-Jan-2004) contains a bug that keeps mdecrypt_generic from functioning. Nearly drove me over the edge... The 30-Dec-2002 version seems to work with no trouble.<br />
&lt;?<br />
<br />
$key = "this is a secret key";<br />
$input = "Let us meet at 9 o'clock at the secret place.";<br />
<br />
$td = mcrypt_module_open('tripledes', '', 'ecb', '');<br />
$iv = mcrypt_create_iv (mcrypt_enc_get_iv_size($td), MCRYPT_RAND);<br />
mcrypt_generic_init($td, $key, $iv);<br />
$encrypted_data = mcrypt_generic($td, $input);<br />
mcrypt_generic_deinit($td);<br />
mcrypt_module_close($td);<br />
<br />
echo "Encrypt: ".$encrypted_data;<br />
<br />
echo "&lt;br&gt;&lt;br&gt;";<br />
<br />
$td = mcrypt_module_open('tripledes', '', 'ecb', '');<br />
$iv = mcrypt_create_iv (mcrypt_enc_get_iv_size($td), MCRYPT_RAND);<br />
$key = substr($key, 0, mcrypt_enc_get_key_size($td));<br />
mcrypt_generic_init($td, $key, $iv);<br />
$decrypted_data = mdecrypt_generic($td, $encrypted_data);<br />
echo "Decrypt: ".$decrypted_data;<br />
mcrypt_generic_deinit($td);<br />
mcrypt_module_close($td);<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mcrypt-ofb.html">mcrypt_ofb</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="book.mhash.html">Mhash</a></div>
 <div class="up"><a href="ref.mcrypt.html">Mcrypt Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
