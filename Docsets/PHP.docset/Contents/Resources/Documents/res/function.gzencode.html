<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Create a gzip compressed string</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.gzdeflate.html">gzdeflate</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.gzeof.html">gzeof</a></div>
 <div class="up"><a href="ref.zlib.html">Zlib Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.gzencode" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">gzencode</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.4, PHP 5)</p><p class="refpurpose"><span class="refname">gzencode</span> &mdash; <span class="dc-title">Create a gzip compressed string</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.gzencode-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><b>gzencode</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$data</tt></span>
   [, <span class="methodparam"><span class="type">int</span> <tt class="parameter">$level</tt><span class="initializer"> = -1</span></span>
   [, <span class="methodparam"><span class="type">int</span> <tt class="parameter">$encoding_mode</tt><span class="initializer"> = FORCE_GZIP</span></span>
  ]] )</div>

  <p class="para rdfs-comment">   
   This function returns a compressed version of the input
   <i><tt class="parameter">data</tt></i> compatible with the output of the
   <strong class="command">gzip</strong> program.
  </p>
  <p class="para">
   For more information on the GZIP file format, see the document:
   <a href="http://www.faqs.org/rfcs/rfc1952" class="link external" title="Link : http://www.faqs.org/rfcs/rfc1952">&raquo;&nbsp;GZIP file format specification
   version 4.3</a> (RFC 1952).
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.gzencode-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">data</tt></i></span>
     <dd>

      <p class="para">
       The data to encode.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">level</tt></i></span>
     <dd>

      <p class="para">
       The level of compression. Can be given as 0 for no compression up to 9
       for maximum compression. If not given, the default compression level will
       be the default compression level of the zlib library.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">encoding_mode</tt></i></span>
     <dd>

      <p class="para">
       The encoding mode. Can be <b><tt>FORCE_GZIP</tt></b> (the default)
       or <b><tt>FORCE_DEFLATE</tt></b>. 
      </p>
      <p class="para">
       If you use <b><tt>FORCE_DEFLATE</tt></b>, you get a standard zlib
       deflated string (inclusive zlib headers) after the gzip file header but
       without the trailing crc32 checksum.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.gzencode-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   The encoded string, or <b><tt>FALSE</tt></b> if an error occurred.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.gzencode-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">4.2.0</td>
       <td align="left">
        The <i><tt class="parameter">encoding_mode</tt></i> parameter was added
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.gzencode-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   The resulting data contains the appropriate headers and data
   structure to make a standard .gz file, e.g.:
   <div class="example" id="example-857">
    <p><b>Example #1 Creating a gzip file</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">file</span><span style="color: #007700">(</span><span style="color: #DD0000">"bigfile.txt"</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">$gzdata&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">gzencode</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">9</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"bigfile.txt.gz"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"w"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$gzdata</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.gzencode-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.gzdecode.html" class="function" rel="rdfs-seeAlso">gzdecode()</a> - Decodes a gzip compressed string</span></li>
    <li class="member"><span class="function"><a href="function.gzdeflate.html" class="function" rel="rdfs-seeAlso">gzdeflate()</a> - Deflate a string</span></li>
    <li class="member"><span class="function"><a href="function.gzinflate.html" class="function" rel="rdfs-seeAlso">gzinflate()</a> - Inflate a deflated string</span></li>
    <li class="member"><span class="function"><a href="function.gzuncompress.html" class="function" rel="rdfs-seeAlso">gzuncompress()</a> - Uncompress a compressed string</span></li>
    <li class="member"><span class="function"><a href="function.gzcompress.html" class="function" rel="rdfs-seeAlso">gzcompress()</a> - Compress a string</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="105498""></a>
  <div class="note">
   <strong class="user">geompse at gmail dot com</strong>
   <a href="#105498" class="date">22-Aug-2011 03:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Had some trouble finding the correct way to send a Content-Length header with HTTP compression.<br />
The pitch is to use gzencode (not gzdeflaten not gzcompress).<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// disable ZLIB ouput compression<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'zlib.output_compression'</span><span class="keyword">,</span><span class="string">'Off'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// compress data<br />
</span><span class="default">$gzipoutput </span><span class="keyword">= </span><span class="default">gzencode</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">);<br />
<br />
</span><span class="comment">// various headers, those with # are mandatory<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: application/x-download'</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Encoding: gzip'</span><span class="keyword">); </span><span class="comment">#<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Length: '</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$gzipoutput</span><span class="keyword">)); </span><span class="comment">#<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Disposition: attachment; filename="myfile.name"'</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Cache-Control: no-cache, no-store, max-age=0, must-revalidate'</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Pragma: no-cache'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// output data<br />
</span><span class="keyword">echo </span><span class="default">$gzipoutput</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104772""></a>
  <div class="note">
   <strong class="user">Sam Dowling</strong>
   <a href="#104772" class="date">06-Jul-2011 07:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this is a benchmark test of gzencode (.txt file)<br />
----------------------------------------------<br />
original file size = 3.29 MB (3,459,978 bytes)<br />
compress lvl 1 = 1.09 MB (1,144,006 bytes)<br />
compress lvl 2 = 1.06 MB (1,119,518 bytes)<br />
compress lvl 3 = 1.03 MB (1,085,567 bytes)<br />
compress lvl 4 = 953 KB (976,538 bytes)<br />
compress lvl 5 = 909 KB (931,486 bytes)<br />
compress lvl 6 = 910 KB (932,516 bytes)<br />
compress lvl 7 = 910 KB (932,608 bytes)<br />
compress lvl 8 = 910 KB (932,646 bytes)<br />
compress lvl 9 = 910 KB (932,652 bytes)<br />
----------------------------------------------</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88435""></a>
  <div class="note">
   <strong class="user">getmequick at dot com</strong>
   <a href="#88435" class="date">23-Jan-2009 12:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
NOTE:<br />
<br />
doing like this and so on<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; file_put_contents</span><span class="keyword">(</span><span class="string">'output.gz'</span><span class="keyword">, </span><span class="default">gzencode</span><span class="keyword">( </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'input.file'</span><span class="keyword">),</span><span class="default">9</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
(complete file reading)<br />
<br />
may cause memory overflow (Fatal error: Allowed memory size of ..), so it's better to read by parts/bytes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82880""></a>
  <div class="note">
   <strong class="user">katzlbtjunk at hotmail dot com</strong>
   <a href="#82880" class="date">30-Apr-2008 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Aaron G. 07-Aug-2004 03:29 posted the excellent function gzdecode() (SEE BELOW)<br />
BUGFIX: Change: if($flags &amp; 1) to ... if($flags &amp; 2)<br />
<br />
Unfortunately the function gzencode() does NOT append a CRC! So the previous version worked with output of gzencode but not with output of the gzip program itself.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82520""></a>
  <div class="note">
   <strong class="user">gazj at nukemodified dot com</strong>
   <a href="#82520" class="date">14-Apr-2008 05:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here is my clean up of supaplex %at% pcbkits %d0t% c0m<br />
submission above.<br />
<br />
function alt_gzdecode($gzdatadecode) {<br />
&nbsp; // seed with microseconds since last "whole" second.<br />
&nbsp; mt_srand((float)microtime()*1000000);<br />
&nbsp; $eh="/tmp/php-" . md5(mt_rand(0,mt_getrandmax())) . ".gz";<br />
&nbsp; if(file_exists($eh)){<br />
<br />
&nbsp; $gzf=fopen($eh,"w");<br />
&nbsp; fwrite($gzf,$gzdatadecode);<br />
&nbsp; fclose($gzf);<br />
<br />
&nbsp; $gzf = gzopen ($eh, "r");<br />
&nbsp; $gzdatadecode=gzpassthru($gzf);<br />
&nbsp; unlink($eh);<br />
<br />
&nbsp; return $gzdatadecode;<br />
&nbsp; }else{<br />
&nbsp; return 'File '.$eh.' was not found.';<br />
&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68632""></a>
  <div class="note">
   <strong class="user">cbrunon at free dot fr</strong>
   <a href="#68632" class="date">03-Aug-2006 06:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Correct is:<br />
<span class="default">&lt;?php<br />
&nbsp; file_put_contents</span><span class="keyword">(</span><span class="string">'output.gz'</span><span class="keyword">, </span><span class="default">gzencode</span><span class="keyword">( </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'input.file'</span><span class="keyword">),</span><span class="default">9</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44470""></a>
  <div class="note">
   <strong class="user">Aaron G.</strong>
   <a href="#44470" class="date">06-Aug-2004 06:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">gzdecode</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp; if (</span><span class="default">$len </span><span class="keyword">&lt; </span><span class="default">18 </span><span class="keyword">|| </span><span class="default">strcmp</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">),</span><span class="string">"\x1f\x8b"</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">null</span><span class="keyword">;&nbsp; </span><span class="comment">// Not GZIP format (See RFC 1952)<br />
&nbsp; </span><span class="keyword">}<br />
&nbsp; </span><span class="default">$method </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));&nbsp; </span><span class="comment">// Compression method<br />
&nbsp; </span><span class="default">$flags&nbsp; </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));&nbsp; </span><span class="comment">// Flags<br />
&nbsp; </span><span class="keyword">if (</span><span class="default">$flags </span><span class="keyword">&amp; </span><span class="default">31 </span><span class="keyword">!= </span><span class="default">$flags</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Reserved bits are set -- NOT ALLOWED by RFC 1952<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">null</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; </span><span class="comment">// NOTE: $mtime may be negative (PHP integer limitations)<br />
&nbsp; </span><span class="default">$mtime </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"V"</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$mtime </span><span class="keyword">= </span><span class="default">$mtime</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp; </span><span class="default">$xfl&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$os&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$headerlen </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$extralen&nbsp; </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$extra&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">$flags </span><span class="keyword">&amp; </span><span class="default">4</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// 2-byte length prefixed EXTRA data in header<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$len </span><span class="keyword">- </span><span class="default">$headerlen </span><span class="keyword">- </span><span class="default">2 </span><span class="keyword">&lt; </span><span class="default">8</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Invalid format<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$extralen </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"v"</span><span class="keyword">,</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$extralen </span><span class="keyword">= </span><span class="default">$extralen</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$len </span><span class="keyword">- </span><span class="default">$headerlen </span><span class="keyword">- </span><span class="default">2 </span><span class="keyword">- </span><span class="default">$extralen </span><span class="keyword">&lt; </span><span class="default">8</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Invalid format<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$extra </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">,</span><span class="default">$extralen</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headerlen </span><span class="keyword">+= </span><span class="default">2 </span><span class="keyword">+ </span><span class="default">$extralen</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="default">$filenamelen </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">$flags </span><span class="keyword">&amp; </span><span class="default">8</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// C-style string file NAME data in header<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$len </span><span class="keyword">- </span><span class="default">$headerlen </span><span class="keyword">- </span><span class="default">1 </span><span class="keyword">&lt; </span><span class="default">8</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Invalid format<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filenamelen </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">+</span><span class="default">$extralen</span><span class="keyword">),</span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$filenamelen </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">|| </span><span class="default">$len </span><span class="keyword">- </span><span class="default">$headerlen </span><span class="keyword">- </span><span class="default">$filenamelen </span><span class="keyword">- </span><span class="default">1 </span><span class="keyword">&lt; </span><span class="default">8</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Invalid format<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">$headerlen</span><span class="keyword">,</span><span class="default">$filenamelen</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headerlen </span><span class="keyword">+= </span><span class="default">$filenamelen </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="default">$commentlen </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$comment </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">$flags </span><span class="keyword">&amp; </span><span class="default">16</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// C-style string COMMENT data in header<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$len </span><span class="keyword">- </span><span class="default">$headerlen </span><span class="keyword">- </span><span class="default">1 </span><span class="keyword">&lt; </span><span class="default">8</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Invalid format<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$commentlen </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">+</span><span class="default">$extralen</span><span class="keyword">+</span><span class="default">$filenamelen</span><span class="keyword">),</span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$commentlen </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">|| </span><span class="default">$len </span><span class="keyword">- </span><span class="default">$headerlen </span><span class="keyword">- </span><span class="default">$commentlen </span><span class="keyword">- </span><span class="default">1 </span><span class="keyword">&lt; </span><span class="default">8</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Invalid header format<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$comment </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">$headerlen</span><span class="keyword">,</span><span class="default">$commentlen</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headerlen </span><span class="keyword">+= </span><span class="default">$commentlen </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="default">$headercrc </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">$flags </span><span class="keyword">&amp; </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// 2-bytes (lowest order) of CRC32 on header present<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$len </span><span class="keyword">- </span><span class="default">$headerlen </span><span class="keyword">- </span><span class="default">2 </span><span class="keyword">&lt; </span><span class="default">8</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Invalid format<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$calccrc </span><span class="keyword">= </span><span class="default">crc32</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$headerlen</span><span class="keyword">)) &amp; </span><span class="default">0xffff</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headercrc </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"v"</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">$headerlen</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headercrc </span><span class="keyword">= </span><span class="default">$headercrc</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$headercrc </span><span class="keyword">!= </span><span class="default">$calccrc</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Bad header CRC<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headerlen </span><span class="keyword">+= </span><span class="default">2</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="comment">// GZIP FOOTER - These be negative due to PHP's limitations<br />
&nbsp; </span><span class="default">$datacrc </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"V"</span><span class="keyword">,</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,-</span><span class="default">8</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$datacrc </span><span class="keyword">= </span><span class="default">$datacrc</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp; </span><span class="default">$isize </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"V"</span><span class="keyword">,</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,-</span><span class="default">4</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$isize </span><span class="keyword">= </span><span class="default">$isize</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
<br />
&nbsp; </span><span class="comment">// Perform the decompression:<br />
&nbsp; </span><span class="default">$bodylen </span><span class="keyword">= </span><span class="default">$len</span><span class="keyword">-</span><span class="default">$headerlen</span><span class="keyword">-</span><span class="default">8</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">$bodylen </span><span class="keyword">&lt; </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// This should never happen - IMPLEMENTATION BUG!<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">null</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">$headerlen</span><span class="keyword">,</span><span class="default">$bodylen</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">$bodylen </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">$method</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="default">8</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Currently the only supported compression method:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">gzinflate</span><span class="keyword">(</span><span class="default">$body</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Unknown compression method<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// I'm not sure if zero-byte body content is allowed.<br />
&nbsp;&nbsp;&nbsp; // Allow it for now...&nbsp; Do nothing...<br />
&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp; </span><span class="comment">// Verifiy decompressed size and CRC32:<br />
&nbsp; // NOTE: This may fail with large data sizes depending on how<br />
&nbsp; //&nbsp; &nbsp; &nbsp;&nbsp; PHP's integer limitations affect strlen() since $isize<br />
&nbsp; //&nbsp; &nbsp; &nbsp;&nbsp; may be negative for large sizes.<br />
&nbsp; </span><span class="keyword">if (</span><span class="default">$isize </span><span class="keyword">!= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) || </span><span class="default">crc32</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) != </span><span class="default">$datacrc</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Bad format!&nbsp; Length or CRC doesn't match!<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20411""></a>
  <div class="note">
   <strong class="user">tychay at alumni dot caltech dot edu</strong>
   <a href="#20411" class="date">03-Apr-2002 02:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The 10 byte string in gzencode is the standard gzip header. The first two bytes (1f 8b) define the return as a gzip file, the third byte (08) means that the body is compressed using the "deflate" algorithm. The rest is padding (00)'s.<br />
<br />
Technically, I believe one should check if the third byte is hex 08 and if so strip off the first ten bytes and last four bytes and run inflate on it. The last four bytes are file size and checksum bits.<br />
<br />
In practice, you can get away with just stripping the first 10 bytes and running inflate on it.<br />
<br />
Hope this helps,<br />
<br />
terry</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19074""></a>
  <div class="note">
   <strong class="user">henryk at ploetzli dot ch</strong>
   <a href="#19074" class="date">14-Feb-2002 06:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well, I was looking for a gzdecode too and didn't consider the temporary file example above to be very elegant. <br />
However, as is noted in the very first comment: gzencode() only adds a&nbsp; 10 byte header. <br />
<br />
I don't quite know what this header is supposed to be used for, but gzinflate() certainly doesn't like it, so I stripped it off:<br />
<br />
function my_gzdecode($string) {<br />
&nbsp; $string = substr($string, 10);<br />
&nbsp; return gzinflate($string);<br />
&nbsp;}<br />
<br />
That's useful to read HTTP-Connections that were compressed by mod_gzip.<br />
-- <br />
Henryk Plötz<br />
Grüße aus Berlin</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="15411""></a>
  <div class="note">
   <strong class="user">mm.. oops? - amendum (yes, tested hehe.)</strong>
   <a href="#15411" class="date">09-Sep-2001 12:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function alt_gzdecode($str) {<br />
&nbsp; // seed with microseconds since last "whole" second<br />
&nbsp; mt_srand((float)microtime()*1000000);<br />
&nbsp; $eh="/tmp/php-" . md5(mt_rand(0,mt_getrandmax())) . ".gz";<br />
<br />
&nbsp; $fd=fopen($eh,"w");<br />
&nbsp; fwrite($fd,$str);<br />
&nbsp; fclose($fd);<br />
<br />
&nbsp; unset($str);<br />
<br />
&nbsp; $fd = gzopen ($eh, "r");<br />
&nbsp; while (1==1) {<br />
&nbsp;&nbsp;&nbsp; $s=gzread($fd,10240);<br />
&nbsp;&nbsp;&nbsp; if ("$s" == "") {<br />
&nbsp;&nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $str=$str . $s;<br />
&nbsp; }<br />
&nbsp; unlink($eh);<br />
<br />
&nbsp; return $str;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="15410""></a>
  <div class="note">
   <strong class="user">&lt; supaplex %at% pcbkits %d0t% c0m &gt;</strong>
   <a href="#15410" class="date">08-Sep-2001 11:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was almost discouraged when I didn't find a gzdecode() function!&nbsp; However, fear not, for I'll contribute my work... :)<br />
function alt_gzdecode($str) {<br />
&nbsp; // seed with microseconds since last "whole" second.<br />
&nbsp; mt_srand((float)microtime()*1000000);<br />
&nbsp; $eh="/tmp/php-" . md5(mt_rand(0,mt_getrandmax())) . ".gz";<br />
<br />
<br />
&nbsp; $fd=fopen($eh,"w");<br />
&nbsp; fwrite($fd,$str);<br />
&nbsp; fclose($fd);<br />
<br />
&nbsp; $fd = gzopen ($eh, "r");<br />
&nbsp; $str=gzpassthru($fd);<br />
&nbsp; unlink($eh);<br />
<br />
&nbsp; return $str;<br />
}<br />
<br />
It's only ugly point is that it does not check to see if the file already exists.&nbsp; You may also have to adjust reference names like $str and $fd if they stomp on your code. (Sorry, but this is all you get atm! ;} )&nbsp; If your conserned about a race condition, cry for a internal gzdecode() function that actualy functions...<br />
I spent about 3 hours straight debugging this problem.&nbsp; I know the input data was valid, becuase I validated it with MD5() to compare to the md5's I had made of the input data before hand.&nbsp; I'm not sure whats up with gzuncompress or gzinflate, but this works in its place . . .<br />
<br />
Enjoy!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.gzdeflate.html">gzdeflate</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.gzeof.html">gzeof</a></div>
 <div class="up"><a href="ref.zlib.html">Zlib Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
