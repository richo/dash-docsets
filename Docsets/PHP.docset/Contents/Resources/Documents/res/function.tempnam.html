<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Create file with unique file name</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.symlink.html">symlink</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.tmpfile.html">tmpfile</a></div>
 <div class="up"><a href="ref.filesystem.html">Filesystem Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.tempnam" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">tempnam</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">tempnam</span> &mdash; <span class="dc-title">Create file with unique file name</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.tempnam-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><b>tempnam</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$dir</tt></span>
   , <span class="methodparam"><span class="type">string</span> <tt class="parameter">$prefix</tt></span>
   )</div>

  <p class="para rdfs-comment">
   Creates a file with a unique filename, with access permission set to 0600, in the specified directory.
   If the directory does not exist, <span class="function"><b>tempnam()</b></span> may
   generate a file in the system&#039;s temporary directory, and return
   the name of that.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.tempnam-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">dir</tt></i></span>
     <dd>

      <p class="para">
       The directory where the temporary filename will be created.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">prefix</tt></i></span>
     <dd>

      <p class="para">
       The prefix of the generated temporary filename.
      </p>
      <blockquote class="note"><p><b class="note">Note</b>: 
       <span class="simpara">
        Windows uses only the first three characters of prefix.
       </span>
      </p></blockquote>
     </dd>

    </dt>

   </dl>

  </p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-function.tempnam-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the new temporary filename, or <b><tt>FALSE</tt></b> on
   failure.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.tempnam-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">4.0.6</td>
       <td align="left">
        Prior to PHP 4.0.6, the behaviour of the
        <span class="function"><b>tempnam()</b></span> function was system dependent. On
        Windows the <var class="varname"><var class="varname">TMP</var></var> environment variable will override the
        <i><tt class="parameter">dir</tt></i> parameter, on Linux the <var class="varname"><var class="varname">TMPDIR</var></var>
        environment variable has precedence, while SVR4 will always use
        your <i><tt class="parameter">dir</tt></i> parameter if the directory it
        points to exists. Consult your system documentation on the
        tempnam(3) function if in doubt.
       </td>
      </tr>

      <tr valign="middle">
       <td align="left">4.0.3</td>
       <td align="left">
        This function&#039;s behavior changed in 4.0.3. The temporary file is also
        created to avoid a race condition where the file might appear in the
        filesystem between the time the string was generated and before
        the script gets around to creating the file. Note, that you need
        to remove the file in case you need it no more, it is not done
        automatically.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.tempnam-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-2230">
    <p><b>Example #1 <span class="function"><b>tempnam()</b></span> example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$tmpfname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">tempnam</span><span style="color: #007700">(</span><span style="color: #DD0000">"/tmp"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"FOO"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$handle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #0000BB">$tmpfname</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"w"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$handle</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"writing&nbsp;to&nbsp;tempfile"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$handle</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;do&nbsp;here&nbsp;something<br /><br /></span><span style="color: #0000BB">unlink</span><span style="color: #007700">(</span><span style="color: #0000BB">$tmpfname</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.tempnam-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <span class="simpara">
    If PHP cannot create a file in the specified <i><tt class="parameter">dir</tt></i>
    parameter, it falls back on the system default. On NTFS this also happens
    if the specified <i><tt class="parameter">dir</tt></i> contains more than 65534 files.
   </span>
  </p></blockquote>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-function.tempnam-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.tmpfile.html" class="function" rel="rdfs-seeAlso">tmpfile()</a> - Creates a temporary file</span></li>
    <li class="member"><span class="function"><a href="function.sys-get-temp-dir.html" class="function" rel="rdfs-seeAlso">sys_get_temp_dir()</a> - Returns directory path used for temporary files</span></li>
    <li class="member"><span class="function"><a href="function.unlink.html" class="function" rel="rdfs-seeAlso">unlink()</a> - Deletes a file</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="102550""></a>
  <div class="note">
   <strong class="user">ayalsule at gmail dot com</strong>
   <a href="#102550" class="date">21-Feb-2011 12:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* create a temp file alternative to tempnam() because this functions disabled for security reasons <br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">ayham_tempnam</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">,</span><span class="default">$prefix</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$name </span><span class="keyword">= </span><span class="default">$prefix</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">time</span><span class="keyword">().</span><span class="default">rand</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98232""></a>
  <div class="note">
   <strong class="user">tomas at slax dot org</strong>
   <a href="#98232" class="date">03-Jun-2010 02:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware: functions are not atomic.&nbsp; If many processes call the same function at the same time, you may end up with unwanted behavior.<br />
<br />
If you need your own variant of tempnam, use something like this:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">tempnam_sfx</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$suffix</span><span class="keyword">)<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; do<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">$path</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">mt_rand</span><span class="keyword">().</span><span class="default">$suffix</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'x'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; while(!</span><span class="default">$fp</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; </span><span class="comment">// call it like this:<br />
&nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">tempnam_sfx</span><span class="keyword">(</span><span class="string">"/tmp"</span><span class="keyword">, </span><span class="string">".jpg"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
You may replace mt_rand() by some other random name generator, if needed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97179""></a>
  <div class="note">
   <strong class="user">anthon at piwik dot org</strong>
   <a href="#97179" class="date">06-Apr-2010 04:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The file created by tempnam() will have file permissions that reflect the current umask applied to the default (e.g., 0600 or -rw-------).&nbsp; This is the case whether the umask is set before starting the web server process, or set by an earlier call to PHP's umask() function.<br />
<br />
For example, if the current umask is 0022, the temporary file is created with permissions 0600 (read/write by owner).<br />
<br />
Also, if the current umask is 0222, the temporary file is created with permissions 0400 (read-only by owner).&nbsp; (This is problematic if your code then tries to open the temporary file for writing.)<br />
<br />
It's important to remember that the umask revokes permissions.&nbsp; In neither of the above examples are the group, other, or execute permissions set.<br />
<br />
See:&nbsp; umask(), chmod().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97086""></a>
  <div class="note">
   <strong class="user">Artur Graniszewski</strong>
   <a href="#97086" class="date">31-Mar-2010 10:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
tempnam() function does not support custom stream wrappers registered by stream_register_wrapper(). <br />
<br />
For example if you'll try to use tempnam() on Windows platform, PHP will try to generate unique filename in %TMP% folder (usually: C:\WINDOWS\Temp) without any warning or notice.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// &lt;&lt; ...custom stream wrapper goes somewhere here...&gt;&gt;<br />
<br />
</span><span class="keyword">echo </span><span class="string">'&lt;pre&gt;'</span><span class="keyword">;<br />
</span><span class="default">error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'display_errors'</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">clearstatcache</span><span class="keyword">();<br />
</span><span class="default">stream_register_wrapper</span><span class="keyword">(</span><span class="string">'test'</span><span class="keyword">, </span><span class="string">'MemoryStream'</span><span class="keyword">);<br />
<br />
</span><span class="default">mkdir</span><span class="keyword">(</span><span class="string">'test://aaa'</span><span class="keyword">);<br />
</span><span class="default">mkdir</span><span class="keyword">(</span><span class="string">'test://aaa/cc'</span><span class="keyword">);<br />
</span><span class="default">mkdir</span><span class="keyword">(</span><span class="string">'test://aaa/dd'</span><span class="keyword">); <br />
echo </span><span class="string">'PHP '</span><span class="keyword">.</span><span class="default">PHP_VERSION</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;br /&gt;node exists: '</span><span class="keyword">.</span><span class="default">file_exists</span><span class="keyword">(</span><span class="string">'test://aaa/cc'</span><span class="keyword">);<br />
echo </span><span class="string">'&lt;br /&gt;node is writable: '</span><span class="keyword">.</span><span class="default">is_writable</span><span class="keyword">(</span><span class="string">'test://aaa/cc'</span><span class="keyword">);<br />
echo </span><span class="string">'&lt;br /&gt;node is dir: '</span><span class="keyword">.</span><span class="default">is_dir</span><span class="keyword">(</span><span class="string">'test://aaa/cc'</span><span class="keyword">);<br />
echo </span><span class="string">'&lt;br /&gt;tempnam in dir: '</span><span class="keyword">.</span><span class="default">tempnam</span><span class="keyword">(</span><span class="string">'test://aaa/cc'</span><span class="keyword">, </span><span class="string">'tmp'</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;br /&gt;&lt;/pre&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
ouputs:<br />
--------------------<br />
PHP 5.2.13<br />
node exists: 1<br />
node is writable: 1<br />
node is dir: 1<br />
tempnam in dir: C:\Windows\Temp\tmp1D03.tmp<br />
<br />
If you want to create temporary file, you have to create your own function (which will probably use opendir() and fopen($filename, "x") functions)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96027""></a>
  <div class="note">
   <strong class="user">Chris</strong>
   <a href="#96027" class="date">03-Feb-2010 01:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed a function that allowed me to specify a filename suffix and a longer prefix:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">my_tempnam</span><span class="keyword">(</span><span class="default">$prefix </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$suffix </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">func_num_args</span><span class="keyword">() &gt; </span><span class="default">3 </span><span class="keyword">and exit(</span><span class="default">__FUNCTION__</span><span class="keyword">.</span><span class="string">'(): passed '</span><span class="keyword">.</span><span class="default">func_num_args</span><span class="keyword">().</span><span class="string">' args, should pass 0, 1, 2, or 3 args.&nbsp; Usage: '</span><span class="keyword">.</span><span class="default">__FUNCTION__</span><span class="keyword">.</span><span class="string">'(optional filename prefix, optional filename suffix, optional directory)'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prefix </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$prefix</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$suffix </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$suffix</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; empty(</span><span class="default">$dir</span><span class="keyword">) and </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">sys_get_temp_dir</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; empty(</span><span class="default">$dir</span><span class="keyword">) and exit(</span><span class="default">__FUNCTION__</span><span class="keyword">.</span><span class="string">'(): could not get system temp dir'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">) or exit(</span><span class="default">__FUNCTION__</span><span class="keyword">.</span><span class="string">"(): \"</span><span class="default">$dir</span><span class="string">\" is not a directory"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//&nbsp; &nbsp; posix valid filename characters. exclude "similar" characters 0, O, 1, l, I to enhance readability. add - _<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fn_chars </span><span class="keyword">= </span><span class="default">array_flip</span><span class="keyword">(</span><span class="default">array_diff</span><span class="keyword">(</span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">range</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">,</span><span class="default">57</span><span class="keyword">), </span><span class="default">range</span><span class="keyword">(</span><span class="default">65</span><span class="keyword">,</span><span class="default">90</span><span class="keyword">), </span><span class="default">range</span><span class="keyword">(</span><span class="default">97</span><span class="keyword">,</span><span class="default">122</span><span class="keyword">), array(</span><span class="default">95</span><span class="keyword">,</span><span class="default">45</span><span class="keyword">)), array(</span><span class="default">73</span><span class="keyword">,</span><span class="default">79</span><span class="keyword">,</span><span class="default">108</span><span class="keyword">)));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//&nbsp; create random filename 20 chars long for security<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$fn </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">) . </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$prefix</span><span class="keyword">, </span><span class="default">$loop </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++ &lt; </span><span class="default">20</span><span class="keyword">; </span><span class="default">$fn </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">array_rand</span><span class="keyword">(</span><span class="default">$fn_chars</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">.</span><span class="default">$suffix</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fn </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">array_rand</span><span class="keyword">(</span><span class="default">$fn_chars</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$loop</span><span class="keyword">++ &gt; </span><span class="default">10 </span><span class="keyword">and exit(</span><span class="default">__FUNCTION__</span><span class="keyword">.</span><span class="string">"(): looped too many times trying to create a unique file name in directory \"</span><span class="default">$dir</span><span class="string">\""</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">clearstatcache</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fn </span><span class="keyword">= </span><span class="default">$fn</span><span class="keyword">.</span><span class="default">$suffix</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">touch</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">) or exit(</span><span class="default">__FUNCTION__</span><span class="keyword">.</span><span class="string">"(): could not create tmp file \"</span><span class="default">$fn</span><span class="string">\""</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$fn</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93256""></a>
  <div class="note">
   <strong class="user">koyama</strong>
   <a href="#93256" class="date">30-Aug-2009 05:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Watch out using a blank $dir as a "trick" to create temporary files in the system temporary directory.<br />
<br />
<span class="default">&lt;?php<br />
$tmpfname </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">, </span><span class="string">'FOO'</span><span class="keyword">); </span><span class="comment">// not good<br />
</span><span class="default">?&gt;<br />
</span><br />
If an open_basedir restriction is in effect, the trick will not work. You will get a warning message like<br />
<br />
Warning: tempnam() [function.tempnam]: open_basedir restriction in effect.<br />
File() is not within the allowed path(s): (/var/www/vhosts/example.com/httpdocs:/tmp)<br />
<br />
What works is this:<br />
<br />
<span class="default">&lt;?php<br />
$tmpfname </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="default">sys_get_temp_dir</span><span class="keyword">(), </span><span class="string">'FOO'</span><span class="keyword">); </span><span class="comment">// good<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88544""></a>
  <div class="note">
   <strong class="user">hm2k at php dot net</strong>
   <a href="#88544" class="date">28-Jan-2009 09:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">tempdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">,</span><span class="default">$prefix</span><span class="keyword">=</span><span class="string">'php'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tempfile</span><span class="keyword">=</span><span class="default">tempnam</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$tempfile</span><span class="keyword">)) { </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$tempfile</span><span class="keyword">); }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$tempfile</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$tempfile</span><span class="keyword">)) { return </span><span class="default">$tempfile</span><span class="keyword">; }<br />
}<br />
<br />
</span><span class="comment">/*example*/<br />
<br />
</span><span class="keyword">echo </span><span class="default">tempdir</span><span class="keyword">();<br />
</span><span class="comment">// returns: /tmp/8e9MLi<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78245""></a>
  <div class="note">
   <strong class="user">flat at serverart dot com</strong>
   <a href="#78245" class="date">04-Oct-2007 03:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that in between 5.2.2 and 5.2.4 tempnam() changed how it handles a relative path:<br />
<br />
In 5.2.2:<br />
$file=tempnam('tmpdownload', 'Ergebnis_'.date(Y.m.d).'_').'.pdf';<br />
echo $file;<br />
tmpdownload/Ergebnis_20071004_xTfKzz.pdf<br />
<br />
In 5.2.4:<br />
$file=tempnam('tmpdownload', 'Ergebnis_'.date(Y.m.d).'_').'.pdf';<br />
echo $file;<br />
/var/www/html/tmpdownload/Ergebnis_20071004_Xbn6PY.pdf<br />
<br />
This broke quite a lot of our webpages as we try to display those pdfs (and other files) via the webbrowser and the resulting URI is of course invalid and gets the user a 404 page.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77547""></a>
  <div class="note">
   <strong class="user">dmhouse at gmail dot com</strong>
   <a href="#77547" class="date">03-Sep-2007 03:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Guillaume Paramelle's comments below are worth underlining: tempnam() will not accept a relative path for its first directory. If you pass it one, it will (on Windows XP at least) create the temporary file in the system temp directory.<br />
<br />
The easiest way to convert a relative path to an absolute path is to prepend getcwd():<br />
<br />
<span class="default">&lt;?php<br />
$file </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="string">'files/temp'</span><span class="keyword">, </span><span class="string">'tmp'</span><span class="keyword">); </span><span class="comment">// Wrong!<br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="default">getcwd</span><span class="keyword">() . </span><span class="string">'files/tmp'</span><span class="keyword">, </span><span class="string">'tmp'</span><span class="keyword">) </span><span class="comment">// Right.<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72304""></a>
  <div class="note">
   <strong class="user">Jason Pell</strong>
   <a href="#72304" class="date">12-Jan-2007 04:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I want to guarantee that the file will be created in the specified directory or else the function should return FALSE, I have a simple function that works, but I am unsure if its a potential security issue.<br />
<br />
function dir_tempnam($dir, $prefix)<br />
{<br />
&nbsp;&nbsp;&nbsp; $real_dir_path = realpath($dir);<br />
&nbsp;&nbsp;&nbsp; if (substr($real_dir_path, -1) != '/')<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $real_dir_path .= '/';<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $tempfile = tempnam($real_dir_path, $prefix);<br />
&nbsp;&nbsp;&nbsp; $name = basename($tempfile);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(is_file($real_dir_path.$name))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $name;<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @unlink($name);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return FALSE;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
This function returns just the name of the temporary file in the specified directory, or FALSE.<br />
<br />
Obviously it could return the entire $tempfile, but in my case, I actually want the basename value seperate.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69220""></a>
  <div class="note">
   <strong class="user">tux ARROBA cenobioracing PUNTO com</strong>
   <a href="#69220" class="date">27-Aug-2006 05:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware that on Windows NT and other windows, if you have, for example, a variable $work_dir with a path to some dir on your document root(or any other dir). Note the following:<br />
<span class="default">&lt;?php<br />
$work_dir </span><span class="keyword">= </span><span class="string">'C:/some/path/to/document_root/dir'</span><span class="keyword">;<br />
</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$working_dir</span><span class="keyword">); </span><span class="comment">// Returns true<br />
</span><span class="default">is_writable</span><span class="keyword">(</span><span class="default">$working_dir</span><span class="keyword">); </span><span class="comment">// Returns true<br />
</span><span class="default">$tempfile </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="default">$working_dir</span><span class="keyword">,</span><span class="string">'img'</span><span class="keyword">);<br />
</span><span class="comment">//$temfile now contains a system wide temp directory file, like 'C:/WINNT.SBS/img444.tmp' instead of the directory we pass it<br />
//Thats because we need to give I_USR (IIS user) user write permission to $working_dir&nbsp; although according to the aforementioned functions seemed it already had it...<br />
//If you want to use just the system wide temp directory return by default by tempnam you will also need to give it write permission to I_USR user to be able to write to that file...<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67260""></a>
  <div class="note">
   <strong class="user">Guillaume Paramelle</strong>
   <a href="#67260" class="date">06-Jun-2006 06:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On a windows server (php 5.1.2), tempnam() may not use the dir parameter, and create the file in $_ENV['TMP'].<br />
I also had problem because the directory was relative.<br />
Everything was solved using :<br />
<br />
tempnam(realpath("../_cache/"), "prefix") ;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61436""></a>
  <div class="note">
   <strong class="user">Ron Korving</strong>
   <a href="#61436" class="date">03-Feb-2006 12:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function creates a temporary directory. The previous example given could bug if between the unlink() and mkdir() some process creates the same directory or file. This implementation is faster too.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function </span><span class="default">tempdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$prefix</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">=</span><span class="default">0700</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">) != </span><span class="string">'/'</span><span class="keyword">) </span><span class="default">$dir </span><span class="keyword">.= </span><span class="string">'/'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; do<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$prefix</span><span class="keyword">.</span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">9999999</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } while (!</span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$path</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56894""></a>
  <div class="note">
   <strong class="user">KOmaSHOOTER at gmx dot de</strong>
   <a href="#56894" class="date">18-Sep-2005 01:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This Example makes a File called "user.txt"<br />
in the dir www.XXXXX.XX/restricted/<br />
<span class="default">&lt;?php<br />
$tmpfname </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">"DOCUMENT_ROOT"</span><span class="keyword">].</span><span class="string">"/restricted"</span><span class="keyword">, </span><span class="string">"FOO"</span><span class="keyword">);<br />
</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$tmpfname</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">);<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">"writing to tempfile"</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
<br />
</span><span class="comment">// do here something<br />
//echo($_ENV["DOCUMENT_ROOT"]);<br />
</span><span class="default">copy</span><span class="keyword">(</span><span class="default">$tmpfname</span><span class="keyword">,</span><span class="string">'user.txt'</span><span class="keyword">);<br />
&nbsp;</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53790""></a>
  <div class="note">
   <strong class="user">chris</strong>
   <a href="#53790" class="date">13-Jun-2005 09:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Use the following to create a temporary directory...<br />
<br />
// Creates a directory with a unique name<br />
// at the specified with the specified prefix.<br />
// Returns directory name on success, false otherwise<br />
function tmpdir($path, $prefix)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Use PHP's tmpfile function to create a temporary<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // directory name. Delete the file and keep the name.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tempname = tempnam($path,$prefix);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!$tempname)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!unlink($tempname))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Create the temporary directory and returns its name.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (mkdir($tempname))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $tempname;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50658""></a>
  <div class="note">
   <strong class="user">php at REMOVEMEkennel17 dot co dot uk</strong>
   <a href="#50658" class="date">05-Mar-2005 10:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that tempnam returns the full path to the temporary file, not just the filename.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50084""></a>
  <div class="note">
   
   <a href="#50084" class="date">17-Feb-2005 06:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding Typo3 and Safe mode "Generally, everything in TYPO3 can work under safe_mode and open_basedir as long as the script permissions are correct. Notice, this is not something TYPO3 can do better or worse; for a working TYPO3 system there must be access to writing files and directories in the filesystem and this is done by plain PHP functions."</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49266""></a>
  <div class="note">
   <strong class="user">Sebastian Kun</strong>
   <a href="#49266" class="date">21-Jan-2005 01:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you go to the linux man page for the C function tempnam(3), you will see at the end "Never use this function. Use mkstemp(3) instead." But php's tempnam() function doesn't actually use tmpnam(3), so there's no problem (under Linux, it will use mkstemp(3) if it's available).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49223""></a>
  <div class="note">
   <strong class="user">Nick Smith</strong>
   <a href="#49223" class="date">20-Jan-2005 11:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is worth noting that if the 'dir' that you supply doesn't exist, then it is silently ignored and the system /tmp directory used. At least under Linux, PHP v4.1.2.<br />
<br />
I had a script that appeared to work fine with safe mode switched off, but I didn't realise that my 'dir' parameter had a typo (so the files were going in /tmp), and once safe mode was switched on I started getting errors because the rest of the script couldn't read files from the system /tmp folder.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47848""></a>
  <div class="note">
   <strong class="user">soletan at toxa dot de</strong>
   <a href="#47848" class="date">02-Dec-2004 08:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
tempnam and SAFE MODE don't generally exclude each other - that link below just shows frustrating trials to find some meaning in SAFE MODE. However, SAFE MODE is good and I'd appreciate to find it used in more of contemporarily hyped projects like typo3 or similar, since many people don't seem to care about security that much, but get enraged by tens and hundreds of Spam-Mails a day.<br />
<br />
Okay, that post from Feb-2004 and the "bug report" is unconditionally true for multi-hosted PHP environments where several users may have their individual scripts placed on same server machine. Just take a visit to one of your local webspace-providers, that give space for 5 Û or less a month.<br />
<br />
But the truth get conditional if you gain access to the server all by yourself and may set it up to have your script's and the web server's GID being same so you can "fall back" to GID-based SAFE MODE and use tempnam as desired. This is true for several local work, intranet-related projects in your company etc. Just take a look at how SAFE MODE _really_ works and why it's rockingly important to use it. You should do when you're developing a company tool for public access at least.<br />
<br />
Never forget to take a moment to think about Unix-filesystem and access rights as well ... even if you're locally running Windows to have some great IDE or similar (like me :). PHP is available on both systems, but that's not succeeding to define your work as "portable".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44512""></a>
  <div class="note">
   <strong class="user">andi&lt;at&gt;splitbrain&lt;dot&gt;org</strong>
   <a href="#44512" class="date">08-Aug-2004 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
tempname ignores the current umask and always creates the file with permission 0600.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43802""></a>
  <div class="note">
   <strong class="user">anakin dot skyw at gmx dot de</strong>
   <a href="#43802" class="date">04-Jul-2004 08:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&gt;Under UNIX (where you can rename onto an extant file and so I used link), you will have to remove both the link and the link's target.<br />
<br />
Couldn't you do<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$newFileCreated</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">unlink </span><span class="keyword">(</span><span class="default">$sysFileName</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$newFileName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
</span><span class="default">?&gt;<br />
</span>and get the same semantics as the windows version?</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42052""></a>
  <div class="note">
   <strong class="user">bishop</strong>
   <a href="#42052" class="date">30-Apr-2004 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Creating a temporary file with a specific extension is a common requirement on dynamic websites. Largely this need arises from Microsoft browsers that identify a downloaded file's mimetype based on the file's extension.<br />
<br />
No single PHP function creates a temporary filename with a specific extension, and, as has been shown, there are race conditions involved unless you use the PHP atomic primitives.<br />
<br />
I use only primitives below and exploit OS dependent behaviour to securely create a file with a specific postfix, prefix, and directory.&nbsp; Enjoy.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">secure_tmpname</span><span class="keyword">(</span><span class="default">$postfix </span><span class="keyword">= </span><span class="string">'.tmp'</span><span class="keyword">, </span><span class="default">$prefix </span><span class="keyword">= </span><span class="string">'tmp'</span><span class="keyword">, </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// validate arguments<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (! (isset(</span><span class="default">$postfix</span><span class="keyword">) &amp;&amp; </span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$postfix</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (! (isset(</span><span class="default">$prefix</span><span class="keyword">) &amp;&amp; </span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$prefix</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (! isset(</span><span class="default">$dir</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">getcwd</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// find a temporary name<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tries </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; do {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// get a known, unique temporary file name<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sysFileName </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$prefix</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$sysFileName </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// tack on the extension<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newFileName </span><span class="keyword">= </span><span class="default">$sysFileName </span><span class="keyword">. </span><span class="default">$postfix</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$sysFileName </span><span class="keyword">== </span><span class="default">$newFileName</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$sysFileName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// move or point the created temporary file to the new filename<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // NOTE: these fail if the new file name exist<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newFileCreated </span><span class="keyword">= (</span><span class="default">isWindows</span><span class="keyword">() ? @</span><span class="default">rename</span><span class="keyword">(</span><span class="default">$sysFileName</span><span class="keyword">, </span><span class="default">$newFileName</span><span class="keyword">) : @</span><span class="default">link</span><span class="keyword">(</span><span class="default">$sysFileName</span><span class="keyword">, </span><span class="default">$newFileName</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$newFileCreated</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$newFileName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unlink </span><span class="keyword">(</span><span class="default">$sysFileName</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tries</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; } while (</span><span class="default">$tries </span><span class="keyword">&lt;= </span><span class="default">5</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
The isWindows function is mostly left as an exercise for the reader. A starting point is below:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">isWindows</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">DIRECTORY_SEPARATOR </span><span class="keyword">== </span><span class="string">'\\' </span><span class="keyword">? </span><span class="default">true </span><span class="keyword">: </span><span class="default">false</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Like tempnam(), this function requires you to cleanup your own files later. Under UNIX (where you can rename onto an extant file and so I used link), you will have to remove both the link and the link's target. Cleanup is left entirely to the reader.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39590""></a>
  <div class="note">
   <strong class="user">kulpp at wsg dot net</strong>
   <a href="#39590" class="date">03-Feb-2004 11:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
tempnam should not be used with SAFE MODE as of 4.3.4<br />
see <a href="http://bugs.php.net/bug.php?id=27133" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=27133</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37762""></a>
  <div class="note">
   <strong class="user">phpdoc at rickbradley dot com</strong>
   <a href="#37762" class="date">25-Nov-2003 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The "newtempnam" recipe provided below (posted by "tempnam" on " 23-Jul-2003 08:56") has at least one race condition.&nbsp; The while loop checks to make sure that the file in question doesn't exist, and then goes and creates the file.&nbsp; In between the existence test and the fopen() call there is an opportunity for an attacker to create the file in question.<br />
<br />
This is a classic race-condition, and while it seems difficult to exploit there are a number of well-known attacks against this kind of sloppy file creation.<br />
<br />
The atomic primitives necessary to implement secure file creation are not available at the language level in PHP.&nbsp; This further underscores the need for PHP-language developers to rely on the language's security primitives (including tempnam() and tempfile()) instead of rolling their own.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34303""></a>
  <div class="note">
   
   <a href="#34303" class="date">23-Jul-2003 10:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The tempnam() function will not let you specify a postfix to the filename created. Here is a function that will create a new filename with pre and post fix'es. Not returns false if it can't create in the dir specified where tempnam() creates in the systems temp dir.<br />
<br />
function newtempnam($dir, $prefix, $postfix){<br />
&nbsp;&nbsp;&nbsp; /* Creates a new non-existant file with the specified post and pre fixes */<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if ($dir[strlen($dir) - 1] == '/') {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $trailing_slash = "";<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $trailing_slash = "/";<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; /*The PHP function is_dir returns true on files that have no extension.<br />
&nbsp;&nbsp;&nbsp; The filetype function will tell you correctly what the file is */<br />
&nbsp;&nbsp;&nbsp; if (!is_dir(realpath($dir)) || filetype(realpath($dir)) != "dir") {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // The specified dir is not actualy a dir<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (!is_writable($dir)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // The directory will not let us create a file there<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; do{&nbsp; &nbsp; $seed = substr(md5(microtime().posix_getpid()), 0, 8);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $filename = $dir . $trailing_slash . $prefix . $seed . $postfix;<br />
&nbsp;&nbsp;&nbsp; } while (file_exists($filename));<br />
&nbsp;&nbsp;&nbsp; $fp = fopen($filename, "w");<br />
&nbsp;&nbsp;&nbsp; fclose($fp);<br />
&nbsp;&nbsp;&nbsp; return $filename;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24801""></a>
  <div class="note">
   <strong class="user">lreilly at lanl dot gov</strong>
   <a href="#24801" class="date">28-Aug-2002 05:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful with you forward and back slashes. Innocent looking code like this...<br />
<br />
$uploaddir = "C:/Program Files/Apache Group/Apache2/htdocs/sasdap/uploads/";<br />
$tempFile = tempnam ($uploaddir, "TMPANAL");<br />
$fp = fopen($tmpfname, "w");<br />
fwrite($fp, $iqdata);<br />
//fclose($fp);<br />
<br />
... may show something odd when echoing $tempFile";<br />
<br />
i.e. /Program Files/Apache Group/Apache2/htdocs/sasdap/uploads/\TMP3D.tmp<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
Must... remember... to... use... backslashes...<br />
<br />
&nbsp;- Lee P. Reilly</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="13031""></a>
  <div class="note">
   <strong class="user">seb at nospam dot 50carleton dot com</strong>
   <a href="#13031" class="date">22-May-2001 05:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to a note previously posted, on Windows NT Server 4.0, I noticed that tempnam() only uses the first THREE characters of the specified prefix.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.symlink.html">symlink</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.tmpfile.html">tmpfile</a></div>
 <div class="up"><a href="ref.filesystem.html">Filesystem Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
