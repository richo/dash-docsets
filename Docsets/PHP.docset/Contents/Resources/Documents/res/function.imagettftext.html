<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Write text to the image using TrueType fonts</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagettfbbox.html">imagettfbbox</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagetypes.html">imagetypes</a></div>
 <div class="up"><a href="ref.image.html">GD and Image Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.imagettftext" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagettftext</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">imagettftext</span> &mdash; <span class="dc-title">Write text to the image using TrueType fonts</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagettftext-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">array</span> <span class="methodname"><b>imagettftext</b></span>
    ( <span class="methodparam"><span class="type">resource</span> <tt class="parameter">$image</tt></span>
   , <span class="methodparam"><span class="type">float</span> <tt class="parameter">$size</tt></span>
   , <span class="methodparam"><span class="type">float</span> <tt class="parameter">$angle</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$x</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$y</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$color</tt></span>
   , <span class="methodparam"><span class="type">string</span> <tt class="parameter">$fontfile</tt></span>
   , <span class="methodparam"><span class="type">string</span> <tt class="parameter">$text</tt></span>
   )</div>

  <p class="para rdfs-comment">
   Writes the given <i><tt class="parameter">text</tt></i> into the image using TrueType
   fonts.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagettftext-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>
<span class="term"><i><tt class="parameter">
image</tt></i></span><dd>
<p class="para">An image resource, returned by one of the image creation functions,
such as <span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>.</p></dd>
</dt>

    <dt>

     <span class="term"><i><tt class="parameter">size</tt></i></span>
     <dd>

      <p class="para">The font size. Depending on your version of GD, this should be specified as the pixel size (GD1) or point size (GD2).</p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">angle</tt></i></span>
     <dd>

      <p class="para">
       The angle in degrees, with 0 degrees being left-to-right reading text.
       Higher values represent a counter-clockwise rotation. For example, a 
       value of 90 would result in bottom-to-top reading text.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">x</tt></i></span>
     <dd>

      <p class="para">
       The coordinates given by <i><tt class="parameter">x</tt></i> and
       <i><tt class="parameter">y</tt></i> will define the basepoint of the first
       character (roughly the lower-left corner of the character). This
       is different from the <span class="function"><a href="function.imagestring.html" class="function">imagestring()</a></span>, where
       <i><tt class="parameter">x</tt></i> and <i><tt class="parameter">y</tt></i> define the
       upper-left corner of the first character. For example, &quot;top left&quot;
       is 0, 0.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">y</tt></i></span>
     <dd>

      <p class="para">
       The y-ordinate. This sets the position of the fonts baseline, not the
       very bottom of the character.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">color</tt></i></span>
     <dd>

      <p class="para">
       The color index. Using the negative of a color index has the effect of
       turning off antialiasing. See <span class="function"><a href="function.imagecolorallocate.html" class="function">imagecolorallocate()</a></span>.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">fontfile</tt></i></span>
     <dd>

      <p class="para">
       The path to the TrueType font you wish to use.
      </p>
      <p class="para">
       Depending on which version of the GD library PHP is using, <em class="emphasis">when
       <i><tt class="parameter">fontfile</tt></i> does not begin with a leading
       <i>/</i> then <i>.ttf</i> will be appended</em>
       to the filename and the library will attempt to search for that
       filename along a library-defined font path.
      </p>
      <p class="para">
       When using versions of the GD library lower than 2.0.18, a <i>space</i> character,
       rather than a semicolon, was used as the &#039;path separator&#039; for different font files.
       Unintentional use of this feature will result in the warning message:
       <i>Warning: Could not find/open font</i>. For these affected versions, the
       only solution is moving the font to a path which does not contain spaces.
      </p>
      <p class="para">
       In many cases where a font resides in the same directory as the script using it
       the following trick will alleviate any include problems.
       <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;Set&nbsp;the&nbsp;enviroment&nbsp;variable&nbsp;for&nbsp;GD<br /></span><span style="color: #0000BB">putenv</span><span style="color: #007700">(</span><span style="color: #DD0000">'GDFONTPATH='&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">realpath</span><span style="color: #007700">(</span><span style="color: #DD0000">'.'</span><span style="color: #007700">));<br /><br /></span><span style="color: #FF8000">//&nbsp;Name&nbsp;the&nbsp;font&nbsp;to&nbsp;be&nbsp;used&nbsp;(note&nbsp;the&nbsp;lack&nbsp;of&nbsp;the&nbsp;.ttf&nbsp;extension)<br /></span><span style="color: #0000BB">$font&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'SomeFont'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
       </div>

      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">text</tt></i></span>
     <dd>

      <p class="para">
       The text string in UTF-8 encoding.
      </p>
      <p class="para">
       May include decimal numeric character references (of the form:
       &amp;#8364;) to access characters in a font beyond position 127.
       The hexadecimal format (like &amp;#xA9;) is supported.
       Strings in UTF-8 encoding can be passed directly.
      </p>
      <p class="para">
       Named entities, such as &amp;copy;, are not supported. Consider using 
       <span class="function"><a href="function.html-entity-decode.html" class="function">html_entity_decode()</a></span>
       to decode these named entities into UTF-8 strings (html_entity_decode()
       supports this as of PHP 5.0.0).
      </p>
      <p class="para">
       If a character is used in the string which is not supported by the
       font, a hollow rectangle will replace the character.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagettftext-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns an array with 8 elements representing four points making the
   bounding box of the text. The order of the points is lower left, lower 
   right, upper right, upper left. The points are relative to the text
   regardless of the angle, so &quot;upper left&quot; means in the top left-hand 
   corner when you see the text horizontally.
   Returns <b><tt>FALSE</tt></b> on error.
  </p>
 </div>

 <div class="refsect1 changelog" id="refsect1-function.imagettftext-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">5.2.0</td>
       <td align="left">
        It is now possible to specify an hexadecimal entity in 
        <i><tt class="parameter">text</tt></i>.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagettftext-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-3032">
    <p><b>Example #1 <span class="function"><b>imagettftext()</b></span> example</b></p>
    <div class="example-contents"><p>
     This example script will produce a white PNG 400x30 pixels, with
     the words &quot;Testing...&quot; in black (with grey shadow), in the font Arial.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;Set&nbsp;the&nbsp;content-type<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/png'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Create&nbsp;the&nbsp;image<br /></span><span style="color: #0000BB">$im&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">400</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">30</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Create&nbsp;some&nbsp;colors<br /></span><span style="color: #0000BB">$white&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$grey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">128</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">128</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">128</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$black&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagefilledrectangle</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">399</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">29</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$white</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;The&nbsp;text&nbsp;to&nbsp;draw<br /></span><span style="color: #0000BB">$text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Testing...'</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;Replace&nbsp;path&nbsp;by&nbsp;your&nbsp;own&nbsp;font&nbsp;path<br /></span><span style="color: #0000BB">$font&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'arial.ttf'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Add&nbsp;some&nbsp;shadow&nbsp;to&nbsp;the&nbsp;text<br /></span><span style="color: #0000BB">imagettftext</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">20</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">11</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">21</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$grey</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$font</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$text</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Add&nbsp;the&nbsp;text<br /></span><span style="color: #0000BB">imagettftext</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">20</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">20</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$black</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$font</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$text</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Using&nbsp;imagepng()&nbsp;results&nbsp;in&nbsp;clearer&nbsp;text&nbsp;compared&nbsp;with&nbsp;imagejpeg()<br /></span><span style="color: #0000BB">imagepng</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output
something similar to:</p></div>
    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/21009b70229598c6a80eef8b45bf282b-imagettftext.png" alt="Output of example : imagettftext()" width="400" height="30" />
     </div>
    </div>
   </div>
  </p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagettftext-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    This function requires both the GD library and the <a href="http://www.freetype.org/" class="link external" title="Link : http://www.freetype.org/">&raquo;&nbsp;FreeType</a> library.
   </p>
  </p></blockquote>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imagettftext-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imagettfbbox.html" class="function" rel="rdfs-seeAlso">imagettfbbox()</a> - Give the bounding box of a text using TrueType fonts</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="107236""></a>
  <div class="note">
   <strong class="user">john at jbwalker dot com</strong>
   <a href="#107236" class="date">23-Jan-2012 08:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function can be tricky. To begin with the example that omits the ".ttf" from the name of the font is incorrect. I've found that I have to include it (perhaps different in Windows?).<br />
<br />
I have also found that odd things happen if you happen to pick a font size that doesn't match one of the known fonts.<br />
<br />
See my comment under imagecolortransparent for trying to use a transparent background with text.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105073""></a>
  <div class="note">
   <strong class="user">mirza_aqueel_qau at hotmail dot com</strong>
   <a href="#105073" class="date">26-Jul-2011 04:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To make a font underline and bold without using the fonts file available in fonts directory of windows use this code. I hope this will help alot of you out there.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Create the image<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">499</span><span class="keyword">, </span><span class="default">330</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Create some colors<br />
</span><span class="default">$white </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
</span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">499</span><span class="keyword">, </span><span class="default">329</span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br />
<br />
</span><span class="comment">// The text to draw<br />
<br />
</span><span class="default">$text </span><span class="keyword">=</span><span class="string">"Muhammad Sarfraz"</span><span class="keyword">;<br />
</span><span class="default">$text </span><span class="keyword">=</span><span class="string">"Khurram Faraz"</span><span class="keyword">;<br />
</span><span class="default">$text </span><span class="keyword">=</span><span class="string">"Mohammad Imran"</span><span class="keyword">;<br />
</span><span class="default">$text </span><span class="keyword">=</span><span class="string">"Zulfiqar Ahmed Khan"</span><span class="keyword">;<br />
</span><span class="default">$text</span><span class="keyword">=</span><span class="string">"Najam ul Hasnain Shah"</span><span class="keyword">;<br />
</span><span class="default">$text</span><span class="keyword">=</span><span class="string">"Abdul Rehman Daniyal"</span><span class="keyword">;<br />
</span><span class="default">$text</span><span class="keyword">=</span><span class="string">"Yasir Siddiqui"</span><span class="keyword">;<br />
</span><span class="default">$text</span><span class="keyword">=</span><span class="string">"Sohail ur Rehman"</span><span class="keyword">;<br />
</span><span class="default">$text</span><span class="keyword">=</span><span class="string">"Hamad Aziz Sheikh"</span><span class="keyword">;<br />
</span><span class="default">$text</span><span class="keyword">=</span><span class="string">"Nauman Khalid"</span><span class="keyword">;<br />
</span><span class="default">$text</span><span class="keyword">=</span><span class="string">"Saad Ahmed"</span><span class="keyword">;<br />
</span><span class="default">$text</span><span class="keyword">=</span><span class="string">"Nasir Mehmood Butt"</span><span class="keyword">;<br />
</span><span class="default">$text</span><span class="keyword">=</span><span class="string">"Mohammad Aqeel Mirza"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Replace path by your own font path<br />
</span><span class="default">$font </span><span class="keyword">= </span><span class="string">'walt.ttf'</span><span class="keyword">; </span><span class="comment">// Place this file in your code directory or if font is in font directory set its path with font name as $font=$path.'arial.ttf';<br />
<br />
// Add the text<br />
</span><span class="default">$x</span><span class="keyword">=</span><span class="default">10</span><span class="keyword">;<br />
</span><span class="default">$y</span><span class="keyword">=</span><span class="default">120</span><span class="keyword">;<br />
</span><span class="default">$font_size</span><span class="keyword">=</span><span class="default">40</span><span class="keyword">;<br />
</span><span class="default">$angle</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$total_width</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$counter</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//$text_to_write=urldecode(substr($text,$i,1)."%0D_");<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dimensions </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$font_size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$total_width</span><span class="keyword">+=(</span><span class="default">$dimensions</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">$dimensions </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$font_size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
echo </span><span class="string">"Dimension of full string="</span><span class="keyword">.</span><span class="default">$dimensions</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">].</span><span class="string">"&lt;br/&gt;"</span><span class="keyword">;<br />
<br />
echo </span><span class="string">"Total width calcuated by algorithm="</span><span class="keyword">.</span><span class="default">$total_width</span><span class="keyword">.</span><span class="string">"&lt;br/&gt;"</span><span class="keyword">;<br />
</span><span class="default">$difference</span><span class="keyword">=</span><span class="default">$dimensions</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]-</span><span class="default">$total_width</span><span class="keyword">;<br />
<br />
echo </span><span class="string">"Difference="</span><span class="keyword">.</span><span class="default">$difference</span><span class="keyword">;<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$font_size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$font_size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
<br />
</span><span class="default">$x2</span><span class="keyword">=</span><span class="default">$x</span><span class="keyword">+</span><span class="default">$total_width</span><span class="keyword">+</span><span class="default">$difference</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">;<br />
</span><span class="comment">//echo $total_width;<br />
</span><span class="keyword">echo </span><span class="string">"&lt;pre/&gt;"</span><span class="keyword">;<br />
</span><span class="comment">//imageline( $im , $x , $y+4 , $x2 , $y+4 , $black );<br />
</span><span class="default">imageBoldLine</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">+</span><span class="default">4</span><span class="keyword">, </span><span class="default">$x2</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">+</span><span class="default">4</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">, </span><span class="default">$BoldNess</span><span class="keyword">=</span><span class="default">4</span><span class="keyword">, </span><span class="default">$func</span><span class="keyword">=</span><span class="string">'imageLine'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Using imagepng() results in clearer text compared with imagejpeg()<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="string">"underline.png"</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;img src='underline.png'/&gt;"</span><span class="keyword">;<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104239""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#104239" class="date">02-Jun-2011 01:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to render text to an exact sized image that then you will run into problems depending on the font you use.<br />
<br />
Use the code below to render text to an image that is exactly sized to fit.<br />
<br />
This code will also take into consideration the baseline. You can safely render seperate pieces of text and place them side by side without annoying pixel discrepencies.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//vars<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$font </span><span class="keyword">= </span><span class="string">'QuatroUltraBlack.ttf'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="string">'hello world!'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">40</span><span class="keyword">;</span><span class="comment">//pt<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="string">'#ffffff'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//over compensate dimensions!<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cropPadding </span><span class="keyword">= </span><span class="default">6</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fontRange </span><span class="keyword">= </span><span class="string">'xgypqXi'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bounds </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$fontRange</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bounds</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]-</span><span class="default">$bounds</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">])+</span><span class="default">$cropPadding</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bounds</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">])-</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bounds </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bounds</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-</span><span class="default">$bounds</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">])+</span><span class="default">$cropPadding</span><span class="keyword">+</span><span class="default">$cropPadding</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= (</span><span class="default">$bounds</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] * -</span><span class="default">1</span><span class="keyword">)+</span><span class="default">$cropPadding</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//create transparent image<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$background </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$background</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//make color<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">str_split</span><span class="keyword">(</span><span class="default">ltrim</span><span class="keyword">(</span><span class="default">$color</span><span class="keyword">,</span><span class="string">'#'</span><span class="keyword">),</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]),</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]),</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]),</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//render text to image<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">$size</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">$color</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">.</span><span class="string">'&nbsp; &nbsp;&nbsp; '</span><span class="keyword">.</span><span class="default">$fontRange</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//calculate crop<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trim_bottom </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trim_left </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trim_right </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//bottom<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$trim_y </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">;</span><span class="default">$trim_y </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$trim_y</span><span class="keyword">--) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$trim_x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$trim_x </span><span class="keyword">&lt; </span><span class="default">$width</span><span class="keyword">; </span><span class="default">$trim_x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$alpha </span><span class="keyword">= (</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$trim_x</span><span class="keyword">, </span><span class="default">$trim_y</span><span class="keyword">) &gt;&gt; </span><span class="default">24</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$alpha </span><span class="keyword">!= </span><span class="default">127</span><span class="keyword">) { break </span><span class="default">2</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trim_bottom</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//left<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$trim_x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$trim_x </span><span class="keyword">&lt; </span><span class="default">$width</span><span class="keyword">; </span><span class="default">$trim_x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$trim_y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$trim_y </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">; </span><span class="default">$trim_y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$alpha </span><span class="keyword">= (</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$trim_x</span><span class="keyword">, </span><span class="default">$trim_y</span><span class="keyword">) &gt;&gt; </span><span class="default">24</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$alpha </span><span class="keyword">!= </span><span class="default">127</span><span class="keyword">) { break </span><span class="default">2</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trim_left</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//right<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$trim_x </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">;</span><span class="default">$trim_x </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$trim_x</span><span class="keyword">--) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$trim_y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$trim_y </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">; </span><span class="default">$trim_y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$alpha </span><span class="keyword">= (</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$trim_x</span><span class="keyword">, </span><span class="default">$trim_y</span><span class="keyword">) &gt;&gt; </span><span class="default">24</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$alpha </span><span class="keyword">!= </span><span class="default">127</span><span class="keyword">) { break </span><span class="default">2</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trim_right</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//do crop<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$trim_left </span><span class="keyword">|| </span><span class="default">$trim_right </span><span class="keyword">|| </span><span class="default">$trim_bottom</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//create new image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newWidth </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">-</span><span class="default">$trim_left</span><span class="keyword">-</span><span class="default">$trim_right</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newHeight </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">-</span><span class="default">$trim_bottom</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newImage </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$newWidth</span><span class="keyword">,</span><span class="default">$newHeight</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$newImage</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$newImage</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$background </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$newImage</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">127</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$newImage</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$newWidth</span><span class="keyword">,</span><span class="default">$newHeight</span><span class="keyword">,</span><span class="default">$background</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$newImage</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$newImage</span><span class="keyword">,</span><span class="default">$image</span><span class="keyword">,</span><span class="default">$trim_left</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$imageWidth</span><span class="keyword">,</span><span class="default">$imageHeight</span><span class="keyword">,</span><span class="default">$imageWidth</span><span class="keyword">,</span><span class="default">$imageHeight</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//swap the new image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">$newImage</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//do something with image<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//free image<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101128""></a>
  <div class="note">
   <strong class="user">contact at pointhunter dot net</strong>
   <a href="#101128" class="date">28-Nov-2010 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Print username on the picture from a sent variable. (u)<br />
<br />
<span class="default">&lt;?php<br />
$USERNAME</span><span class="keyword">=</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'u'</span><span class="keyword">];<br />
</span><span class="comment">// Set the content-type<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/png'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Create the image<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">350</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Create some colors<br />
</span><span class="default">$white </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$grey </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
</span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
</span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">399</span><span class="keyword">, </span><span class="default">29</span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br />
<br />
</span><span class="comment">// The text to draw<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="string">'Welcome, '</span><span class="keyword">.</span><span class="default">$USERNAME</span><span class="keyword">;<br />
</span><span class="comment">// Replace path by your own font path<br />
</span><span class="default">$font </span><span class="keyword">= </span><span class="string">'cour.ttf'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Add some shadow to the text<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">11</span><span class="keyword">, </span><span class="default">21</span><span class="keyword">, </span><span class="default">$grey</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Add the text<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Using imagepng() results in clearer text compared with imagejpeg()<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100713""></a>
  <div class="note">
   <strong class="user">John Conde</strong>
   <a href="#100713" class="date">01-Nov-2010 10:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to create a paragraph you will need to break your text up into lines and then place each line individually one below the next.<br />
<br />
Here's a basic example of how to do that:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Basic font settings<br />
</span><span class="default">$font </span><span class="keyword">=</span><span class="string">'./times.ttf'</span><span class="keyword">;<br />
</span><span class="default">$font_size </span><span class="keyword">= </span><span class="default">15</span><span class="keyword">;<br />
</span><span class="default">$font_color </span><span class="keyword">=&nbsp; </span><span class="default">0x000000<br />
<br />
</span><span class="comment">// Text to be placed as a paragraph<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="string">'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer non nunc lectus. Curabitur hendrerit bibendum enim dignissim tempus. Suspendisse non ipsum auctor metus consectetur eleifend. Fusce cursus ullamcorper sem nec ultricies. Aliquam erat volutpat. Vivamus massa justo, pharetra et sodales quis, rhoncus in ligula. Integer dolor velit, ultrices in iaculis nec, viverra ut nunc.'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Break it up into pieces 125 characters long<br />
</span><span class="default">$lines </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'|'</span><span class="keyword">, </span><span class="default">wordwrap</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">115</span><span class="keyword">, </span><span class="string">'|'</span><span class="keyword">));<br />
<br />
</span><span class="comment">// Starting Y position<br />
</span><span class="default">$y </span><span class="keyword">= </span><span class="default">513</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Loop through the lines and place them on the image<br />
</span><span class="keyword">foreach (</span><span class="default">$lines </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$font_size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$font_color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Increment Y so the next line is below the previous line<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">+= </span><span class="default">23</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100194""></a>
  <div class="note">
   <strong class="user">eboyjr</strong>
   <a href="#100194" class="date">30-Sep-2010 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You may want to be able to extract the name of the font with the font file. If so you can use this class I've developed. It only works with TTF fonts, not OpenType fonts. It has worked with all fonts that I have tested so far. Not extensively tested. There may be some character set issues but that is up to someone else to fix :) And sorry I had to strip a lot of the comments so that I could post it.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* TTFReader<br />
&nbsp;* Gives you name information of TTF font files.<br />
&nbsp;* Thanks to Apple, for their TTF specification.<br />
&nbsp;*<br />
&nbsp;* @name TTFReader<br />
&nbsp;* @author Devin Samarin &lt;eboyjr14@gmail.com&gt;<br />
&nbsp;*/<br />
</span><span class="keyword">class </span><span class="default">TTFReader </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$handle</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$is_parsed </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$info </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$name_ids </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0 </span><span class="keyword">=&gt; </span><span class="string">"copyright"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">1 </span><span class="keyword">=&gt; </span><span class="string">"font_family"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">2 </span><span class="keyword">=&gt; </span><span class="string">"font_subfamily"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">3 </span><span class="keyword">=&gt; </span><span class="string">"unique_id"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">4 </span><span class="keyword">=&gt; </span><span class="string">"full_name"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">5 </span><span class="keyword">=&gt; </span><span class="string">"version"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">6 </span><span class="keyword">=&gt; </span><span class="string">"postscript_name"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">7 </span><span class="keyword">=&gt; </span><span class="string">"trademark"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">8 </span><span class="keyword">=&gt; </span><span class="string">"manufacturer"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">9 </span><span class="keyword">=&gt; </span><span class="string">"designer"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">10 </span><span class="keyword">=&gt; </span><span class="string">"description"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">11 </span><span class="keyword">=&gt; </span><span class="string">"vendor_url"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">12 </span><span class="keyword">=&gt; </span><span class="string">"designer_url"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">13 </span><span class="keyword">=&gt; </span><span class="string">"license"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">14 </span><span class="keyword">=&gt; </span><span class="string">"license_url"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">16 </span><span class="keyword">=&gt; </span><span class="string">"preferred_family"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">17 </span><span class="keyword">=&gt; </span><span class="string">"preferred_subfamily"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">18 </span><span class="keyword">=&gt; </span><span class="string">"compatible_full"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">19 </span><span class="keyword">=&gt; </span><span class="string">"sample_text"<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">translate_name_id</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name_ids</span><span class="keyword">[</span><span class="default">$id</span><span class="keyword">]) ) return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name_ids</span><span class="keyword">[</span><span class="default">$id</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$id</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">open</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">close</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( !</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle </span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">info</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">is_parsed </span><span class="keyword">) { return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">info</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">is_parsed </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( !</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle </span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttf_header </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"nmajor_version/" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"nminor_version/" </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"nnumber_of_tables/" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"nsearch_range/" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"nentry_selector/" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"nrange_shift"</span><span class="keyword">, </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">, </span><span class="default">12</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$ttf_header</span><span class="keyword">[</span><span class="string">'major_version'</span><span class="keyword">] != </span><span class="default">1 </span><span class="keyword">|| </span><span class="default">$ttf_header</span><span class="keyword">[</span><span class="string">'minor_version'</span><span class="keyword">] != </span><span class="default">0 </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttf_found </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$ttf_header</span><span class="keyword">[</span><span class="string">'number_of_tables'</span><span class="keyword">]; </span><span class="default">$i</span><span class="keyword">++ ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttf_table_name </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttf_table </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"Nchecksum/" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Noffset/" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Nlength"</span><span class="keyword">, </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">, </span><span class="default">12</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$ttf_table_name </span><span class="keyword">== </span><span class="string">'name' </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttf_found </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$ttf_found </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">, </span><span class="default">$ttf_table</span><span class="keyword">[</span><span class="string">'offset'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttf_table</span><span class="keyword">[</span><span class="string">'header'</span><span class="keyword">] =<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"nformat_selector/" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"nname_records_count/" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"nstorage_offset"</span><span class="keyword">, </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttf_name_records </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$ttf_table</span><span class="keyword">[</span><span class="string">'header'</span><span class="keyword">][</span><span class="string">'name_records_count'</span><span class="keyword">]; </span><span class="default">$i</span><span class="keyword">++ ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttf_record </span><span class="keyword">=<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"nplatform_id/" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"nencoding_id/" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"nlanguage_id/" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"nname_id/" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"nlength/" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"noffset"</span><span class="keyword">, </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">, </span><span class="default">12</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$ttf_record</span><span class="keyword">[</span><span class="string">'length'</span><span class="keyword">] &lt;= </span><span class="default">0 </span><span class="keyword">) continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttf_record_offset </span><span class="keyword">= </span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttf_table</span><span class="keyword">[</span><span class="string">'offset'</span><span class="keyword">] +<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttf_table</span><span class="keyword">[</span><span class="string">'header'</span><span class="keyword">][</span><span class="string">'storage_offset'</span><span class="keyword">] +<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttf_record</span><span class="keyword">[</span><span class="string">'offset'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttf_value </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">, </span><span class="default">$ttf_record</span><span class="keyword">[</span><span class="string">'length'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$ttf_record</span><span class="keyword">[</span><span class="string">'platform_id'</span><span class="keyword">] != </span><span class="default">1 </span><span class="keyword">) </span><span class="default">$ttf_value </span><span class="keyword">= @</span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-16be'</span><span class="keyword">, </span><span class="string">'UTF-8//TRANSLIT'</span><span class="keyword">, </span><span class="default">$ttf_value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info</span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">translate_name_id</span><span class="keyword">(</span><span class="default">$ttf_record</span><span class="keyword">[</span><span class="string">'name_id'</span><span class="keyword">])] = </span><span class="default">$ttf_value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">, </span><span class="default">$ttf_record_offset</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">info </span><span class="keyword">= </span><span class="default">$info</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Here an example with Arial, since that's everyone's favorite font:<br />
<span class="default">&lt;?php<br />
$ttf </span><span class="keyword">= new </span><span class="default">TTFReader</span><span class="keyword">();<br />
</span><span class="default">$ttf</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">"arial.ttf"</span><span class="keyword">);<br />
</span><span class="default">$info </span><span class="keyword">= </span><span class="default">$ttf</span><span class="keyword">-&gt;</span><span class="default">info</span><span class="keyword">();<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$info</span><span class="keyword">); </span><span class="comment">// $info["full_name"] will give you the name of the font, but check if it is set first!<br />
</span><span class="default">$ttf</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100184""></a>
  <div class="note">
   <strong class="user">eee ess c p 9 9 AT yahoo DOT com</strong>
   <a href="#100184" class="date">29-Sep-2010 03:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you get letters cut off (clipped) by adjacent letters when using imagettftext with transparency (i.e., imagealphablending set to false), try setting imagealphablending back to TRUE before calling the imagettftext function.<br />
<br />
<span class="default">&lt;?php<br />
$im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">300</span><span class="keyword">, </span><span class="default">300</span><span class="keyword">);<br />
<br />
</span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Create colors and draw transparent background<br />
</span><span class="default">$trans </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br />
</span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">299</span><span class="keyword">, </span><span class="default">299</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Bad text<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">, </span><span class="string">'arial.ttf'</span><span class="keyword">, </span><span class="string">'Bad: Oj Pj wj'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Good text<br />
</span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">, </span><span class="default">150</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">, </span><span class="string">'arial.ttf'</span><span class="keyword">, </span><span class="string">'Good: Oj Pj wj'</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*** You'll need a copy of the arial.ttf font file in the same location as the PHP script ***/<br />
<br />
// Output PNG<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99204""></a>
  <div class="note">
   <strong class="user">barnaby at waterpigs dot co dot uk</strong>
   <a href="#99204" class="date">03-Aug-2010 04:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just created a HTML5 Video Poster Image generator in PHP - code is below if anyone wants to use.&nbsp; It's heavily commented, so you should be able to adjust it easily.&nbsp; It puts a transparent black bar along the top of an image, and writes some text in white over it - easily readable and applicable to most images.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// PHP File used to quickly put some text over a poster image - for video or other.<br />
<br />
// To use:&nbsp; Use this file as the source file of an image.&nbsp; Pass it two GET variables:&nbsp; pat=path of image&amp;text=text to overlay<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: image/jpeg"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Open the image:<br />
<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">] . </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">]);<br />
<br />
</span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">); </span><span class="comment">// Gets the width - better to use imagesx here as we don't need to feed it a path, just a handle.<br />
<br />
</span><span class="default">$rectCol </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">40</span><span class="keyword">); </span><span class="comment">// Create a black colour, slightly transparent<br />
</span><span class="default">$textCol </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">); </span><span class="comment">// Create a white colour<br />
<br />
// Fill the top of the image with this rectangle...<br />
<br />
</span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">, </span><span class="default">$rectCol</span><span class="keyword">);<br />
<br />
</span><span class="default">$textX </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">;<br />
</span><span class="default">$textY </span><span class="keyword">= </span><span class="default">32</span><span class="keyword">; </span><span class="comment">// X and Y values for the text generation<br />
<br />
</span><span class="default">$font </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">] . </span><span class="string">'/site/fonts/Verdana.ttf'</span><span class="keyword">; </span><span class="comment">// Replace this with the path to your font file.<br />
<br />
// Write Text:<br />
<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">18</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$textX</span><span class="keyword">, </span><span class="default">$textY</span><span class="keyword">, </span><span class="default">$textCol</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'text'</span><span class="keyword">]);<br />
<br />
</span><span class="comment">// Now we're done editing... output the final image:<br />
<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Free up some space:<br />
<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98392""></a>
  <div class="note">
   <strong class="user">Endeer</strong>
   <a href="#98392" class="date">12-Jun-2010 04:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If latin characters with accents don't work for you (blank characters or rectangles), then it may be perhaps caused by PHP being compiled with --enable-gd-jis-conv. Verified on PHP 5.2.13.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97767""></a>
  <div class="note">
   <strong class="user">Amir</strong>
   <a href="#97767" class="date">06-May-2010 06:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In order to pass text of RTL language to imagettftext function, I used this function.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">revUni</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$wordsArray </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rtlCompleteText</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">sizeOf</span><span class="keyword">(</span><span class="default">$wordsArray</span><span class="keyword">); </span><span class="default">$i </span><span class="keyword">&gt; -</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//$lettersArray = explode("|", str_replace(";|", ";", $wordsArray[$i]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lettersArray </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">";"</span><span class="keyword">, </span><span class="default">$wordsArray</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rtlWord</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$k </span><span class="keyword">= </span><span class="default">sizeOf</span><span class="keyword">(</span><span class="default">$lettersArray</span><span class="keyword">); </span><span class="default">$k </span><span class="keyword">&gt; -</span><span class="default">1</span><span class="keyword">; </span><span class="default">$k </span><span class="keyword">= </span><span class="default">$k</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$lettersArray</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">]) &gt; </span><span class="default">1</span><span class="keyword">) { </span><span class="comment">// make sure its full unicode letter<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rtlWord </span><span class="keyword">= </span><span class="default">$rtlWord</span><span class="keyword">.</span><span class="string">""</span><span class="keyword">.</span><span class="default">$lettersArray</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">].</span><span class="string">";"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rtlCompleteText </span><span class="keyword">= </span><span class="default">$rtlCompleteText</span><span class="keyword">.</span><span class="string">" "</span><span class="keyword">.</span><span class="default">$rtlWord</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$rtlCompleteText</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96908""></a>
  <div class="note">
   <strong class="user">mail at miikku dot de</strong>
   <a href="#96908" class="date">22-Mar-2010 07:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Because the text generated this way is not the same quality in all resolutions, i thought about a method to make it best quality without high resolution. So i wrote this simple code wich should do something like multisampling... Here it is (the $iMultiSampling parameter is the quality - multiplicator of multisampling):<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">imagettftextmultisampled</span><span class="keyword">(&amp;</span><span class="default">$hImg</span><span class="keyword">, </span><span class="default">$iSize</span><span class="keyword">, </span><span class="default">$sAngle</span><span class="keyword">, </span><span class="default">$iX</span><span class="keyword">, </span><span class="default">$iY</span><span class="keyword">, </span><span class="default">$cColor</span><span class="keyword">, </span><span class="default">$sFont</span><span class="keyword">, </span><span class="default">$sText</span><span class="keyword">, </span><span class="default">$iMultiSampling</span><span class="keyword">){<br />
&nbsp;</span><span class="default">$iWidth&nbsp; </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$hImg</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$iHeight </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$hImg</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$hImgCpy </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$iWidth</span><span class="keyword">*</span><span class="default">$iMultiSampling</span><span class="keyword">), </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$iHeight</span><span class="keyword">*</span><span class="default">$iMultiSampling</span><span class="keyword">));<br />
&nbsp;</span><span class="default">$cColor&nbsp; </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$hImg</span><span class="keyword">, </span><span class="default">$cColor</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$cColor&nbsp; </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$hImgCpy</span><span class="keyword">, </span><span class="default">$cColor</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$cColor</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$cColor</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">], </span><span class="default">$cColor</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">]);<br />
&nbsp;</span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$hImgCpy</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;</span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$hImgCpy</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$cTransparent </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$hImgCpy</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$hImgCpy</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">));<br />
&nbsp;</span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$hImgCpy</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$cTransparent</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$aBox </span><span class="keyword">= </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$hImgCpy</span><span class="keyword">, </span><span class="default">$iSize</span><span class="keyword">*</span><span class="default">$iMultiSampling</span><span class="keyword">, </span><span class="default">$sAngle</span><span class="keyword">, </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$iX</span><span class="keyword">*</span><span class="default">$iMultiSampling</span><span class="keyword">), </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$iY</span><span class="keyword">*</span><span class="default">$iMultiSampling</span><span class="keyword">), </span><span class="default">$cColor</span><span class="keyword">, </span><span class="default">$sFont</span><span class="keyword">, </span><span class="default">$sText</span><span class="keyword">);<br />
&nbsp;</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$hImg</span><span class="keyword">, </span><span class="default">$hImgCpy</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$iWidth</span><span class="keyword">, </span><span class="default">$iHeight</span><span class="keyword">, </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$iWidth</span><span class="keyword">*</span><span class="default">$iMultiSampling</span><span class="keyword">), </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$iHeight</span><span class="keyword">*</span><span class="default">$iMultiSampling</span><span class="keyword">));<br />
&nbsp;</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$hImgCpy</span><span class="keyword">);<br />
&nbsp;foreach(</span><span class="default">$aBox </span><span class="keyword">as </span><span class="default">$iKey </span><span class="keyword">=&gt; </span><span class="default">$iCoordinate</span><span class="keyword">)<br />
&nbsp; </span><span class="default">$aBox</span><span class="keyword">[</span><span class="default">$iKey</span><span class="keyword">] = </span><span class="default">$iCoordinate</span><span class="keyword">/</span><span class="default">$iMultiSampling</span><span class="keyword">;<br />
&nbsp;return(</span><span class="default">$aBox</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">imagettfbboxmultisampled</span><span class="keyword">(</span><span class="default">$iSize</span><span class="keyword">, </span><span class="default">$iAngle</span><span class="keyword">, </span><span class="default">$sFont</span><span class="keyword">, </span><span class="default">$sText</span><span class="keyword">, </span><span class="default">$iMultiSampling</span><span class="keyword">){<br />
&nbsp;</span><span class="default">$aBox </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$iSize</span><span class="keyword">*</span><span class="default">$iMultiSampling</span><span class="keyword">, </span><span class="default">$iAngle</span><span class="keyword">, </span><span class="default">$sFont</span><span class="keyword">, </span><span class="default">$sText</span><span class="keyword">);<br />
&nbsp;foreach(</span><span class="default">$aBox </span><span class="keyword">as </span><span class="default">$iKey </span><span class="keyword">=&gt; </span><span class="default">$iCoordinate</span><span class="keyword">)<br />
&nbsp; </span><span class="default">$aBox</span><span class="keyword">[</span><span class="default">$iKey</span><span class="keyword">] = </span><span class="default">$iCoordinate</span><span class="keyword">/</span><span class="default">$iMultiSampling</span><span class="keyword">;<br />
&nbsp;return(</span><span class="default">$aBox</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96472""></a>
  <div class="note">
   <strong class="user">JohnB</strong>
   <a href="#96472" class="date">28-Feb-2010 11:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just in case you were--like me--unaware of this, in Windows, ttf fonts don't necessarily antialias at all font sizes. Arial appears to work at all sizes but Calibri, for example, only antialiases at a point size of 8 and then at all sizes 16 and up. Not only that but at fonts sizes like 10 and 12 characters don't print at the expected angle: the characters are all printed upright on an angled baseline.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94975""></a>
  <div class="note">
   <strong class="user">adam at worldwrestlingmania dot cjb dot net</strong>
   <a href="#94975" class="date">05-Dec-2009 08:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a good number verification captcha i just made:<br />
<br />
1. on the page/s it will be used on, enter:<br />
<span class="default">&lt;?php<br />
$pageToGo </span><span class="keyword">= </span><span class="string">"<a href="http://example.com/" rel="nofollow" target="_blank">http://example.com/</a>" </span><span class="comment">#the page to go to if captcha correct<br />
</span><span class="keyword">if (</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"captchaused"</span><span class="keyword">] == </span><span class="string">"true"</span><span class="keyword">)<br />
{<br />
if (</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"numcaptcha"</span><span class="keyword">] == </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"captcha"</span><span class="keyword">])<br />
{<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Location: ' </span><span class="keyword">. </span><span class="default">$pageToGo</span><span class="keyword">);<br />
}<br />
else<br />
{<br />
echo </span><span class="string">'&lt;form action="' </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'php_self'</span><span class="keyword">] . </span><span class="string">'" method="post"&gt;'</span><span class="keyword">;<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">();<br />
echo </span><span class="string">'&lt;input type="hidden" name="captchaused" value="true" /&gt;'</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;input type="hidden" name="numcaptcha" value="' </span><span class="keyword">. </span><span class="default">$text </span><span class="keyword">. </span><span class="string">'" /&gt;'</span><span class="keyword">;<br />
echo </span><span class="string">'Enter the numbers you see: &lt;br&gt;&lt;input type="text" name="captcha" /&gt;'</span><span class="keyword">;<br />
require_once(</span><span class="string">'numcaptcha.php'</span><span class="keyword">);<br />
echo </span><span class="string">'&lt;input type="submit" value="enter site" /&gt;&lt;/form&gt;'</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
2. create a page called numcaptcha.php and enter:<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">'Content-type: image/png'</span><span class="keyword">);<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">400</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
</span><span class="default">$white </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
</span><span class="default">$grey </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
</span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">399</span><span class="keyword">, </span><span class="default">29</span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">11</span><span class="keyword">, </span><span class="default">21</span><span class="keyword">, </span><span class="default">$grey</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
it might have a few security issues but it still works fine.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91061""></a>
  <div class="note">
   <strong class="user">web at evanreeves dot com</strong>
   <a href="#91061" class="date">22-May-2009 12:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having trouble trying to render non antialiased text using a pixel font. The tips about setting a negative value for the color are valid, but I was still having trouble with the text I was trying to render because it was black. I discovered that if I changed the imagecolorallocate() function from:<br />
<br />
$color = imagecolorallocate($base, 0, 0, 0);<br />
<br />
to <br />
<br />
$color = imagecolorallocate($base, 1, 1, 1); (near black)<br />
<br />
and then used the negative value for the color in imagettftext(), it would work properly. The difference is that my first implementation set $color = 0. Obviously, you can't have $color = -0, it made no difference. When I switched to (1,1,1) it became $color = 1 which I could take a negative value for.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91028""></a>
  <div class="note">
   <strong class="user">nadavkav at gmail dot com</strong>
   <a href="#91028" class="date">21-May-2009 05:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
for passing hebrew (and maybe other rtl language text) you can use the following code (as suggested by udi and which worked for me) :<br />
<span class="default">&lt;?php<br />
$returnedtext </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"ISO-8859-8"</span><span class="keyword">, </span><span class="string">"UTF-8"</span><span class="keyword">, </span><span class="default">hebrev</span><span class="keyword">(</span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"UTF-8"</span><span class="keyword">, </span><span class="string">"ISO-8859-8"</span><span class="keyword">, </span><span class="default">$originaltext</span><span class="keyword">)));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90580""></a>
  <div class="note">
   <strong class="user">philip at webdesco dot com</strong>
   <a href="#90580" class="date">29-Apr-2009 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
for the dummies (like myself) if you are having problems including your font file, prefix the file name with ./<br />
<br />
On my development server the following worked fine<br />
$myfont = "coolfont.ttf";<br />
<br />
on my hosting server the only way i could get the font to work was as follows<br />
$myfont = "./coolfont.ttf";<br />
<br />
hope this helps someone out!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89505""></a>
  <div class="note">
   <strong class="user">ben at spooty dot net</strong>
   <a href="#89505" class="date">11-Mar-2009 06:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a simple function to wrap text going into an image. It'll wrap onto as many lines as it needs to, but $angle has to be zero. The $width parameter is the width of the image.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">wrap</span><span class="keyword">(</span><span class="default">$fontSize</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$fontFace</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach ( </span><span class="default">$arr </span><span class="keyword">as </span><span class="default">$word </span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$teststring </span><span class="keyword">= </span><span class="default">$ret</span><span class="keyword">.</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$word</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$testbox </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$fontSize</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$fontFace</span><span class="keyword">, </span><span class="default">$teststring</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$testbox</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] &gt; </span><span class="default">$width </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret</span><span class="keyword">.=(</span><span class="default">$ret</span><span class="keyword">==</span><span class="string">""</span><span class="keyword">?</span><span class="string">""</span><span class="keyword">:</span><span class="string">"\n"</span><span class="keyword">).</span><span class="default">$word</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret</span><span class="keyword">.=(</span><span class="default">$ret</span><span class="keyword">==</span><span class="string">""</span><span class="keyword">?</span><span class="string">""</span><span class="keyword">:</span><span class="string">' '</span><span class="keyword">).</span><span class="default">$word</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$ret</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87145""></a>
  <div class="note">
   <strong class="user">roland dot hentschel at t-online dot de</strong>
   <a href="#87145" class="date">21-Nov-2008 03:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi!<br />
<br />
I played around with that multi-line-script "makeImageF".<br />
Added some features, mainly: you can read text-files<br />
or add text as parameter - eg :<br />
imagettftext.php?file=test.txt<br />
imagettftext.php?text=hello|world!<br />
<br />
have fun!<br />
<br />
======================================<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/*<br />
&nbsp;* @name: makeImageF<br />
&nbsp;* <a href="http://de3.php.net/manual/en/function.imagettftext.php#77739" rel="nofollow" target="_blank">http://de3.php.net/manual/en/function.imagettftext.php#77739</a><br />
&nbsp;*<br />
&nbsp;* @param String $file : Textfile.<br />
&nbsp;* @param String $text : Text (New Line : "|").<br />
&nbsp;* @param String $font : Font name.<br />
&nbsp;* @param int $fsize: Font size.<br />
&nbsp;* @param int $pos : Justify (0-Left, 1-Right, 2-Center).<br />
&nbsp;* @param int $Leading : Space between lines.<br />
&nbsp;* @param int $W: Width of the Image.<br />
&nbsp;* @param int $H: Hight of the Image.<br />
&nbsp;* @param int $X: x-coordinate of the text into the image.<br />
&nbsp;* @param int $Y: y-coordinate of the text into the image.<br />
&nbsp;* @param array $rgb: RGB color array for text &amp; background color.<br />
&nbsp;*<br />
&nbsp;*/<br />
<br />
</span><span class="default">$type </span><span class="keyword">= </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]&nbsp; ? </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] : </span><span class="string">"png"</span><span class="keyword">;<br />
switch(</span><span class="default">$type</span><span class="keyword">) {<br />
&nbsp;case </span><span class="string">"gif" </span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/gif"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imageGIF</span><span class="keyword">(</span><span class="default">imagettfpostext</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">$rgb</span><span class="keyword">),</span><span class="string">"wm.gif"</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">); break;<br />
&nbsp;case </span><span class="string">"png" </span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagePNG</span><span class="keyword">(</span><span class="default">imagettfpostext</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">$rgb</span><span class="keyword">),</span><span class="string">"wm.png"</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">); break;<br />
}<br />
<br />
<br />
function </span><span class="default">rgb2hex</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$color </span><span class="keyword">= array(</span><span class="string">"black"</span><span class="keyword">=&gt;</span><span class="string">"#000"</span><span class="keyword">, </span><span class="string">"grn"</span><span class="keyword">=&gt;</span><span class="string">"#090"</span><span class="keyword">, <br />
&nbsp; </span><span class="string">"red"</span><span class="keyword">=&gt;</span><span class="string">"#f00"</span><span class="keyword">, </span><span class="string">"blu"</span><span class="keyword">=&gt;</span><span class="string">"00f"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$trans </span><span class="keyword">= array(</span><span class="string">"a"</span><span class="keyword">=&gt;</span><span class="string">"10"</span><span class="keyword">, </span><span class="string">"b"</span><span class="keyword">=&gt;</span><span class="string">"11"</span><span class="keyword">, </span><span class="string">"c"</span><span class="keyword">=&gt;</span><span class="string">"12"</span><span class="keyword">, <br />
&nbsp; </span><span class="string">"d"</span><span class="keyword">=&gt;</span><span class="string">"13"</span><span class="keyword">, </span><span class="string">"e"</span><span class="keyword">=&gt;</span><span class="string">"14"</span><span class="keyword">, </span><span class="string">"f"</span><span class="keyword">=&gt;</span><span class="string">"15"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$hex </span><span class="keyword">= array();<br />
&nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"#"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$color</span><span class="keyword">), </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$color</span><span class="keyword">), </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">)));<br />
&nbsp; for (</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) <br />
&nbsp; </span><span class="default">$hex</span><span class="keyword">[] = </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">],</span><span class="default">$trans</span><span class="keyword">);<br />
&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$hex</span><span class="keyword">)==</span><span class="default">3</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hex</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] = </span><span class="default">$hex</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]; </span><span class="default">$hex</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] = </span><span class="default">$hex</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hex</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] = </span><span class="default">$hex</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]; </span><span class="default">$hex</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="default">$hex</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hex</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$hex</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp; };<br />
&nbsp; </span><span class="default">$hex </span><span class="keyword">= (</span><span class="default">$hex</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]*</span><span class="default">16</span><span class="keyword">+</span><span class="default">$hex</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])<br />
&nbsp; .</span><span class="string">"x"</span><span class="keyword">.(</span><span class="default">$hex</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]*</span><span class="default">16</span><span class="keyword">+</span><span class="default">$hex</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">])<br />
&nbsp; .</span><span class="string">"x"</span><span class="keyword">.(</span><span class="default">$hex</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]*</span><span class="default">16</span><span class="keyword">+</span><span class="default">$hex</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]);<br />
&nbsp; return </span><span class="default">$hex</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$file&nbsp; </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">]&nbsp; <br />
? </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">] : </span><span class="string">"logo.txt"</span><span class="keyword">;<br />
if (</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">]) {<br />
&nbsp; </span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);&nbsp; <br />
&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) </span><span class="default">$text </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
} else </span><span class="default">$text </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"|"</span><span class="keyword">,</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'text'</span><span class="keyword">]);<br />
</span><span class="default">$pos&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'pos'</span><span class="keyword">]&nbsp;&nbsp; <br />
? </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'pos'</span><span class="keyword">] : </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$font&nbsp; </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'font'</span><span class="keyword">]&nbsp; <br />
? </span><span class="string">"./fonts/"</span><span class="keyword">.</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'font'</span><span class="keyword">].</span><span class="string">".ttf" </span><span class="keyword">: </span><span class="string">"./fonts/verdana.ttf"</span><span class="keyword">;<br />
</span><span class="default">$fsize </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'fsize'</span><span class="keyword">] <br />
? </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'fsize'</span><span class="keyword">] : </span><span class="default">12</span><span class="keyword">;<br />
</span><span class="default">$rgb&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'rgb'</span><span class="keyword">]&nbsp;&nbsp; <br />
? </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'rgb'</span><span class="keyword">] : </span><span class="string">"#ff9,#393"</span><span class="keyword">;<br />
<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">imagettfpostext</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">$rgb</span><span class="keyword">));<br />
<br />
function </span><span class="default">imagettfpostext</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">$rgb</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Leading</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$W</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$H</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$X</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$Y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$_bx </span><span class="keyword">= </span><span class="default">imageTTFBbox</span><span class="keyword">(</span><span class="default">$fsize</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"[\n]+"</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">); <br />
&nbsp; </span><span class="default">$nL&nbsp; </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">); <br />
&nbsp; </span><span class="default">$W&nbsp;&nbsp; </span><span class="keyword">= (</span><span class="default">$W</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">) <br />
&nbsp; ? </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$_bx</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]-</span><span class="default">$_bx</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) <br />
&nbsp; : </span><span class="default">$W</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$H </span><span class="keyword">= (</span><span class="default">$H</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">) <br />
&nbsp; ? </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$_bx</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]-</span><span class="default">$_bx</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">])+(</span><span class="default">$nL</span><span class="keyword">&gt;</span><span class="default">1 <br />
&nbsp; </span><span class="keyword">? (</span><span class="default">$nL</span><span class="keyword">*</span><span class="default">$Leading</span><span class="keyword">) <br />
&nbsp; : </span><span class="default">0</span><span class="keyword">) <br />
&nbsp; : </span><span class="default">$H</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$im </span><span class="keyword">= @</span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">$W</span><span class="keyword">, </span><span class="default">$H</span><span class="keyword">) <br />
&nbsp; or die(</span><span class="string">"Cannot Initialize new GD image stream"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">,</span><span class="default">$rgb</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$tc&nbsp; </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"x"</span><span class="keyword">,</span><span class="default">rgb2hex</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])); <br />
&nbsp; </span><span class="default">$bc</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"x"</span><span class="keyword">,</span><span class="default">rgb2hex</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]));<br />
&nbsp; </span><span class="default">$bc&nbsp; </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$bc</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$bc</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$bc</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]); <br />
&nbsp; </span><span class="default">$tc&nbsp; </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$tc</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$tc</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$tc</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]); <br />
&nbsp; if (</span><span class="default">$pos </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) { <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$X</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">$tc</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$alpha </span><span class="keyword">= </span><span class="default">range</span><span class="keyword">(</span><span class="string">"a"</span><span class="keyword">, </span><span class="string">"z"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$alpha </span><span class="keyword">= </span><span class="default">$alpha</span><span class="keyword">.</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$alpha</span><span class="keyword">).</span><span class="default">range</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_b </span><span class="keyword">= </span><span class="default">imageTTFBbox</span><span class="keyword">(</span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$alpha</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_H </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$_b</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]-</span><span class="default">$_b</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$__H </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$nL</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$_b </span><span class="keyword">= </span><span class="default">imageTTFBbox</span><span class="keyword">(</span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$_W </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$_b</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]-</span><span class="default">$_b</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$pos </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) </span><span class="default">$_X </span><span class="keyword">= </span><span class="default">$W</span><span class="keyword">-</span><span class="default">$_W</span><span class="keyword">;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; else </span><span class="default">$_X </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$W</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)-</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$_W</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$__H </span><span class="keyword">+= </span><span class="default">$_H</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$_X</span><span class="keyword">, </span><span class="default">$__H</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$tc</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$__H </span><span class="keyword">+= </span><span class="default">$Leading</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
<br />
&nbsp; if (</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">"trans"</span><span class="keyword">]) {<br />
&nbsp;&nbsp; </span><span class="default">$bg_color </span><span class="keyword">= </span><span class="default">ImageColorAt</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">ImageColorTransparent</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$bg_color</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; return </span><span class="default">$im</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86100""></a>
  <div class="note">
   <strong class="user">cameron at prolifique dot com</strong>
   <a href="#86100" class="date">02-Oct-2008 08:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
"php at yvanrodrigues dot com" is right...this function is not reliable on extended characters. User beware.<br />
<br />
In my case, it produced different results with OpenType vs. TrueType versions of the same font. (Converted my OT font to TT using FontForge as suggested. Strangely, the resulting TT font file was twice as big as the OT version and didn't look the same...heavier weight and slightly different spacing.) While the TT version was more accurate at displaying certain characters, neither was totally reliable, both yielding boxes in place of perfectly valid character glyphs that I could verify existed in the font. (Both fonts showed the same characters perfectly on an HTML page with UTF-8 charset.)<br />
<br />
What's more, using this same function with the same font on our development vs. production server also produced different results: some chars worked on dev but not production. Stranger still, the font spacing and size were slightly different between the two. Font file is identical. Dev server is Linux, production server is Windows, but should that matter? Suspect it has more to do with differing versions of FreeType (2.1 vs. 1.9 respectively).<br />
<br />
Anyway, careful with this function...best to stick within the rather small range of safe characters and avoid anything else.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85552""></a>
  <div class="note">
   <strong class="user">php at yvanrodrigues dot com</strong>
   <a href="#85552" class="date">05-Sep-2008 07:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After many hours of failure may I suggest:<br />
<br />
This function will work on OpenType fonts with Postscript outlines, but from what I can tell, characters &gt; ASCII 127 do not display correctly or at all, even if the text is correctly coded as UTF-8.<br />
<br />
Converting the font to truetype or possibly OpenType with truetype outlines; or buying the font as such fixes the problem.<br />
<br />
I used FontForge to open the otf and export as ttf and it works perfectly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84961""></a>
  <div class="note">
   <strong class="user">s.pynenburg _at_ gm ail dotcom</strong>
   <a href="#84961" class="date">07-Aug-2008 07:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had an image generator where the user could position where they wanted the text to begin - however it kept going off the side of an image. So I made this basic function: it measures if the inputted text and x-position will cause the string to go off the edge, and if so, it will fit as much as it can on the first line, then go down to the next one.<br />
Limitations:<br />
-It only performs this once (i.e. it won't split into three lines)<br />
-I'm pretty sure it won't work with angled text.<br />
<br />
<span class="default">&lt;?PHP<br />
<br />
</span><span class="keyword">function </span><span class="default">imagettftextwrap</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$x_pos</span><span class="keyword">, </span><span class="default">$y_pos</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$instr</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$box </span><span class="keyword">= @</span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$instr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$box</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] - </span><span class="default">$box</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$box</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] - </span><span class="default">$box</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$overlap </span><span class="keyword">= ((</span><span class="default">$x_pos </span><span class="keyword">+ </span><span class="default">$width</span><span class="keyword">) - </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$overlap </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) </span><span class="comment">//if the text doesn't fit on the image<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chars </span><span class="keyword">= </span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$instr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pstr </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$m</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$m </span><span class="keyword">&lt; </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$chars</span><span class="keyword">); </span><span class="default">$m</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bo </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$fsize1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font1</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$wid </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bo</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] - </span><span class="default">$bo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$x_pos </span><span class="keyword">+ </span><span class="default">$wid</span><span class="keyword">) &lt; </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)) </span><span class="comment">//add one char from the string as long as it's not overflowing<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pstr </span><span class="keyword">.= </span><span class="default">$chars</span><span class="keyword">[</span><span class="default">$m</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bo2 </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$fsize1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font1</span><span class="keyword">, </span><span class="default">$pstr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$wid2 </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bo2</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] - </span><span class="default">$bo2</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$x_pos </span><span class="keyword">+ </span><span class="default">$wid2</span><span class="keyword">) &lt; </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">.= </span><span class="default">$chars</span><span class="keyword">[</span><span class="default">$m</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$restof </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$l</span><span class="keyword">=</span><span class="default">$m</span><span class="keyword">; </span><span class="default">$l </span><span class="keyword">&lt; </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$chars</span><span class="keyword">); </span><span class="default">$l</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$restof </span><span class="keyword">.= </span><span class="default">$chars</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">]; </span><span class="comment">//add the rest of the string to a new line<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$x_pos</span><span class="keyword">, </span><span class="default">$y_pos</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">); </span><span class="comment">// print out the smaller line<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$y_pos </span><span class="keyword">+ </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$restof</span><span class="keyword">); </span><span class="comment">//and the rest of it<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$x_pos</span><span class="keyword">, </span><span class="default">$y_pos</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$instr</span><span class="keyword">); </span><span class="comment">//otherwise just do normally<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84833""></a>
  <div class="note">
   <strong class="user">sk89q</strong>
   <a href="#84833" class="date">01-Aug-2008 01:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I updated my imagettftextbox function considerably. It fixes the problems of the older imagettftextbox code I uploaded a few months ago (that's now gone).<br />
<br />
You can get it here:<br />
<a href="http://sk89q.therisenrealm.com/2008/08/ttf-textbox-in-php/" rel="nofollow" target="_blank">http://sk89q.therisenrealm.com/2008/08/ttf-textbox-in-php/</a><br />
<br />
It has both horizontal and vertical alignment, custom line spacing, borders, width, height, etc.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83316""></a>
  <div class="note">
   <strong class="user">Stefan at colulus dot com</strong>
   <a href="#83316" class="date">20-May-2008 10:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I worked out a script the allows the transfer of alphanumeric data to be placed on an image. The HTML feature is img src and the php feature is imagettftext. This simple code will increment from 1 to 3 on images.<br />
<br />
code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//ImageCall.php -- This script will call a script to produce the image.<br />
</span><span class="keyword">for(</span><span class="default">$next </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;</span><span class="default">$next </span><span class="keyword">&lt; </span><span class="default">4</span><span class="keyword">; </span><span class="default">$next</span><span class="keyword">++){<br />
print </span><span class="string">"Image </span><span class="default">$next</span><span class="string">:&lt;br&gt;"</span><span class="keyword">;<br />
print </span><span class="string">"&lt;img src = 'Image.php?\$text=</span><span class="default">$next</span><span class="string">'&gt;"</span><span class="keyword">;<br />
print </span><span class="string">"&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
<span class="default">&lt;?php<br />
</span><span class="comment">//Image.php -- This script creates a square image and places the text on it.<br />
<br />
// image size and color<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">ImageCreate</span><span class="keyword">(</span><span class="default">77</span><span class="keyword">,</span><span class="default">77</span><span class="keyword">);<br />
</span><span class="default">$color1 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x66</span><span class="keyword">,</span><span class="default">0xCC</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">);<br />
</span><span class="default">$color2 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x33</span><span class="keyword">,</span><span class="default">0x66</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">);<br />
</span><span class="default">$color3 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">,</span><span class="default">0x99</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">);<br />
</span><span class="default">$color4 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x3D</span><span class="keyword">,</span><span class="default">0x3D</span><span class="keyword">,</span><span class="default">0x3D</span><span class="keyword">);<br />
<br />
</span><span class="comment">// image creation<br />
</span><span class="default">ImageFilledRectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">$color1</span><span class="keyword">);<br />
</span><span class="default">ImageFilledpolygon</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, array (</span><span class="default">76</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">),</span><span class="default">3</span><span class="keyword">,</span><span class="default">$color2</span><span class="keyword">);<br />
</span><span class="default">ImageFilledRectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">72</span><span class="keyword">,</span><span class="default">72</span><span class="keyword">,</span><span class="default">$color3</span><span class="keyword">);<br />
<br />
</span><span class="comment">// determine numeric center of image<br />
</span><span class="default">$size </span><span class="keyword">= </span><span class="default">ImageTTFBBox</span><span class="keyword">(</span><span class="default">45</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="string">'impact'</span><span class="keyword">,</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'$text'</span><span class="keyword">]);<br />
</span><span class="default">$X </span><span class="keyword">= (</span><span class="default">77 </span><span class="keyword">- (</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]- </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])))/</span><span class="default">2</span><span class="keyword">;<br />
</span><span class="default">$Y </span><span class="keyword">= ((</span><span class="default">77 </span><span class="keyword">- (</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$size</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">])))/</span><span class="default">2 </span><span class="keyword">+ (</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$size</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">])));<br />
<br />
</span><span class="comment">//places numeric information on image<br />
</span><span class="default">ImageTTFText</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">45</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,(</span><span class="default">$X</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">),</span><span class="default">$Y</span><span class="keyword">,</span><span class="default">$color4</span><span class="keyword">,</span><span class="string">'impact'</span><span class="keyword">,</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'$text'</span><span class="keyword">]);<br />
<br />
</span><span class="comment">//returns completed image to calling script<br />
</span><span class="default">Header</span><span class="keyword">(</span><span class="string">'Content-Type: image/png'</span><span class="keyword">);<br />
</span><span class="default">Imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83248""></a>
  <div class="note">
   <strong class="user">Valentijn de Pagter</strong>
   <a href="#83248" class="date">16-May-2008 10:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're looking for easy text alignment, you need to use the imagettfbbox() command. When given the correct parameters, it will return the boundaries of your to-be-made text field in an array, which will allow you to calculate the x and y coordinate that you need to use for centering or aligning your text.<br />
<br />
A horizontal centering example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$tb </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">17</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="string">'airlock.ttf'</span><span class="keyword">, </span><span class="string">'Hello world!'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
$tb would contain:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; 0 // lower left X coordinate<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; -1 // lower left Y coordinate<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; 198 // lower right X coordinate<br />
&nbsp;&nbsp;&nbsp; [3] =&gt; -1 // lower right Y coordinate<br />
&nbsp;&nbsp;&nbsp; [4] =&gt; 198 // upper right X coordinate<br />
&nbsp;&nbsp;&nbsp; [5] =&gt; -20 // upper right Y coordinate<br />
&nbsp;&nbsp;&nbsp; [6] =&gt; 0 // upper left X coordinate<br />
&nbsp;&nbsp;&nbsp; [7] =&gt; -20 // upper left Y coordinate<br />
)<br />
<br />
For horizontal alignment, we need to substract the "text box's" width { $tb[2] or $tb[4] } from the image's width and then substract by two.<br />
<br />
Saying you have a 200px wide image, you could do something like this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$x </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">((</span><span class="default">200 </span><span class="keyword">- </span><span class="default">$tb</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]) / </span><span class="default">2</span><span class="keyword">); </span><span class="comment">// lower left X coordinate for text<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">17</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$tc</span><span class="keyword">, </span><span class="string">'airlock.ttf'</span><span class="keyword">, </span><span class="string">'Hello world!'</span><span class="keyword">); </span><span class="comment">// write text to image<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This'll give you perfect horizontal center alignment for your text, give or take 1 pixel. Have fun!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82706""></a>
  <div class="note">
   <strong class="user">damititi at gmail dot com</strong>
   <a href="#82706" class="date">22-Apr-2008 01:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
First of all, thanks sk89q for the func! it was exactly I was looking for.<br />
<br />
I made a change. Depending on the letter, the text were incorrect vertical aligned.<br />
I replace the line:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $line_height = $dimensions[1] - $dimensions[7];<br />
for the following:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $line_height = $size+4;<br />
<br />
No matter if mama or jeje is written, the vertical position will be the same.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81833""></a>
  <div class="note">
   <strong class="user">sk89q</strong>
   <a href="#81833" class="date">14-Mar-2008 03:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is an update to my imagettftextwrapped function. I had posted the old version that cut off lines if it wordwrapped.<br />
<br />
Here's a new version with the bug fixed, a list of arguments closer to imagettftext(), and partial angle support (the text is angled, but the left margins for each line are not adjusted for the angle).<br />
<br />
It's a function I wrote a few years ago to do unjustified aligned text.<br />
<br />
<span class="default">&lt;?php<br />
define</span><span class="keyword">(</span><span class="string">"ALIGN_LEFT"</span><span class="keyword">, </span><span class="string">"left"</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">"ALIGN_CENTER"</span><span class="keyword">, </span><span class="string">"center"</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">"ALIGN_RIGHT"</span><span class="keyword">, </span><span class="string">"right"</span><span class="keyword">);<br />
<br />
function </span><span class="default">imagettftextbox</span><span class="keyword">(&amp;</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$left</span><span class="keyword">, </span><span class="default">$top</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">, </span><span class="default">$max_width</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text_lines </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">); </span><span class="comment">// Supports manual line breaks!<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line_widths </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$largest_line_height </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$text_lines </span><span class="keyword">as </span><span class="default">$block</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current_line </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">; </span><span class="comment">// Reset current line<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$words </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">$block</span><span class="keyword">); </span><span class="comment">// Split the text into an array of single words<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$first_word </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last_width </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$words</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$item </span><span class="keyword">= </span><span class="default">$words</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dimensions </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$current_line </span><span class="keyword">. (</span><span class="default">$first_word </span><span class="keyword">? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">' '</span><span class="keyword">) . </span><span class="default">$item</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line_width </span><span class="keyword">= </span><span class="default">$dimensions</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$dimensions</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line_height </span><span class="keyword">= </span><span class="default">$dimensions</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] - </span><span class="default">$dimensions</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$line_height </span><span class="keyword">&gt; </span><span class="default">$largest_line_height</span><span class="keyword">) </span><span class="default">$largest_line_height </span><span class="keyword">= </span><span class="default">$line_height</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$line_width </span><span class="keyword">&gt; </span><span class="default">$max_width </span><span class="keyword">&amp;&amp; !</span><span class="default">$first_word</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines</span><span class="keyword">[] = </span><span class="default">$current_line</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line_widths</span><span class="keyword">[] = </span><span class="default">$last_width </span><span class="keyword">? </span><span class="default">$last_width </span><span class="keyword">: </span><span class="default">$line_width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/*if($i == count($words))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }*/<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current_line </span><span class="keyword">= </span><span class="default">$item</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current_line </span><span class="keyword">.= (</span><span class="default">$first_word </span><span class="keyword">? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">' '</span><span class="keyword">) . </span><span class="default">$item</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$i </span><span class="keyword">== </span><span class="default">count</span><span class="keyword">(</span><span class="default">$words</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines</span><span class="keyword">[] = </span><span class="default">$current_line</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line_widths</span><span class="keyword">[] = </span><span class="default">$line_width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last_width </span><span class="keyword">= </span><span class="default">$line_width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$first_word </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$current_line</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current_line </span><span class="keyword">= </span><span class="default">$item</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$lines </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$align </span><span class="keyword">== </span><span class="default">ALIGN_CENTER</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$left_offset </span><span class="keyword">= (</span><span class="default">$max_width </span><span class="keyword">- </span><span class="default">$line_widths</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) / </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">$align </span><span class="keyword">== </span><span class="default">ALIGN_RIGHT</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$left_offset </span><span class="keyword">= (</span><span class="default">$max_width </span><span class="keyword">- </span><span class="default">$line_widths</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$left </span><span class="keyword">+ </span><span class="default">$left_offset</span><span class="keyword">, </span><span class="default">$top </span><span class="keyword">+ </span><span class="default">$largest_line_height </span><span class="keyword">+ (</span><span class="default">$largest_line_height </span><span class="keyword">* </span><span class="default">$i</span><span class="keyword">), </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$largest_line_height </span><span class="keyword">* </span><span class="default">count</span><span class="keyword">(</span><span class="default">$lines</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81746""></a>
  <div class="note">
   <strong class="user">llewellyntd at gmail dot com</strong>
   <a href="#81746" class="date">12-Mar-2008 03:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi All,<br />
<br />
I struggled for moths to do a decent text warp with GD lib. Here is the code that I made use of:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//word wrap<br />
</span><span class="default">$warpText </span><span class="keyword">= </span><span class="default">wordwrap</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">);<br />
</span><span class="comment">//display text<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$fontSize</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$fontColor</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$warpText</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps somebody.<br />
<br />
Cheers</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81088""></a>
  <div class="note">
   <strong class="user">m0r1arty at mail dot ru</strong>
   <a href="#81088" class="date">13-Feb-2008 10:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sorry my English.<br />
I have trouble with using imagettftext under Windows.<br />
I can't used short name of fonts(example "arial","arialbd.ttf" etc). PHP say what not find this font.<br />
Manipulation with environment GDFONTPATH lost.<br />
This is my solution<br />
<span class="default">&lt;?php<br />
$dir</span><span class="keyword">=</span><span class="default">opendir</span><span class="keyword">(</span><span class="string">'./font/'</span><span class="keyword">);</span><span class="comment">//directory with fonts<br />
</span><span class="keyword">if(</span><span class="default">$dir</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">$f</span><span class="keyword">=</span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/\.ttf$/'</span><span class="keyword">,</span><span class="default">$f</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$font</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">,</span><span class="default">$f</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="default">$font</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">realpath</span><span class="keyword">(</span><span class="string">'./font/'</span><span class="keyword">.</span><span class="default">$f</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
if(</span><span class="default">$dir</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>Directory "font" have two file: arial.ttf and arialbd.ttf<br />
Now one can using constant font name by calling imagettftext:<br />
imagettftext($img,12,0,25,28,$color,arialbd,'some text');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80473""></a>
  <div class="note">
   <strong class="user">matt at mmkennedy dot net</strong>
   <a href="#80473" class="date">17-Jan-2008 07:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For anyone attempting to print black barcodes, and trying to turn of anti-aliasing, remember that -1 * [0,0,0] is 0, not -0.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80013""></a>
  <div class="note">
   <strong class="user">denis at reddodo dot com</strong>
   <a href="#80013" class="date">24-Dec-2007 06:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Small but very dangerous bug in function ttfWordWrappedText, written by waage, just try ttfWordWrappedText("aaaaa\naa",4) and your script will run into endless loop. <br />
You can fix it with code below:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">ttfWordWrappedText_fixed</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$strlen </span><span class="keyword">= </span><span class="default">8</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$text </span><span class="keyword">as </span><span class="default">$text</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) &gt; </span><span class="default">$strlen&nbsp; </span><span class="keyword">&amp;&amp; </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">) !== </span><span class="default">FALSE</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$startPoint </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][] =</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$startPoint</span><span class="keyword">);&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">)); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$line</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span>better solutions is to check input text for lines longer than needed wrap point.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80012""></a>
  <div class="note">
   <strong class="user">denis at reddodo dot com</strong>
   <a href="#80012" class="date">24-Dec-2007 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Small but very dangerous bug in function ttfWordWrappedText, written by waage, just try ttfWordWrappedText("aaaaa\naa",4) and your script will run into endless loop. <br />
You can fix it with code below:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">ttfWordWrappedText_fixed</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$strlen </span><span class="keyword">= </span><span class="default">8</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$text </span><span class="keyword">as </span><span class="default">$text</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) &gt; </span><span class="default">$strlen </span><span class="keyword">&amp;&amp; </span><span class="default">stristr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">) !== </span><span class="default">FALSE</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$startPoint </span><span class="keyword">= </span><span class="default">$strlen </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$startPoint</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) != </span><span class="string">" "</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$startPoint</span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$startPoint</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$startPoint</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$line</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span>better solutions is to check input text for lines longer than needed wrap point.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79705""></a>
  <div class="note">
   <strong class="user">dotpointer</strong>
   <a href="#79705" class="date">09-Dec-2007 04:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those trying to disable the font smoothing or font cleartype:ing, take a look at the color parameter for this function. The correct word for what you're looking for is antialiasing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79233""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#79233" class="date">16-Nov-2007 04:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just to comment on Sohel Taslims great function...<br />
if anyone needs to add BACKGROUND TRANSPARENCY to this kind of function (which almost does everyone one would want already) then add <br />
<br />
$bg_color = imagecolorat($im,1,1);<br />
imagecolortransparent($im, $bg_color);<br />
<br />
ABOVE the "if($L_R_C == 0){ //Justify Left"&nbsp; line</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79024""></a>
  <div class="note">
   <strong class="user">waage</strong>
   <a href="#79024" class="date">07-Nov-2007 07:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had some issues trying to get both word wrapping and new line detection but with some of the help from the comments below i got this. (thanks to jwe for the main part of the code here)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ttfWordWrappedText</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$strlen </span><span class="keyword">= </span><span class="default">38</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$text </span><span class="keyword">as </span><span class="default">$text</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) &gt; </span><span class="default">$strlen</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$startPoint </span><span class="keyword">= </span><span class="default">$strlen </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$startPoint</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) != </span><span class="string">" "</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$startPoint</span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$startPoint</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$startPoint</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$line</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This returns an array for each newline entered and subarray for each wordwrapped line to print.<br />
<br />
ie.<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; This is the first long line<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; that i entered.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; And this is the new line after that.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77935""></a>
  <div class="note">
   <strong class="user">mitch at electricpulp dot com</strong>
   <a href="#77935" class="date">20-Sep-2007 07:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're having issues with fonts not working... (Could not find/open font) check your permissions on the folder/font files and make sure they're 775, especially if you've just pulled them from a windows box. Hope this helps!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77739""></a>
  <div class="note">
   <strong class="user">Ole Clausen</strong>
   <a href="#77739" class="date">11-Sep-2007 09:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Comment to: Sohel Taslim (03-Aug-2007 06:19)<br />
<br />
Thanks for the function which I have modified a bit. In the new version the lines have equal space between them (the g's in your example create bigger space between the lines) - set by the parameter '$Leading'.<br />
<br />
I have used the for-loop for better performance and slimmed the rest a little&nbsp; :)<br />
<br />
&nbsp;&nbsp;&nbsp; /**<br />
&nbsp;&nbsp; &nbsp; * @name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : makeImageF<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * Function for create image from text with selected font. Justify text in image (0-Left, 1-Right, 2-Center).<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param String $text&nbsp; &nbsp;&nbsp; : String to convert into the Image.<br />
&nbsp;&nbsp; &nbsp; * @param String $font&nbsp; &nbsp;&nbsp; : Font name of the text. Kip font file in same folder.<br />
&nbsp;&nbsp; &nbsp; * @param int&nbsp; &nbsp; $Justify&nbsp; : Justify text in image (0-Left, 1-Right, 2-Center).<br />
&nbsp;&nbsp; &nbsp; * @param int&nbsp; &nbsp; $Leading&nbsp; : Space between lines.<br />
&nbsp;&nbsp; &nbsp; * @param int&nbsp; &nbsp; $W&nbsp; &nbsp; &nbsp; &nbsp; : Width of the Image.<br />
&nbsp;&nbsp; &nbsp; * @param int&nbsp; &nbsp; $H&nbsp; &nbsp; &nbsp; &nbsp; : Hight of the Image.<br />
&nbsp;&nbsp; &nbsp; * @param int&nbsp; &nbsp; $X&nbsp; &nbsp; &nbsp; &nbsp; : x-coordinate of the text into the image.<br />
&nbsp;&nbsp; &nbsp; * @param int&nbsp; &nbsp; $Y&nbsp; &nbsp; &nbsp; &nbsp; : y-coordinate of the text into the image.<br />
&nbsp;&nbsp; &nbsp; * @param int&nbsp; &nbsp; $fsize&nbsp; &nbsp; : Font size of text.<br />
&nbsp;&nbsp; &nbsp; * @param array&nbsp; $color&nbsp; &nbsp; : RGB color array for text color.<br />
&nbsp;&nbsp; &nbsp; * @param array&nbsp; $bgcolor&nbsp; : RGB color array for background.<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; function imagettfJustifytext($text, $font="CENTURY.TTF", $Justify=2, $Leading=0, $W=0, $H=0, $X=0, $Y=0, $fsize=12, $color=array(0x0,0x0,0x0), $bgcolor=array(0xFF,0xFF,0xFF)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $angle = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $_bx = imageTTFBbox($fsize,0,$font,$text);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $s = split("[\n]+", $text);&nbsp; // Array of lines<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $nL = count($s);&nbsp; // Number of lines<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $W = ($W==0)?abs($_bx[2]-$_bx[0]):$W;&nbsp; &nbsp; // If Width not initialized by programmer then it will detect and assign perfect width. <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $H = ($H==0)?abs($_bx[5]-$_bx[3])+($nL&gt;1?($nL*$Leading):0):$H;&nbsp; &nbsp; // If Height not initialized by programmer then it will detect and assign perfect height. <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $im = @imagecreate($W, $H)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; or die("Cannot Initialize new GD image stream");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $background_color = imagecolorallocate($im, $bgcolor[0], $bgcolor[1], $bgcolor[2]);&nbsp; // RGB color background.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $text_color = imagecolorallocate($im, $color[0], $color[1], $color[2]); // RGB color text.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($Justify == 0){ //Justify Left<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagettftext($im, $fsize, $angle, $X, $fsize, $text_color, $font, $text);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Create alpha-nummeric string with all international characters - both upper- and lowercase<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $alpha = range("a", "z");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $alpha = $alpha.strtoupper($alpha).range(0, 9);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Use the string to determine the height of a line<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $_b = imageTTFBbox($fsize,0,$font,$alpha);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $_H = abs($_b[5]-$_b[3]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $__H=0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for ($i=0; $i&lt;$nL; $i++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $_b = imageTTFBbox($fsize,0,$font,$s[$i]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $_W = abs($_b[2]-$_b[0]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //Defining the X coordinate.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($Justify == 1) $_X = $W-$_W;&nbsp; // Justify Right<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else $_X = abs($W/2)-abs($_W/2);&nbsp; // Justify Center<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //Defining the Y coordinate.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $__H += $_H;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagettftext($im, $fsize, $angle, $_X, $__H, $text_color, $font, $s[$i]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $__H += $Leading;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $im;<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76871""></a>
  <div class="note">
   <strong class="user">Sohel Taslim</strong>
   <a href="#76871" class="date">02-Aug-2007 09:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Left Right Center align/justify of text in image. It is easy and simple to do in PHP.<br />
Create an image from text and align them as you want. After that save or display image.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Function for converting Text to Image.<br />
&nbsp;* Kip CENTURY.TTF file in same folder.<br />
&nbsp;* <br />
&nbsp;* @author Taslim Mazumder Sohel<br />
&nbsp;* @deprecated 1.0 - 2007/08/03<br />
&nbsp;* <br />
&nbsp;*/<br />
&nbsp;&nbsp; &nbsp; //Example call.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="string">"New life in programming.\nNext Line of Image.\nLine Number 3\n" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"This is line numbet 4\nLine number 5\nYou can write as you want."</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/gif"</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">imagettfJustifytext</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="string">"CENTURY.TTF"</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//End of example.<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; /**<br />
&nbsp;&nbsp; &nbsp; * @name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : makeImageF<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * Function for create image from text with selected font. Justify text in image (0-Left, 1-Right, 2-Center).<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * @param String $text&nbsp; &nbsp;&nbsp; : String to convert into the Image.<br />
&nbsp;&nbsp; &nbsp; * @param String $font&nbsp; &nbsp;&nbsp; : Font name of the text. Kip font file in same folder.<br />
&nbsp;&nbsp; &nbsp; * @param int&nbsp; &nbsp; $W&nbsp; &nbsp; &nbsp; &nbsp; : Width of the Image.<br />
&nbsp;&nbsp; &nbsp; * @param int&nbsp; &nbsp; $H&nbsp; &nbsp; &nbsp; &nbsp; : Hight of the Image.<br />
&nbsp;&nbsp; &nbsp; * @param int&nbsp; &nbsp; $X&nbsp; &nbsp; &nbsp; &nbsp; : x-coordinate of the text into the image.<br />
&nbsp;&nbsp; &nbsp; * @param int&nbsp; &nbsp; $Y&nbsp; &nbsp; &nbsp; &nbsp; : y-coordinate of the text into the image.<br />
&nbsp;&nbsp; &nbsp; * @param int&nbsp; &nbsp; $fsize&nbsp; &nbsp; : Font size of text.<br />
&nbsp;&nbsp; &nbsp; * @param array&nbsp; $color&nbsp; &nbsp; &nbsp;&nbsp; : RGB color array for text color.<br />
&nbsp;&nbsp; &nbsp; * @param array&nbsp; $bgcolor&nbsp; : RGB color array for background.<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">imagettfJustifytext</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">=</span><span class="string">"CENTURY.TTF"</span><span class="keyword">, </span><span class="default">$Justify</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">, </span><span class="default">$W</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$H</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$X</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$Y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$fsize</span><span class="keyword">=</span><span class="default">12</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">=array(</span><span class="default">0x0</span><span class="keyword">,</span><span class="default">0x0</span><span class="keyword">,</span><span class="default">0x0</span><span class="keyword">), </span><span class="default">$bgcolor</span><span class="keyword">=array(</span><span class="default">0xFF</span><span class="keyword">,</span><span class="default">0xFF</span><span class="keyword">,</span><span class="default">0xFF</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$L_R_C </span><span class="keyword">= </span><span class="default">$Justify</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_bx </span><span class="keyword">= </span><span class="default">imageTTFBbox</span><span class="keyword">(</span><span class="default">$fsize</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$W </span><span class="keyword">= (</span><span class="default">$W</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">)?</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$_bx</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]-</span><span class="default">$_bx</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]):</span><span class="default">$W</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">//If Height not initialized by programmer then it will detect and assign perfect height. <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$H </span><span class="keyword">= (</span><span class="default">$H</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">)?</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$_bx</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]-</span><span class="default">$_bx</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]):</span><span class="default">$H</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">//If Width not initialized by programmer then it will detect and assign perfect width. <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= @</span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">$W</span><span class="keyword">, </span><span class="default">$H</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; or die(</span><span class="string">"Cannot Initialize new GD image stream"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$background_color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$bgcolor</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$bgcolor</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//RGB color background.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text_color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$color</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$color</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//RGB color text.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$L_R_C </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">){ </span><span class="comment">//Justify Left<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$X</span><span class="keyword">, </span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">$text_color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }elseif(</span><span class="default">$L_R_C </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">){ </span><span class="comment">//Justify Right<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"[\n]+"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$__H</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$s </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_b </span><span class="keyword">= </span><span class="default">imageTTFBbox</span><span class="keyword">(</span><span class="default">$fsize</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_W </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$_b</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]-</span><span class="default">$_b</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Defining the X coordinate.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_X </span><span class="keyword">= </span><span class="default">$W</span><span class="keyword">-</span><span class="default">$_W</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Defining the Y coordinate.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_H </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$_b</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]-</span><span class="default">$_b</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$__H </span><span class="keyword">+= </span><span class="default">$_H</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$_X</span><span class="keyword">, </span><span class="default">$__H</span><span class="keyword">, </span><span class="default">$text_color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$__H </span><span class="keyword">+= </span><span class="default">6</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">$L_R_C </span><span class="keyword">== </span><span class="default">2</span><span class="keyword">){ </span><span class="comment">//Justify Center<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"[\n]+"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$__H</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$s </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_b </span><span class="keyword">= </span><span class="default">imageTTFBbox</span><span class="keyword">(</span><span class="default">$fsize</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_W </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$_b</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]-</span><span class="default">$_b</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Defining the X coordinate.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_X </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$W</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)-</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$_W</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Defining the Y coordinate.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_H </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$_b</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]-</span><span class="default">$_b</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$__H </span><span class="keyword">+= </span><span class="default">$_H</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$_X</span><span class="keyword">, </span><span class="default">$__H</span><span class="keyword">, </span><span class="default">$text_color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$__H </span><span class="keyword">+= </span><span class="default">6</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$im</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76728""></a>
  <div class="note">
   <strong class="user">Borgso</strong>
   <a href="#76728" class="date">27-Jul-2007 04:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Right align out of "webmaster at higher-designs dot com" code<br />
<span class="default">&lt;?php<br />
$color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$font </span><span class="keyword">= </span><span class="string">'visitor.ttf'</span><span class="keyword">;<br />
</span><span class="default">$fontsize </span><span class="keyword">= </span><span class="string">"12"</span><span class="keyword">;<br />
</span><span class="default">$fontangle </span><span class="keyword">= </span><span class="string">"0"</span><span class="keyword">;<br />
</span><span class="default">$imagewidth </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">$imageheight </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="string">"My right align text"</span><span class="keyword">;<br />
<br />
</span><span class="default">$box </span><span class="keyword">= @</span><span class="default">imageTTFBbox</span><span class="keyword">(</span><span class="default">$fontsize</span><span class="keyword">,</span><span class="default">$fontangle</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">$textwidth </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$box</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] - </span><span class="default">$box</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
</span><span class="default">$textheight </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$box</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$box</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
</span><span class="default">$xcord </span><span class="keyword">= </span><span class="default">$imagewidth </span><span class="keyword">- (</span><span class="default">$textwidth</span><span class="keyword">)-</span><span class="default">2</span><span class="keyword">; </span><span class="comment">// 2 = some space from right side.<br />
</span><span class="default">$ycord </span><span class="keyword">= (</span><span class="default">$imageheight</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)+(</span><span class="default">$textheight</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br />
<br />
</span><span class="default">ImageTTFText </span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$fontsize</span><span class="keyword">, </span><span class="default">$fontangle</span><span class="keyword">, </span><span class="default">$xcord</span><span class="keyword">, </span><span class="default">$ycord</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75718""></a>
  <div class="note">
   <strong class="user">Lassial at the google mail dot com</strong>
   <a href="#75718" class="date">13-Jun-2007 12:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Creating multiline text with GD is bit complicated, one of the issues I've ran to is how to set line spacing, a normal feature in all type setting (even type writers). By default, line spacing with imagettftext seems to be 150 % or more, too much for me anyhow. Thus I've used the function below to get the lines closer to each other. By default, it appears to create 100 % linespacing, but it has not been tested thoroughly.<br />
<br />
null imagettfmultilinetext<br />
(resource $image, float $size, float $angle, int $x, int $y, int $color, string $fontfile, string $text , $spacing)<br />
<br />
spacing is a coefficient, comparable to Line spacing in a word processors or graphics software, causing a shift relative to font size in the line spacing<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">imagettfmultilinetext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">,&nbsp; </span><span class="default">$text</span><span class="keyword">, </span><span class="default">$spacing</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">)<br />
{<br />
<br />
</span><span class="default">$lines</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$lines</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newY</span><span class="keyword">=</span><span class="default">$y</span><span class="keyword">+(</span><span class="default">$i </span><span class="keyword">* </span><span class="default">$size </span><span class="keyword">* </span><span class="default">$spacing</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$newY</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">,&nbsp; </span><span class="default">$lines</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">$spacing</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
return </span><span class="default">null</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75678""></a>
  <div class="note">
   <strong class="user">ken at smallbox software</strong>
   <a href="#75678" class="date">11-Jun-2007 09:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Strangely this function seems to work with adobe post script files (tried .pfb) not sure why this isn't documented or why there is a separate set of functions for dealing with postscript.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75493""></a>
  <div class="note">
   <strong class="user">php at gilbertson dot me dot uk</strong>
   <a href="#75493" class="date">01-Jun-2007 01:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Users may note a problem trying to use this function to display the Euro symbol.<br />
<br />
The reason is that it is a late addition. Although the operating systems generally recognise code 0x80 (128 decimal) as Euro, this is not where it necessarily appears in the font. Some have it there, but many just have it in the extended character set at position 0x20AC (8364 decimal).<br />
<br />
I have yet to find a font with it only at 0x80, so here is the fix:<br />
<br />
<span class="default">&lt;?php<br />
$image</span><span class="keyword">=</span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">135</span><span class="keyword">,</span><span class="default">24</span><span class="keyword">);<br />
</span><span class="default">$bg</span><span class="keyword">=</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$fg</span><span class="keyword">=</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="string">'coffee - 3.50'</span><span class="keyword">;<br />
</span><span class="default">$friendly </span><span class="keyword">= </span><span class="default">eurofix</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">16</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">$fg</span><span class="keyword">,</span><span class="string">"Papyrus.ttf"</span><span class="keyword">,</span><span class="default">$friendly</span><span class="keyword">);<br />
</span><span class="default">imagegif </span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
</span><span class="default">imagedestroy </span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
<br />
function </span><span class="default">eurofix</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
</span><span class="default">$euro</span><span class="keyword">=</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="string">'&amp;#8364;'</span><span class="keyword">);<br />
</span><span class="default">$str </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\x80/'</span><span class="keyword">,</span><span class="default">$euro</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
return (</span><span class="default">$str</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
You should note, however, this won't help with fonts older than about 1999. It can only make sure the Euro is displayed where available.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75062""></a>
  <div class="note">
   <strong class="user">lassial at gmail dot com</strong>
   <a href="#75062" class="date">10-May-2007 06:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Roy van Arem suggested a neat code for listing TTFs on a machine. However, it has some problems (such as lower and upper case distinction of file extension and defective fonts) that I have corrected in the following script, which can be implemented as a single PHP script (name as you like):<br />
<br />
<span class="default">&lt;?php </span><span class="comment">//make sure there are no blank lines above<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="default">$ffolder</span><span class="keyword">=</span><span class="string">"/usr/local/bin/fonts"</span><span class="keyword">; </span><span class="comment">//The directory where your fonts reside<br />
<br />
</span><span class="keyword">if (empty(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'f'</span><span class="keyword">]))<br />
{<br />
</span><span class="default">$folder</span><span class="keyword">=</span><span class="default">dir</span><span class="keyword">(</span><span class="default">$ffolder</span><span class="keyword">); </span><span class="comment">//open directory<br />
</span><span class="keyword">echo </span><span class="string">"&lt;HTML&gt;&lt;BODY&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
while(</span><span class="default">$font</span><span class="keyword">=</span><span class="default">$folder</span><span class="keyword">-&gt;</span><span class="default">read</span><span class="keyword">())<br />
&nbsp; if(</span><span class="default">stristr</span><span class="keyword">(</span><span class="default">$font</span><span class="keyword">,</span><span class="string">'.ttf'</span><span class="keyword">)) </span><span class="comment">//only ttf fonts<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fonts</span><span class="keyword">[]=</span><span class="default">$font</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="default">$folder</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
<br />
if (!empty(</span><span class="default">$fonts</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;table&gt;&lt;tr&gt;&lt;th colspan='2'&gt;Fonts available in </span><span class="default">$ffolder</span><span class="string">&lt;/th&gt;&lt;/tr&gt;"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">.</span><span class="string">"\n&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Appereance&lt;/th&gt;"</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sort</span><span class="keyword">(</span><span class="default">$fonts</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$fonts </span><span class="keyword">as </span><span class="default">$font</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;tr&gt;&lt;td&gt;</span><span class="default">$font</span><span class="string">&lt;/td&gt;&lt;td&gt; &lt;IMG src='"</span><span class="keyword">.</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SCRIPT_NAME'</span><span class="keyword">] <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .</span><span class="string">"?f=</span><span class="default">$font</span><span class="string">'&gt;&lt;/td&gt;&lt;/tr&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
else echo </span><span class="string">"No fonts found from </span><span class="default">$ffolder</span><span class="string">"</span><span class="keyword">;<br />
echo </span><span class="string">"\n&lt;/HTML&gt;&lt;/BODY&gt;"</span><span class="keyword">;<br />
}<br />
<br />
else<br />
{<br />
</span><span class="default">$im</span><span class="keyword">=@</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">200</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; or die(</span><span class="string">"Cannot Initialize new GD image stream"</span><span class="keyword">);<br />
<br />
</span><span class="default">$black</span><span class="keyword">=</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$white</span><span class="keyword">=</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">);<br />
<br />
</span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$white</span><span class="keyword">);<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">14</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">25</span><span class="keyword">,</span><span class="default">$black</span><span class="keyword">, </span><span class="string">"</span><span class="default">$ffolder</span><span class="string">/"</span><span class="keyword">.</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'f'</span><span class="keyword">] , </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'f'</span><span class="keyword">]);<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Length: ' </span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">));<br />
<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74949""></a>
  <div class="note">
   <strong class="user">ultraniblet at gmail dot com</strong>
   <a href="#74949" class="date">05-May-2007 01:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have found the kerning (spacing between letters) pretty poor with GD - it's not up to your average designer's standards. Here are some ways to improve it:<br />
- Place the letters one by one using their bounding box instead of using one string<br />
- adjust with a $kerning value<br />
- For small text, sample it down from a larger size to adjust in increments less than 1px<br />
<br />
Eg:<br />
<br />
<span class="default">&lt;?PHP<br />
<br />
$STRING </span><span class="keyword">= </span><span class="string">"NOTRE PHILOSOPHIE"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// ---- PRESETS<br />
</span><span class="default">$FONT </span><span class="keyword">= </span><span class="string">"CantoriaMTStd-SemiBold.otf"</span><span class="keyword">;<br />
</span><span class="default">$FONT_SIZE </span><span class="keyword">= </span><span class="default">10.5</span><span class="keyword">;<br />
</span><span class="default">$WIDTH </span><span class="keyword">= </span><span class="default">200</span><span class="keyword">;<br />
</span><span class="default">$HEIGHT </span><span class="keyword">= </span><span class="default">16</span><span class="keyword">;<br />
</span><span class="default">$KERNING </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$BASELINE </span><span class="keyword">= </span><span class="default">12</span><span class="keyword">;<br />
</span><span class="default">$BG_COLOR </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"R"</span><span class="keyword">=&gt;</span><span class="default">5</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"G"</span><span class="keyword">=&gt;</span><span class="default">45</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"B"</span><span class="keyword">=&gt;</span><span class="default">53<br />
</span><span class="keyword">);<br />
</span><span class="default">$TXT_COLOR </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"R"</span><span class="keyword">=&gt;</span><span class="default">188</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"G"</span><span class="keyword">=&gt;</span><span class="default">189</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"B"</span><span class="keyword">=&gt;</span><span class="default">0<br />
</span><span class="keyword">);<br />
<br />
</span><span class="comment">// ---- CREATE CANVAS + PALETTE<br />
</span><span class="default">$canvas </span><span class="keyword">= </span><span class="default">imageCreateTrueColor</span><span class="keyword">(</span><span class="default">$WIDTH</span><span class="keyword">*</span><span class="default">4</span><span class="keyword">,</span><span class="default">$HEIGHT</span><span class="keyword">*</span><span class="default">4</span><span class="keyword">);<br />
<br />
</span><span class="default">$bg_color </span><span class="keyword">= </span><span class="default">imageColorAllocate</span><span class="keyword">(</span><span class="default">$canvas</span><span class="keyword">, </span><span class="default">$BG_COLOR</span><span class="keyword">[</span><span class="string">"R"</span><span class="keyword">], </span><span class="default">$BG_COLOR</span><span class="keyword">[</span><span class="string">"G"</span><span class="keyword">], </span><span class="default">$BG_COLOR</span><span class="keyword">[</span><span class="string">"B"</span><span class="keyword">]);<br />
<br />
</span><span class="default">$txt_color </span><span class="keyword">= </span><span class="default">imageColorAllocate</span><span class="keyword">(</span><span class="default">$canvas</span><span class="keyword">, </span><span class="default">$TXT_COLOR</span><span class="keyword">[</span><span class="string">"R"</span><span class="keyword">], </span><span class="default">$TXT_COLOR</span><span class="keyword">[</span><span class="string">"G"</span><span class="keyword">], </span><span class="default">$TXT_COLOR</span><span class="keyword">[</span><span class="string">"B"</span><span class="keyword">]);<br />
<br />
</span><span class="default">imagefill </span><span class="keyword">( </span><span class="default">$canvas</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$bg_color </span><span class="keyword">);<br />
<br />
</span><span class="comment">// ---- DRAW<br />
<br />
</span><span class="default">$array </span><span class="keyword">= </span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$STRING</span><span class="keyword">);<br />
</span><span class="default">$hpos </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bbox </span><span class="keyword">= </span><span class="default">imagettftext</span><span class="keyword">( </span><span class="default">$canvas</span><span class="keyword">, </span><span class="default">$FONT_SIZE</span><span class="keyword">*</span><span class="default">4</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$hpos</span><span class="keyword">, </span><span class="default">$BASELINE</span><span class="keyword">*</span><span class="default">4</span><span class="keyword">, </span><span class="default">$txt_color</span><span class="keyword">, </span><span class="default">$FONT</span><span class="keyword">, </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] );<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hpos </span><span class="keyword">= </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]+</span><span class="default">$KERNING</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// ---- SAMPLE DOWN &amp; OUTPUT<br />
</span><span class="default">$final </span><span class="keyword">= </span><span class="default">imageCreateTrueColor</span><span class="keyword">(</span><span class="default">$WIDTH</span><span class="keyword">,</span><span class="default">$HEIGHT</span><span class="keyword">);<br />
<br />
</span><span class="default">imageCopyResampled</span><span class="keyword">( </span><span class="default">$final</span><span class="keyword">, </span><span class="default">$canvas</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$WIDTH</span><span class="keyword">, </span><span class="default">$HEIGHT</span><span class="keyword">, </span><span class="default">$WIDTH</span><span class="keyword">*</span><span class="default">4</span><span class="keyword">, </span><span class="default">$HEIGHT</span><span class="keyword">*</span><span class="default">4 </span><span class="keyword">);<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/png'</span><span class="keyword">);<br />
<br />
</span><span class="default">imagePNG</span><span class="keyword">(</span><span class="default">$final</span><span class="keyword">);<br />
<br />
</span><span class="default">imageDestroy</span><span class="keyword">(</span><span class="default">$canvas</span><span class="keyword">);<br />
</span><span class="default">imageDestroy</span><span class="keyword">(</span><span class="default">$final</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71399""></a>
  <div class="note">
   <strong class="user">Roy van Arem</strong>
   <a href="#71399" class="date">26-Nov-2006 08:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to display a list of fonts in a directory and see what they look like, you could do something like this:<br />
<br />
&lt;HTML&gt;&lt;BODY&gt;<br />
<br />
<span class="default">&lt;?php<br />
<br />
$folder</span><span class="keyword">=</span><span class="default">dir</span><span class="keyword">(</span><span class="string">"fonts/"</span><span class="keyword">); </span><span class="comment">//The directory where your fonts reside<br />
<br />
</span><span class="keyword">while(</span><span class="default">$font</span><span class="keyword">=</span><span class="default">$folder</span><span class="keyword">-&gt;</span><span class="default">read</span><span class="keyword">())<br />
&nbsp; {<br />
<br />
&nbsp; if(</span><span class="default">stristr</span><span class="keyword">(</span><span class="default">$font</span><span class="keyword">,</span><span class="string">'.ttf'</span><span class="keyword">))echo </span><span class="string">'&lt;IMG SRC="img.php?'</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$font</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$font</span><span class="keyword">,</span><span class="string">'.'</span><span class="keyword">)).</span><span class="string">'"&gt;'</span><span class="keyword">; </span><span class="comment">//only ttf fonts<br />
<br />
&nbsp; </span><span class="keyword">}<br />
<br />
</span><span class="default">$folder</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
&lt;/BODY&gt;&lt;/HTML&gt;<br />
<br />
The file for 'img.php' should be something like this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$font</span><span class="keyword">=</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"QUERY_STRING"</span><span class="keyword">];<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
</span><span class="default">$im</span><span class="keyword">=@</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">200</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">)or die(</span><span class="string">"Cannot Initialize new GD image stream"</span><span class="keyword">);<br />
<br />
</span><span class="default">$black</span><span class="keyword">=</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$white</span><span class="keyword">=</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">);<br />
<br />
</span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$white</span><span class="keyword">);<br />
<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">18</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">25</span><span class="keyword">,</span><span class="default">$black</span><span class="keyword">,</span><span class="string">"fonts/"</span><span class="keyword">.</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">);<br />
<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Something similar I implemented at <a href="http://font.beginstart.com" rel="nofollow" target="_blank">http://font.beginstart.com</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70946""></a>
  <div class="note">
   <strong class="user">ben at evolutioncomputing co uk</strong>
   <a href="#70946" class="date">05-Nov-2006 01:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A centralised text watermark - of&nbsp; any length, that automatically sizes to about 70% of the width, and can be rotated to any angle.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/* Get image info */<br />
</span><span class="default">$Image </span><span class="keyword">= @</span><span class="default">ImageCreateFromJPEG </span><span class="keyword">(</span><span class="string">"YourImage.jpg"</span><span class="keyword">) ;<br />
</span><span class="default">$sx </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$Image</span><span class="keyword">) ;<br />
</span><span class="default">$sy </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$Image</span><span class="keyword">) ;<br />
if (</span><span class="default">$WatermarkNeeded</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Set text info */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Text</span><span class="keyword">=</span><span class="string">"Copyright Ben Clay" </span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Font</span><span class="keyword">=</span><span class="string">"arial.ttf" </span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$FontColor </span><span class="keyword">= </span><span class="default">ImageColorAllocate </span><span class="keyword">(</span><span class="default">$Image</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">) ;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$FontShadow </span><span class="keyword">= </span><span class="default">ImageColorAllocate </span><span class="keyword">(</span><span class="default">$Image</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">) ;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Rotation </span><span class="keyword">= </span><span class="default">30 </span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Make a copy image */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$OriginalImage </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$sx</span><span class="keyword">,</span><span class="default">$sy</span><span class="keyword">) ;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ImageCopy </span><span class="keyword">(</span><span class="default">$OriginalImage</span><span class="keyword">,</span><span class="default">$Image</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$sx</span><span class="keyword">,</span><span class="default">$sy</span><span class="keyword">) ;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Iterate to get the size up */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$FontSize</span><span class="keyword">=</span><span class="default">1 </span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; do<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$FontSize </span><span class="keyword">*= </span><span class="default">1.1 </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Box </span><span class="keyword">= @</span><span class="default">ImageTTFBBox</span><span class="keyword">(</span><span class="default">$FontSize</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$Font</span><span class="keyword">,</span><span class="default">$Text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$TextWidth </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$Box</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] - </span><span class="default">$Box</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$TextHeight </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$Box</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$Box</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$TextWidth </span><span class="keyword">&lt; </span><span class="default">$sx</span><span class="keyword">*</span><span class="default">0.7</span><span class="keyword">) ;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*&nbsp; Awkward maths to get the origin of the text in the right place */ <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$sx</span><span class="keyword">/</span><span class="default">2 </span><span class="keyword">- </span><span class="default">cos</span><span class="keyword">(</span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$Rotation</span><span class="keyword">))*</span><span class="default">$TextWidth</span><span class="keyword">/</span><span class="default">2 </span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">$sy</span><span class="keyword">/</span><span class="default">2 </span><span class="keyword">+ </span><span class="default">sin</span><span class="keyword">(</span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$Rotation</span><span class="keyword">))*</span><span class="default">$TextWidth</span><span class="keyword">/</span><span class="default">2 </span><span class="keyword">+ </span><span class="default">cos</span><span class="keyword">(</span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$Rotation</span><span class="keyword">))*</span><span class="default">$TextHeight</span><span class="keyword">/</span><span class="default">2 </span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Make shadow text first followed by solid text */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ImageTTFText </span><span class="keyword">(</span><span class="default">$Image</span><span class="keyword">,</span><span class="default">$FontSize</span><span class="keyword">,</span><span class="default">$Rotation</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">+</span><span class="default">4</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">+</span><span class="default">4</span><span class="keyword">,</span><span class="default">$FontShadow</span><span class="keyword">,</span><span class="default">$Font</span><span class="keyword">,</span><span class="default">$Text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ImageTTFText </span><span class="keyword">(</span><span class="default">$Image</span><span class="keyword">,</span><span class="default">$FontSize</span><span class="keyword">,</span><span class="default">$Rotation</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">$FontColor</span><span class="keyword">,</span><span class="default">$Font</span><span class="keyword">,</span><span class="default">$Text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* merge original image into version with text to show image through text */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ImageCopyMerge </span><span class="keyword">(</span><span class="default">$Image</span><span class="keyword">,</span><span class="default">$OriginalImage</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$sx</span><span class="keyword">,</span><span class="default">$sy</span><span class="keyword">,</span><span class="default">50</span><span class="keyword">) ;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">ImageJPEG </span><span class="keyword">(</span><span class="default">$Image</span><span class="keyword">) ;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70130""></a>
  <div class="note">
   <strong class="user">Tom Pike</strong>
   <a href="#70130" class="date">04-Oct-2006 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ref: Craig at frostycoolslug dot com<br />
<br />
"Using the negative of a color index has the effect of turning off antialiasing."<br />
<br />
This is true, but only if the image has been created with imagecreate() (as opposed to imagecreatetruecolor())</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69972""></a>
  <div class="note">
   <strong class="user">Craig at frostycoolslug dot com</strong>
   <a href="#69972" class="date">28-Sep-2006 07:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This one caught me out a little bit as confusing, so in an attempt to help others..<br />
<br />
"Using the negative of a color index has the effect of turning off antialiasing."<br />
<br />
Simply put:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$textColour </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
</span><span class="default">ImageTTFText</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">$textColour</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Note the - (minus) before the $textColor in ImageTTFText, this creates the negative colour index, and switches off AA on text.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68920""></a>
  <div class="note">
   <strong class="user">webmaster at higher-designs dot com</strong>
   <a href="#68920" class="date">15-Aug-2006 10:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I spent days looking for this, couldn't find it, so just made it myself. This is an ultra simple text banner that keeps the text pretty much centered (not perfect when text is angled) vertically and horizontally. Size, font, colors are easy to edit and in HTML version for the colors.<br />
<br />
Any additions (maybe for multi-line functionality) can be added if you desire.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">### Declare this script will be displayed as a PNG image.<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
<br />
</span><span class="comment">####################### BEGIN USER EDITS #######################<br />
</span><span class="default">$imagewidth </span><span class="keyword">= </span><span class="default">500</span><span class="keyword">;<br />
</span><span class="default">$imageheight </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;<br />
</span><span class="default">$fontsize </span><span class="keyword">= </span><span class="string">"20"</span><span class="keyword">;<br />
</span><span class="default">$fontangle </span><span class="keyword">= </span><span class="string">"0"</span><span class="keyword">;<br />
</span><span class="default">$font </span><span class="keyword">= </span><span class="string">"arial.ttf"</span><span class="keyword">;<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="string">"123456789"</span><span class="keyword">;<br />
</span><span class="default">$backgroundcolor </span><span class="keyword">= </span><span class="string">"003366"</span><span class="keyword">;<br />
</span><span class="default">$textcolor </span><span class="keyword">= </span><span class="string">"FFCC66"</span><span class="keyword">;<br />
</span><span class="comment">######################## END USER EDITS ########################<br />
<br />
### Convert HTML backgound color to RGB<br />
</span><span class="keyword">if( </span><span class="default">eregi</span><span class="keyword">( </span><span class="string">"([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})"</span><span class="keyword">, </span><span class="default">$backgroundcolor</span><span class="keyword">, </span><span class="default">$bgrgb </span><span class="keyword">) )<br />
{</span><span class="default">$bgred </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">( </span><span class="default">$bgrgb</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] );&nbsp;&nbsp; </span><span class="default">$bggreen </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">( </span><span class="default">$bgrgb</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] );&nbsp;&nbsp; </span><span class="default">$bgblue </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">( </span><span class="default">$bgrgb</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] );}<br />
<br />
</span><span class="comment">### Convert HTML text color to RGB<br />
</span><span class="keyword">if( </span><span class="default">eregi</span><span class="keyword">( </span><span class="string">"([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})"</span><span class="keyword">, </span><span class="default">$textcolor</span><span class="keyword">, </span><span class="default">$textrgb </span><span class="keyword">) )<br />
{</span><span class="default">$textred </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">( </span><span class="default">$textrgb</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] );&nbsp;&nbsp; </span><span class="default">$textgreen </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">( </span><span class="default">$textrgb</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] );&nbsp;&nbsp; </span><span class="default">$textblue </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">( </span><span class="default">$textrgb</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] );}<br />
<br />
</span><span class="comment">### Create image<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">( </span><span class="default">$imagewidth</span><span class="keyword">, </span><span class="default">$imageheight </span><span class="keyword">);<br />
<br />
</span><span class="comment">### Declare image's background color<br />
</span><span class="default">$bgcolor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$bgred</span><span class="keyword">,</span><span class="default">$bggreen</span><span class="keyword">,</span><span class="default">$bgblue</span><span class="keyword">);<br />
<br />
</span><span class="comment">### Declare image's text color<br />
</span><span class="default">$fontcolor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$textred</span><span class="keyword">,</span><span class="default">$textgreen</span><span class="keyword">,</span><span class="default">$textblue</span><span class="keyword">);<br />
<br />
</span><span class="comment">### Get exact dimensions of text string<br />
</span><span class="default">$box </span><span class="keyword">= @</span><span class="default">imageTTFBbox</span><span class="keyword">(</span><span class="default">$fontsize</span><span class="keyword">,</span><span class="default">$fontangle</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
<br />
</span><span class="comment">### Get width of text from dimensions<br />
</span><span class="default">$textwidth </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$box</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] - </span><span class="default">$box</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
<br />
</span><span class="comment">### Get height of text from dimensions<br />
</span><span class="default">$textheight </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$box</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$box</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
<br />
</span><span class="comment">### Get x-coordinate of centered text horizontally using length of the image and length of the text<br />
</span><span class="default">$xcord </span><span class="keyword">= (</span><span class="default">$imagewidth</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)-(</span><span class="default">$textwidth</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)-</span><span class="default">2</span><span class="keyword">;<br />
<br />
</span><span class="comment">### Get y-coordinate of centered text vertically using height of the image and height of the text<br />
</span><span class="default">$ycord </span><span class="keyword">= (</span><span class="default">$imageheight</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)+(</span><span class="default">$textheight</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br />
<br />
</span><span class="comment">### Declare completed image with colors, font, text, and text location<br />
</span><span class="default">imagettftext </span><span class="keyword">( </span><span class="default">$im</span><span class="keyword">, </span><span class="default">$fontsize</span><span class="keyword">, </span><span class="default">$fontangle</span><span class="keyword">, </span><span class="default">$xcord</span><span class="keyword">, </span><span class="default">$ycord</span><span class="keyword">, </span><span class="default">$fontcolor</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text </span><span class="keyword">);<br />
<br />
</span><span class="comment">### Display completed image as PNG<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
</span><span class="comment">### Close the image<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68366""></a>
  <div class="note">
   <strong class="user">jwe</strong>
   <a href="#68366" class="date">24-Jul-2006 11:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found this line a little confusing:<br />
<br />
"May include decimal numeric character references (of the form: &amp;#8364;) to access characters in a font beyond position 127."<br />
<br />
I was using a font that had apostrophes and quotes stored in a non-standard position, and so they were being rendered as spaces by imagettftext.&nbsp; This line seemed to suggest a solution, but it took a while to figure it out.<br />
<br />
Turns out, a "decimal numeric character reference" is a decimal conversion of the hex value of the *unicode* position of the character you want.&nbsp; For a while I was trying ASCII positions (I knew the ALT+ code for typing the character I needed in Windows).<br />
<br />
In the Windows XP character map, the unicode positions are shown as U+2018 or U+201C, etc.&nbsp; Ignore the U+ and convert that hex number to decimal, and then stick that in your text string with the &amp;# on the front and ; on the end, and pass it to imagettftext.<br />
<br />
--Julian</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68232""></a>
  <div class="note">
   <strong class="user">jwe</strong>
   <a href="#68232" class="date">18-Jul-2006 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Quick tip for anyone who is receiving text like in the example in this page (ie: through $_GET['text'] or something similar) and needs to format the text into multiple lines.&nbsp; The trick is finding the spaces...<br />
<br />
<span class="default">&lt;?php<br />
$text </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'text'</span><span class="keyword">];<br />
</span><span class="comment">// for a maximum of 38 characters on a line...<br />
</span><span class="keyword">while(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) &gt; </span><span class="default">38</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$startPoint </span><span class="keyword">= </span><span class="default">37</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="comment">// find a space to break the line on<br />
&nbsp;&nbsp; </span><span class="keyword">while(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$startPoint</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) != </span><span class="string">" "</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$startPoint</span><span class="keyword">--;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="default">$line</span><span class="keyword">[] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$startPoint</span><span class="keyword">));<br />
&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$startPoint</span><span class="keyword">);<br />
}<br />
</span><span class="default">$line</span><span class="keyword">[] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The result is an array called $line that contains all the lines of text you need to output in order.<br />
<br />
The only tasks left are to determine the correct height of the image based on the font size you want to use.&nbsp; Don't forget to leave some padding space for punctuation and descenders between lines (commas, g, q, p, y, etc).<br />
<br />
imagettftext is unbelievably useful when you need to create header images using non-standard fonts.&nbsp; Amazing.&nbsp; Huge thanks to the devs.<br />
<br />
--Julian</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65460""></a>
  <div class="note">
   <strong class="user">admin at sgssweb dot com</strong>
   <a href="#65460" class="date">01-May-2006 04:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another way of the bellow. After creating a child class of GMIPluggableSet class, which should override two method: getExpression() and getVariables(), throw it to a instance of FontImageGenerator class.<br />
For example, the code follows:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">require_once </span><span class="string">'package.fig.php'</span><span class="keyword">;<br />
<br />
class </span><span class="default">SampleFontImagePluggableSet<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">extends </span><span class="default">GMIPluggableSet<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$defaultVariables </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"text" </span><span class="keyword">=&gt; </span><span class="default">null</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"size" </span><span class="keyword">=&gt; </span><span class="default">null</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"font" </span><span class="keyword">=&gt; </span><span class="default">null</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"color" </span><span class="keyword">=&gt; </span><span class="string">"0x000000"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"alpha" </span><span class="keyword">=&gt; </span><span class="string">"100"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"padding" </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"width" </span><span class="keyword">=&gt; </span><span class="default">null</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"height" </span><span class="keyword">=&gt; </span><span class="default">null</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"align" </span><span class="keyword">=&gt; </span><span class="string">"left"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"valign" </span><span class="keyword">=&gt; </span><span class="string">"middle"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"bgcolor" </span><span class="keyword">=&gt; </span><span class="string">"0xffffff"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"antialias" </span><span class="keyword">=&gt; </span><span class="default">4<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">SampleFontImagePluggableSet</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">GMIPluggableSet</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getExpression</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"size {width}, {height};"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"autoresize none;"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"type gif, 256, {color: {bgcolor}};"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"padding {padding};"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"color {color: {bgcolor}};"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"fill;"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"color {color: {color}, {alpha}};"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"antialias {antialias};"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"font {font}, {size};"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"string {text}, 0, 0, {width}, {height}, {align}, {valign};"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getVariables</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">defaultVariables</span><span class="keyword">, </span><span class="default">$_GET</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$pluggableSet </span><span class="keyword">= new </span><span class="default">SampleFontImagePluggableSet</span><span class="keyword">();<br />
</span><span class="default">$fig </span><span class="keyword">= new </span><span class="default">FontImageGenerator</span><span class="keyword">();<br />
</span><span class="default">$fig</span><span class="keyword">-&gt;</span><span class="default">setPluggableSet</span><span class="keyword">(</span><span class="default">$pluggableSet</span><span class="keyword">);<br />
</span><span class="default">$fig</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This output a image with the text defined in $_GET['text'], the font in $_GET['font'], the text color in $_GET['color'], the background in $_GET['bgcolor'], and so on.<br />
<br />
The script file is available at: <a href="http://sgssweb.com/experiments/?file=PHPFontImageGenerator ." rel="nofollow" target="_blank">http://sgssweb.com/experiments/?file=PHPFontImageGenerator .</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65401""></a>
  <div class="note">
   <strong class="user">admin at sgssweb dot com</strong>
   <a href="#65401" class="date">29-Apr-2006 11:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote two classes: PHP Abstract Drawing Toolkit and PHP Graphics, the elements of PHP Font Image Generator2. An instance of the class Graphics can draw multi-sampling antialiased text, 7 horizontal alignment of text box (left, center, right, left-adjust, center-adjust, right-adjust, adjust), 3 vertical alignment (top, middle, bottom), and other Java-like methods.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">require_once </span><span class="string">"package.graphics.php"</span><span class="keyword">;<br />
<br />
</span><span class="default">$canvas </span><span class="keyword">= new </span><span class="default">Canvas</span><span class="keyword">();<br />
</span><span class="default">$canvas</span><span class="keyword">-&gt;</span><span class="default">setSize</span><span class="keyword">(</span><span class="default">400</span><span class="keyword">, </span><span class="default">400</span><span class="keyword">);<br />
</span><span class="default">$g </span><span class="keyword">=&amp; </span><span class="default">$canvas</span><span class="keyword">-&gt;</span><span class="default">getGraphics</span><span class="keyword">();<br />
</span><span class="default">$g</span><span class="keyword">-&gt;</span><span class="default">setColor</span><span class="keyword">(new </span><span class="default">Color</span><span class="keyword">(</span><span class="default">0xffffff</span><span class="keyword">));<br />
</span><span class="default">$g</span><span class="keyword">-&gt;</span><span class="default">fill</span><span class="keyword">();<br />
</span><span class="default">$g</span><span class="keyword">-&gt;</span><span class="default">setColor</span><span class="keyword">(new </span><span class="default">Color</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">));<br />
</span><span class="default">$g</span><span class="keyword">-&gt;</span><span class="default">setFont</span><span class="keyword">(new </span><span class="default">Font</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'font'</span><span class="keyword">], </span><span class="default">20</span><span class="keyword">));<br />
</span><span class="default">$g</span><span class="keyword">-&gt;</span><span class="default">drawString</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'text'</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">400</span><span class="keyword">, </span><span class="default">400</span><span class="keyword">, </span><span class="string">'center-adjust'</span><span class="keyword">, </span><span class="string">'middle'</span><span class="keyword">);<br />
</span><span class="default">$canvas</span><span class="keyword">-&gt;</span><span class="default">complete</span><span class="keyword">();<br />
</span><span class="default">$canvas</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The class script is here.<br />
<a href="http://sgssweb.com/experiments/?file=PHPFontImageGenerator2" rel="nofollow" target="_blank">http://sgssweb.com/experiments/?file=PHPFontImageGenerator2</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65251""></a>
  <div class="note">
   <strong class="user">jpetsel at riverviewtech dot net</strong>
   <a href="#65251" class="date">27-Apr-2006 12:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was looking at ugo's center and it was great for left to right centering, but it wouldn't center up and down.&nbsp; So with some changes to suit my needs this is what I came up with.&nbsp; Some of the notations are just for my edifcation so may mean nothing for you all but you will see I added a $posy that helps with centering up and down.&nbsp; I was also feeding my feilds from a form.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Set the content-type<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
<br />
</span><span class="comment">//1line per column<br />
</span><span class="default">$text</span><span class="keyword">=array(</span><span class="default">0</span><span class="keyword">=&gt;</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'linei'</span><span class="keyword">],</span><span class="default">1</span><span class="keyword">=&gt;</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'lineii'</span><span class="keyword">],<br />
</span><span class="default">2</span><span class="keyword">=&gt;</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'lineiii'</span><span class="keyword">],</span><span class="default">3</span><span class="keyword">=&gt;</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'lineiv'</span><span class="keyword">],</span><span class="default">4</span><span class="keyword">=&gt;</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'linev'</span><span class="keyword">]);<br />
<br />
</span><span class="default">$Image_Width</span><span class="keyword">=</span><span class="default">400</span><span class="keyword">;<br />
</span><span class="default">$Text_Size</span><span class="keyword">=</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'textsize'</span><span class="keyword">];<br />
</span><span class="default">$Image_Height</span><span class="keyword">=</span><span class="default">400</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Create the image<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor </span><span class="keyword">(</span><span class="default">$Image_Width</span><span class="keyword">, </span><span class="default">$Image_Height</span><span class="keyword">); </span><span class="comment">/* Create a blank image */<br />
<br />
// Create some colors<br />
</span><span class="default">$white </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
</span><span class="default">$grey </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
</span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">398</span><span class="keyword">, </span><span class="default">398</span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Replace path by your own font path<br />
</span><span class="default">$font </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'font_name'</span><span class="keyword">];<br />
<br />
for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Center the text<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Text_Box_Size </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$Text_Size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Text_Box_Width </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$Text_Box_Size</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] + </span><span class="default">$Text_Box_Size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Text_Box_Height </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$Text_Box_Size</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">] + </span><span class="default">$Text_Box_Size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Text_Height </span><span class="keyword">= </span><span class="default">$Text_Height </span><span class="keyword">+ </span><span class="default">$Text_Box_Height</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$posx </span><span class="keyword">= (</span><span class="default">$Image_Width </span><span class="keyword">- </span><span class="default">$Text_Box_Width</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$posy </span><span class="keyword">= (</span><span class="default">$Image_Height </span><span class="keyword">- </span><span class="default">$Text_Box_Height </span><span class="keyword">* </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">)) / </span><span class="default">2 </span><span class="keyword">+ </span><span class="default">$Text_Height</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; Add the text (***array imagettftext ( resource image, float size, float angle, <br />
&nbsp;&nbsp;&nbsp; int x, int y, int color, string fontfile, string text )***)<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$Text_Size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$posx</span><span class="keyword">, </span><span class="default">$posy</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
}<br />
<br />
</span><span class="comment">// Using imagepng() results in clearer text compared with imagejpeg()<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64654""></a>
  <div class="note">
   <strong class="user">ugo dot quaisse at gmail dot com</strong>
   <a href="#64654" class="date">19-Apr-2006 06:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a script that aim at center the (multi) lines :<br />
<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
<br />
</span><span class="comment">//1line per column<br />
</span><span class="default">$text</span><span class="keyword">=array(</span><span class="default">0</span><span class="keyword">=&gt;</span><span class="string">"line 1"</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">=&gt;</span><span class="string">"line 2"</span><span class="keyword">);<br />
<br />
</span><span class="default">$largeur</span><span class="keyword">=</span><span class="default">500</span><span class="keyword">;<br />
</span><span class="default">$line_height</span><span class="keyword">=</span><span class="default">30</span><span class="keyword">;<br />
</span><span class="default">$hauteur</span><span class="keyword">=</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">)*</span><span class="default">$line_height</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Create the image<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$largeur</span><span class="keyword">, </span><span class="default">$hauteur</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Create some colors<br />
</span><span class="default">$white </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
</span><span class="default">$grey </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">225</span><span class="keyword">, </span><span class="default">225</span><span class="keyword">, </span><span class="default">225</span><span class="keyword">);<br />
</span><span class="default">$blue </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">62</span><span class="keyword">, </span><span class="default">126</span><span class="keyword">);<br />
</span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$largeur</span><span class="keyword">, </span><span class="default">$hauteur</span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Replace path by your own font path<br />
</span><span class="default">$font </span><span class="keyword">= </span><span class="string">'font.ttf'</span><span class="keyword">;<br />
<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;=</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++) {<br />
</span><span class="comment">//Center the text<br />
</span><span class="default">$size </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">20</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
</span><span class="default">$long_text </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]+</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
</span><span class="default">$posx</span><span class="keyword">=(</span><span class="default">$largeur</span><span class="keyword">-</span><span class="default">$long_text</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">;<br />
</span><span class="comment">// Add the text<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$posx</span><span class="keyword">, </span><span class="default">$line_height</span><span class="keyword">+</span><span class="default">$line_height</span><span class="keyword">*</span><span class="default">$i</span><span class="keyword">, </span><span class="default">$blue</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
}<br />
<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63684""></a>
  <div class="note">
   <strong class="user">mats dot engstrom at gmail dot com</strong>
   <a href="#63684" class="date">28-Mar-2006 02:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'll second the note from --colobri--.&nbsp; <br />
<br />
Just adding --with-ttf and --with-freetype-dir=/usr/lib/ on the ./configure and then doing a "make; make install" is not enough.<br />
<br />
I had to do a "make clean" and then a "make install" in order to get the FreeType-support enabled.<br />
<br />
Here are my relevant ./configure lines:<br />
--with-gd \<br />
--enable-gd-native-ttf \<br />
--with-ttf \<br />
--with-freetype-dir=/usr/lib/ \<br />
--with-jpeg-dir=/usr/lib/libjpeg.so.62 \<br />
--enable-exif \</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62437""></a>
  <div class="note">
   <strong class="user">admin at phpru dot com</strong>
   <a href="#62437" class="date">28-Feb-2006 09:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On my conf: php5.1.2+apache 1.33<br />
iconv() function works very well with all cyrillic encodings, so you needn't to write your function like win2uni</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61227""></a>
  <div class="note">
   <strong class="user">--Colibri--</strong>
   <a href="#61227" class="date">28-Jan-2006 12:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have configured and compiled PHP with all the necessary command-line options and still get the error:<br />
<br />
Fatal error: Call to undefined function imagettftext()<br />
<br />
Try doing a "make clean"&nbsp; before building the php apache module:<br />
<br />
./configure [...]<br />
make clean<br />
make<br />
make install <br />
<br />
This may solve your problem (and hopefully keep you from wasting hours trying different compile options!)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60992""></a>
  <div class="note">
   <strong class="user">nospam at nospam dot nospam</strong>
   <a href="#60992" class="date">22-Jan-2006 03:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've found that upsampling your text by a factor of 8 or more can really improve the readability of generated text, especially in smaller font sizes (9 or less). I find it also helps with fonts that have kerning to reduce space between letters such as capital T and capital A (TA) where the top-right of the T will be cut off due to GD "features".<br />
<br />
I can't tell you, the reader, exactly how to do this, as it will depend on how you are currently generating your text, but essentially what you want to try doing is upsize your font by a factor of 8 and then scale down the resulting image by the same factor.<br />
<br />
So if you were using font size 10, use font size 80 and use imagecopyresampled() to divide the width/height down again by 8. The resulting image will be a few pixels different in width / height compared to direct text writing, so make sure to check your image sizes if you are using fixed dimensions.<br />
<br />
Play around with other factors, 16 is a bit nicer but results in a higher CPU/RAM load when processing. Any higher is unnecessary I think. If possible you should also cache the image to a file instead of reprocessing it each request.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60547""></a>
  <div class="note">
   <strong class="user">Mer`Zikain</strong>
   <a href="#60547" class="date">10-Jan-2006 12:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was looking for a way to add kerning to my text and finally just made this function to do it. Of course, if you're generating the size of the image based on the text you're putting in it, you'll have to figure out the new size to fit the new text width but I'm sure you can figure that out.<br />
<br />
for($i=0;$i&lt;strlen($text);$i++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Get single character<br />
&nbsp;&nbsp;&nbsp; $value=substr($text,$i,1);<br />
&nbsp;&nbsp;&nbsp; if($pval){ // check for existing previous character<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list($lx,$ly,$rx,$ry) = imagettfbbox($fontsize,0,$font,$pval);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $nxpos+=$rx+3;<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $nxpos=0;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Add the letter to the image<br />
&nbsp;&nbsp;&nbsp; imagettftext($im, $fontsize, 0, $nxpos, $ypos, $fontcolor, $font, $value);<br />
&nbsp;&nbsp;&nbsp; $pval=$value; // save current character for next loop<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58081""></a>
  <div class="note">
   <strong class="user">a4W</strong>
   <a href="#58081" class="date">23-Oct-2005 12:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function will make your text bold:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">drawboldtext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$x_cord</span><span class="keyword">, </span><span class="default">$y_cord</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">) <br />
{ <br />
&nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">); <br />
&nbsp;&nbsp; </span><span class="default">$_x </span><span class="keyword">= array(</span><span class="default">1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">); <br />
&nbsp;&nbsp; </span><span class="default">$_y </span><span class="keyword">= array(</span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); <br />
&nbsp;&nbsp; for(</span><span class="default">$n</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$n</span><span class="keyword">&lt;=</span><span class="default">8</span><span class="keyword">;</span><span class="default">$n</span><span class="keyword">++) <br />
&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">ImageTTFText</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$x_cord</span><span class="keyword">+</span><span class="default">$_x</span><span class="keyword">[</span><span class="default">$n</span><span class="keyword">], </span><span class="default">$y_cord</span><span class="keyword">+</span><span class="default">$_y</span><span class="keyword">[</span><span class="default">$n</span><span class="keyword">], </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">); <br />
&nbsp;&nbsp; } <br />
} <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57416""></a>
  <div class="note">
   <strong class="user">limalopex.eisfux.de</strong>
   <a href="#57416" class="date">03-Oct-2005 09:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have problems displaying german umlauts or other chars with an ascii value &gt; 127, try to convert the text-parameter first. The following function converts character-values &gt; 127 (both: UTF-8 + ANSI) to HTML's numeric coded entities:<br />
<br />
<span class="default">&lt;?php<br />
define</span><span class="keyword">(</span><span class="string">'EMPTY_STRING'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
<br />
function </span><span class="default">foxy_utf8_to_nce</span><span class="keyword">( <br />
&nbsp; </span><span class="default">$utf </span><span class="keyword">= </span><span class="default">EMPTY_STRING <br />
</span><span class="keyword">) { <br />
&nbsp; if(</span><span class="default">$utf </span><span class="keyword">== </span><span class="default">EMPTY_STRING</span><span class="keyword">) return(</span><span class="default">$utf</span><span class="keyword">); <br />
<br />
&nbsp; </span><span class="default">$max_count </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">; </span><span class="comment">// flag-bits in $max_mark ( 1111 1000 == 5 times 1) <br />
&nbsp; </span><span class="default">$max_mark </span><span class="keyword">= </span><span class="default">248</span><span class="keyword">; </span><span class="comment">// marker for a (theoretical ;-)) 5-byte-char and mask for a 4-byte-char; <br />
<br />
&nbsp; </span><span class="default">$html </span><span class="keyword">= </span><span class="default">EMPTY_STRING</span><span class="keyword">; <br />
&nbsp; for(</span><span class="default">$str_pos </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$str_pos </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$utf</span><span class="keyword">); </span><span class="default">$str_pos</span><span class="keyword">++) { <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$old_chr </span><span class="keyword">= </span><span class="default">$utf</span><span class="keyword">{</span><span class="default">$str_pos</span><span class="keyword">}; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$old_val </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">( </span><span class="default">$utf</span><span class="keyword">{</span><span class="default">$str_pos</span><span class="keyword">} ); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_val </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$utf8_marker </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// skip non-utf-8-chars <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">$old_val </span><span class="keyword">&gt; </span><span class="default">127 </span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$mark </span><span class="keyword">= </span><span class="default">$max_mark</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp;&nbsp; for(</span><span class="default">$byte_ctr </span><span class="keyword">= </span><span class="default">$max_count</span><span class="keyword">; </span><span class="default">$byte_ctr </span><span class="keyword">&gt; </span><span class="default">2</span><span class="keyword">; </span><span class="default">$byte_ctr</span><span class="keyword">--) { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// actual byte is utf-8-marker? <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( ( </span><span class="default">$old_val </span><span class="keyword">&amp; </span><span class="default">$mark&nbsp; </span><span class="keyword">) == ( (</span><span class="default">$mark </span><span class="keyword">&lt;&lt; </span><span class="default">1</span><span class="keyword">) &amp; </span><span class="default">255 </span><span class="keyword">) ) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$utf8_marker </span><span class="keyword">= </span><span class="default">$byte_ctr </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mark </span><span class="keyword">= (</span><span class="default">$mark </span><span class="keyword">&lt;&lt; </span><span class="default">1</span><span class="keyword">) &amp; </span><span class="default">255</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// marker found: collect following bytes <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$utf8_marker </span><span class="keyword">&gt; </span><span class="default">1 </span><span class="keyword">and isset( </span><span class="default">$utf</span><span class="keyword">{</span><span class="default">$str_pos </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">} ) ) { <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$str_off </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$new_val </span><span class="keyword">= </span><span class="default">$old_val </span><span class="keyword">&amp; (</span><span class="default">127 </span><span class="keyword">&gt;&gt; </span><span class="default">$utf8_marker</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp;&nbsp; for(</span><span class="default">$byte_ctr </span><span class="keyword">= </span><span class="default">$utf8_marker</span><span class="keyword">; </span><span class="default">$byte_ctr </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">; </span><span class="default">$byte_ctr</span><span class="keyword">--) { <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// check if following chars are UTF8 additional data blocks <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // UTF8 and ord() &gt; 127 <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$utf</span><span class="keyword">{</span><span class="default">$str_pos </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">}) &amp; </span><span class="default">192</span><span class="keyword">) == </span><span class="default">128 </span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_val </span><span class="keyword">= </span><span class="default">$new_val </span><span class="keyword">&lt;&lt; </span><span class="default">6</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str_off</span><span class="keyword">++; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// no need for Addition, bitwise OR is sufficient <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // 63: more UTF8-bytes; 0011 1111 <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_val </span><span class="keyword">= </span><span class="default">$new_val </span><span class="keyword">| ( </span><span class="default">ord</span><span class="keyword">( </span><span class="default">$utf</span><span class="keyword">{</span><span class="default">$str_pos </span><span class="keyword">+ </span><span class="default">$str_off</span><span class="keyword">} ) &amp; </span><span class="default">63 </span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// no UTF8, but ord() &gt; 127 <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // nevertheless convert first char to NCE <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">else { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_val </span><span class="keyword">= </span><span class="default">$old_val</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// build NCE-Code <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$html </span><span class="keyword">.= </span><span class="string">'&amp;#'</span><span class="keyword">.</span><span class="default">$new_val</span><span class="keyword">.</span><span class="string">';'</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// Skip additional UTF-8-Bytes <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$str_pos </span><span class="keyword">= </span><span class="default">$str_pos </span><span class="keyword">+ </span><span class="default">$str_off</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; else { <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$html </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$old_val</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$new_val </span><span class="keyword">= </span><span class="default">$old_val</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; } <br />
&nbsp; } <br />
&nbsp; return(</span><span class="default">$html</span><span class="keyword">); <br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56340""></a>
  <div class="note">
   <strong class="user">alexey at NOSPAMPLS dot ozerov dot de</strong>
   <a href="#56340" class="date">31-Aug-2005 12:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Notice that the path to the TrueType font has to be included in open_basedir list if open_basedir restriction is activated in php.ini.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55687""></a>
  <div class="note">
   <strong class="user">gav-alex at bk dot ru</strong>
   <a href="#55687" class="date">10-Aug-2005 09:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi all!<br />
When my hoster updated his php's libs at first minutes i've got the same problem as some of you.<br />
Php couldn't find the path to true type fonts.<br />
The solution in my case was to make the path look like this<br />
<span class="default">&lt;?php<br />
imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">620</span><span class="keyword">, </span><span class="default">260</span><span class="keyword">, </span><span class="default">$secondary_color</span><span class="keyword">, </span><span class="string">"./tahoma.ttf" </span><span class="keyword">, </span><span class="string">"NEWS"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>so as you can see i simply added "./"<br />
<br />
another tip that i wanted to add here is how to write in RUssian on image using imagettftext<br />
you simply have to change the function argument like this<br />
<span class="default">&lt;?php<br />
imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">15</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">575</span><span class="keyword">, </span><span class="default">300</span><span class="keyword">, </span><span class="default">$secondary_color</span><span class="keyword">, </span><span class="string">"./tahoma.ttf" </span><span class="keyword">, </span><span class="default">win2uni</span><span class="keyword">(</span><span class="string">"some word in russian"</span><span class="keyword">));<br />
&nbsp;</span><span class="default">?&gt;<br />
</span>where win2uni is the function that converts win1251 to unicode. here is the code of it<br />
<span class="default">&lt;?php <br />
<br />
&nbsp; </span><span class="comment">//&nbsp; Windows 1251 -&gt; Unicode<br />
&nbsp; </span><span class="keyword">function </span><span class="default">win2uni</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">convert_cyr_string</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="string">'w'</span><span class="keyword">,</span><span class="string">'i'</span><span class="keyword">); </span><span class="comment">//&nbsp; win1251 -&gt; iso8859-5<br />
&nbsp;&nbsp;&nbsp; //&nbsp; iso8859-5 -&gt; unicode:<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$result</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$charcode </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">.= (</span><span class="default">$charcode</span><span class="keyword">&gt;</span><span class="default">175</span><span class="keyword">)?</span><span class="string">"&amp;#"</span><span class="keyword">.(</span><span class="default">1040</span><span class="keyword">+(</span><span class="default">$charcode</span><span class="keyword">-</span><span class="default">176</span><span class="keyword">)).</span><span class="string">";"</span><span class="keyword">:</span><span class="default">$s</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
That's all today! Thanks for your attention!<br />
Alex</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54972""></a>
  <div class="note">
   <strong class="user">BuddyHacker</strong>
   <a href="#54972" class="date">21-Jul-2005 02:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A correction to Paul Reinheimer's note above regarding this PHP error:<br />
<br />
Fatal error: Call to undefined function imagettftext().<br />
<br />
Paul states that you need XPM libraries to resolve this issue.&nbsp; This is not true.&nbsp; There is an error message that originates from "configure" which mistakenly shows itself when other components are missing.&nbsp; For instance, if you tell "configure" to add JPEG support, and it can't find the libraries, it will tell you it can't find the JPEG libraries AND it will recommend adding --with-xpm to solve the problem.&nbsp; This recommendation is ill-placed and misleading.<br />
<br />
I received the same error message above, along with the recommendation to add XPM supprt.&nbsp; However I resolved it by adding the --with-freetype-dir&nbsp; AND --enable-gd-native-ttf&nbsp; options&nbsp; to the "configure" command line.&nbsp; I did _not_ need XPM.<br />
<br />
There are other variations to this error message, such as the script recommending adding JPEG support or PNG support to resolve it's own inability to locate other libraries.&nbsp; The script needs some cleanup in order to fix these poorly placed recommendations.<br />
<br />
FYI, imagettftext() is a call to one of the truetype fonts functions.&nbsp; It is NOT related in any way to the XPM libraries, so it is not required unless you explicitly want XPM functionality.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51494""></a>
  <div class="note">
   <strong class="user">nick</strong>
   <a href="#51494" class="date">01-Apr-2005 01:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A trivial function to get right or centre aligned horizontal text:<br />
<br />
function imagettftextalign($image, $size, $angle, $x, $y, $color, $font, $text, $alignment='L') {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; //check width of the text<br />
&nbsp;&nbsp;&nbsp; $bbox = imagettfbbox ($size, $angle, $font, $text);<br />
&nbsp;&nbsp;&nbsp; $textWidth = $bbox[2] - $bbox[0];<br />
&nbsp;&nbsp;&nbsp; switch ($alignment) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case "R":<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $x -= $textWidth; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case "C":<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $x -= $textWidth / 2;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; //write text<br />
&nbsp;&nbsp;&nbsp; imagettftext ($image, $size, $angle, $x, $y, $color, $font, $text);<br />
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50599""></a>
  <div class="note">
   <strong class="user">erik[at]phpcastle.com</strong>
   <a href="#50599" class="date">04-Mar-2005 04:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Remember!!!<br />
<br />
When uploading a font to your website you have to set the transfer mode to binary. It took me some time to find out :P. Tried to download the font from my website and it was spoiled.<br />
<br />
In your script, the path to your font, use realpath("arial.ttf") so there is no confusion about that.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48938""></a>
  <div class="note">
   <strong class="user">pillepop2003 at nospam dot yahoo dot de</strong>
   <a href="#48938" class="date">12-Jan-2005 05:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hey guys,<br />
<br />
check this function if you want to rotate the text around its center and not its "lower left" pivot-point:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Put center-rotated ttf-text into image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Same signature as imagettftext();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">imagettftext_cr</span><span class="keyword">(&amp;</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// retrieve boundingbox<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bbox </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// calculate deviation<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dx </span><span class="keyword">= (</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]-</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])/</span><span class="default">2.0 </span><span class="keyword">- (</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]-</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">])/</span><span class="default">2.0</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// deviation left-right<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dy </span><span class="keyword">= (</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]-</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])/</span><span class="default">2.0 </span><span class="keyword">+ (</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]-</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])/</span><span class="default">2.0</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// deviation top-bottom<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // new pivotpoint<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$px </span><span class="keyword">= </span><span class="default">$x</span><span class="keyword">-</span><span class="default">$dx</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$py </span><span class="keyword">= </span><span class="default">$y</span><span class="keyword">-</span><span class="default">$dy</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$px</span><span class="keyword">, </span><span class="default">$py</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Big up<br />
Phil</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45816""></a>
  <div class="note">
   <strong class="user">Paul Reinheimer</strong>
   <a href="#45816" class="date">20-Sep-2004 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you compiled PHP yourself but get an error:<br />
Fatal error: Call to undefined function imagettftext().<br />
<br />
You need to compile PHP with more options.<br />
<br />
--with-gd<br />
--enable-gd-native-ttf<br />
--with-png<br />
--with-zlib-dir=/usr/local/lib/zlib-1.2.1<br />
--with-ttf<br />
--with-jpeg-dir=/usr/local/lib/jpeg-6b/<br />
--with-freetype-dir=/usr/local/lib/freetype-2.1.9/<br />
--with-xpm-dir=/usr/X11R6/<br />
<br />
The next set deal with setting up GD, and the appropriate options. Just enabling GD, ttf, png &amp; jpeg is NOT enough. You also need Freetype and XPM.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44127""></a>
  <div class="note">
   <strong class="user">plusplus7 at hotmail dot com</strong>
   <a href="#44127" class="date">15-Jul-2004 01:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting all rectangles instead of text, it may well mean that your ttf font is not opentype, particularly if it is an older freeware one. This requirement didn't exist in older versions so you may find that your font stops working after you upgrade. To fix this problem, try downloading the free MS Volt utility. From there, open your font file, and then click on Compile, and resave.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27335""></a>
  <div class="note">
   
   <a href="#27335" class="date">02-Dec-2002 11:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have an older version of the GD library, but wish to use a font file which has spaces in the path, you should convert the path into DOS style names. This will only work on windows.<br />
<br />
For example:<br />
C:\reallylongpath\reallylongpath\font.ttf<br />
Would become:<br />
C:\really~1\really~1\font.ttf</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagettfbbox.html">imagettfbbox</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagetypes.html">imagetypes</a></div>
 <div class="up"><a href="ref.image.html">GD and Image Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
