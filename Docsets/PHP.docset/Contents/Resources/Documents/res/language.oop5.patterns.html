<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Patterns</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="language.oop5.iterations.html">Object Iteration</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="language.oop5.magic.html">Magic Methods</a></div>
 <div class="up"><a href="language.oop5.html">Classes and Objects</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="language.oop5.patterns" class="sect1">
 <h2 class="title">Patterns</h2>
 <p class="para">
  Patterns are ways to describe best practices and good designs.
  They show a flexible solution to common programming problems.
 </p>
 
 <div class="sect2" id="language.oop5.patterns.factory">
  <h3 class="title">Factory</h3>
  <p class="para">
   The Factory pattern allows for the instantiation of objects
   at runtime. It is called a Factory Pattern since it is
   responsible for &quot;manufacturing&quot; an object. A Parameterized Factory receives
   the name of the class to instantiate as argument.
  </p>
  <div class="example" id="example-203">
   <p><b>Example #1 Parameterized Factory Method</b></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Example<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;The&nbsp;parameterized&nbsp;factory&nbsp;method<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">factory</span><span style="color: #007700">(</span><span style="color: #0000BB">$type</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(include_once&nbsp;</span><span style="color: #DD0000">'Drivers/'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$type&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'.php'</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$classname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Driver_'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$type</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;</span><span style="color: #0000BB">$classname</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">Exception</span><span style="color: #007700">(</span><span style="color: #DD0000">'Driver&nbsp;not&nbsp;found'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>
    Defining this method in a class allows drivers to be loaded on the
    fly. If the <i>Example</i> class was a database
    abstraction class, loading a <i>MySQL</i> and
    <i>SQLite</i> driver could be done as follows:
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;Load&nbsp;a&nbsp;MySQL&nbsp;Driver<br /></span><span style="color: #0000BB">$mysql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Example</span><span style="color: #007700">::</span><span style="color: #0000BB">factory</span><span style="color: #007700">(</span><span style="color: #DD0000">'MySQL'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Load&nbsp;an&nbsp;SQLite&nbsp;Driver<br /></span><span style="color: #0000BB">$sqlite&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Example</span><span style="color: #007700">::</span><span style="color: #0000BB">factory</span><span style="color: #007700">(</span><span style="color: #DD0000">'SQLite'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </div>
 
 <div class="sect2" id="language.oop5.patterns.singleton">
  <h3 class="title">Singleton</h3>
  <p class="para">
   The Singleton ensures that there can be only one instance of a Class and provides a 
   global access point to that instance. Singleton is a &quot;Gang of Four&quot; Creational Pattern.
  </p>
  <p class="para">The Singleton pattern is often implemented in Database Classes, Loggers, Front 
   Controllers or Request and Response objects.
  </p>
  
  <div class="example" id="example-204">
   <p><b>Example #2 Singleton example</b></p>
   <div class="example-contents"><div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Example<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;</span><span style="color: #0000BB">$instance</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">singleton</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!isset(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$instance</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Creating&nbsp;new&nbsp;instance.'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$className&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">__CLASS__</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$instance&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">$className</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$instance</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">increment</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">count</span><span style="color: #007700">++;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__clone</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #DD0000">'Clone&nbsp;is&nbsp;not&nbsp;allowed.'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__wakeup</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #DD0000">'Unserializing&nbsp;is&nbsp;not&nbsp;allowed.'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>Illustrated below is how the Singleton behaves</p></div>
   <div class="example-contents"><div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$singleton&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Example</span><span style="color: #007700">::</span><span style="color: #0000BB">singleton</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;prints&nbsp;"Creating&nbsp;new&nbsp;instance."<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$singleton</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">increment</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;0<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$singleton</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">increment</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;1<br /><br /></span><span style="color: #0000BB">$singleton&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Example</span><span style="color: #007700">::</span><span style="color: #0000BB">singleton</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;reuses&nbsp;existing&nbsp;instance&nbsp;now<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$singleton</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">increment</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;2<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$singleton</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">increment</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;3<br /><br />//&nbsp;all&nbsp;of&nbsp;these&nbsp;will&nbsp;raise&nbsp;a&nbsp;Fatal&nbsp;Error<br /></span><span style="color: #0000BB">$singleton2&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Example</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$singleton3&nbsp;</span><span style="color: #007700">=&nbsp;clone&nbsp;</span><span style="color: #0000BB">$singleton</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$singleton4&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">unserialize</span><span style="color: #007700">(</span><span style="color: #0000BB">serialize</span><span style="color: #007700">(</span><span style="color: #0000BB">$singleton</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
  <div class="warning"><b class="warning">Warning</b>
   <p class="para">
    The Singleton pattern is one of the more controversial patterns. Critics argue that 
    Singletons introduce Global State into an application and tightly couple the Singleton 
    and its consuming classes. This leads to hidden dependencies and unexpected side-effects, 
    which in turn leads to code that is harder to test and maintain.
   </p>
   <p class="para">
    Critics further argue that it is pointless to use a Singleton in a Shared Nothing Architecture 
    like PHP where objects are unique within the Request only anyways. It is easier and cleaner to 
    create collaborator object graphs by using Builders and Factory patterns once at the beginning 
    of the Request.
   </p>
   <p class="para">
    Singletons also violate several of the &quot;SOLID&quot; OOP design principles and the Law of Demeter.
    Singletons cannot be serialized. They cannot be subtyped (before PHP 5.3) and won&#039;t be Garbage
    Collected because of the instance being stored as a static attribute of the Singleton.
   </p>   
  </div>
 </div>
 
</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="106747""></a>
  <div class="note">
   <strong class="user">geliscan[at]gmail[dot]com</strong>
   <a href="#106747" class="date">03-Dec-2011 03:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a simple Command Pattern example which performs Undo operation on a calculator. You may use callbacks in order to verify open-close principle.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">abstract class </span><span class="default">Command </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; abstract public function </span><span class="default">unExecute </span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; abstract public function </span><span class="default">Execute </span><span class="keyword">();<br />
}<br />
class </span><span class="default">concreteCommand </span><span class="keyword">extends </span><span class="default">Command </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$operator</span><span class="keyword">,</span><span class="default">$operand</span><span class="keyword">,</span><span class="default">$calculator</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct </span><span class="keyword">(</span><span class="default">$calculator</span><span class="keyword">,</span><span class="default">$operator</span><span class="keyword">,</span><span class="default">$operand</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">operator </span><span class="keyword">= </span><span class="default">$operator</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">operand </span><span class="keyword">= </span><span class="default">$operand</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">calculator </span><span class="keyword">= </span><span class="default">$calculator</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">Execute</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">calculator</span><span class="keyword">-&gt;</span><span class="default">Action</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">operator</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">operand</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">unExecute </span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">calculator</span><span class="keyword">-&gt;</span><span class="default">Action</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">Undo</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">operator</span><span class="keyword">),</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">operand</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">Undo </span><span class="keyword">(</span><span class="default">$operator</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$operator</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'+'</span><span class="keyword">: return </span><span class="string">'-'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'-'</span><span class="keyword">: return </span><span class="string">'+'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'*'</span><span class="keyword">: return </span><span class="string">'/'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'/'</span><span class="keyword">: return </span><span class="string">'*'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class </span><span class="default">Calculator </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$current</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">Action</span><span class="keyword">(</span><span class="default">$operator</span><span class="keyword">,</span><span class="default">$operand</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$operator</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'+'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current </span><span class="keyword">+= </span><span class="default">$operand</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'-'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current </span><span class="keyword">-= </span><span class="default">$operand</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'*'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current </span><span class="keyword">*= </span><span class="default">$operand</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'/'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current </span><span class="keyword">/= </span><span class="default">$operand</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">getCurrent</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class </span><span class="default">Invoker </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$commands</span><span class="keyword">,</span><span class="default">$calculator</span><span class="keyword">,</span><span class="default">$current</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current </span><span class="keyword">=-</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">Undo</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">commands</span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">]-&gt;</span><span class="default">unExecute</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">Compute</span><span class="keyword">(</span><span class="default">$command</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$command</span><span class="keyword">-&gt;</span><span class="default">Execute</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">commands</span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">] = </span><span class="default">$command</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Example Usage:<br />
<br />
<span class="default">&lt;?php<br />
$User </span><span class="keyword">= new </span><span class="default">Invoker</span><span class="keyword">();<br />
</span><span class="default">$calculator </span><span class="keyword">= new </span><span class="default">Calculator</span><span class="keyword">();<br />
</span><span class="default">$command </span><span class="keyword">= new </span><span class="default">concreteCommand</span><span class="keyword">(</span><span class="default">$calculator</span><span class="keyword">,</span><span class="string">'+'</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">);<br />
</span><span class="default">$User</span><span class="keyword">-&gt;</span><span class="default">Compute</span><span class="keyword">(</span><span class="default">$command</span><span class="keyword">);<br />
echo </span><span class="string">"After +5: "</span><span class="keyword">.</span><span class="default">$calculator</span><span class="keyword">-&gt;</span><span class="default">getCurrent</span><span class="keyword">().</span><span class="string">"&lt;br/&gt;"</span><span class="keyword">;<br />
</span><span class="default">$command </span><span class="keyword">= new </span><span class="default">concreteCommand</span><span class="keyword">(</span><span class="default">$calculator</span><span class="keyword">,</span><span class="string">'*'</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">);<br />
</span><span class="default">$User</span><span class="keyword">-&gt;</span><span class="default">Compute</span><span class="keyword">(</span><span class="default">$command</span><span class="keyword">);<br />
echo </span><span class="string">"After *7: "</span><span class="keyword">.</span><span class="default">$calculator</span><span class="keyword">-&gt;</span><span class="default">getCurrent</span><span class="keyword">().</span><span class="string">"&lt;br/&gt;"</span><span class="keyword">;<br />
</span><span class="default">$command </span><span class="keyword">= new </span><span class="default">concreteCommand</span><span class="keyword">(</span><span class="default">$calculator</span><span class="keyword">,</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$User</span><span class="keyword">-&gt;</span><span class="default">Compute</span><span class="keyword">(</span><span class="default">$command</span><span class="keyword">);<br />
echo </span><span class="string">"After /2: "</span><span class="keyword">.</span><span class="default">$calculator</span><span class="keyword">-&gt;</span><span class="default">getCurrent</span><span class="keyword">().</span><span class="string">"&lt;br/&gt;"</span><span class="keyword">;<br />
</span><span class="default">$command </span><span class="keyword">= new </span><span class="default">concreteCommand</span><span class="keyword">(</span><span class="default">$calculator</span><span class="keyword">,</span><span class="string">'-'</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">);<br />
</span><span class="default">$User</span><span class="keyword">-&gt;</span><span class="default">Compute</span><span class="keyword">(</span><span class="default">$command</span><span class="keyword">);<br />
echo </span><span class="string">"After -10: "</span><span class="keyword">.</span><span class="default">$calculator</span><span class="keyword">-&gt;</span><span class="default">getCurrent</span><span class="keyword">().</span><span class="string">"&lt;br/&gt;"</span><span class="keyword">;<br />
</span><span class="default">$User</span><span class="keyword">-&gt;</span><span class="default">Undo</span><span class="keyword">();<br />
echo </span><span class="string">"Undo Operation: "</span><span class="keyword">.</span><span class="default">$calculator</span><span class="keyword">-&gt;</span><span class="default">getCurrent</span><span class="keyword">().</span><span class="string">"&lt;br/&gt;"</span><span class="keyword">;<br />
</span><span class="default">$User</span><span class="keyword">-&gt;</span><span class="default">Undo</span><span class="keyword">();<br />
echo </span><span class="string">"Undo Operation: "</span><span class="keyword">.</span><span class="default">$calculator</span><span class="keyword">-&gt;</span><span class="default">getCurrent</span><span class="keyword">().</span><span class="string">"&lt;br/&gt;"</span><span class="keyword">;<br />
</span><span class="default">$User</span><span class="keyword">-&gt;</span><span class="default">Undo</span><span class="keyword">();<br />
echo </span><span class="string">"Undo Operation: "</span><span class="keyword">.</span><span class="default">$calculator</span><span class="keyword">-&gt;</span><span class="default">getCurrent</span><span class="keyword">().</span><span class="string">"&lt;br/&gt;"</span><span class="keyword">;<br />
</span><span class="default">$User</span><span class="keyword">-&gt;</span><span class="default">Undo</span><span class="keyword">();<br />
echo </span><span class="string">"Undo Operation: "</span><span class="keyword">.</span><span class="default">$calculator</span><span class="keyword">-&gt;</span><span class="default">getCurrent</span><span class="keyword">().</span><span class="string">"&lt;br/&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
and Output:<br />
<br />
After +5: 5<br />
After *7: 35<br />
After /2: 17.5<br />
After -10: 7.5<br />
Undo Operation: 17.5<br />
Undo Operation: 35<br />
Undo Operation: 5<br />
Undo Operation: 0</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102617""></a>
  <div class="note">
   <strong class="user">patrick at bierans dot de</strong>
   <a href="#102617" class="date">24-Feb-2011 10:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is possible to use every class <br />
as if it is a singleton with a little abstraction.<br />
<br />
I wrote some code to show you:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">class </span><span class="default">MyEngine</span><span class="keyword">{ </span><span class="comment">/* static */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">static </span><span class="default">$singletons</span><span class="keyword">=array();<br />
&nbsp;&nbsp;&nbsp; static function </span><span class="default">singletonizer</span><span class="keyword">(</span><span class="default">$classname</span><span class="keyword">,</span><span class="default">$classarguments</span><span class="keyword">=array()){<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$sca</span><span class="keyword">=</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$classarguments</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">$singletons</span><span class="keyword">[</span><span class="default">$classname</span><span class="keyword">][</span><span class="default">$sca</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">class_exists</span><span class="keyword">(</span><span class="default">$classname</span><span class="keyword">)) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* auto loader, add error reporting for missing classes etc */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">include(</span><span class="string">"classes/"</span><span class="keyword">.</span><span class="default">$classname</span><span class="keyword">.</span><span class="string">"/.class.php"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">$singletons</span><span class="keyword">[</span><span class="default">$classname</span><span class="keyword">][</span><span class="default">$sca</span><span class="keyword">]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; =&amp; new </span><span class="default">$classname</span><span class="keyword">(</span><span class="default">$classarguments</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">/* this is the pointer/reference and not a new object! */<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">$singletons</span><span class="keyword">[</span><span class="default">$classname</span><span class="keyword">][</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$classarguments</span><span class="keyword">)];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; static function </span><span class="default">debug</span><span class="keyword">(</span><span class="default">$msg</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">.</span><span class="default">$msg</span><span class="keyword">.</span><span class="string">"\t"</span><span class="keyword">.</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">).</span><span class="string">"&lt;/pre&gt;\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>&nbsp;&nbsp; <br />
<br />
Now let's test it!<br />
Defining a class:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">class </span><span class="default">testclass</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">debug</span><span class="keyword">(</span><span class="string">"- testclass contructed with "</span><span class="keyword">,</span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$args</span><span class="keyword">[</span><span class="string">"value"</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">set</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">[</span><span class="string">"value"</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">value</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">set</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">value </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">debug</span><span class="keyword">(</span><span class="string">"- testclass set value ="</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">value</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">get</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">debug</span><span class="keyword">(</span><span class="string">"- testclass get value ="</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
And here we run a testcase:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $args</span><span class="keyword">=array(</span><span class="string">"value"</span><span class="keyword">=&gt;</span><span class="default">12</span><span class="keyword">);<br />
&nbsp; </span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">debug</span><span class="keyword">(</span><span class="string">'create $a'</span><span class="keyword">,</span><span class="string">'expecting: contruct and set 12'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$a</span><span class="keyword">=</span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">singletonizer</span><span class="keyword">(</span><span class="string">"testclass"</span><span class="keyword">,</span><span class="default">$args</span><span class="keyword">); <br />
&nbsp; </span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">set</span><span class="keyword">(</span><span class="default">13</span><span class="keyword">);<br />
&nbsp; </span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">debug</span><span class="keyword">(</span><span class="string">'create $b'</span><span class="keyword">,</span><span class="string">'expecting: just load it. should be 13, no contruct'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">singletonizer</span><span class="keyword">(</span><span class="string">"testclass"</span><span class="keyword">,</span><span class="default">$args</span><span class="keyword">); <br />
&nbsp; </span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">debug</span><span class="keyword">(</span><span class="string">"b value is (expecting 13)"</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">());<br />
&nbsp; </span><span class="default">$args</span><span class="keyword">=array(</span><span class="string">"value"</span><span class="keyword">=&gt;</span><span class="default">11</span><span class="keyword">);<br />
&nbsp; </span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">debug</span><span class="keyword">(</span><span class="string">'create $c'</span><span class="keyword">,</span><span class="string">'different args -&gt; new construct, set 11'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">singletonizer</span><span class="keyword">(</span><span class="string">"testclass"</span><span class="keyword">,</span><span class="default">$args</span><span class="keyword">); <br />
&nbsp; </span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">debug</span><span class="keyword">(</span><span class="string">"c value is (expecting 11)"</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">());<br />
&nbsp; </span><span class="default">$args</span><span class="keyword">=array(</span><span class="string">"value"</span><span class="keyword">=&gt;</span><span class="default">12</span><span class="keyword">);<br />
&nbsp; </span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">debug</span><span class="keyword">(</span><span class="string">'create $d'</span><span class="keyword">,</span><span class="string">'recognize args, load it, should be 13'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$d</span><span class="keyword">=</span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">singletonizer</span><span class="keyword">(</span><span class="string">"testclass"</span><span class="keyword">,</span><span class="default">$args</span><span class="keyword">);<br />
&nbsp; </span><span class="default">MyEngine</span><span class="keyword">::</span><span class="default">debug</span><span class="keyword">(</span><span class="string">"d value is (expecting 13)"</span><span class="keyword">,</span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">());<br />
</span><span class="default">?&gt;<br />
</span><br />
feedback welcome!<br />
<br />
HTH :)<br />
<br />
Patrick from Berlin, Germany</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101982""></a>
  <div class="note">
   <strong class="user">sjh</strong>
   <a href="#101982" class="date">21-Jan-2011 06:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The problem with the singleton pattern is that there aren't really many cases where it is a true singleton.<br />
<br />
There are many cases where you want to get access to a specific object that is the same each time. <br />
For example accessing objects that have different drivers.<br />
<br />
In this instance its better to use the Lazy Initialization pattern:<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">abstract function </span><span class="default">Lazy_Initialization_Object </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Set up the array of instances */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">protected static </span><span class="default">$instances </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/** Make sure the constructor isn't accessible to <br />
&nbsp;&nbsp; &nbsp; * the rest of the world <br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private function </span><span class="default">__construct</span><span class="keyword">() {}<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Returns a specific object that relies on the <br />
&nbsp;&nbsp; &nbsp; * parameter passed<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param string class name to be returned<br />
&nbsp;&nbsp; &nbsp; * @throws Exception if $type doesn't extend __CLASS__<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">get_object</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$reflection_class </span><span class="keyword">= new </span><span class="default">ReflectionClass</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check if the object is a Lazy Iinitialization Object<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( ! </span><span class="default">$reflection_class</span><span class="keyword">-&gt;</span><span class="default">isSubclassOf</span><span class="keyword">(</span><span class="default">__CLASS__</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"</span><span class="default">$type</span><span class="string"> does not extend __CLASS__"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check if the object already exists in the pool <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( ! </span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">,</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// If not initialise a new one and place it in the pool<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$type</span><span class="keyword">]=</span><span class="default">$reflection_class</span><span class="keyword">-&gt;</span><span class="default">newInstance</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Return the object you want <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$type</span><span class="keyword">]&nbsp; &nbsp; <br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/** Specify all the functions that these drivers have in common */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public abstract function </span><span class="default">initialize</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">display</span><span class="keyword">() {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="default">$content<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$content</span><span class="keyword">;<br />
}<br />
<br />
class </span><span class="default">Person_Driver_HTML </span><span class="keyword">extends </span><span class="default">Lazy_Initialization_Object </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; public function </span><span class="default">initialize</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="string">"&lt;p&gt;Name: </span><span class="default">$name</span><span class="string">&lt;/p&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
class </span><span class="default">Person_Driver_Raw </span><span class="keyword">extends </span><span class="default">Lazy_Initialization_Object </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">initialize</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="string">"name: </span><span class="default">$name</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } <br />
<br />
}<br />
<br />
</span><span class="default">Lazy_Initialization_Object</span><span class="keyword">::<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">get_object</span><span class="keyword">(</span><span class="string">"Person_Driver_Raw"</span><span class="keyword">)-&gt;</span><span class="default">initialize</span><span class="keyword">(</span><span class="string">"fifi"</span><span class="keyword">);<br />
<br />
</span><span class="default">Lazy_Initialization_Object</span><span class="keyword">::<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">get_object</span><span class="keyword">(</span><span class="string">"Person_Driver_HTML"</span><span class="keyword">)-&gt;</span><span class="default">initialize</span><span class="keyword">(</span><span class="string">"fifi"</span><span class="keyword">);<br />
<br />
</span><span class="default">Lazy_Initialization_Object</span><span class="keyword">::<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">get_object</span><span class="keyword">(</span><span class="string">"Person_Driver_HTML"</span><span class="keyword">)-&gt;</span><span class="default">display</span><span class="keyword">(); <br />
</span><span class="comment">// will output "&lt;p&gt;Name: fifi&lt;/p&gt;"<br />
</span><span class="default">Lazy_Initialization_Object</span><span class="keyword">::<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">get_object</span><span class="keyword">(</span><span class="string">"Person_Driver_Raw"</span><span class="keyword">)-&gt;</span><span class="default">display</span><span class="keyword">(); <br />
</span><span class="comment">// will output "name: fifi";<br />
<br />
</span><span class="keyword">echo </span><span class="default">Lazy_Initialization_Object</span><span class="keyword">::<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">get_object</span><span class="keyword">(</span><span class="string">"Person_Driver_HTML"</span><span class="keyword">) === <br />
&nbsp;&nbsp; &nbsp; </span><span class="default">Lazy_Initialization_Object</span><span class="keyword">::<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">get_object</span><span class="keyword">(</span><span class="string">"Person_Driver_HTML"</span><span class="keyword">); </span><span class="comment">// TRUE<br />
<br />
</span><span class="keyword">echo </span><span class="default">Lazy_Initialization_Object</span><span class="keyword">::<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">get_object</span><span class="keyword">(</span><span class="string">"Person_Driver_HTML"</span><span class="keyword">) === <br />
&nbsp;&nbsp; &nbsp; </span><span class="default">Lazy_Initialization_Object</span><span class="keyword">::<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">get_object</span><span class="keyword">(</span><span class="string">"Person_Driver_Raw"</span><span class="keyword">); </span><span class="comment">// FALSE<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99446""></a>
  <div class="note">
   <strong class="user">boukeversteegh at gmail dot com</strong>
   <a href="#99446" class="date">18-Aug-2010 02:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've come up with an interesting and intuitive way to define a generic Factory class. It's basically an empty object that remembers all operations you perform on it. You can then request an actual instance, and all operations are repeated on that instance. The order of the operations is preserved.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># If you want a factory that initializes an object like this:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myobject </span><span class="keyword">= new </span><span class="default">MyObject</span><span class="keyword">(</span><span class="string">'arg1'</span><span class="keyword">, </span><span class="string">'arg2'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myobject</span><span class="keyword">-&gt;</span><span class="default">doFooBar</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myobject</span><span class="keyword">-&gt;</span><span class="default">baz </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># You write:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$f_myobject </span><span class="keyword">= new </span><span class="default">MagicFactory</span><span class="keyword">(</span><span class="string">'MyObject'</span><span class="keyword">, </span><span class="string">'arg1'</span><span class="keyword">, </span><span class="string">'arg2'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$f_myobject</span><span class="keyword">-&gt;</span><span class="default">doFooBar</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$f_myobject</span><span class="keyword">-&gt;</span><span class="default">baz </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># You can now get the same object like this:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myobject </span><span class="keyword">= </span><span class="default">$f_myobject</span><span class="keyword">-&gt;</span><span class="default">instance</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Generic Factory class<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * This Magic Factory will remember all operations you perform on it,<br />
&nbsp;&nbsp; &nbsp; * and apply them to the object it instantiates.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">MagicFactory </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; private </span><span class="default">$history</span><span class="keyword">, </span><span class="default">$class</span><span class="keyword">, </span><span class="default">$constructor_args</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Create a factory of given class. Accepts extra arguments to be passed to<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * class constructor.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">__construct</span><span class="keyword">( </span><span class="default">$class </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">class </span><span class="keyword">= </span><span class="default">$class</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">constructor_args </span><span class="keyword">= </span><span class="default">array_slice</span><span class="keyword">( </span><span class="default">$args</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">__call</span><span class="keyword">( </span><span class="default">$method</span><span class="keyword">, </span><span class="default">$args </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">history</span><span class="keyword">[] = Array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'action'&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'call'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'method'&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">$method</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'args'&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">$args<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">__set</span><span class="keyword">( </span><span class="default">$property</span><span class="keyword">, </span><span class="default">$value </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">history</span><span class="keyword">[] = Array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'action'&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'set'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'property'&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">$property</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'value'&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">$value<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Creates an instance and performs all operations that were done on this MagicFactory<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">instance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># use Reflection to create a new instance, using the $args <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$reflection_object </span><span class="keyword">= new </span><span class="default">ReflectionClass</span><span class="keyword">( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">class </span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$object </span><span class="keyword">= </span><span class="default">$reflection_object</span><span class="keyword">-&gt;</span><span class="default">newInstanceArgs</span><span class="keyword">( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">constructor_args </span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Alternative method that doesn't use ReflectionClass, but doesn't support variable<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # number of constructor parameters.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //$object = new $this-&gt;class();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Repeat all remembered operations, apply to new object.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">history </span><span class="keyword">as </span><span class="default">$item </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$item</span><span class="keyword">[</span><span class="string">'action'</span><span class="keyword">] == </span><span class="string">'call' </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">( Array( </span><span class="default">$object</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">[</span><span class="string">'method'</span><span class="keyword">] ), </span><span class="default">$item</span><span class="keyword">[</span><span class="string">'args'</span><span class="keyword">] );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$item</span><span class="keyword">[</span><span class="string">'action'</span><span class="keyword">] == </span><span class="string">'set' </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$object</span><span class="keyword">-&gt;{</span><span class="default">$item</span><span class="keyword">[</span><span class="string">'property'</span><span class="keyword">]} = </span><span class="default">$item</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Done<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$object</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="default">?&gt;<br />
</span><br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">Person </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; private </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$sirname</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$age</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">( </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$sirname </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sirname </span><span class="keyword">= </span><span class="default">$sirname</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">setName</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">introduce</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"Hello, my name is </span><span class="keyword">{</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">}</span><span class="string"> </span><span class="keyword">{</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sirname</span><span class="keyword">}</span><span class="string">! I'm </span><span class="keyword">{</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">age</span><span class="keyword">}</span><span class="string"> years old."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Setup a factory<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$person_factory </span><span class="keyword">= new </span><span class="default">MagicFactory</span><span class="keyword">(</span><span class="string">'Person'</span><span class="keyword">, </span><span class="string">'John'</span><span class="keyword">, </span><span class="string">'Johnson'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$person_factory</span><span class="keyword">-&gt;</span><span class="default">setName</span><span class="keyword">(</span><span class="string">'Jack'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$person_factory</span><span class="keyword">-&gt;</span><span class="default">age </span><span class="keyword">= </span><span class="default">55</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Get an instance<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$jack </span><span class="keyword">= </span><span class="default">$person_factory</span><span class="keyword">-&gt;</span><span class="default">instance</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$jack</span><span class="keyword">-&gt;</span><span class="default">introduce</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Prints:<br />
&nbsp;&nbsp;&nbsp; # Hello, my name is Jack Johnson! I'm 55 years old</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98353""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#98353" class="date">10-Jun-2010 05:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Singleton in php doesn't responded like java (or others), the static instance resets on every request......</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96566""></a>
  <div class="note">
   <strong class="user">Deman</strong>
   <a href="#96566" class="date">05-Mar-2010 07:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Php needs macros! That's right php seems almost unusable sometimes without precompiler. Fortunately you can generate php code with php and (easily) cache it so you can still take advantage of the php optimizing capabilities. It just creates a mess when debugging, no big deal ;)<br />
<br />
You need to extend the language to your own needs.<br />
<br />
But this singleton business might just work without without macros, not that nicely though.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">singleton</span><span class="keyword">(</span><span class="default">$class </span><span class="keyword">= </span><span class="default">__CLASS__</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">[</span><span class="default">$classname</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">[</span><span class="default">$classname</span><span class="keyword">] = new </span><span class="default">$classname</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">[</span><span class="default">$classname</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class </span><span class="default">SubClass </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">singleton</span><span class="keyword">(</span><span class="default">$class </span><span class="keyword">= </span><span class="default">__CLASS__</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">singleton</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class </span><span class="default">SubSubClass </span><span class="keyword">extends </span><span class="default">SubClass </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">singleton</span><span class="keyword">(</span><span class="default">$class </span><span class="keyword">= </span><span class="default">__CLASS__</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">singleton</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
As you can see, the static $instance can be an associative array holding all the instances of derived classes, but you still can't work around overriding the singleton/getInstance static method... That's what macros or language extensions would be for...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">SINGLETON</span><span class="keyword">(</span><span class="default">SubClass</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*...*/<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
Translate to:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">SubClass </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">singleton</span><span class="keyword">(</span><span class="default">$class </span><span class="keyword">= </span><span class="default">__CLASS__</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">singleton</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*...*/<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95196""></a>
  <div class="note">
   <strong class="user">quentinberlemont at gmail dot com</strong>
   <a href="#95196" class="date">17-Dec-2009 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Class Singleton is a generic implementation of the singleton design pattern.<br />
&nbsp;*<br />
&nbsp;* Extending this class allows to make a single instance easily accessible by<br />
&nbsp;* many other objects.<br />
&nbsp;*<br />
&nbsp;* @author&nbsp; &nbsp;&nbsp; Quentin Berlemont &lt;quentinberlemont@gmail.com&gt;<br />
&nbsp;*/<br />
</span><span class="keyword">abstract class </span><span class="default">Singleton<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Prevents direct creation of object.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param&nbsp; void<br />
&nbsp;&nbsp; &nbsp; * @return void<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">protected function </span><span class="default">__construct</span><span class="keyword">() {}<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Prevents to clone the instance.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param&nbsp; void<br />
&nbsp;&nbsp; &nbsp; * @return void<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">final private function </span><span class="default">__clone</span><span class="keyword">() {}<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Gets a single instance of the class the static method is called in.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * See the {@link <a href="http://php.net/lsb Late Static Bindings} feature for more" rel="nofollow" target="_blank">http://php.net/lsb Late Static Bindings} feature for more</a><br />
&nbsp;&nbsp; &nbsp; * information.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param&nbsp; void<br />
&nbsp;&nbsp; &nbsp; * @return object Returns a single instance of the class.<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">final static public function </span><span class="default">getInstance</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static </span><span class="default">$instance </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$instance </span><span class="keyword">?: </span><span class="default">$instance </span><span class="keyword">= new static;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
E.g.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Foo class<br />
</span><span class="keyword">class </span><span class="default">Foo </span><span class="keyword">extends \</span><span class="default">Framework</span><span class="keyword">\</span><span class="default">Core</span><span class="keyword">\</span><span class="default">Singleton<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Bar method<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">bar</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">__CLASS__ </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// Returns a single instance of Foo class<br />
</span><span class="default">$foo </span><span class="keyword">= </span><span class="default">Foo</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
<br />
</span><span class="comment">// Prints: Foo<br />
&nbsp;</span><span class="default">$foo</span><span class="keyword">-&gt;</span><span class="default">bar</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Best regards,<br />
Quentin.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93677""></a>
  <div class="note">
   <strong class="user">ltearno at gmail dot com</strong>
   <a href="#93677" class="date">22-Sep-2009 09:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The Singleton class version wich is useable by only extending it :<br />
<br />
you would use is for example like this :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Users </span><span class="keyword">extends </span><span class="default">Singleton<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// ...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">SomeMethod</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
and in your code :<br />
<br />
<span class="default">&lt;?php<br />
Users</span><span class="keyword">::</span><span class="default">inst</span><span class="keyword">()-&gt;</span><span class="default">SomeMethod</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
I didn't check for performance, but here is the code :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Singleton<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Hold an instance of the class<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private static </span><span class="default">$instances </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// A private constructor; prevents direct creation of object<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">final private function </span><span class="default">__construct</span><span class="keyword">() <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Prevent users to clone the instance<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">final public function </span><span class="default">__clone</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">( </span><span class="string">'Clone is not allowed.'</span><span class="keyword">, </span><span class="default">E_USER_ERROR </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// The singleton method<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">final public static function </span><span class="default">inst</span><span class="keyword">() <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">get_called_class</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( ! isset( </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">] ) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">] = new </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93133""></a>
  <div class="note">
   <strong class="user">edgar at goodforall dot eu</strong>
   <a href="#93133" class="date">25-Aug-2009 02:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Example, which shows how the class works:<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/* First we create hunderd numbered chainable classes, which will quadrate the passed integer if the number of the class is the same as the integer. <br />
*/<br />
</span><span class="keyword">for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">100</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){<br />
</span><span class="default">$funcs</span><span class="keyword">[] = </span><span class="default">create_function</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">,</span><span class="string">'class C'</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">' extends Chainable {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function run(Message $msg){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $int = $msg-&gt;getMessage();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($int == '</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">'){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return new Message($int * $int);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; };<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return new C'</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">'; <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; '</span><span class="keyword">);<br />
}<br />
</span><span class="comment">/* Then we create a function, which will chain the objects together and returns C0. <br />
&nbsp;C0 -&gt; C1 -&gt; C2 -&gt; C3 ... -&gt; C99<br />
*/<br />
</span><span class="keyword">function </span><span class="default">chain</span><span class="keyword">(</span><span class="default">$funcs</span><span class="keyword">, </span><span class="default">$c </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$c </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$func </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$funcs</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">$func</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$init </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$init </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$funcs</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$func </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$funcs</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">$func</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c</span><span class="keyword">-&gt;</span><span class="default">addLink</span><span class="keyword">(</span><span class="default">$d</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chain</span><span class="keyword">(</span><span class="default">$funcs</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$init</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
</span><span class="comment">/* Create the chain */<br />
</span><span class="default">$c </span><span class="keyword">= </span><span class="default">chain</span><span class="keyword">(</span><span class="default">$funcs</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* Now we can use the chain to calculate quadrates up to 99 <br />
output: <br />
25<br />
No object can handle this type<br />
*/<br />
</span><span class="keyword">try {<br />
</span><span class="comment">/* This will forward the new Message(5) to C0 then to C1 until it reaches C5,<br />
which calculates 5 * 5 and then returns new Message(5 * 5) to C4 -&gt; C3 .. -&gt;C0 -&gt; caller<br />
When I enter 100 the chain will fail to process the integer, because there is no C100 class. C99 will throw an exception.<br />
*/&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mesg </span><span class="keyword">= </span><span class="default">$c</span><span class="keyword">-&gt;</span><span class="default">forward</span><span class="keyword">(new </span><span class="default">Message</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">)); </span><span class="comment">// 25<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">print </span><span class="default">$mesg </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mesg </span><span class="keyword">= </span><span class="default">$c</span><span class="keyword">-&gt;</span><span class="default">forward</span><span class="keyword">(new </span><span class="default">Message</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="default">$mesg </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
} catch(</span><span class="default">Exception $e</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">() . </span><span class="string">"\n"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93118""></a>
  <div class="note">
   <strong class="user">edgar at goodforall dot eu</strong>
   <a href="#93118" class="date">24-Aug-2009 09:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This class will let you chain objects together into a chain. You can forward a message into the chain. The message propagates upwards into the chain until an object can handle it and returns a value. Then the return value is send backwards into the chain until it reached the caller. <br />
<br />
This can be useful in various situations, where flexibility is needed. <br />
<br />
In the begin of the chain we put more specialized methods, which will handle special cases (like user defined objects, json code, xml etcetera). And in the back more general (strings, array's). Now we can pass data to the chain and always get valid and safe html back. If we encounter a new data type we just put on the head of the chain a new object, which can handle this type of data. <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">abstract class </span><span class="default">Chainable </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; protected </span><span class="default">$next </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; protected </span><span class="default">$prev </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; protected </span><span class="default">$res </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">forward</span><span class="keyword">(</span><span class="default">Message $object</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$return </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">run</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">backward</span><span class="keyword">(</span><span class="default">$return</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">next </span><span class="keyword">!== </span><span class="default">null</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">next</span><span class="keyword">-&gt;</span><span class="default">forward</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'No object can handle this type'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">backward</span><span class="keyword">(</span><span class="default">Message $object</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">prev </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$object</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">prev</span><span class="keyword">-&gt;</span><span class="default">backward</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; abstract public function </span><span class="default">run</span><span class="keyword">(</span><span class="default">Message $object</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">addLink</span><span class="keyword">(</span><span class="default">Chainable $link</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">next </span><span class="keyword">!== </span><span class="default">null</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">next</span><span class="keyword">-&gt;</span><span class="default">addLink</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">next </span><span class="keyword">= </span><span class="default">$link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">next</span><span class="keyword">-&gt;</span><span class="default">setPrevLink</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; protected function </span><span class="default">setPrevLink</span><span class="keyword">(</span><span class="default">Chainable $link</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">prev </span><span class="keyword">= </span><span class="default">$link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Also needed the message object:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">Message </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; protected </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">getMessage</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">setMessage</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__toString</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return (string)</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92185""></a>
  <div class="note">
   <strong class="user">edgar at goodforall dot eu</strong>
   <a href="#92185" class="date">13-Jul-2009 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Example of a decorator, which adds array access to any object:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">ArrayAccessDecorator </span><span class="keyword">implements </span><span class="default">ArrayAccess </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; protected </span><span class="default">$object </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">object </span><span class="keyword">= </span><span class="default">$object</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">productpart</span><span class="keyword">-&gt;</span><span class="default">$method</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__set</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">object</span><span class="keyword">-&gt;</span><span class="default">$key </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">object</span><span class="keyword">-&gt;</span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* ArrayAccess */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">offsetSet</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">__set</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">offsetGet</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">__get</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">offsetUnset</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">__set</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">offsetExists</span><span class="keyword">(</span><span class="default">$offset</span><span class="keyword">){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$test </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">object</span><span class="keyword">-&gt;</span><span class="default">__get</span><span class="keyword">(</span><span class="default">$offset</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$test </span><span class="keyword">!== </span><span class="default">null</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$stdobject </span><span class="keyword">= (object)array(</span><span class="string">'test'</span><span class="keyword">=&gt;</span><span class="string">'test'</span><span class="keyword">, </span><span class="string">'test2' </span><span class="keyword">=&gt; </span><span class="string">'test2'</span><span class="keyword">);<br />
</span><span class="default">$arr </span><span class="keyword">= new </span><span class="default">ArrayAccessDecorator</span><span class="keyword">(</span><span class="default">$stdobject</span><span class="keyword">);<br />
print </span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'test'</span><span class="keyword">]; </span><span class="comment">// test<br />
</span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'test'</span><span class="keyword">] = </span><span class="string">'hello'</span><span class="keyword">;<br />
print </span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'test'</span><span class="keyword">]; </span><span class="comment">// hello<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91309""></a>
  <div class="note">
   <strong class="user">rskret at gmail dot com</strong>
   <a href="#91309" class="date">04-Jun-2009 03:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ex.2 only makes a 'Singleton' in the sense there is only one object makable.<br />
But! you can still assign the object to other names(like making aliases). Probably not <br />
what you usually want. Change the method a bit and you get only one unique name<br />
for your 'Singleton'.. or else it will bark again and again!<br />
<span class="default">&lt;?php<br />
</span><span class="comment">#if you don't change example 2 you will get a $badDoggie<br />
</span><span class="default">$badDoggie</span><span class="keyword">=</span><span class="string">"I am constructedSorry but I'm already set.Sorry but I'm already set.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Sorry but I'm already set.Woof!Woof!Woof!"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// The singleton method<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">singleton</span><span class="keyword">() <br />
&nbsp;&nbsp;&nbsp; {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">__CLASS__</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">#return self::$instance;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Sorry but I'm already set."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">; </span><span class="comment">##...wrong place for this!comment this, uncomment it above<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}&nbsp; &nbsp; <br />
</span><span class="default">?&gt;<br />
&lt;?php<br />
</span><span class="comment">// This would fail because the constructor is private<br />
#$test = new Example;<br />
// This will always retrieve a single instance of the class<br />
</span><span class="default">$test </span><span class="keyword">= </span><span class="default">Example</span><span class="keyword">::</span><span class="default">singleton</span><span class="keyword">();<br />
</span><span class="default">$again </span><span class="keyword">= </span><span class="default">Example</span><span class="keyword">::</span><span class="default">singleton</span><span class="keyword">();<br />
</span><span class="default">$and_again </span><span class="keyword">= </span><span class="default">Example</span><span class="keyword">::</span><span class="default">singleton</span><span class="keyword">();<br />
</span><span class="default">$test</span><span class="keyword">-&gt;</span><span class="default">bark</span><span class="keyword">();<br />
</span><span class="default">$again</span><span class="keyword">-&gt;</span><span class="default">bark</span><span class="keyword">();<br />
</span><span class="default">$and_again</span><span class="keyword">-&gt;</span><span class="default">bark</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90360""></a>
  <div class="note">
   <strong class="user">marshall dot mattingly at NOSPAM dot gmail dot com</strong>
   <a href="#90360" class="date">17-Apr-2009 09:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's my singleton class for php 5.3.0:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp; </span><span class="comment">// this must be in every inherited singleton!<br />
&nbsp; </span><span class="keyword">protected static </span><span class="default">$_instance</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="comment">// get the instance<br />
&nbsp; </span><span class="keyword">final public static function </span><span class="default">instance</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// create the instance if we don't have one<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (empty(static::</span><span class="default">$_instance</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= </span><span class="default">get_called_class</span><span class="keyword">(); </span><span class="comment">// php 5.3.0<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">static::</span><span class="default">$_instance </span><span class="keyword">= new </span><span class="default">$class</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return static::</span><span class="default">$_instance</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="comment">// must protect the constructor<br />
&nbsp; </span><span class="keyword">protected function </span><span class="default">__construct</span><span class="keyword">() { }<br />
<br />
&nbsp; </span><span class="comment">// overload __clone<br />
&nbsp; </span><span class="keyword">final public function </span><span class="default">__clone</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Cannot duplicate a singleton.'</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// a sample extension<br />
</span><span class="keyword">class </span><span class="default">Extension </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp; </span><span class="comment">// has to be here, sadly... if only statics were inherited<br />
&nbsp; </span><span class="keyword">protected static </span><span class="default">$_instance</span><span class="keyword">;<br />
<br />
&nbsp; protected function </span><span class="default">__construct</span><span class="keyword">() { ... }<br />
<br />
&nbsp; public function </span><span class="default">foo</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'foo\n'</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// example<br />
</span><span class="default">$extension </span><span class="keyword">= </span><span class="default">Extension</span><span class="keyword">::</span><span class="default">instance</span><span class="keyword">();<br />
</span><span class="default">$extension</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">(); </span><span class="comment">// echo's 'foo\n' as expected<br />
</span><span class="default">?&gt;<br />
</span><br />
Having to add "protected static $_instance" to every singleton is somewhat annoying. I tried the obvious alternative and stored all the instances within an array in the Singleton class. I ran Extension::getInstance() 1,000,000 over 10 runs to see which method was faster:<br />
<br />
Array of $_instances:&nbsp; 3.47s average<br />
Individual $_instance: 1.75s average<br />
<br />
Considering the array of instances only had 1 key to search through, it's reasonable to assume that method would get slower as singletons are added, whereas the method above will always stay the same speed. The difference was enough for me to suffer the minor inconvenience.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90104""></a>
  <div class="note">
   <strong class="user">grummfy at gmail dot com</strong>
   <a href="#90104" class="date">06-Apr-2009 09:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well, for non-php 5.3 users, another way is replacing get_called_class() by get_class(self) ou get_class($this).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90090""></a>
  <div class="note">
   <strong class="user">grummfy at gmail dot com</strong>
   <a href="#90090" class="date">05-Apr-2009 08:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Exemple of singleton that can be used for other class (need phpversion &gt;= 5.3)<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">SingletonModel<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Instance of singleton's class<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @var array<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private static </span><span class="default">$_instance</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * All constructeur should be protected<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">protected function </span><span class="default">__construct</span><span class="keyword">(){}<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Singleton method to load a new object<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @return HlPwd_SingletonModel<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">singleton</span><span class="keyword">() <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">[ </span><span class="default">get_called_class</span><span class="keyword">() ]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">get_called_class</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Destroy the singleton<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">destroySingleton</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instance</span><span class="keyword">[ </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">) ]);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Destructeur<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">__destruct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instance</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Impeach the clone of singleton<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">__clone</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Cloning not allowed on a singleton object'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment"># EOF<br />
<br />
</span><span class="default">you can easyli </span><span class="keyword">use </span><span class="default">it&nbsp; like that<br />
<br />
</span><span class="keyword">class </span><span class="default">mySingChild </span><span class="keyword">extends </span><span class="default">SingletonModel<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//do important things<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">foo</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'hello world'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$t </span><span class="keyword">= </span><span class="default">mySingChild</span><span class="keyword">::</span><span class="default">singleton</span><span class="keyword">();<br />
</span><span class="default">$t</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">();</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89537""></a>
  <div class="note">
   <strong class="user">Talraith</strong>
   <a href="#89537" class="date">12-Mar-2009 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I think a simpler option is to have a loader class/object and then the actual class.&nbsp; It keeps your class more secure in that you are defining the visibility on $instances and you keep your class neat and tidy.<br />
<br />
I found this useful when trying to use the singleton method on a class that extends another class.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">module_loader </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$instances</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">(</span><span class="default">$module_name</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$module_name</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$module_name</span><span class="keyword">] = new </span><span class="default">$module_name</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$module_name</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">module_base </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">proteced $name</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Do initialization stuff here<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp;&nbsp;&nbsp; public final function </span><span class="default">SomePermanentFunction</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Perform function actions<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
}<br />
<br />
class </span><span class="default">module_test </span><span class="keyword">extends </span><span class="default">module_base </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$my_var</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__construct</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="string">'test'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">my_var </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">ModuleSpecificFunction</span><span class="keyword">() {<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
So then once you have all of that defined, you can then use it like such:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Get first instance and set value<br />
</span><span class="default">$instance1 </span><span class="keyword">= </span><span class="default">module_loader</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">(</span><span class="string">'module_test'</span><span class="keyword">);<br />
</span><span class="default">$instance1</span><span class="keyword">-&gt;</span><span class="default">my_var </span><span class="keyword">= </span><span class="string">'abc'</span><span class="keyword">;<br />
<br />
print </span><span class="string">"Instance 1 Var = " </span><span class="keyword">. </span><span class="default">$instance1</span><span class="keyword">-&gt;</span><span class="default">my_var</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Create second instance and check value<br />
</span><span class="default">$instance2 </span><span class="keyword">= </span><span class="default">module_loader</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">(</span><span class="string">'module_test'</span><span class="keyword">);<br />
<br />
print </span><span class="string">"Instance 2 Var = " </span><span class="keyword">. </span><span class="default">$instance2</span><span class="keyword">-&gt;</span><span class="default">my_var</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Set value on second instance, check first instance<br />
</span><span class="default">$instance2</span><span class="keyword">-&gt;</span><span class="default">my_var </span><span class="keyword">= </span><span class="string">'def'</span><span class="keyword">;<br />
<br />
print </span><span class="string">"Instance 1 Var = " </span><span class="keyword">. </span><span class="default">$instance1</span><span class="keyword">-&gt;</span><span class="default">my_var</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The output would then look like this:<br />
<br />
Instance 1 Var = abc<br />
Instance 2 Var = abc<br />
Instance 1 Var = def<br />
<br />
Thus $instance1 and $instance2 are created using the factory pattern but they both point back to the same object (singleton pattern).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88411""></a>
  <div class="note">
   <strong class="user">vaddsm(at)gmail.com</strong>
   <a href="#88411" class="date">22-Jan-2009 12:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello! I want to suggest another fast and universal way to create a singleton, that can store instances any class types. The idea based on php's ability to create object's properties in run time, and magic functions support. Main trick is to create not existed property in __get method and assign to it a value of new instance of class, named as property.<br />
<br />
Code:<br />
<br />
<span class="default">&lt;?php <br />
<br />
</span><span class="keyword">class </span><span class="default">fClassOne<br />
</span><span class="keyword">{<br />
<br />
&nbsp;public function </span><span class="default">get</span><span class="keyword">()<br />
&nbsp;{<br />
&nbsp; return </span><span class="string">"value 1&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp;}<br />
<br />
&nbsp;public function&nbsp; </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;{<br />
&nbsp; echo </span><span class="string">"fClassOne constructed&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp;}<br />
<br />
}<br />
<br />
class </span><span class="default">fClassTwo<br />
</span><span class="keyword">{<br />
<br />
&nbsp;public function </span><span class="default">get</span><span class="keyword">()<br />
&nbsp;{<br />
&nbsp; return </span><span class="string">"value 2&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp;}<br />
<br />
&nbsp;public function&nbsp; </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;{<br />
&nbsp; echo </span><span class="string">"fClassTwo constructed&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp;}<br />
<br />
}<br />
<br />
class </span><span class="default">fSingleton<br />
</span><span class="keyword">{<br />
&nbsp;public function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$sClassName</span><span class="keyword">)<br />
&nbsp;{<br />
&nbsp; echo </span><span class="string">"isset check&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp; if(!isset(</span><span class="default">$this</span><span class="keyword">-&gt;{</span><span class="default">$sClassName</span><span class="keyword">})) </span><span class="default">$this</span><span class="keyword">-&gt;{</span><span class="default">$sClassName</span><span class="keyword">} = new </span><span class="default">$sClassName</span><span class="keyword">;<br />
&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;{</span><span class="default">$sClassName</span><span class="keyword">};<br />
&nbsp;}<br />
}<br />
<br />
</span><span class="default">$MySingleton </span><span class="keyword">= new </span><span class="default">fSingleton</span><span class="keyword">();<br />
<br />
for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">5</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) echo </span><span class="default">$MySingleton</span><span class="keyword">-&gt;</span><span class="default">fClassOne</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">();<br />
<br />
echo </span><span class="default">$MySingleton</span><span class="keyword">-&gt;</span><span class="default">fClassTwo</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">();<br />
echo </span><span class="default">$MySingleton</span><span class="keyword">-&gt;</span><span class="default">fClassTwo</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">();<br />
<br />
&nbsp;</span><span class="default">?&gt;<br />
</span><br />
Output:<br />
<br />
isset check<br />
fClassOne constructed<br />
value 1<br />
value 1<br />
value 1<br />
value 1<br />
value 1<br />
isset check<br />
fClassTwo constructed<br />
value 2<br />
value 2</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87941""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#87941" class="date">31-Dec-2008 11:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
1: The singleton pattern ensures that only one instance of a class is ever created. Thus, applying it to a database connection object is common, since reusing a connection reduces latency and slows down reaching the database server's connection limit. If a database connection is only made in the singleton's constructor then it is probably impossible to accidentally open another connection via that object.<br />
<br />
I say "probably impossible" because there are still some other issues: in this example, an invalid database connection identifier can be stored, retrieved, or lost (since it is an unserializable resource type) via object serialization without careful attention to the __sleep and __wakeup magic methods (and probably won't be valid on deserialization even if it is retained), and the __clone magic method should be implemented in a way that prevents object duplication.<br />
<br />
(This example also ignores database connection pooling to stay focused on singletons.)<br />
<br />
2: A singleton does not contain itself; it contains a reference to itself, which is conceptually similar to a pointer from the C language or a reference from Java. (In fact these are all very different under the hood and in practice, but I will ignore this for simplicity.)<br />
<br />
Consider the following typical PHP 5.0 to 5.2 implementation:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Example </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Do important initializations here, like normal.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">null </span><span class="keyword">== </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">):<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// First invocation only.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$className </span><span class="keyword">= </span><span class="default">__CLASS__</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">$className</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; endif;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__clone</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Illegally attempted to clone ' </span><span class="keyword">. </span><span class="default">__CLASS__</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Static class member variables can exist even without an instance of their class, and static class methods can be invoked without a class instance as well. The member variable that holds a reference to the singleton class instance ($instance) is static, as is the method to instantiate a singleton object (Example::getInstance()). Note that the variable $instance is private, so it cannot be affected by anything external to the class (thus preventing outside code from creating an instance of Example).<br />
<br />
Static member variables are not really "inside" a class; each class instance points to the same static member variables as other instances, "sharing" these static variables between them (in a way) even before any class instances exist. Thus, Example::getInstance() always checks the same $instance variable.<br />
<br />
3: The constructor has an access specifier of "private" to prevent direct instantiation using the "new" operator. (Prior to the implementation of the __callStatic features of PHP 5.3 it is not useful to mark the constructor "protected" since subclasses won't automatically also be singletons.) However, private methods can be invoked from a class's other methods; the static method Example::getInstance() is therefore allowed to invoke the private constructor. On first invocation, it creates an instance of Example and stores a reference to it in $instance. Subsequently, it just returns this reference.<br />
<br />
4: The singleton pattern makes a class (slightly) more complicated, and the overhead of invoking its instantiation method is probably slightly higher than accessing a global variable instead. However, the benefits are substantial from an architectural perspective: it helps prevent performance losses due to accidentally instantiating more than one heavyweight class, it helps prevent bugs due to accidentally instantiating more than one instance of a class (such as a class that renders the requested HTML document in an online content management system), and helps keeps your global namespace and other lexical scopes clean even prior to the introduction of proper namespaces in PHP 5.3 (thus helping to prevent accidental variable clobbering or unexpected initial variable values from a previous module).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86323""></a>
  <div class="note">
   <strong class="user">k at tamayuz dot com</strong>
   <a href="#86323" class="date">13-Oct-2008 01:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Till now writing singleton classes depends on making class constructor private or protected and that sounds good, but what if class constructor must be public (for example, a singleton class inherits from a non-singleton class which already has a public constructor). The way to do so is:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">nonSingleton<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; protected </span><span class="default">$_foo</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$foo</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">_foo </span><span class="keyword">= </span><span class="default">$foo</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; class </span><span class="default">Singleton </span><span class="keyword">extends </span><span class="default">nonSingleton<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Single instance of the class<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * @var Singleton<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">protected static </span><span class="default">$_instance </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * A flag to know if we are in getInstance method or not.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * @var bool<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">protected static </span><span class="default">$_withinGetInstance </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Public singleton class constructor<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * @param mixed $foo<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$foo</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (! </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_withinGetInstance</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'You cannot make a new instance of this class by using constructor, use getInstance() instead...'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parent </span><span class="keyword">:: </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$foo</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Any other operations constructor should do...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Regular getInstance method<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * @param mixed $foo<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * @return Singleton<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">getInstance</span><span class="keyword">(</span><span class="default">$foo</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_withinGetInstance </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (! </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_instance</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_instance </span><span class="keyword">= new </span><span class="default">Singleton</span><span class="keyword">(</span><span class="default">$foo</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_withinGetInstance </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_instance</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86026""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#86026" class="date">29-Sep-2008 05:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Let me describe another pattern it is called Decorator. It can be used to add features to already written object. It is useful for extending some library classes from your framework without changing the original classes (especially if somebody else wrote those). The actual meaning is best presented in an example.<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="comment">// the main interface in which we going to do some decoration<br />
</span><span class="keyword">interface </span><span class="default">salad</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">wait</span><span class="keyword">();<br />
}<br />
<br />
</span><span class="comment">// main class which is already defined and you can't or don't want to change<br />
</span><span class="keyword">class </span><span class="default">shopSalad </span><span class="keyword">implements </span><span class="default">salad</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$tomatoes</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$cucumbers</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$cheese</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$tomatoes</span><span class="keyword">, </span><span class="default">$cucumbers</span><span class="keyword">, </span><span class="default">$cheese</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tomatoes </span><span class="keyword">= </span><span class="default">$tomatoes</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cucumbers </span><span class="keyword">= </span><span class="default">$cucumbers</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cheese </span><span class="keyword">= </span><span class="default">$cheese</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">wait</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"the salad is served using </span><span class="keyword">{</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tomatoes</span><span class="keyword">}</span><span class="string"> tomatoes, </span><span class="keyword">{</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cucumbers</span><span class="keyword">}</span><span class="string"> cucumbers and </span><span class="keyword">{</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cheese</span><span class="keyword">}</span><span class="string"> gr. of cheese."</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// abstract decorator class - note that it implements salad<br />
</span><span class="keyword">abstract class </span><span class="default">saladDecorator </span><span class="keyword">implements </span><span class="default">salad</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$salad</span><span class="keyword">;&nbsp; </span><span class="comment">// the object for decoration<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">salad $salad</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">salad</span><span class="keyword">=</span><span class="default">$salad</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// there is no need to mention the wait function therefore this class inherits the original salad<br />
&nbsp;&nbsp;&nbsp; // the purpose of this class is maintaining the type of the object produced by the decorators.<br />
&nbsp;&nbsp;&nbsp; // it inherits the same interface as the original and it will be inherited by the concrete decorators<br />
</span><span class="keyword">}<br />
<br />
</span><span class="comment">// sauce decorator<br />
</span><span class="keyword">class </span><span class="default">saladSauce </span><span class="keyword">extends </span><span class="default">saladDecorator </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">wait</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">salad</span><span class="keyword">-&gt;</span><span class="default">wait</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">" Then it was decorated with some sauce."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// onions decorator<br />
</span><span class="keyword">class </span><span class="default">saladOnions </span><span class="keyword">extends </span><span class="default">saladDecorator </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">wait</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">salad</span><span class="keyword">-&gt;</span><span class="default">wait</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">" Then it was decorated with some onions."</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$order1 </span><span class="keyword">= new </span><span class="default">shopSalad</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">); </span><span class="comment">// creates the salad in the normal way<br />
</span><span class="default">$order1 </span><span class="keyword">= new </span><span class="default">saladSauce</span><span class="keyword">(</span><span class="default">$order1</span><span class="keyword">); </span><span class="comment">// add a decorator to the class<br />
</span><span class="default">$order1</span><span class="keyword">-&gt;</span><span class="default">wait</span><span class="keyword">();<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// or<br />
</span><span class="default">$order3 </span><span class="keyword">= new </span><span class="default">saladOnions</span><span class="keyword">(new </span><span class="default">saladSauce</span><span class="keyword">(new </span><span class="default">shopSalad</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">0.5</span><span class="keyword">,</span><span class="default">50</span><span class="keyword">))); </span><span class="comment">// you don't need to load a variable with the reference<br />
</span><span class="default">$order3</span><span class="keyword">-&gt;</span><span class="default">wait</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
this will outputs:<br />
the salad is served using 2 tomatoes, 1 cucumbers and 100 gr. of cheese. Then it was decorated with some sauce.<br />
the salad is served using 3 tomatoes, 2 cucumbers and 100 gr. of cheese. Then it was decorated with some onions. Then it was decorated with some sauce.<br />
the salad is served using 1 tomatoes, 0.5 cucumbers and 50 gr. of cheese. Then it was decorated with some souse. Then it was decorated with some onions.<br />
<br />
The pattern is not intended to be used with simple object and I couldn't do more simple than that. The pattern is useful in every way when the extending of an object is required. It can be used to divide some methods from others or to create layers of interaction with the object. In example if you have an file interface and a imageFile class which implements the file and then you can have also an textFile for the textFile you can do some layering and if you want to read the file as XML you can mace a decorator to do so. The XML decorator will inherit the interface file so you can save it and&nbsp; &nbsp; the instance of textFile will be given to create the decorator so you can read the actual text and pars it as XML. It is possible the file to be .ini or some other text based document and you can make a decorator for every one of them. This is the actual benefit of the pattern.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86024""></a>
  <div class="note">
   <strong class="user">Partty</strong>
   <a href="#86024" class="date">29-Sep-2008 04:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The singleton effect you are applying to can be achieved in a old-fashioned and simpler way. Remember that the 'static' is the way for sharing the data between the objects from one type. And there is no pattern in this. So the only think you can do is to use the static keyword. If your program is already written and the rewrite is not recommended there is the "adapter pattern" witch can be used. It is intended to adapt an object to an already build environment. This is one way to have singleton functionality without actually the singleton pattern, it uses a class with static data and static methods and a adaptor class to adapt those methods to your interface.<br />
<br />
The example shows how the every instance of the singlePoint class givs you the same data.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">single </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$a</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$b</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected static function </span><span class="default">_start</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$a</span><span class="keyword">=</span><span class="default">$a</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$b</span><span class="keyword">=</span><span class="default">$b</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; protected static function </span><span class="default">_get_a</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$a</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; protected static function </span><span class="default">_get_b</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$b</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class </span><span class="default">singlePoint </span><span class="keyword">extends </span><span class="default">single </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$a</span><span class="keyword">!=</span><span class="string">'' </span><span class="keyword">&amp;&amp; </span><span class="default">$b</span><span class="keyword">!=</span><span class="string">''</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">single</span><span class="keyword">::</span><span class="default">_start</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">get_a</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">single</span><span class="keyword">::</span><span class="default">_get_a</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">get_b</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">single</span><span class="keyword">::</span><span class="default">_get_b</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">scopeTest</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$singlePointInstance </span><span class="keyword">= new </span><span class="default">singlePoint</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'In scopeTest a='</span><span class="keyword">.</span><span class="default">$singlePointInstance</span><span class="keyword">-&gt;</span><span class="default">get_a</span><span class="keyword">().</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$theSingle </span><span class="keyword">= new </span><span class="default">singlePoint</span><span class="keyword">(</span><span class="default">3</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">);<br />
echo </span><span class="string">'In index a='</span><span class="keyword">.</span><span class="default">$theSingle</span><span class="keyword">-&gt;</span><span class="default">get_a</span><span class="keyword">().</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$theScopeTest </span><span class="keyword">= new </span><span class="default">scopeTest</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
My point is that you don't need single instance of the class but you need access to the same data over and over again ant the build in way to do that in every language I know so far is the 'static' keyword. It was engineered to give you this functionality. All the singleton patterns and even this adapter is unnecessary complication of the structure. KISS = Keep It Simple Stupid no need of that!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85582""></a>
  <div class="note">
   <strong class="user">Mattlock</strong>
   <a href="#85582" class="date">06-Sep-2008 06:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've been forward-developing for PHP 5.3, and couldn't help but notice that late-static-binding makes implementing Singletons simple. Its even easy to set up some function forwarding so that static calls are transformed into non-staic calls:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Requires PHP 5.3!<br />
</span><span class="keyword">class </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">Instance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static </span><span class="default">$instances </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= </span><span class="default">get_called_class</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">, </span><span class="default">$instances</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">] = new </span><span class="default">$class</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">__callStatic</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= static::</span><span class="default">Instance</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$class</span><span class="keyword">, </span><span class="string">'__'</span><span class="keyword">.</span><span class="default">$func</span><span class="keyword">), </span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Earth </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__DoSomething</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">15 </span><span class="keyword">+ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">SomethingElse</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; protected function </span><span class="default">SomethingElse</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$c </span><span class="keyword">% </span><span class="default">$d</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
echo </span><span class="default">Earth</span><span class="keyword">::</span><span class="default">DoSomething</span><span class="keyword">(</span><span class="default">6</span><span class="keyword">,</span><span class="default">27</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85365""></a>
  <div class="note">
   <strong class="user">alexander gavazov</strong>
   <a href="#85365" class="date">27-Aug-2008 07:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For quick instance access use function<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Example</span><span class="keyword">{....}<br />
<br />
function </span><span class="default">Example </span><span class="keyword">{<br />
&nbsp; return </span><span class="default">Example</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
}<br />
<br />
</span><span class="comment">// Global access<br />
</span><span class="default">Example</span><span class="keyword">()-&gt;</span><span class="default">sayHallo</span><span class="keyword">(...);<br />
</span><span class="default">Example</span><span class="keyword">()-&gt;</span><span class="default">doSomething</span><span class="keyword">(...);<br />
print </span><span class="default">Example</span><span class="keyword">()-&gt;</span><span class="default">someData</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83593""></a>
  <div class="note">
   <strong class="user">Alex (raffe) toader_alexandru at yahoo dot com</strong>
   <a href="#83593" class="date">03-Jun-2008 11:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Db layer design algorithm:<br />
"Separation of database layer by database functionality"<br />
<br />
First we draw this line:<br />
<br />
Application<br />
-------------<br />
&nbsp;&nbsp; &nbsp; DB<br />
<br />
Here comes the new thing:<br />
The db layer we separate it into two areas like this:<br />
<br />
Db layer<br />
&nbsp;&nbsp; &nbsp; &nbsp; |<br />
select | insert, update delete<br />
&nbsp;&nbsp; &nbsp; &nbsp; |<br />
<br />
in the left side we have the select part.<br />
The difference between the left and the right sides is that select side has no connection with the db structure - you can take data querying all table, while the right side is table oriented.<br />
<br />
Select side:<br />
Here all queries are in one file called "getters". Like getterUsers.<br />
<br />
Inside it will be the body of the query but the fields that are to be selected will be build dynamically.<br />
When calling this "getter" you will provide an array of fields to be selected or no fields, situation when it will take all fields.<br />
<br />
To keep those db field names as low as possible in this architecture - so the above code dont need to know about the name of the fields in db, you will make just above this "getter", a "filter" file.<br />
This filter will have a switch with a key and inside will call the getter with fields from db.<br />
Ex:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">switch(</span><span class="default">key</span><span class="keyword">)<br />
case </span><span class="string">'Label'</span><span class="keyword">:<br />
</span><span class="default">$fields </span><span class="keyword">= array(</span><span class="string">"label"</span><span class="keyword">, </span><span class="string">"firstName"</span><span class="keyword">);<br />
</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">getUser</span><span class="keyword">(</span><span class="default">$fields</span><span class="keyword">)<br />
break;<br />
</span><span class="default">?&gt;<br />
</span><br />
Above this filter you will have a "caller" that will call the "filter" with the key:<br />
Ex:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">callerUserLabel</span><span class="keyword">()<br />
{<br />
-&gt;</span><span class="default">filterUserLabel</span><span class="keyword">(</span><span class="string">'Label'</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
So in the higher code you just make<br />
-&gt;callerUserLabel();<br />
and this will return all what you need.<br />
<br />
If you want this query to get out of the db and another field called "email", you just create another case in the switch and a "caller" to call that case.<br />
<br />
Dynamic and extensible.<br />
<br />
----------------<br />
<br />
Now on the insert update side.<br />
Here we only think in db tables.<br />
<br />
First we do some "checkers" for all fields in db.<br />
checkerTableName.php<br />
This will contain an array with all the fields and the checks that must be done on that field and perform the checks only on the provided fields.<br />
<br />
Then we do the "updaters". Those are build dinamically like the "getters" - if fields provided, only those updated. If all fields provided, can be used as an "inserter".<br />
<br />
When performing an insert, all checks on that table will be done.<br />
<br />
When performing an update on only one field - like updating a label, only that label will be checked to be in conformity with requirements like a length, special chars inside.<br />
Dependency checks are made here also.<br />
<br />
When having in one application action a multiple insert or update (when inserting an operator also add a webUser lets say) you do above those "inserter" and "updater" files a small "manager" that will do:<br />
-&gt;checkOperatorFields();<br />
-&gt;checkWebUserFields();<br />
<br />
-&gt;insertOperator();<br />
-&gt;insertWebUser();<br />
<br />
If no error is thrown, all things will go nice and quiet.<br />
<br />
Now also the "getters" will have their fields checked when needed using those checkers. I am talking about the values that are given as parameters not about the ones that are returned from db. <br />
<br />
If you are working with domain objects or business logic objects (whatever you call them) above the db layer you will have to make below that line we first draw a "business logic asambler" object that will make from your data what you want.<br />
<br />
If this dont exist, at least an intermediary layer that will map the names from db with the ones used in application must be done in both directions - from application to db and from db to application.<br />
<br />
-------------------------------------<br />
<br />
Advantages of this architecture:<br />
- Usefull in complex application especheally where the selects are made ussually from many tables so you dont have to load lots and lots of files and to get lost in the logic for one simple select.<br />
- NO DUPLICATE CODE<br />
- Simple and intuitive.<br />
- Flexible and expendable.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83565""></a>
  <div class="note">
   <strong class="user">Andrea Giammarchi</strong>
   <a href="#83565" class="date">01-Jun-2008 10:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A tricky way to implement Factory or Singleton is this one:<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// your amazing stuff<br />
</span><span class="keyword">}<br />
<br />
</span><span class="comment">// implicit factory<br />
</span><span class="keyword">function </span><span class="default">A</span><span class="keyword">( </span><span class="comment">/* one or more args */ </span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; return new </span><span class="default">A</span><span class="keyword">( </span><span class="comment">/* one or more args */ </span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">A</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">);<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">A</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">);<br />
<br />
</span><span class="comment">// or implicit Singleton<br />
</span><span class="keyword">function </span><span class="default">A</span><span class="keyword">( </span><span class="comment">/* one or more args */ </span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return isset(</span><span class="default">$instance</span><span class="keyword">) ? </span><span class="default">$instance </span><span class="keyword">: (</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">( </span><span class="comment">/* one or more args */ </span><span class="keyword">));<br />
}<br />
<br />
</span><span class="default">A</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) === </span><span class="default">A</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">); </span><span class="comment">// true<br />
</span><span class="default">?&gt;<br />
</span><br />
More details in WebReflection, byez</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82985""></a>
  <div class="note">
   <strong class="user">someone  at  somewhere dot com</strong>
   <a href="#82985" class="date">05-May-2008 01:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want a singleton and you don't mind on throwing a stop error/exception when a 2nd instace is created instead of returning the already created object, then this code works with subclassing and without getInstace alike functions (just with __construct)<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">SINGLETON<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// the array for checking the created instances<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">protected static </span><span class="default">$singletons </span><span class="keyword">= array ();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// make it final so extended classes cannot override it<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">final public function </span><span class="default">__construct </span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$classname </span><span class="keyword">= </span><span class="default">get_class </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( ! isset ( </span><span class="default">self</span><span class="keyword">::</span><span class="default">$singletons</span><span class="keyword">[</span><span class="default">$classname</span><span class="keyword">] ) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// instead of $this it could be any value since we are checking for isset, but a reference to the object may be useful in a possible improvement, somewhat<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$singletons</span><span class="keyword">[</span><span class="default">$classname</span><span class="keyword">] = </span><span class="default">$this</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// your favorite stop error here<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trow </span><span class="keyword">new </span><span class="default">Exception </span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// final as well, no overriding, plus protected so it cannot be called<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">final protected function </span><span class="default">__clone </span><span class="keyword">() {}<br />
}<br />
<br />
class </span><span class="default">X </span><span class="keyword">extends </span><span class="default">SINGLETON<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//...<br />
</span><span class="keyword">}<br />
<br />
class </span><span class="default">Y </span><span class="keyword">extends </span><span class="default">X<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//...<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">$x </span><span class="keyword">= new </span><span class="default">X </span><span class="keyword">();<br />
</span><span class="default">$y </span><span class="keyword">= new </span><span class="default">Y </span><span class="keyword">();<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">X </span><span class="keyword">(); </span><span class="comment">// execution stops, as an instance of X is created already<br />
<br />
</span><span class="default">$b </span><span class="keyword">= new </span><span class="default">Y </span><span class="keyword">(); </span><span class="comment">// execution stops, as an instance of Y is created already, it DOES NOT give problems with X, despite extending X<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
so, if it is ok to stops the execution, this method is way simpler<br />
<br />
it must stops the execution because no matter what, __construct will return a reference to the new object, always, so if the script goes on further you will have effectively 2 instances (as a matter of fact, the code above only checks the existence of another object from the same class, it does not prohibit the creation of a new one)<br />
<br />
hth</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81295""></a>
  <div class="note">
   <strong class="user">Mattlock</strong>
   <a href="#81295" class="date">21-Feb-2008 08:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This allows for singleton functionality via class extension, and does not use any shady functions like eval.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">interface </span><span class="default">ISingleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">GetInstance</span><span class="keyword">();<br />
}<br />
<br />
class </span><span class="default">Singleton </span><span class="keyword">implements </span><span class="default">ISingleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">GetInstance</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">=</span><span class="string">'Singleton'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static </span><span class="default">$instances </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">] === </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">] = new </span><span class="default">$class</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Mars </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">implements </span><span class="default">ISingleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">GetInstance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">Singleton</span><span class="keyword">::</span><span class="default">GetInstance</span><span class="keyword">(</span><span class="default">get_class</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Neptune </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">implements </span><span class="default">ISingleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">GetInstance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">Singleton</span><span class="keyword">::</span><span class="default">GetInstance</span><span class="keyword">(</span><span class="default">get_class</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$x </span><span class="keyword">= </span><span class="default">Mars</span><span class="keyword">::</span><span class="default">GetInstance</span><span class="keyword">();<br />
echo </span><span class="string">'&lt;pre&gt;'</span><span class="keyword">.</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">).</span><span class="string">'&lt;/pre&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$x </span><span class="keyword">= </span><span class="default">Neptune</span><span class="keyword">::</span><span class="default">GetInstance</span><span class="keyword">();<br />
echo </span><span class="string">'&lt;pre&gt;'</span><span class="keyword">.</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">).</span><span class="string">'&lt;/pre&gt;'</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80316""></a>
  <div class="note">
   <strong class="user">Alexandre at dontspamme gaigalas dot net</strong>
   <a href="#80316" class="date">09-Jan-2008 01:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Simplest PHP5 singleton implementation ever:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Some_Class<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; static private </span><span class="default">$_i</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; static public function </span><span class="default">singleton</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_i</span><span class="keyword">) ? </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_i </span><span class="keyword">: </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_i </span><span class="keyword">= new </span><span class="default">self</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75853""></a>
  <div class="note">
   <strong class="user">dario [dot] ocles [at] gmail [dot] com</strong>
   <a href="#75853" class="date">18-Jun-2007 03:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This's a example of Composite Pattern:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">abstract class </span><span class="default">Graphic</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; abstract public function </span><span class="default">draw</span><span class="keyword">();<br />
}<br />
<br />
class </span><span class="default">Triangle </span><span class="keyword">extends </span><span class="default">Graphic</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$name </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$name </span><span class="keyword">= </span><span class="string">'unknown'</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">draw</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'-I\'m a triangle '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">.</span><span class="string">'.&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Container </span><span class="keyword">extends </span><span class="default">Graphic</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$name </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$container </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$name </span><span class="keyword">= </span><span class="string">'unknown'</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">draw</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'I\'m a container '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">.</span><span class="string">'.&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">container </span><span class="keyword">as </span><span class="default">$graphic</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$graphic</span><span class="keyword">-&gt;</span><span class="default">draw</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">add</span><span class="keyword">(</span><span class="default">Graphic $graphic</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">container</span><span class="keyword">[] = </span><span class="default">$graphic</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">del</span><span class="keyword">(</span><span class="default">Graphic $graphic</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">container</span><span class="keyword">[</span><span class="default">$graphic</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$tri1 </span><span class="keyword">= new </span><span class="default">Triangle</span><span class="keyword">(</span><span class="string">'1'</span><span class="keyword">);<br />
</span><span class="default">$tri2 </span><span class="keyword">= new </span><span class="default">Triangle</span><span class="keyword">(</span><span class="string">'2'</span><span class="keyword">);<br />
</span><span class="default">$tri3 </span><span class="keyword">= new </span><span class="default">Triangle</span><span class="keyword">(</span><span class="string">'3'</span><span class="keyword">);<br />
<br />
</span><span class="default">$container1 </span><span class="keyword">= new </span><span class="default">Container</span><span class="keyword">(</span><span class="string">'1'</span><span class="keyword">);<br />
</span><span class="default">$container2 </span><span class="keyword">= new </span><span class="default">Container</span><span class="keyword">(</span><span class="string">'2'</span><span class="keyword">);<br />
</span><span class="default">$container3 </span><span class="keyword">= new </span><span class="default">Container</span><span class="keyword">(</span><span class="string">'3'</span><span class="keyword">);<br />
<br />
</span><span class="default">$container1</span><span class="keyword">-&gt;</span><span class="default">add</span><span class="keyword">(</span><span class="default">$tri1</span><span class="keyword">);<br />
</span><span class="default">$container1</span><span class="keyword">-&gt;</span><span class="default">add</span><span class="keyword">(</span><span class="default">$tri2</span><span class="keyword">);<br />
</span><span class="default">$container2</span><span class="keyword">-&gt;</span><span class="default">add</span><span class="keyword">(</span><span class="default">$tri3</span><span class="keyword">);<br />
<br />
</span><span class="default">$container3</span><span class="keyword">-&gt;</span><span class="default">add</span><span class="keyword">(</span><span class="default">$container1</span><span class="keyword">);<br />
</span><span class="default">$container3</span><span class="keyword">-&gt;</span><span class="default">add</span><span class="keyword">(</span><span class="default">$container2</span><span class="keyword">);<br />
<br />
</span><span class="default">$container3</span><span class="keyword">-&gt;</span><span class="default">draw</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
The above example will output:<br />
<br />
I'm a container 3.<br />
I'm a container 1.<br />
-I'm a triangle 1.<br />
-I'm a triangle 2.<br />
I'm a container 2.<br />
-I'm a triangle 3.<br />
<br />
Dario Ocles.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74105""></a>
  <div class="note">
   <strong class="user">Dave Miller</strong>
   <a href="#74105" class="date">25-Mar-2007 02:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a way to make singleton classes with no extra code other than "extends Singleton" - if you use __AutoLoad() and keep each class in a separate file that is...<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">abstract class </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// Cannot be instantiated by any other class<br />
&nbsp; </span><span class="keyword">protected function </span><span class="default">__Construct</span><span class="keyword">() { }<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// Cannot be cloned ever<br />
&nbsp; </span><span class="keyword">private function </span><span class="default">__Clone</span><span class="keyword">() { }<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// Create/fetch an instance of the class<br />
&nbsp; </span><span class="keyword">static public function </span><span class="default">getInstance</span><span class="keyword">(</span><span class="default">$ClassName </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$Instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$Instance</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$Instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$ClassName</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$Instance </span><span class="keyword">= new </span><span class="default">$ClassName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$Instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">null</span><span class="keyword">; </span><span class="comment">// or throw exception if you want...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp; }<br />
&nbsp; <br />
}<br />
<br />
function </span><span class="default">__AutoLoad</span><span class="keyword">(</span><span class="default">$ClassName</span><span class="keyword">) {<br />
&nbsp; include </span><span class="string">"</span><span class="default">$ClassName</span><span class="string">.php"</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">is_subclass_of</span><span class="keyword">(</span><span class="default">$ClassName</span><span class="keyword">, </span><span class="string">'Singleton'</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; eval(</span><span class="default">$ClassName</span><span class="keyword">.</span><span class="string">'::getInstance($ClassName);'</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// ClassName.php<br />
</span><span class="keyword">class </span><span class="default">ClassName </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp; </span><span class="comment">// ... Code ...<br />
</span><span class="keyword">}<br />
<br />
</span><span class="comment">// To use<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">ClassName</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">MyFunc</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Of course you could do this differently - the point is that you can use __AutoLoad() to tell the single what class it is, unlike some other ways where this is done manually every time you define a singleton class.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71579""></a>
  <div class="note">
   <strong class="user">eyvindh79 at gmail dot com</strong>
   <a href="#71579" class="date">06-Dec-2006 09:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A pure extendable(multiple sublevels) Singleton class in PHP seems impossible at the moment because of the way PHP handles static inheritance, but my class is close to what i want. <br />
<br />
Very simple usage:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Test </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">Singleton</span><span class="keyword">::</span><span class="default">getSingleton</span><span class="keyword">(</span><span class="default">get_class</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Singleton class implementation:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Singleton </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/***********************<br />
&nbsp;&nbsp; &nbsp; * HOW TO USE<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * Inherit(extend) from Singleton and add getter:<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; *&nbsp; //public getter for singleton instance<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp;&nbsp; public static function getInstance(){<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; return Singleton::getSingleton(get_class());<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private static </span><span class="default">$instanceMap </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//protected getter for singleton instances<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">protected static function </span><span class="default">getSingleton</span><span class="keyword">(</span><span class="default">$className</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instanceMap</span><span class="keyword">[</span><span class="default">$className</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$object </span><span class="keyword">= new </span><span class="default">$className</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Make sure this object inherit from Singleton<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$object </span><span class="keyword">instanceof </span><span class="default">Singleton</span><span class="keyword">){&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instanceMap</span><span class="keyword">[</span><span class="default">$className</span><span class="keyword">] = </span><span class="default">$object</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw </span><span class="default">SingletonException</span><span class="keyword">(</span><span class="string">"Class '</span><span class="default">$className</span><span class="string">' do not inherit from Singleton!"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instanceMap</span><span class="keyword">[</span><span class="default">$className</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//protected constructor to prevent outside instantiation<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">protected function </span><span class="default">__construct</span><span class="keyword">(){<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//denie cloning of singleton objects<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public final function </span><span class="default">__clone</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'It is impossible to clone singleton'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Just a simple test case:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$rndId</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected function </span><span class="default">__construct</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rndId </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">whatAmI</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'I am a A('</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rndId</span><span class="keyword">.</span><span class="string">')&lt;br /&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">Singleton</span><span class="keyword">::</span><span class="default">getSingleton</span><span class="keyword">(</span><span class="default">get_class</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">A </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">whatAmI</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'I am a B('</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rndId</span><span class="keyword">.</span><span class="string">')&lt;br /&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">Singleton</span><span class="keyword">::</span><span class="default">getSingleton</span><span class="keyword">(</span><span class="default">get_class</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">A</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">B</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">whatAmI</span><span class="keyword">();</span><span class="comment">// should echo 'I am a A(some number)<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">whatAmI</span><span class="keyword">();</span><span class="comment">// should echo 'I am a B(some number)<br />
<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">A</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">B</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">whatAmI</span><span class="keyword">();</span><span class="comment">// should echo 'I am a A(same number as above)<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">whatAmI</span><span class="keyword">();</span><span class="comment">// should echo 'I am a B(same number as above)<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();</span><span class="comment">// this should fail<br />
</span><span class="default">$b </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">();</span><span class="comment">// this should fail<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I hope this helps.<br />
-Eyvind-</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70025""></a>
  <div class="note">
   <strong class="user">suki at psychosensor dot de</strong>
   <a href="#70025" class="date">29-Sep-2006 05:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's sometimes useful to let one sigleton class extend another. You can achieve this by only using static attributes:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$value </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$instance </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">set</span><span class="keyword">(</span><span class="default">time</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">is_null</span><span class="keyword">((</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$class_name </span><span class="keyword">= </span><span class="default">__CLASS__</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">$class_name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">set</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$value </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">out</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">out</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="default">self</span><span class="keyword">::</span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
<br />
&nbsp; class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static </span><span class="default">$instance </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= </span><span class="default">__CLASS__</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">$class</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">B</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">out</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
This will output the current time twice. If $value isn't static, the call to $b-&gt;out() will output 0. Maybe it can save someone some time...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68816""></a>
  <div class="note">
   <strong class="user">Dennis</strong>
   <a href="#68816" class="date">11-Aug-2006 12:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An easy way to have your singleton persistent between page loads:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;*&nbsp; &nbsp; Returns an instance of the singleton class.<br />
&nbsp;*&nbsp; &nbsp; @return&nbsp; &nbsp; object&nbsp; &nbsp; &nbsp; &nbsp; The singleton instance<br />
&nbsp;*/<br />
</span><span class="keyword">public static function </span><span class="default">_instance</span><span class="keyword">() <br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Start a session if not already started<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">Session</span><span class="keyword">::</span><span class="default">start</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">false </span><span class="keyword">== isset( </span><span class="default">$_SESSION</span><span class="keyword">[ </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_singleton_class </span><span class="keyword">] ) )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_singleton_class</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[ </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_singleton_class </span><span class="keyword">] = new </span><span class="default">$class</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$_SESSION</span><span class="keyword">[ </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_singleton_class </span><span class="keyword">];&nbsp; &nbsp; &nbsp; &nbsp; <br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;*&nbsp; &nbsp; Destroy the singleton object. Deleting the session variable in the<br />
&nbsp;*&nbsp; &nbsp; destructor does not make sense since the destructor is called every<br />
&nbsp;*&nbsp; &nbsp; time the script ends.<br />
&nbsp;*/<br />
</span><span class="keyword">public static function </span><span class="default">_destroy</span><span class="keyword">() <br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[ </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_singleton_class </span><span class="keyword">] = </span><span class="default">null</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;*&nbsp; &nbsp; Initialize the singleton object. Use instead of constructor. <br />
&nbsp;*/<br />
</span><span class="keyword">public function </span><span class="default">_initialize</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">) <br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Something...<br />
</span><span class="keyword">}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;*&nbsp; &nbsp; Prevent cloning of singleton.<br />
&nbsp;*/<br />
</span><span class="keyword">private function </span><span class="default">__clone</span><span class="keyword">() <br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">( </span><span class="string">"Cloning a singleton object is not allowed."</span><span class="keyword">, </span><span class="default">E_USER_ERROR </span><span class="keyword">);<br />
}<br />
<br />
private static </span><span class="default">$_singleton_class </span><span class="keyword">= </span><span class="default">__CLASS__</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67066""></a>
  <div class="note">
   <strong class="user">cortex at pressemicro dot net</strong>
   <a href="#67066" class="date">02-Jun-2006 01:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's often forgotten, but a singleton class MUST be final. So it's useless to have a base class that implements the pattern and to inherit of it. That's why it's called a pattern and not a class library.<br />
<br />
Here a little example that will show why.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
</span><span class="comment">// singleton pattern with getInstance static method<br />
</span><span class="keyword">private </span><span class="default">$var</span><span class="keyword">; </span><span class="comment">// A ressource variable<br />
</span><span class="keyword">function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">var </span><span class="keyword">= </span><span class="string">"get a ressource that could only&nbsp; be taken one time by process"</span><span class="keyword">;<br />
}<br />
}<br />
<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">A </span><span class="keyword">{<br />
</span><span class="comment">// singleton pattern<br />
</span><span class="keyword">function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__construct</span><span class="keyword">();<br />
}<br />
}<br />
<br />
</span><span class="default">$anA </span><span class="keyword">= </span><span class="default">A </span><span class="keyword">:: </span><span class="default">getInstance</span><span class="keyword">();<br />
</span><span class="default">$aB </span><span class="keyword">= </span><span class="default">B </span><span class="keyword">:: </span><span class="default">getInstance</span><span class="keyword">(); </span><span class="comment">// try to get a second ressource, :(<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
When developping class A, you may have think to be the only one with a $var ressource, but it's completly wrong. As $aB is an A (Think that there is two A instanciate and one with more than just A), $anA and $aB will have a different ressource variable and thus two different database connection for eg.<br />
<br />
You'd never know how will be used your code, so you need to make it strong. This is the way of poo thinking.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65352""></a>
  <div class="note">
   <strong class="user">lycboy at gmail dot com</strong>
   <a href="#65352" class="date">29-Apr-2006 03:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I don't agree to take a class with only static members and static methods as a 'singleton'. According to GoF's book, the singleton pattern means a class that only have one instance. A class containing only static members and functions still can be instantiated and extended, it have multiple instances. Consider the code below:<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">StaticTest<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$_test </span><span class="keyword">= </span><span class="string">"aaa"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">test</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_test</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">StaticTest</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span>The code will not report errors(although it's useless). So there can be many instances of the class.<br />
<br />
It's reasonable that there is a class that create and store a unique instance of another class. Such as:<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">A<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$_id </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">getId</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_id</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">B<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$_instance</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">singleton</span><span class="keyword">() <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instance</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span>Here class B act as a guard to class A. But as same as the first section, it's useless too! Unless you can make sure that the users of your class will never find the class A, you shouldn't make the class you wanna to be unique can be instantiated many times.<br />
<br />
So the best way to create a unique instance of a class is that the class save the unique instance itself. It is the core meaning of singleton pattern. Any information that mentioned here can be found in the book of GoF. I think it's worth reading the book.<br />
<br />
BTW: It's allowed that there are a few of subclasses of a singleton class.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61276""></a>
  <div class="note">
   <strong class="user">vsviridov at exceede dot com</strong>
   <a href="#61276" class="date">29-Jan-2006 08:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Singleton is a very useful pattern if you need multiple instances of different classes to use only one unique instance of common class. It's not just about having static methods.<br />
<br />
e.g. Your database connection class probably should be a singleton, in order to spare all redundant connect calls, etc...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59142""></a>
  <div class="note">
   <strong class="user">toomuchphp-phpman at yahoo dot com</strong>
   <a href="#59142" class="date">27-Nov-2005 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The principle of the Singleton pattern can easily be expanded to form [what I have dubbed as] the 'Unique' pattern - where a particular class may have several instances, each with a 'Unique ID'.&nbsp; This can be useful when a single instance is required for each database record.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp; </span><span class="comment">// Each instance of 'Customer' represents one customer!<br />
&nbsp; </span><span class="keyword">class </span><span class="default">Customer </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// Access a unique instance of class for a customer record<br />
&nbsp;&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">Unique</span><span class="keyword">(</span><span class="default">$CustomerID</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; static </span><span class="default">$instances </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="comment">// a unique instance for each CustomerID<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="keyword">if(!isset(</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$CustomerID</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$CustomerID</span><span class="keyword">] = new </span><span class="default">Customer</span><span class="keyword">(</span><span class="default">$CustomerID</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$CustomerID</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; private </span><span class="default">$CustomerID</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; private function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$CustomerID</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">CustomerID </span><span class="keyword">= </span><span class="default">$CustomerID</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="comment">// get instance of class for customer #1<br />
&nbsp; </span><span class="default">$C1 </span><span class="keyword">= </span><span class="default">Customer</span><span class="keyword">::</span><span class="default">Unique</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">// get instance of class for customer #2<br />
&nbsp; </span><span class="default">$C2 </span><span class="keyword">= </span><span class="default">Customer</span><span class="keyword">::</span><span class="default">Unique</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57692""></a>
  <div class="note">
   <strong class="user">steffen at morkland dot com</strong>
   <a href="#57692" class="date">11-Oct-2005 07:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding the singleton pattern, you have to create the function for every singleton class you want to have, because settting a variable static will set the variable on all instances of the class, and second of all, by extending a singleton class, you are breaking rule No #1 of the singleton pattern. an instance of a given type may only excist ONCE, by extending the singleton class you have multiple instances of the singleton class, and by is sharing the static $instance variable.<br />
<br />
on thing could be done though, to make sure a programmer does not make any mistakes when creating singleton classes, an interface could be made, to make sure the singleton class is correctly defined.<br />
<br />
it could look something like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">interface </span><span class="default">singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">();<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
however, this interface does NOT force the programmer to make the constructor private, and don't even bother to try, it would just result in a error.<br />
<br />
sorry to say it guys, there are no easy way around this one. not even a factory class can do the job for you since, the constructor must be private, to ensure that only one instance excists.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57487""></a>
  <div class="note">
   <strong class="user">axon dot wp a at t wp dot pl</strong>
   <a href="#57487" class="date">05-Oct-2005 09:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Short version of Singleton:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">public function </span><span class="default">__clone</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Clone is not allowed.'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span>&nbsp; &nbsp; <br />
is : <br />
<span class="default">&lt;?php </span><span class="keyword">private function </span><span class="default">__clone</span><span class="keyword">() {} </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54843""></a>
  <div class="note">
   <strong class="user">lukas dot starecek at centrum dot cz</strong>
   <a href="#54843" class="date">17-Jul-2005 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need singleton of any class and don't want write singleton wrapper for each this class, try this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">UniverzalSingleton </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; const </span><span class="default">EXCEPTION_NO_CLASS </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; protected static </span><span class="default">$_instances </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">class_exists</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw (new </span><span class="default">Exception</span><span class="keyword">(</span><span class="default">__CLASS__ </span><span class="keyword">. </span><span class="string">': Requsted class is not exist.'</span><span class="keyword">, </span><span class="default">self</span><span class="keyword">::</span><span class="default">EXCEPTION_NO_CLASS</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">] = new </span><span class="default">$class</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } </span><span class="comment">// if<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; } </span><span class="comment">// getInstance<br />
<br />
</span><span class="keyword">} </span><span class="comment">// class UniverzalSingleton<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54574""></a>
  <div class="note">
   <strong class="user">disappear dot nz at gmail dot com</strong>
   <a href="#54574" class="date">07-Jul-2005 11:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi ,<br />
<br />
Singleton Patterns are excellent ,<br />
I have created a singleton pattern that enables any class to be loaded from the one modular singleton library.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">singleton<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; private static </span><span class="default">$o_instance </span><span class="keyword">= </span><span class="default">NULL </span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public static function </span><span class="default">call_singleton </span><span class="keyword">( </span><span class="default">$s_class </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">class_exists </span><span class="keyword">( </span><span class="default">$s_class </span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$o_instance </span><span class="keyword">=== </span><span class="default">NULL </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$o_instance </span><span class="keyword">= new </span><span class="default">$s_class </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$o_instance </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54550""></a>
  <div class="note">
   <strong class="user">php at mijav dot dk</strong>
   <a href="#54550" class="date">07-Jul-2005 09:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please use design patterns as they were intended:<br />
<br />
Design patterns are designs that are known to solve common problems, such as having only 1 instance of a class. Design patterns are are not code libraries.<br />
Most design patterns, if not all, have alternate implementations but common to them all is that the recommended implementation solves the problem.<br />
<br />
Singleton should not be made as a class and then extended. Nor shuld __autoload be used.<br />
Autoloading is very PHP-specific (and there might be nothing wrong with that, but design patterns are general patterns that are abstracted from the implementing language).<br />
Making a class that you extend is very ugly. What if you have to extend that class too? You will have to make a dummy that extends your singleton class, just so you can extend the class you want. This is a very "ugly" solution that completely overrules the idea of well known design patters: A thought-though idea that works the way intended.<br />
<br />
The manual shows a PHP implementation of the standard Singleton-pattern without "nifty" modifications.<br />
<br />
To finish off this lesson on design patterns, I would like to ackknowledge that there is nothing wrong in tweaking patterns to suit your needs.<br />
But remember: "If it isn't broken - don't fix it".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54401""></a>
  <div class="note">
   
   <a href="#54401" class="date">02-Jul-2005 11:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's an effective strategy for creating singletons.<br />
<br />
1.) define an __autoload() function<br />
<br />
2.) Define all properties of a class to be static<br />
<br />
3.) Make the constructor private.<br />
<br />
Now, anywhere in your code, you can simply do as follows:<br />
<br />
Class::Function();<br />
<br />
The __autoload() function will take care of loading the class.<br />
<br />
It's even better when you use the auto_prepend directive to define __autoload(). Now you can create a php script which looks like this:<br />
<br />
<span class="default">&lt;?php<br />
TemplateSystem</span><span class="keyword">::</span><span class="default">Start</span><span class="keyword">();<br />
echo </span><span class="string">'This is just a test!'</span><span class="keyword">;<br />
</span><span class="default">TemplateSystem</span><span class="keyword">::</span><span class="default">Stop</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Now you've effectively got a 2-line solution to all templating issues, the templates will be available to every script, and the only additional overhead that you'll have for scripts that don't use the templating system is a 3-line autoload function!<br />
<br />
Obviously, there's still a problem with __autoload() if you are attempting to write a templating system that has to work with someone else's software that also defines __autoload(). The best advice I can give here is to remove one of the __autoload()'s and modify the other to work with both.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53104""></a>
  <div class="note">
   <strong class="user">anon at anon dot org</strong>
   <a href="#53104" class="date">23-May-2005 01:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After programming a number of real world applications with PHP, I found that this version of the singleton doesn't really resemble other singleton patterns, but is the only one I've ended up using and it works great.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">User </span><span class="keyword">{<br />
&nbsp;&nbsp; </span><span class="comment">/* .. your code, nothing specific matters in the class .. */<br />
</span><span class="keyword">}<br />
<br />
function </span><span class="default">user</span><span class="keyword">(){<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$user</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(!isset(</span><span class="default">$user</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$user </span><span class="keyword">= new </span><span class="default">User</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$user</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">//creates the user object then calls a method on it<br />
</span><span class="default">user</span><span class="keyword">()-&gt;</span><span class="default">doSomething</span><span class="keyword">();<br />
<br />
</span><span class="comment">//calls a method on the same object<br />
</span><span class="default">user</span><span class="keyword">()-&gt;</span><span class="default">doSomethingElse</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Note that it is *possible* to create multiple instances of User, but in your API docs, or when you tell people how to use the class just say you are supposed to refer to it only via the user() function, and then there should be no reason to enforce it in your code any other way.<br />
<br />
Also note that this syntax is only possible in PHP 5 because of the object / function dereferencing feature.&nbsp; user()-&gt;someMethod(); will throw a fatal error in 4.x</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52849""></a>
  <div class="note">
   <strong class="user">dmnEe0 at gmail dot com</strong>
   <a href="#52849" class="date">14-May-2005 02:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I struggled a few hours on writing a simple Generic factory method for dynamic object factoring. I initially went for call_user_func_array() to create the object but that obviously didn't work. An anonymous function was what I needed. Here's the result (PHP5):<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;*&nbsp; &nbsp; Name:&nbsp; &nbsp; Factory<br />
&nbsp;*&nbsp; &nbsp; Author:&nbsp; &nbsp; Ezku<br />
&nbsp;*&nbsp; &nbsp; Contact:&nbsp; &nbsp; dmnEe0 at gmail dot com<br />
&nbsp;*/<br />
</span><span class="keyword">class </span><span class="default">Factory<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Generic factory method<br />
&nbsp;&nbsp; &nbsp; * @param string&nbsp; &nbsp; Path to class definition<br />
&nbsp;&nbsp; &nbsp; * @param string&nbsp; &nbsp; Basic class name<br />
&nbsp;&nbsp; &nbsp; * @param string&nbsp; &nbsp; Derived class name<br />
&nbsp;&nbsp; &nbsp; * @param array&nbsp; &nbsp; Class constructor arguments, optional<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">Generic</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$base</span><span class="keyword">, </span><span class="default">$derived</span><span class="keyword">, </span><span class="default">$args </span><span class="keyword">= array())<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Check that the file exists<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; include_once </span><span class="default">$filename</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * Check that the file contained the appropriate class definition<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">class_exists</span><span class="keyword">(</span><span class="default">$derived</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * Create argument list for constructor<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arglist </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$n </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">); </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$n</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arglist</span><span class="keyword">[] = </span><span class="string">'$args['</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">']'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arglist </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">,</span><span class="default">$arglist</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * Create new instance via an anonymous function<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_class </span><span class="keyword">= </span><span class="default">create_function</span><span class="keyword">(</span><span class="string">'$name, $args'</span><span class="keyword">, </span><span class="string">'return new $name('</span><span class="keyword">.</span><span class="default">$arglist</span><span class="keyword">.</span><span class="string">');'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$new_class</span><span class="keyword">(</span><span class="default">$derived</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"Definition file (</span><span class="default">$filename</span><span class="string">) did not contain definition for the </span><span class="default">$base</span><span class="string"> class &lt;code&gt;</span><span class="default">$derived</span><span class="string">&lt;/code&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"Definition file (</span><span class="default">$filename</span><span class="string">) for the </span><span class="default">$base</span><span class="string"> class &lt;code&gt;</span><span class="default">$derived</span><span class="string">&lt;/code&gt; was not found"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Useless usage example:<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">createCat</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$scary_eyes </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">, </span><span class="default">$whiskers </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">PATH_ANIMALS</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">'.php'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$base </span><span class="keyword">= </span><span class="string">'Cat'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$derived </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">.</span><span class="default">$base</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$args </span><span class="keyword">= array(</span><span class="default">$scary_eyes</span><span class="keyword">, </span><span class="default">$whiskers</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">Factory</span><span class="keyword">::</span><span class="default">Generic</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$base</span><span class="keyword">, </span><span class="default">$derived</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// Create a MeowCat with scary eyes and whiskers<br />
</span><span class="default">$cat </span><span class="keyword">= </span><span class="default">createCat</span><span class="keyword">(</span><span class="string">'Meow'</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
</span><span class="comment">// Do whatever<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="language.oop5.iterations.html">Object Iteration</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="language.oop5.magic.html">Magic Methods</a></div>
 <div class="up"><a href="language.oop5.html">Classes and Objects</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
