<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Encodes data with MIME base64</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.base64-decode.html">base64_decode</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.get-headers.html">get_headers</a></div>
 <div class="up"><a href="ref.url.html">URL Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.base64-encode" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">base64_encode</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">base64_encode</span> &mdash; <span class="dc-title">Encodes data with MIME base64</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.base64-encode-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><b>base64_encode</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$data</tt></span>
   )</div>

  <p class="para rdfs-comment">
   Encodes the given <i><tt class="parameter">data</tt></i> with base64.
  </p>
  <p class="para">
   This encoding is designed to make binary data survive transport through
   transport layers that are not 8-bit clean, such as mail bodies.
  </p>
  <p class="para">
   Base64-encoded data takes about 33% more space than the original
   data.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.base64-encode-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">data</tt></i></span>
     <dd>

      <p class="para">
       The data to encode.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.base64-encode-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   The encoded data, as a string or <b><tt>FALSE</tt></b> on failure.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.base64-encode-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-3718">
    <p><b>Example #1 <span class="function"><b>base64_encode()</b></span> example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'This&nbsp;is&nbsp;an&nbsp;encoded&nbsp;string'</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">base64_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
VGhpcyBpcyBhbiBlbmNvZGVkIHN0cmluZw==
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.base64-encode-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.base64-decode.html" class="function" rel="rdfs-seeAlso">base64_decode()</a> - Decodes data encoded with MIME base64</span></li>
    <li class="member"><span class="function"><a href="function.chunk-split.html" class="function" rel="rdfs-seeAlso">chunk_split()</a> - Split a string into smaller chunks</span></li>
    <li class="member"><span class="function"><a href="function.convert-uuencode.html" class="function" rel="rdfs-seeAlso">convert_uuencode()</a> - Uuencode a string</span></li>
    <li class="member"><a href="http://www.faqs.org/rfcs/rfc2045" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2045">&raquo;&nbsp;RFC 2045</a> section 6.8</li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="105200""></a>
  <div class="note">
   <strong class="user">luke at lukeoliff.com</strong>
   <a href="#105200" class="date">02-Aug-2011 09:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A function I'm using to return local images as base64 encrypted code, i.e. embedding the image source into the html request.<br />
<br />
This will greatly reduce your page load time as the browser will only need to send one server request for the entire page, rather than multiple requests for the HTML and the images. Requests need to be uploaded and 99% of the world are limited on their upload speed to the server.<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">function </span><span class="default">base64_encode_image </span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">=</span><span class="default">string</span><span class="keyword">,</span><span class="default">$filetype</span><span class="keyword">=</span><span class="default">string</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$filename</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgbinary </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">), </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'data:image/' </span><span class="keyword">. </span><span class="default">$filetype </span><span class="keyword">. </span><span class="string">';base64,' </span><span class="keyword">. </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$imgbinary</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
used as so<br />
<br />
&lt;style type="text/css"&gt;<br />
.logo {<br />
&nbsp;&nbsp;&nbsp; background: url("<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">base64_encode_image </span><span class="keyword">(</span><span class="string">'img/logo.png'</span><span class="keyword">,</span><span class="string">'png'</span><span class="keyword">); </span><span class="default">?&gt;</span>") no-repeat right 5px;<br />
}<br />
&lt;/style&gt;<br />
<br />
or<br />
<br />
&lt;img src="<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">base64_encode_image </span><span class="keyword">(</span><span class="string">'img/logo.png'</span><span class="keyword">,</span><span class="string">'png'</span><span class="keyword">); </span><span class="default">?&gt;</span>"/&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104801""></a>
  <div class="note">
   <strong class="user">markrose at markrose dot ca</strong>
   <a href="#104801" class="date">07-Jul-2011 03:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An even faster way to line-breaks every 64th character is using the chunk_split function:<br />
<br />
<span class="default">&lt;?php<br />
$string </span><span class="keyword">= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">), </span><span class="default">64</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103849""></a>
  <div class="note">
   <strong class="user">gutzmer at usa dot net</strong>
   <a href="#103849" class="date">06-May-2011 09:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For anyone interested in the 'base64url' variant encoding, you can use this pair of functions:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">base64url_encode</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp; return </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">), </span><span class="string">'+/'</span><span class="keyword">, </span><span class="string">'-_'</span><span class="keyword">), </span><span class="string">'='</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">base64url_decode</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp; return </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">'-_'</span><span class="keyword">, </span><span class="string">'+/'</span><span class="keyword">), </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) % </span><span class="default">4</span><span class="keyword">, </span><span class="string">'='</span><span class="keyword">, </span><span class="default">STR_PAD_RIGHT</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103607""></a>
  <div class="note">
   <strong class="user">Nimja.com</strong>
   <a href="#103607" class="date">22-Apr-2011 01:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A much easier way to add linebreaks every 64'th character would be with regular expressions.<br />
<br />
<span class="default">&lt;?php<br />
$string </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
</span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/(.{64})/'</span><span class="keyword">, </span><span class="string">'$1\n'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
And I'm assuming this would be faster too. Hope people have use for this ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99842""></a>
  <div class="note">
   <strong class="user">andronick(dot)mail(dog)gmail(dot)com</strong>
   <a href="#99842" class="date">09-Sep-2010 06:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
output images into html:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$imgfile </span><span class="keyword">= </span><span class="string">"test.gif"</span><span class="keyword">;<br />
<br />
</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
<br />
</span><span class="default">$imgbinary </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$imgfile</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">), </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$imgfile</span><span class="keyword">));<br />
<br />
echo </span><span class="string">'&lt;img src="data:image/gif;base64,' </span><span class="keyword">. </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$imgbinary</span><span class="keyword">) . </span><span class="string">'" /&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
gif - data:image/gif;base64,...<br />
jpg - data:image/jpeg;base64,...<br />
png - data:image/png;base64,...<br />
etc.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95612""></a>
  <div class="note">
   <strong class="user">gustavo at duranlinar dot es</strong>
   <a href="#95612" class="date">12-Jan-2010 09:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some files can give a real headhache when script file is coded in UTF-8. Change it to ANSI and it'll work fine.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93375""></a>
  <div class="note">
   <strong class="user">jonb at wobblymusic dot com</strong>
   <a href="#93375" class="date">06-Sep-2009 12:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that some applications, such as OpenSSL's enc command, require that there be a line break every 64 characters in order for their base64 decode function to work. The following function will take care of this problem:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function (</span><span class="default">$encodeMe</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$encodeMe</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$datalb </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) &gt; </span><span class="default">64</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$datalb </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">64</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$datalb </span><span class="keyword">.= </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$datalb</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92762""></a>
  <div class="note">
   <strong class="user">MitMacher</strong>
   <a href="#92762" class="date">07-Aug-2009 02:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Unfortunately my "function" for encoding base64 on-the-fly from 2007 [which has been removed from the manual in favor of this post] had 2 errors!<br />
The first led to an endless loop because of a missing "$feof"-check, the second caused the rare mentioned errors when encoding failed for some reason in larger files, especially when<br />
setting fgets($fh, 2) for example. But lower values then 1024 are bad overall because they slow down the whole process, so 4096 will be fine for all purposes, I guess.<br />
The error was caused by the use of "empty()".<br />
<br />
Here comes the corrected version which I have tested for all kind of files and length (up to 4,5 Gb!) without any error:<br />
<br />
<span class="default">&lt;?php<br />
$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'Input-File'</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">);<br />
</span><span class="comment">//$fh2 = fopen('Output-File', 'wb');<br />
<br />
</span><span class="default">$cache </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
</span><span class="default">$eof </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
while (</span><span class="default">1</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$eof</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$row </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$row </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$eof </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$cache </span><span class="keyword">!== </span><span class="string">''</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$row </span><span class="keyword">= </span><span class="default">$cache</span><span class="keyword">.</span><span class="default">$row</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; elseif (</span><span class="default">$eof</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$b64 </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$put </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$b64</span><span class="keyword">) &lt; </span><span class="default">76</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$eof</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$put </span><span class="keyword">= </span><span class="default">$b64</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cache </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cache </span><span class="keyword">= </span><span class="default">$row</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$b64</span><span class="keyword">) &gt; </span><span class="default">76</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; do {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$put </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$b64</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">76</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b64 </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$b64</span><span class="keyword">, </span><span class="default">76</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } while (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$b64</span><span class="keyword">) &gt; </span><span class="default">76</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cache </span><span class="keyword">= </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$b64</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$eof </span><span class="keyword">&amp;&amp; </span><span class="default">$b64</span><span class="keyword">{</span><span class="default">75</span><span class="keyword">} == </span><span class="string">'='</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cache </span><span class="keyword">= </span><span class="default">$row</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$put </span><span class="keyword">= </span><span class="default">$b64</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cache </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$put </span><span class="keyword">!== </span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$put</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//fputs($fh2, $put);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //fputs($fh2, base64_decode($put));&nbsp; &nbsp; &nbsp; &nbsp; // for comparing<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
}<br />
<br />
</span><span class="comment">//fclose($fh2);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87925""></a>
  <div class="note">
   <strong class="user">pablo  at  compuar dot com</strong>
   <a href="#87925" class="date">30-Dec-2008 03:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to send a very long value over URL, you might consider using base64_encode, and discover that IE6 only supports 2000 or so chars.<br />
<br />
So, Using a little bit of magic you can do this and be happy:<br />
<br />
<span class="default">&lt;?php<br />
$string </span><span class="keyword">= </span><span class="string">'Blah'</span><span class="keyword">;<br />
<br />
</span><span class="default">$encoded </span><span class="keyword">= </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">gzcompress</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">),</span><span class="default">9</span><span class="keyword">))), </span><span class="string">'+/='</span><span class="keyword">, </span><span class="string">'-_,'</span><span class="keyword">);<br />
<br />
&nbsp;</span><span class="default">$string</span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">gzuncompress</span><span class="keyword">(</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$encoded</span><span class="keyword">, </span><span class="string">'-_,'</span><span class="keyword">, </span><span class="string">'+/='</span><span class="keyword">)))));<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85839""></a>
  <div class="note">
   <strong class="user">gglockner AT NOSPAMdwaffler DOT com</strong>
   <a href="#85839" class="date">19-Sep-2008 08:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I omitted the strtr functions in my examples.&nbsp; Here are corrected functions:<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">function </span><span class="default">encode</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">) { <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'Cksum'</span><span class="keyword">],</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">28</span><span class="keyword">),</span><span class="default">4</span><span class="keyword">) . </span><span class="default">$x</span><span class="keyword">), </span><span class="string">'+/='</span><span class="keyword">, </span><span class="string">'-_~'</span><span class="keyword">);<br />
} <br />
<br />
function </span><span class="default">decode</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">) { <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="string">'-_~'</span><span class="keyword">, </span><span class="string">'+/='</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'Cksum'</span><span class="keyword">],</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$y</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">)) === </span><span class="default">false</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$y</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">-</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$y</span><span class="keyword">)); <br />
} <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85831""></a>
  <div class="note">
   <strong class="user">gglockner AT NOSPAMdwaffler DOT com</strong>
   <a href="#85831" class="date">19-Sep-2008 06:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have another solution that is simple and elegant.&nbsp; Create a pseudorandom string of characters.&nbsp; Then, each time you want to obfuscate your key, append a random substring from the pseudorandom string and use base64 encoding.&nbsp; When you want to de-obfuscate, convert back from base64.&nbsp; If the prefix is not in your pseudorandom source, then the value is forged.&nbsp; Otherwise, strip the prefix and recover your original key.<br />
<br />
The advantages are that the string will look different even for the same key, and encoding and decoding should be extremely fast.<br />
<br />
Here's an example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Call makeCksum once upon landing on the homepage<br />
</span><span class="keyword">function </span><span class="default">makeCksum</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">32</span><span class="keyword">;++</span><span class="default">$i</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$str </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">32</span><span class="keyword">,</span><span class="default">126</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'Cksum'</span><span class="keyword">] = </span><span class="default">$str</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">encode</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'Cksum'</span><span class="keyword">],</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">28</span><span class="keyword">),</span><span class="default">4</span><span class="keyword">) . </span><span class="default">$x</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">decode</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'Cksum'</span><span class="keyword">],</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$y</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">)) === </span><span class="default">false</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$y</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">-</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$y</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82947""></a>
  <div class="note">
   <strong class="user">marcus dot kabele at kabele dot at</strong>
   <a href="#82947" class="date">02-May-2008 08:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
At Andi:<br />
The last 6 chars of the decoded is used as some checksum + cryptographical salt - this prevents only in/decrementation of a primary key (ID) in an URL.<br />
But there is no obfuscation of the ID, it is visible almost immediately: the number before "-". Hackers are thus guided to this internal ID of the database record and can use this knowledge...<br />
<br />
Obfuscate better, making details a little less obvious, but not more secure:<br />
* avoid the "-" (the "checksum/salt" is always the same lenght...),<br />
* obfuscate the integer by converting ist to hex, like the hash.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// unchanged, thanx Tom, Andy, fsx.nr01<br />
</span><span class="keyword">function </span><span class="default">base64_url_encode</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">), </span><span class="string">'+/='</span><span class="keyword">, </span><span class="string">'-_,'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
function </span><span class="default">base64_url_decode</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="string">'-_,'</span><span class="keyword">, </span><span class="string">'+/='</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="comment">// some variables are used for clarity, they can be avoided and lines can be shortened:<br />
<br />
</span><span class="keyword">function </span><span class="default">encryptId</span><span class="keyword">(</span><span class="default">$int</span><span class="keyword">, </span><span class="default">$TableSalt</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$GlobalSalt</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// global secret for salt.<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$HashedChecksum </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$TableSalt</span><span class="keyword">.</span><span class="default">$int</span><span class="keyword">.</span><span class="default">$GlobalSalt</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// The length of the "HashedChecksum" is another little secret,<br />
&nbsp;&nbsp;&nbsp; // but when the integers are small, it reveals...<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hex </span><span class="keyword">= </span><span class="default">dechex</span><span class="keyword">(</span><span class="default">$int</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// The integer is better obfuscated by being HEX like the hash.<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">base64url_encode</span><span class="keyword">(</span><span class="default">$HashedChecksum</span><span class="keyword">.</span><span class="default">$hex</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// reordered, alternatively use substr() with negative lengths... <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
function </span><span class="default">decryptId</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$TableSalt</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// checks if the second part of the base64 encoded string is correct.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">global </span><span class="default">$GlobalSalt</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// global secret for salt.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">base64url_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hex </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$int </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$hex</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$part1 </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// The "checksum/salt" is always the same length<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$TableSalt</span><span class="keyword">.</span><span class="default">$int</span><span class="keyword">.</span><span class="default">$GlobalSalt</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">) === </span><span class="default">$part1<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">? </span><span class="default">$int<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// distinguish "0" and "false"<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
There are some questions remaining:<br />
* Why should we use sha1() for such an low-security task, it needs a lot of calculation.<br />
* Would other algorithms be faster?<br />
If your goal is, to confuse ordinary users, crc32() is much faster than sha1(). (But it can reveal the "salt" which then is much more a filler than a secret.)<br />
If you want to secure against hackers, you should use strong encryption methods instead of obfuscation.<br />
<br />
Different approach: these calculations for every URL can be avoided:<br />
Take the database-ID, salt it (with a 'secret'), calculate a hash (like sha1), store it to a (unique - if you don't trust the truncated hash-algorithm any more) column in the database in addition to the primary key, index that field, and use that strange string for the URL and for the query. These calculations are done once and never again, but it costs you more memory for the database.<br />
As secure as the other solution, but much faster (at least for php).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82506""></a>
  <div class="note">
   <strong class="user">fsx.nr01 [at] gmail [dot] com</strong>
   <a href="#82506" class="date">14-Apr-2008 02:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Shortened the base64url_encode and decode functions from Andi (<a href="http://nl2.php.net/manual/en/function.base64-encode.php#82200" rel="nofollow" target="_blank">http://nl2.php.net/manual/en/function.base64-encode.php#82200</a>)<br />
<br />
function base64_url_encode($input)<br />
{<br />
&nbsp;&nbsp;&nbsp; return strtr(base64_encode($input), '+/=', '-_,');<br />
}<br />
<br />
function base64_url_decode($input)<br />
{<br />
&nbsp;&nbsp;&nbsp; return base64_decode(strtr($input, '-_,', '+/=')); <br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82200""></a>
  <div class="note">
   <strong class="user">Andi</strong>
   <a href="#82200" class="date">31-Mar-2008 01:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed a simple way to obfuscate auto_increment primary keys in databases when they are visible to users in URIs or API calls. The users should not be able to increment the id in the URL and see the next data record in the database table.<br />
<br />
My solution (uses modified base64 functions by Tom):<br />
<br />
function base64url_encode($plainText) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $base64 = base64_encode($plainText);<br />
&nbsp;&nbsp;&nbsp; $base64url = strtr($base64, '+/=', '-_,');<br />
&nbsp;&nbsp;&nbsp; return $base64url;&nbsp;&nbsp; <br />
}<br />
<br />
function base64url_decode($plainText) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $base64url = strtr($plainText, '-_,', '+/=');<br />
&nbsp;&nbsp;&nbsp; $base64 = base64_decode($base64url);<br />
&nbsp;&nbsp;&nbsp; return $base64;&nbsp;&nbsp; <br />
}<br />
<br />
function encryptId($int, $class='') {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return base64url_encode($int.'-'.substr(sha1($class.$int.encryptionKey), 0, 6));<br />
}<br />
<br />
function decryptId($string, $class='') {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $parts = explode('-', base64url_decode($string));<br />
&nbsp;&nbsp;&nbsp; if (count($parts) != 2) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return 0;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $int = $parts[0];<br />
&nbsp;&nbsp;&nbsp; return substr(sha1($class.$int.encryptionKey), 0, 6) === $parts[1]<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ? (int)$int<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; : 0;<br />
}<br />
<br />
- The optional 2nd argument is the class name, so two equal ids of different tables will not result in two equal obfuscated ids.<br />
<br />
- encryptionKey is a global secret key for encryption.<br />
<br />
- decryptId() checks if the second part of the base64 encoded string is correct.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81383""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#81383" class="date">25-Feb-2008 05:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a note on URI -safe base64. <br />
Simply replacing + = and / with _ - and . doesn't work as the base64_encode function will insert \r \n chars as well which are not URI-safe. So unless we have a base64encode function that does not insert any newline and padddings, the output can never be URI -safe.<br />
<br />
referring to the note posted by " web at pkasperski dot com"<br />
<br />
- you might as well use $encoded = strtr ( base64_encode ($data), 'ABCDEFG.....', 'aBcDEfG....' ). <br />
<br />
this is more efficient. Also, Is simply changing the casing of the letters&nbsp; more secure? Why don't you try swapping letters around instead<br />
<br />
- for your utf8_encode function, the "ord" function returns&nbsp; a number in the range 0-255. Remember that strings in PHP are actually a sequence of bytes rather than chars. So your utf8 encode func may not work properly. and the line "for ($n = 0; $n &lt; strlen($input); $n++) {" is inefficient, you should assign&nbsp; a variable $count to&nbsp; strlen($input) and use it. <br />
<br />
referring to <br />
"dlyaza aT yahoo DOT com"<br />
<br />
whats the usefulness of encoding your images in a php file??<br />
<br />
referring to&nbsp; "php at ianco dot co dot uk"<br />
<br />
- what version of php are you using? Your code works fine for me. I see all the output.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78765""></a>
  <div class="note">
   <strong class="user">web at pkasperski dot com</strong>
   <a href="#78765" class="date">26-Oct-2007 07:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have implemented the base64_encode() function with some custom&nbsp; mapping table so I could encode some binary data more securely without anyone knowing how to decode it<br />
<br />
here is the class<br />
<br />
<span class="default">&lt;?php <br />
<br />
</span><span class="keyword">class </span><span class="default">Base64 </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * I have changed letter placement (P &lt;=&gt; x, S &lt;=&gt; 9) and the cases<br />
&nbsp;&nbsp; &nbsp; * You can completely redo the mapping table<br />
&nbsp;&nbsp; &nbsp; */<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private static </span><span class="default">$BinaryMap </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'b'</span><span class="keyword">, </span><span class="string">'c'</span><span class="keyword">, </span><span class="string">'d'</span><span class="keyword">, </span><span class="string">'e'</span><span class="keyword">, </span><span class="string">'f'</span><span class="keyword">, </span><span class="string">'g'</span><span class="keyword">, </span><span class="string">'h'</span><span class="keyword">, </span><span class="comment">//&nbsp; 7<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'i'</span><span class="keyword">, </span><span class="string">'j'</span><span class="keyword">, </span><span class="string">'k'</span><span class="keyword">, </span><span class="string">'l'</span><span class="keyword">, </span><span class="string">'m'</span><span class="keyword">, </span><span class="string">'n'</span><span class="keyword">, </span><span class="string">'o'</span><span class="keyword">, </span><span class="string">'x'</span><span class="keyword">, </span><span class="comment">// 15<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'q'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">, </span><span class="string">'9'</span><span class="keyword">, </span><span class="string">'t'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'v'</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">, </span><span class="string">'x'</span><span class="keyword">, </span><span class="comment">// 23<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'y'</span><span class="keyword">, </span><span class="string">'z'</span><span class="keyword">, </span><span class="string">'A'</span><span class="keyword">, </span><span class="string">'B'</span><span class="keyword">, </span><span class="string">'C'</span><span class="keyword">, </span><span class="string">'D'</span><span class="keyword">, </span><span class="string">'E'</span><span class="keyword">, </span><span class="string">'F'</span><span class="keyword">, </span><span class="comment">// 31<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'G'</span><span class="keyword">, </span><span class="string">'H'</span><span class="keyword">, </span><span class="string">'I'</span><span class="keyword">, </span><span class="string">'J'</span><span class="keyword">, </span><span class="string">'K'</span><span class="keyword">, </span><span class="string">'L'</span><span class="keyword">, </span><span class="string">'M'</span><span class="keyword">, </span><span class="string">'N'</span><span class="keyword">, </span><span class="comment">// 39<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'O'</span><span class="keyword">, </span><span class="string">'P'</span><span class="keyword">, </span><span class="string">'Q'</span><span class="keyword">, </span><span class="string">'R'</span><span class="keyword">, </span><span class="string">'S'</span><span class="keyword">, </span><span class="string">'T'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'V'</span><span class="keyword">, </span><span class="comment">// 47<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'W'</span><span class="keyword">, </span><span class="string">'P'</span><span class="keyword">, </span><span class="string">'Y'</span><span class="keyword">, </span><span class="string">'Z'</span><span class="keyword">, </span><span class="string">'0'</span><span class="keyword">, </span><span class="string">'1'</span><span class="keyword">, </span><span class="string">'2'</span><span class="keyword">, </span><span class="string">'3'</span><span class="keyword">, </span><span class="comment">// 55<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'4'</span><span class="keyword">, </span><span class="string">'5'</span><span class="keyword">, </span><span class="string">'6'</span><span class="keyword">, </span><span class="string">'7'</span><span class="keyword">, </span><span class="string">'8'</span><span class="keyword">, </span><span class="string">'S'</span><span class="keyword">, </span><span class="string">'+'</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">, </span><span class="comment">// 63 <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'='</span><span class="keyword">,&nbsp; </span><span class="comment">// padding char<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {}<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chr1 </span><span class="keyword">= </span><span class="default">$chr2 </span><span class="keyword">= </span><span class="default">$chr3 </span><span class="keyword">= </span><span class="default">$enc1 </span><span class="keyword">= </span><span class="default">$enc2 </span><span class="keyword">= </span><span class="default">$enc3 </span><span class="keyword">= </span><span class="default">$enc4 </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="comment">//&nbsp; &nbsp; &nbsp; &nbsp; $input = self::utf8_encode($input);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">while(</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chr1 </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">++]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chr2 </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">++]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chr3 </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">++]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enc1 </span><span class="keyword">= </span><span class="default">$chr1 </span><span class="keyword">&gt;&gt; </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enc2 </span><span class="keyword">= ((</span><span class="default">$chr1 </span><span class="keyword">&amp; </span><span class="default">3</span><span class="keyword">) &lt;&lt; </span><span class="default">4</span><span class="keyword">) | (</span><span class="default">$chr2 </span><span class="keyword">&gt;&gt; </span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enc3 </span><span class="keyword">= ((</span><span class="default">$chr2 </span><span class="keyword">&amp; </span><span class="default">15</span><span class="keyword">) &lt;&lt; </span><span class="default">2</span><span class="keyword">) | (</span><span class="default">$chr3 </span><span class="keyword">&gt;&gt; </span><span class="default">6</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enc4 </span><span class="keyword">= </span><span class="default">$chr3 </span><span class="keyword">&amp; </span><span class="default">63</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_nan</span><span class="keyword">(</span><span class="default">$chr2</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enc3 </span><span class="keyword">= </span><span class="default">$enc4 </span><span class="keyword">= </span><span class="default">64</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">is_nan</span><span class="keyword">(</span><span class="default">$chr3</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enc4 </span><span class="keyword">= </span><span class="default">64</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">.=&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$BinaryMap</span><span class="keyword">[</span><span class="default">$enc1</span><span class="keyword">]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . </span><span class="default">self</span><span class="keyword">::</span><span class="default">$BinaryMap</span><span class="keyword">[</span><span class="default">$enc2</span><span class="keyword">]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . </span><span class="default">self</span><span class="keyword">::</span><span class="default">$BinaryMap</span><span class="keyword">[</span><span class="default">$enc3</span><span class="keyword">]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . </span><span class="default">self</span><span class="keyword">::</span><span class="default">$BinaryMap</span><span class="keyword">[</span><span class="default">$enc4</span><span class="keyword">]; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$output</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$utftext </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$n </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$n </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">); </span><span class="default">$n</span><span class="keyword">++) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$n</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$c </span><span class="keyword">&lt; </span><span class="default">128</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$utftext </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if ((</span><span class="default">$c </span><span class="keyword">&gt; </span><span class="default">128</span><span class="keyword">) &amp;&amp; (</span><span class="default">$c </span><span class="keyword">&lt; </span><span class="default">2048</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$utftext </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">((</span><span class="default">$c </span><span class="keyword">&gt;&gt; </span><span class="default">6</span><span class="keyword">) | </span><span class="default">192</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$utftext </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">((</span><span class="default">$c </span><span class="keyword">&amp; </span><span class="default">63</span><span class="keyword">) | </span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$utftext </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">((</span><span class="default">$c </span><span class="keyword">&gt;&gt; </span><span class="default">12</span><span class="keyword">) | </span><span class="default">224</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$utftext </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(((</span><span class="default">$c </span><span class="keyword">&amp; </span><span class="default">6</span><span class="keyword">) &amp; </span><span class="default">63</span><span class="keyword">) | </span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$utftext </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">((</span><span class="default">$c </span><span class="keyword">&amp; </span><span class="default">63</span><span class="keyword">) | </span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$utftext</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
and the usage as follows:<br />
<br />
<span class="default">&lt;?php<br />
$string </span><span class="keyword">= </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'H*'</span><span class="keyword">, </span><span class="string">"31c85c5aaa56c1f0102301ea497d0ab010e4e131af261787"</span><span class="keyword">); </span><span class="comment">// HEX to binary<br />
</span><span class="keyword">echo </span><span class="default">Base64</span><span class="keyword">::</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
echo </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
and the output will be:<br />
<br />
mCHCwQPwWFaqiWhQ9x0kSbdK4tgVjHEh&nbsp;&nbsp; //&nbsp; with custom mapping<br />
MchcWqpWwfAQIwHqSX0KsBDk4TGvJheH&nbsp;&nbsp; //&nbsp; the base64_encode()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71582""></a>
  <div class="note">
   <strong class="user">Tom</strong>
   <a href="#71582" class="date">06-Dec-2006 10:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function supports "base64url" as described in Section 5 of RFC 4648, "Base 64 Encoding with URL and Filename Safe Alphabet"<br />
<br />
&nbsp;&nbsp;&nbsp; <span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">base64url_encode</span><span class="keyword">(</span><span class="default">$plainText</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$base64 </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$plainText</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$base64url </span><span class="keyword">= </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$base64</span><span class="keyword">, </span><span class="string">'+/'</span><span class="keyword">, </span><span class="string">'-_'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">$base64url</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">?&gt;<br />
</span><br />
You may wish to rtrim (or escape) trailing ='s for use in a URI.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71516""></a>
  <div class="note">
   <strong class="user">eric [at] d512 [dot] com</strong>
   <a href="#71516" class="date">03-Dec-2006 07:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that at least some Windows systems will not print a line of characters longer than a certain length unless it has line breaks of some kind.&nbsp; So if you base-64 encode a file, print it back for debugging purposes, and see nothing, don't be alarmed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70629""></a>
  <div class="note">
   <strong class="user">dlyaza aT yahoo DOT com</strong>
   <a href="#70629" class="date">22-Oct-2006 05:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using Function:<br />
Output for HTML Put:<br />
&lt;img src="$self?image=file" border="0" alt="file"&gt;<br />
&lt;img src="$self?image=folder" border="0" alt="folder"&gt;<br />
<br />
function getimage ($image) {<br />
&nbsp;&nbsp;&nbsp; switch ($image) {<br />
&nbsp;&nbsp;&nbsp; case 'file':<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return base64_decode('R0lGODlhEQANAJEDAJmZmf///wAAAP///yH5BAHoAwMALAAAA<br />
AARAA0AAAItnIGJxg0B42rsiSvCA/REmXQWhmnih3LUSGaqg35vF<br />
bSXucbSabunjnMohq8CADsA');<br />
&nbsp;&nbsp;&nbsp; case 'folder':<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return base64_decode('R0lGODlhEQANAJEDAJmZmf///8zMzP///yH5BAHoAwMALAAAAA<br />
ARAA0AAAIqnI+ZwKwbYgTPtIudlbwLOgCBQJYmCYrn+m3smY5v<br />
Gc+0a7dhjh7ZbygAADsA');<br />
&nbsp;&nbsp;&nbsp; case 'hidden_file':<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return base64_decode('R0lGODlhEQANAJEDAMwAAP///5mZmf///yH5BAHoAwMALAAAA<br />
AARAA0AAAItnIGJxg0B42rsiSvCA/REmXQWhmnih3LUSGaqg35vF<br />
bSXucbSabunjnMohq8CADsA');<br />
&nbsp;&nbsp;&nbsp; case 'link':<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return base64_decode('R0lGODlhEQANAKIEAJmZmf///wAAAMwAAP///wAAAAAAAAAAA<br />
CH5BAHoAwQALAAAAAARAA0AAAM5SArcrDCCQOuLcIotwgTYUll<br />
NOA0DxXkmhY4shM5zsMUKTY8gNgUvW6cnAaZgxMyIM2zBLCaHlJgAADsA');<br />
&nbsp;&nbsp;&nbsp; case 'smiley':<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return base64_decode('R0lGODlhEQANAJECAAAAAP//AP///wAAACH5BAHoAwIALAAAA<br />
AARAA0AAAIslI+pAu2wDAiz0jWD3hqmBzZf1VCleJQch0rkdnppB3<br />
dKZuIygrMRE/oJDwUAOwA=');<br />
&nbsp;&nbsp;&nbsp; case 'arrow':<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return base64_decode('R0lGODlhEQANAIABAAAAAP///yH5BAEKAAEALAAAAAARAA0AA<br />
AIdjA9wy6gNQ4pwUmav0yvn+hhJiI3mCJ6otrIkxxQAOw==');<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69836""></a>
  <div class="note">
   <strong class="user">php at ianco dot co dot uk</strong>
   <a href="#69836" class="date">22-Sep-2006 08:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am finding a length restriction with base64_encode (or possibly with echo) in PHP 4.3.9.<br />
This works ok for me:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">'-'</span><span class="keyword">, </span><span class="default">3273</span><span class="keyword">)); </span><span class="comment">// 3273<br />
</span><span class="keyword">echo </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">'-'</span><span class="keyword">, </span><span class="default">3273</span><span class="keyword">))); </span><span class="comment">// 4364<br />
</span><span class="keyword">echo </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">'-'</span><span class="keyword">, </span><span class="default">3273</span><span class="keyword">)); </span><span class="comment">// LS0t repeated<br />
</span><span class="default">?&gt;<br />
</span>But change the length to 3274 and the third echo prints nothing.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">'-'</span><span class="keyword">, </span><span class="default">3274</span><span class="keyword">)); </span><span class="comment">// 3274<br />
</span><span class="keyword">echo </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">'-'</span><span class="keyword">, </span><span class="default">3274</span><span class="keyword">))); </span><span class="comment">// 4368<br />
</span><span class="keyword">echo </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">'-'</span><span class="keyword">, </span><span class="default">3274</span><span class="keyword">)); </span><span class="comment">// Nothing at all printed<br />
</span><span class="default">?&gt;<br />
</span>This has obvious implications if you're wanting to encode a fairly large serialized array and echo it to a form field.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68334""></a>
  <div class="note">
   <strong class="user">peter at mailinator dot com</strong>
   <a href="#68334" class="date">23-Jul-2006 02:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to decode base64 encoded data in Javascript, you can use the tool (Webtoolkit.base64) on this website: <a href="http://www.webtoolkit.info/" rel="nofollow" target="_blank">http://www.webtoolkit.info/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65184""></a>
  <div class="note">
   <strong class="user">greenthumb at 4point-webdesign dot de</strong>
   <a href="#65184" class="date">26-Apr-2006 02:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had massive problems storing a serialized Object which contained UTF-8 parts and some ascii parts (from the serialization i think) into mysql.<br />
<br />
So i used base64_encode to get a clean string which could be safely decoded and unserialized.<br />
<br />
this is bulletproof - if you ever have trouble use this.<br />
the runtime is imho no problem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63667""></a>
  <div class="note">
   <strong class="user">dawgeatschikin at hotmail dot com</strong>
   <a href="#63667" class="date">27-Mar-2006 08:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a minor tweak of massimo's functions.<br />
<br />
&lt;?<br />
$data = str_replace(array('+','/','='),array('-','_','.'),$data);<br />
//replace '=' with '.' instead of with nothing, that way the process is reversible.&nbsp; '.' is uri-safe according to <a href="http://www.w3.org/Addressing/URL/5_URI_BNF.html" rel="nofollow" target="_blank">http://www.w3.org/Addressing/URL/5_URI_BNF.html</a><br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63554""></a>
  <div class="note">
   <strong class="user">massimo dot scamarcia at gmail dot com</strong>
   <a href="#63554" class="date">23-Mar-2006 07:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$data = str_replace(array('+','/','='),array('-','_',),$data); // MIME::Base64::URLSafe implementation<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
$data = str_replace(array('+','/'),array('-','_'),$data); // Python raise "TypeError: Incorrect padding" if you remove "=" chars when decoding</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63543""></a>
  <div class="note">
   <strong class="user">massimo dot scamarcia at gmail dot com</strong>
   <a href="#63543" class="date">23-Mar-2006 03:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function urlsafe_b64encode($string) {<br />
&nbsp;&nbsp;&nbsp; $data = base64_encode($string);<br />
&nbsp;&nbsp;&nbsp; $data = str_replace(array('+','/','='),array('-','_',''),$data);<br />
&nbsp;&nbsp;&nbsp; return $data;<br />
}<br />
<br />
function urlsafe_b64decode($string) {<br />
&nbsp;&nbsp;&nbsp; $data = str_replace(array('-','_'),array('+','/'),$string);<br />
&nbsp;&nbsp;&nbsp; $mod4 = strlen($data) % 4;<br />
&nbsp;&nbsp;&nbsp; if ($mod4) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $data .= substr('====', $mod4);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return base64_decode($data);<br />
}<br />
<br />
Php version of perl's MIME::Base64::URLSafe, that provides an url-safe base64 string encoding/decoding (compatible with python base64's urlsafe methods)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63270""></a>
  <div class="note">
   <strong class="user">Gabriel Malca</strong>
   <a href="#63270" class="date">17-Mar-2006 01:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the function doesn't exist, this is a messy but effective way of doing it:<br />
<br />
&lt;?<br />
<br />
echo bencode("Gabriel Malca");<br />
// R2FicmllbCBNYWxjYQ==<br />
<br />
function bencode($string='') {<br />
&nbsp;&nbsp;&nbsp; $binval = convert_binary_str($string);<br />
&nbsp;&nbsp;&nbsp; $final = "";<br />
&nbsp;&nbsp;&nbsp; $start = 0;<br />
&nbsp;&nbsp;&nbsp; while ($start &lt; strlen($binval)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (strlen(substr($binval,$start)) &lt; 6)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $binval .= str_repeat("0",6-strlen(substr($binval,$start)));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tmp = bindec(substr($binval,$start,6));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($tmp &lt; 26)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $final .= chr($tmp+65);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif ($tmp &gt; 25 &amp;&amp; $tmp &lt; 52)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $final .= chr($tmp+71);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif ($tmp == 62)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $final .= "+";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif ($tmp == 63)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $final .= "/";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (!$tmp)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $final .= "A";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $final .= chr($tmp-4);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $start += 6;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (strlen($final)%4&gt;0)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $final .= str_repeat("=",4-strlen($final)%4);<br />
&nbsp;&nbsp;&nbsp; return $final;<br />
}<br />
<br />
function convert_binary_str($string) {<br />
&nbsp;&nbsp;&nbsp; if (strlen($string)&lt;=0) return;<br />
&nbsp;&nbsp;&nbsp; $tmp = decbin(ord($string[0]));<br />
&nbsp;&nbsp;&nbsp; $tmp = str_repeat("0",8-strlen($tmp)).$tmp;<br />
&nbsp;&nbsp;&nbsp; return $tmp.convert_binary_str(substr($string,1));<br />
}<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61687""></a>
  <div class="note">
   <strong class="user">conradopinto at yahoo dot com dot br</strong>
   <a href="#61687" class="date">09-Feb-2006 07:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is an error on the example of passing an array through an HTML Form.<br />
<br />
In the line:<br />
$array = unserialize(base64_decode($coded_array);<br />
<br />
There is a ')' missing. it should be:<br />
$array = unserialize(base64_decode($coded_array));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59430""></a>
  <div class="note">
   <strong class="user">virtuall at virtuall dot info</strong>
   <a href="#59430" class="date">06-Dec-2005 01:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you encode text that contains symbols like &lt; &gt; and want to send it in GET query, be sure to urlencode the result of base64_encode, as it sometimes adds a&nbsp; + (and it's a special symbol) at the end:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="string">'&lt;html&gt;'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
returns:<br />
<br />
PGh0bWw+<br />
<br />
A function like this could also be useful:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">base64_urlencode</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; };<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58753""></a>
  <div class="note">
   <strong class="user">andi151278</strong>
   <a href="#58753" class="date">14-Nov-2005 09:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using base64_encode to produce clean filenames from usernames (e.g. for image upload) is a bad idea if Umlaute (,,) are allowed. Then there is a slash (/) added in the filename, that will lead to a nonexisting directory beeing looked for and your script crashing!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56157""></a>
  <div class="note">
   <strong class="user">Cristiano Calligaro</strong>
   <a href="#56157" class="date">25-Aug-2005 03:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've used base64_encode and base64_decode for file attachment both in MySQL (using a BLOB field) and MSSQL (using a TEXT field). For MSSQL remember to set in PHP.INI file both mssql.textsize and mssql.textlimit to 2147483647.<br />
<br />
Here's the code:<br />
<br />
######### MSSQL(mssql_)/MySQL(mysql_) file attach<br />
$val=$HTTP_POST_FILES['lob_upload']['tmp_name'];<br />
$valn=$HTTP_POST_FILES['lob_upload']['name'];<br />
$valt=$HTTP_POST_FILES['lob_upload']['type'];<br />
<br />
$data=base64_encode(addslashes(fread(fopen($val, "r"), filesize($val))));<br />
<br />
mssql_connect("srv","usr","pass") or die ("");<br />
mssql_select_db("db") or die ("");<br />
$query = "UPDATE $table SET $field='$data', $fieldname='$valn', $fieldtype='$valt' WHERE DocID='$DocID'";<br />
$result = mssql_query($query) or die(mssql_error());<br />
mssql_close();<br />
<br />
######### MSSQL(mssql_)/MySQL(mysql_) open file attached<br />
mssql_connect("srv","usr","pass") or die ("");<br />
mssql_select_db("db") or die ("");<br />
$query = "SELECT $field,$fieldtype FROM $table WHERE DocID='$DocID'";<br />
$result = mssql_query($query) or die(mssql_error());<br />
$row = mssql_fetch_array($result);<br />
<br />
header("Content-type: $row[1]");<br />
echo stripslashes(base64_decode($row[0]));<br />
<br />
This strategy is good for Microsoft Word, Acrobat PDF, JPG image and so on (even zipped files!!!)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46962""></a>
  <div class="note">
   <strong class="user">mightymrj at hotmail dot com</strong>
   <a href="#46962" class="date">28-Oct-2004 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Problem: mime attachments sending as blank or almost completely blank documents (all data is lost)<br />
<br />
Explanation: After a couple days of trying to mime pdf attachments without losing all data, I finally came across this function in some obsolete obscure post: <br />
<br />
set_magic_quotes_runtime()<br />
<br />
This is set to on by default in the machine, and it causes fread() and/or base64_encode() (both used in most mime examples I've seen) to read or encrypt binary without slashes for special characters.&nbsp; This causes sent files to process incorrectly, breaking, thus truncating most of the data in the file.&nbsp; <br />
<br />
Fix: pass 0 to this function and it will do a one time turn off while your code executes.<br />
<br />
example:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; set_magic_quotes_runtime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This can also been turned off in the php.ini file, but I'm not sure what uses that setting or what the consequences might be.<br />
<br />
info:<br />
&nbsp;&nbsp; <a href="http://us2.php.net/manual/en/function.set-magic-quotes-runtime.php" rel="nofollow" target="_blank">http://us2.php.net/manual/en/function.set-magic-quotes-runtime.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43449""></a>
  <div class="note">
   <strong class="user">juha at kuhazor dot idlegames dot com</strong>
   <a href="#43449" class="date">21-Jun-2004 08:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use base64encoded strings as cookie names, make sure you remove '=' characters. At least Internet Explorer refuses cookie names containing '=' characters or urlencoded cookie names containing %xx character replacements. Use the function below to turn base64 encoded strings to bare alphabets (get rid of / and + characters as well)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">base64clean</span><span class="keyword">(</span><span class="default">$base64string</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$base64string </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">'='</span><span class="keyword">,</span><span class="string">'+'</span><span class="keyword">,</span><span class="string">'/'</span><span class="keyword">),</span><span class="string">''</span><span class="keyword">,</span><span class="default">$base64string</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">$base64string</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37579""></a>
  <div class="note">
   <strong class="user">Siu from Hong Kong</strong>
   <a href="#37579" class="date">19-Nov-2003 11:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As someone suggested above:<br />
<br />
using base64_encode() to encode image data and finally output to browser using "data" scheme of IMG src:<br />
<br />
&lt;?<br />
// ... <br />
echo '&lt;img src="data:image/png;base64,'.$encoded.' "&gt;';<br />
?&gt;<br />
<br />
Netscape browser supports this... However, Windows' Internet Explorer does not.<br />
<br />
To embed binary contents in ascii text based html file for IE, you need use MIME multipart.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35399""></a>
  <div class="note">
   <strong class="user">sb</strong>
   <a href="#35399" class="date">29-Aug-2003 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Re the message on 10-May-2003 04:02<br />
<br />
You'll want to call urlencode on the base_64 encoded data before putting it into a GET.&nbsp; IIUC, base 64 output includes the plus and the slash, both of which will be mungered by browsers.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32495""></a>
  <div class="note">
   <strong class="user">teddy at mycyberclassroom dot com</strong>
   <a href="#32495" class="date">28-May-2003 09:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you want to insert the base64 encoded image in your html &lt;img src&gt; you need to write 'data:datatype;base64,encodeddata' . For example here's a way to embed an PNG image data:<br />
<br />
&lt;?<br />
//get the base64 encoded image<br />
$handle = fopen($tempfile,'rb');<br />
$file_content = fread($handle,filesize($tempfile));<br />
fclose($handle);<br />
$encoded = chunk_split(base64_encode($file_content)); <br />
<br />
//then echo to browser as:<br />
<br />
echo '&lt;img src="data:image/png;base64,'.$encoded.' "&gt;';<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32021""></a>
  <div class="note">
   <strong class="user">Calvin[at] polbox [at] com</strong>
   <a href="#32021" class="date">13-May-2003 02:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want attach a binary file into mail, pay attention to use mode with "B" flag into fopen function (This is useful only on systems which differentiate between binary and text files, i.e. Windows) Include the 'b' flag in order to make your scripts more portable. <br />
<br />
<span class="default">&lt;?php<br />
$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$source_file</span><span class="keyword">,</span><span class="string">'rb'</span><span class="keyword">);<br />
</span><span class="default">$file_content </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">,</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$source_file</span><span class="keyword">));<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
</span><span class="default">$encoded </span><span class="keyword">= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$file_content</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31959""></a>
  <div class="note">
   <strong class="user">koos_nt_hulskamp at hotmail dot com</strong>
   <a href="#31959" class="date">10-May-2003 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had to send a php array trough a FORM in HTML, and came up with this solution: <br />
<br />
&lt;?<br />
$array[] = array("foo", "bar");<br />
$coded_array = base64_encode(serialize($array));<br />
?&gt;<br />
<br />
now u can put the $coded_array into an input field or even a GET link ex: <br />
<br />
&lt;a href="some_script.php?coded_array=&lt;?=$coded_array;?&gt;"&gt;script link&lt;/a&gt;<br />
<br />
after receiving it in the script you send it to, do the following:<br />
<br />
&lt;?<br />
$coded_array = $_GET["coded_array"]&nbsp; &nbsp;&nbsp; // or $_POST off course<br />
$array = unserialize(base64_decode($coded_array);<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25666""></a>
  <div class="note">
   <strong class="user">guy at bhaktiandvedanta dot com</strong>
   <a href="#25666" class="date">01-Oct-2002 05:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use base64_encode to transfer image file into string text and then display them. I used this to store my images in a database and display them form there. First I open the files using fread, encoded the result, and stored that result in the database. Useful for creating random images. <br />
<br />
image.php:<br />
<br />
&lt;?<br />
<br />
header(" Content-Type: image/jpeg");<br />
header(" Content-Disposition: inline");<br />
$sql = "SELECT data FROM image where name='".$img."'";<br />
$result = mysql_query($sql);<br />
$row = mysql_fetch_row($result);<br />
$image = $row[0];<br />
echo base64_decode($image);<br />
<br />
?&gt;<br />
<br />
And in the html file you put:<br />
<br />
&lt;img src="image.php?img=test3"&nbsp; border="0" alt=""&gt;<br />
<br />
Guy Laor</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.base64-decode.html">base64_decode</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.get-headers.html">get_headers</a></div>
 <div class="up"><a href="ref.url.html">URL Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
