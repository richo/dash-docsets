<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Opens file or URL</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.fnmatch.html">fnmatch</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.fpassthru.html">fpassthru</a></div>
 <div class="up"><a href="ref.filesystem.html">Filesystem Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.fopen" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">fopen</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">fopen</span> &mdash; <span class="dc-title">Opens file or URL</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.fopen-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><b>fopen</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$filename</tt></span>
   , <span class="methodparam"><span class="type">string</span> <tt class="parameter">$mode</tt></span>
   [, <span class="methodparam"><span class="type">bool</span> <tt class="parameter">$use_include_path</tt><span class="initializer"> = false</span></span>
   [, <span class="methodparam"><span class="type">resource</span> <tt class="parameter">$context</tt></span>
  ]] )</div>

  <p class="para rdfs-comment">
   <span class="function"><b>fopen()</b></span> binds a named resource, specified by
   <i><tt class="parameter">filename</tt></i>, to a stream. 
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.fopen-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">filename</tt></i></span>
     <dd>

      <p class="para">
       If <i><tt class="parameter">filename</tt></i> is of the form &quot;scheme://...&quot;, it
       is assumed to be a URL and PHP will search for a protocol handler
       (also known as a wrapper) for that scheme. If no wrappers for that
       protocol are registered, PHP will emit a notice to help you track
       potential problems in your script and then continue as though
       <i><tt class="parameter">filename</tt></i> specifies a regular file.
      </p>
      <p class="para">
       If PHP has decided that <i><tt class="parameter">filename</tt></i> specifies
       a local file, then it will try to open a stream on that file.
       The file must be accessible to PHP, so you need to ensure that
       the file access permissions allow this access.
       If you have enabled <a href="ini.sect.safe-mode.html#ini.safe-mode" class="link">safe mode</a>,
       or <a href="ini.core.html#ini.open-basedir" class="link">open_basedir</a> further
       restrictions may apply.
      </p>
      <p class="para">
       If PHP has decided that <i><tt class="parameter">filename</tt></i> specifies
       a registered protocol, and that protocol is registered as a
       network URL, PHP will check to make sure that
       <a href="filesystem.configuration.html#ini.allow-url-fopen" class="link">allow_url_fopen</a> is
       enabled. If it is switched off, PHP will emit a warning and
       the fopen call will fail.
      </p>
      <blockquote class="note"><p><b class="note">Note</b>: 
       <p class="para">
        The list of supported protocols can be found in <a href="wrappers.html" class="xref">Supported Protocols and Wrappers</a>. Some protocols (also referred to as
        <i>wrappers</i>) support <i>context</i>
        and/or <var class="filename">php.ini</var> options. Refer to the specific page for the
        protocol in use for a list of options which can be set. (e.g.
        <var class="filename">php.ini</var> value <i>user_agent</i> used by the
        <i>http</i> wrapper).
       </p>
      </p></blockquote>
      <p class="para">
       On the Windows platform, be careful to escape any backslashes
       used in the path to the file, or use forward slashes.
       <div class="informalexample">
        <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$handle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"c:\\folder\\resource.txt"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"r"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
        </div>

       </div>
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">mode</tt></i></span>
     <dd>

      <p class="para">
       The <i><tt class="parameter">mode</tt></i> parameter specifies the type of access
       you require to the stream.  It may be any of the following:
       <table class="doctable table">
        <caption><b>
         A list of possible modes for <span class="function"><b>fopen()</b></span>
         using <i><tt class="parameter">mode</tt></i>
        </b></caption>
        
         <thead valign="middle">
          <tr valign="middle">
           <th><i><tt class="parameter">mode</tt></i></th>
           <th>Description</th>
          </tr>

         </thead>

         <tbody valign="middle" class="tbody">
          <tr valign="middle">
           <td align="left"><i>&#039;r&#039;</i></td>
           <td align="left">
            Open for reading only; place the file pointer at the
            beginning of the file.
           </td>
          </tr>

          <tr valign="middle">
           <td align="left"><i>&#039;r+&#039;</i></td>
           <td align="left">
            Open for reading and writing; place the file pointer at
            the beginning of the file.
           </td>
          </tr>

          <tr valign="middle">
           <td align="left"><i>&#039;w&#039;</i></td>
           <td align="left">
            Open for writing only; place the file pointer at the
            beginning of the file and truncate the file to zero length.
            If the file does not exist, attempt to create it.
           </td>
          </tr>

          <tr valign="middle">
           <td align="left"><i>&#039;w+&#039;</i></td>
           <td align="left">
            Open for reading and writing; place the file pointer at
            the beginning of the file and truncate the file to zero
            length.  If the file does not exist, attempt to create it.
           </td>
          </tr>

          <tr valign="middle">
           <td align="left"><i>&#039;a&#039;</i></td>
           <td align="left">
            Open for writing only; place the file pointer at the end of
            the file. If the file does not exist, attempt to create it.
           </td>
          </tr>

          <tr valign="middle">
           <td align="left"><i>&#039;a+&#039;</i></td>
           <td align="left">
            Open for reading and writing; place the file pointer at
            the end of the file. If the file does not exist, attempt to
            create it.
           </td>
          </tr>

          <tr valign="middle">
           <td align="left"><i>&#039;x&#039;</i></td>
           <td align="left">
            Create and open for writing only; place the file pointer at the
            beginning of the file.  If the file already exists, the
            <span class="function"><b>fopen()</b></span> call will fail by returning <b><tt>FALSE</tt></b> and
            generating an error of level <b><tt>E_WARNING</tt></b>.  If
            the file does not exist, attempt to create it.  This is equivalent
            to specifying <i>O_EXCL|O_CREAT</i> flags for the
            underlying <i>open(2)</i> system call. 
           </td>
          </tr>

          <tr valign="middle">
           <td align="left"><i>&#039;x+&#039;</i></td>
           <td align="left">
            Create and open for reading and writing; otherwise it has the
            same behavior as <i>&#039;x&#039;</i>.
           </td>
          </tr>

          <tr valign="middle">
           <td align="left"><i>&#039;c&#039;</i></td>
           <td align="left">
            Open the file for writing only. If the file does not exist, it is
            created. If it exists, it is neither truncated (as opposed to
            <i>&#039;w&#039;</i>), nor the call to this function fails (as is
            the case with <i>&#039;x&#039;</i>). The file pointer is
            positioned on the beginning of the file. This may be useful if it&#039;s
            desired to get an advisory lock (see <span class="function"><a href="function.flock.html" class="function">flock()</a></span>)
            before attempting to modify the file, as using
            <i>&#039;w&#039;</i> could truncate the file before the lock
            was obtained (if truncation is desired,
            <span class="function"><a href="function.ftruncate.html" class="function">ftruncate()</a></span> can be used after the lock is
            requested).
           </td>
          </tr>

          <tr valign="middle">
           <td align="left"><i>&#039;c+&#039;</i></td>
           <td align="left">
            Open the file for reading and writing; otherwise it has the same
            behavior as <i>&#039;c&#039;</i>.
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
      <blockquote class="note"><p><b class="note">Note</b>: 
       <p class="para">
        Different operating system families have different line-ending
        conventions.  When you write a text file and want to insert a line
        break, you need to use the correct line-ending character(s) for your
        operating system.  Unix based systems use <i>\n</i> as the
        line ending character, Windows based systems use <i>\r\n</i>
        as the line ending characters and Macintosh based systems use
        <i>\r</i> as the line ending character.
       </p>
       <p class="para">
        If you use the wrong line ending characters when writing your files, you
        might find that other applications that open those files will &quot;look
        funny&quot;.
       </p>
       <p class="para">
        Windows offers a text-mode translation flag (<i>&#039;t&#039;</i>)
        which will transparently translate <i>\n</i> to
        <i>\r\n</i> when working with the file.  In contrast, you
        can also use <i>&#039;b&#039;</i> to force binary mode, which will not
        translate your data.  To use these flags, specify either
        <i>&#039;b&#039;</i> or <i>&#039;t&#039;</i> as the last character
        of the <i><tt class="parameter">mode</tt></i> parameter.
       </p>
       <p class="para">
        The default translation mode depends on the SAPI and version of PHP that
        you are using, so you are encouraged to always specify the appropriate
        flag for portability reasons.  You should use the <i>&#039;t&#039;</i>
        mode if you are working with plain-text files and you use
        <i>\n</i> to delimit your line endings in your script, but
        expect your files to be readable with applications such as notepad.  You
        should use the <i>&#039;b&#039;</i> in all other cases.
       </p>
       <p class="para">
        If you do not specify the &#039;b&#039; flag when working with binary files, you
        may experience strange problems with your data, including broken image
        files and strange problems with <i>\r\n</i> characters.
       </p>
      </p></blockquote>
      <blockquote class="note"><p><b class="note">Note</b>: 
       <p class="para">
        For portability, it is strongly recommended that you always
        use the &#039;b&#039; flag when opening files with <span class="function"><b>fopen()</b></span>.
       </p>
      </p></blockquote>
      <blockquote class="note"><p><b class="note">Note</b>: 
       <p class="para">
        Again, for portability, it is also strongly recommended that
        you re-write code that uses or relies upon the <i>&#039;t&#039;</i>
        mode so that it uses the correct line endings and
        <i>&#039;b&#039;</i> mode instead.
       </p>
      </p></blockquote>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">use_include_path</tt></i></span>
     <dd>

      <p class="para">
       The optional third <i><tt class="parameter">use_include_path</tt></i> parameter
       can be set to &#039;1&#039; or <b><tt>TRUE</tt></b> if you want to search for the file in the
       <a href="ini.core.html#ini.include-path" class="link">include_path</a>, too.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">context</tt></i></span>
     <dd>

      <blockquote class="note"><p><b class="note">Note</b>: <span class="simpara">Context support was added
with PHP 5.0.0. For a description of <i>contexts</i>, refer to
<a href="book.stream.html" class="xref">Streams</a>.</span></p></blockquote>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.fopen-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns a file pointer resource on success, or <b><tt>FALSE</tt></b> on error.
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.fopen-errors">
  <h3 class="title">Errors/Exceptions</h3>
  <p class="para">
   If the open fails, an error of level
   <b><tt>E_WARNING</tt></b> is generated.  You may use <a href="language.operators.errorcontrol.html" class="link">@</a> to suppress this
   warning.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.fopen-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">4.3.2</td>
       <td align="left">
        As of PHP 4.3.2, the default mode is set to binary for all platforms
        that distinguish between binary and text mode.  If you are having
        problems with your scripts after upgrading, try using the
        <i>&#039;t&#039;</i> flag as a workaround until you have made your
        script more portable as mentioned before
       </td>
      </tr>

      <tr valign="middle">
       <td align="left">4.3.2</td>
       <td align="left">
        The <i>&#039;x&#039;</i> and <i>&#039;x+&#039;</i> options were
        added
       </td>
      </tr>

      <tr valign="middle">
       <td align="left">5.2.6</td>
       <td align="left">
        The <i>&#039;c&#039;</i> and <i>&#039;c+&#039;</i> options were
        added
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.fopen-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-2181">
    <p><b>Example #1 <span class="function"><b>fopen()</b></span> examples</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$handle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"/home/rasmus/file.txt"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"r"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$handle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"/home/rasmus/file.gif"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"wb"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$handle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"http://www.example.com/"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"r"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$handle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"ftp://user:password@example.com/somefile.txt"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"w"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.fopen-notes">
  <h3 class="title">Notes</h3>
  <div class="warning"><b class="warning">Warning</b><p class="para">When using SSL, Microsoft IIS
will violate the protocol by closing the connection without sending a
<i>close_notify</i> indicator. PHP will report this as &quot;SSL: Fatal
Protocol Error&quot; when you reach the end of the data. To work around this, the
value of <a href="errorfunc.configuration.html#ini.error-reporting" class="link">error_reporting</a> should be
lowered to a level that does not include warnings.
PHP 4.3.7 and higher can detect buggy IIS server software when you open
the stream using the <i>https://</i> wrapper and will suppress the
warning. When using <span class="function"><a href="function.fsockopen.html" class="function">fsockopen()</a></span> to create an
<i>ssl://</i> socket, the developer is responsible for detecting
and suppressing this warning.</p></div>
  <blockquote class="note"><p><b class="note">Note</b>: <span class="simpara">When <a href="features.safe-mode.html" class="link">safe mode</a> is enabled, PHP checks whether
the directory in which the script is operating has the same UID (owner) as the
script that is being executed.</span></p></blockquote>
  <p class="para">
   If you are experiencing problems with reading and writing to files and
   you&#039;re using the server module version of PHP, remember to make sure that
   the files and directories you&#039;re using are accessible to the server
   process.
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.fopen-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><a href="wrappers.html" class="xref">Supported Protocols and Wrappers</a></li>
    <li class="member"><span class="function"><a href="function.fclose.html" class="function" rel="rdfs-seeAlso">fclose()</a> - Closes an open file pointer</span></li>
    <li class="member"><span class="function"><a href="function.fgets.html" class="function" rel="rdfs-seeAlso">fgets()</a> - Gets line from file pointer</span></li>
    <li class="member"><span class="function"><a href="function.fread.html" class="function" rel="rdfs-seeAlso">fread()</a> - Binary-safe file read</span></li>
    <li class="member"><span class="function"><a href="function.fwrite.html" class="function" rel="rdfs-seeAlso">fwrite()</a> - Binary-safe file write</span></li>
    <li class="member"><span class="function"><a href="function.fsockopen.html" class="function" rel="rdfs-seeAlso">fsockopen()</a> - Open Internet or Unix domain socket connection</span></li>
    <li class="member"><span class="function"><a href="function.file.html" class="function" rel="rdfs-seeAlso">file()</a> - Reads entire file into an array</span></li>
    <li class="member"><span class="function"><a href="function.file-exists.html" class="function" rel="rdfs-seeAlso">file_exists()</a> - Checks whether a file or directory exists</span></li>
    <li class="member"><span class="function"><a href="function.is-readable.html" class="function" rel="rdfs-seeAlso">is_readable()</a> - Tells whether a file exists and is readable</span></li>
    <li class="member"><span class="function"><a href="function.stream-set-timeout.html" class="function" rel="rdfs-seeAlso">stream_set_timeout()</a> - Set timeout period on a stream</span></li>
    <li class="member"><span class="function"><a href="function.popen.html" class="function" rel="rdfs-seeAlso">popen()</a> - Opens process file pointer</span></li>
    <li class="member"><span class="function"><a href="function.stream-context-create.html" class="function" rel="rdfs-seeAlso">stream_context_create()</a> - Create a streams context</span></li>
    <li class="member"><span class="function"><a href="function.umask.html" class="function" rel="rdfs-seeAlso">umask()</a> - Changes the current umask</span></li>
    <li class="member"><a href="class.splfileobject.html" class="classname">SplFileObject</a></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="105465""></a>
  <div class="note">
   <strong class="user">merye at web-graphique dot com</strong>
   <a href="#105465" class="date">19-Aug-2011 01:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had to switch from relative paths to full paths when my web host recently migrated the server onto their hosting cloud.&nbsp; This used to work for me:<br />
<br />
<span class="default">&lt;?php<br />
$fplog </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'ipn.log'</span><span class="keyword">,</span><span class="string">'a'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
After the migration, however, I received the following error message:<br />
<br />
Warning: fopen(ipn.log) [function.fopen]: failed to open stream: Permission denied in D:\home\server_name\log_test.php on line 21<br />
<br />
I had to change the code to the following to get it to work:<br />
<br />
<span class="default">&lt;?php<br />
$logfile </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">].</span><span class="string">'\\ipn.log'</span><span class="keyword">;<br />
</span><span class="default">$fplog </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$logfile</span><span class="keyword">,</span><span class="string">'a'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105180""></a>
  <div class="note">
   <strong class="user">php at richardneill dot org</strong>
   <a href="#105180" class="date">01-Aug-2011 09:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
fopen() will block if the file to be opened is a fifo. This is true whether it's opened in "r" or "w" mode.&nbsp; (See man 7 fifo: this is the correct, default behaviour; although Linux supports non-blocking fopen() of a fifo, PHP doesn't).<br />
The consequence of this is that you can't discover whether an initial fifo read/write would block because to do that you need stream_select(), which in turn requires that fopen() has happened!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104325""></a>
  <div class="note">
   <strong class="user">splogamurugan at gmail dot com</strong>
   <a href="#104325" class="date">09-Jun-2011 02:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While opening a file with multibyte data (Ex: donnÌ©es multi-octets), faced some issues with the encoding. Got to know that it uses&nbsp; windows-1250. Used iconv to convert it to UTF-8 and it resolved the issue.&nbsp; <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">utf8_fopen_read</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fc </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'windows-1250'</span><span class="keyword">, </span><span class="string">'utf-8'</span><span class="keyword">, </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">)); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"php://memory"</span><span class="keyword">, </span><span class="string">"rw"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$fc</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$handle</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Example usage:<br />
<br />
<span class="default">&lt;?php<br />
$fh </span><span class="keyword">= </span><span class="default">utf8_fopen_read</span><span class="keyword">(</span><span class="string">"./tpKpiBundle.csv"</span><span class="keyword">);<br />
while ((</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fgetcsv</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">1000</span><span class="keyword">, </span><span class="string">","</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$value </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope it helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102291""></a>
  <div class="note">
   <strong class="user">owltech at larkandowl dot net</strong>
   <a href="#102291" class="date">06-Feb-2011 11:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[fopen note]<br />
<br />
I have been trying unsuccessfully to upload and read a Mac OS file on a Linux server. Lots of records show up a just one big using only the following:<br />
<br />
<span class="default">&lt;?php $fhandle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span>&nbsp; or<br />
<span class="default">&lt;?php $fhandle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
It does work, however, this way:<br />
<br />
<span class="default">&lt;?php<br />
ini_set</span><span class="keyword">(</span><span class="string">'auto_detect_line_endings'</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
</span><span class="default">$fhandle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100762""></a>
  <div class="note">
   <strong class="user">conartist6 at gmail dot com</strong>
   <a href="#100762" class="date">04-Nov-2010 09:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In other comments it has been noted that fopen hangs when opening any fifo which is not actively being written to. It has also been noted that it is possible to prevent this behaviour by performing an fopen with the "r+" flags such that PHP keeps a handle open to the fifo itself.<br />
<br />
I hereby document that using the "r+" flag on a pipe under Linux (Slackware 13.0 (i486) and PHP 5.2.14) will render PHP unable to read data waiting to be written to the pipe by any other process. As far as I can tell "r+" is not a valid (read: useful) set of flags for fifo pipes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100452""></a>
  <div class="note">
   <strong class="user">Brad G</strong>
   <a href="#100452" class="date">16-Oct-2010 02:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While adding CFLAGS="-D_FILE_OFFSET_BITS=64" immediately before calling "./configure" on the PHP source will enable support for using fopen() on large files (greater than 2 GB), note that -- if such an installation of PHP is used in conjunction with Apache HTTPD [2.x], Apache will become completely unresponsive even when not serving output from a PHP application.<br />
<br />
In order to gain large file support for non-web applications while maintaining the operability of Apache, consider making two distinct PHP installations:&nbsp; one with the above CFLAGS specified during configuration (for non-web uses), and the other without this flag (for use with Apache).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99176""></a>
  <div class="note">
   <strong class="user">eyrie88 at gmail dot com</strong>
   <a href="#99176" class="date">31-Jul-2010 07:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware that fopen($url) also respects HTTP status headers. If the URL responds with a 1xx, 4xx, or 5xx status code, you will get a "failed to open stream: HTTP request failed!", followed by the HTTP status response. Same goes for file_get_contents($url)...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98128""></a>
  <div class="note">
   <strong class="user">anfragen at tsgames dot de</strong>
   <a href="#98128" class="date">27-May-2010 05:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Since the http-wrapper doesn't support stat() and so you can't use file_exists() for url's, you can simply use a function like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">http_file_exists</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)<br />
{<br />
</span><span class="default">$f</span><span class="keyword">=@</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);<br />
if(</span><span class="default">$f</span><span class="keyword">)<br />
{<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);<br />
return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97663""></a>
  <div class="note">
   <strong class="user">te at sky-networx dot de</strong>
   <a href="#97663" class="date">01-May-2010 11:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is my method for loading the file content.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">public static function </span><span class="default">loadFile</span><span class="keyword">(</span><span class="default">$sFilename</span><span class="keyword">, </span><span class="default">$sCharset </span><span class="keyword">= </span><span class="string">'UTF-8'</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">floatval</span><span class="keyword">(</span><span class="default">phpversion</span><span class="keyword">()) &gt;= </span><span class="default">4.3</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sData </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$sFilename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$sFilename</span><span class="keyword">)) return -</span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rHandle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$sFilename</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$rHandle</span><span class="keyword">) return -</span><span class="default">2</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sData </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$rHandle</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sData </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$rHandle</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$sFilename</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$rHandle</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$sEncoding </span><span class="keyword">= </span><span class="default">mb_detect_encoding</span><span class="keyword">(</span><span class="default">$sData</span><span class="keyword">, </span><span class="string">'auto'</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">) != </span><span class="default">$sCharset</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sData </span><span class="keyword">= </span><span class="default">mb_convert_encoding</span><span class="keyword">(</span><span class="default">$sData</span><span class="keyword">, </span><span class="default">$sCharset</span><span class="keyword">, </span><span class="default">$sEncoding</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$sData</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95777""></a>
  <div class="note">
   <strong class="user">magnetik at magnetik dot org</strong>
   <a href="#95777" class="date">21-Jan-2010 06:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There IS an option to use fopen with a proxy, it's in $context. <br />
No need to recode everything.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95751""></a>
  <div class="note">
   <strong class="user">Pastix</strong>
   <a href="#95751" class="date">20-Jan-2010 03:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If fopen() has been disabled for security reasons, is possible a porting FROM:<br />
<br />
<span class="default">&lt;?php<br />
$f</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">,</span><span class="string">'rb'</span><span class="keyword">);<br />
</span><span class="default">$data</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data</span><span class="keyword">.=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$size</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
TO:<br />
<br />
<span class="default">&lt;?php<br />
$data </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); </span><span class="comment">// (PHP 4 &gt;= 4.3.0, PHP 5)<br />
</span><span class="default">?&gt;<br />
</span><br />
and also a porting FROM:<br />
<br />
<span class="default">&lt;?php<br />
$f </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">,</span><span class="string">'wb'</span><span class="keyword">);<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$content</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">));<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
TO:<br />
<br />
<span class="default">&lt;?php<br />
$f</span><span class="keyword">=</span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$content</span><span class="keyword">); </span><span class="comment">// (PHP 5)<br />
</span><span class="default">?&gt;<br />
</span><br />
For detail read the php manual.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95455""></a>
  <div class="note">
   <strong class="user">rene</strong>
   <a href="#95455" class="date">04-Jan-2010 02:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if fopen() throws a E_WARNING "failed to open stream: HTTP request failed!" at you when opening a valid URL that you know returns data, i advise you to do the following before calling fopen($url,'r'):<br />
<br />
<span class="default">&lt;?php<br />
ini_set </span><span class="keyword">(</span><span class="string">'user_agent'</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">]);<br />
</span><span class="default">?&gt;<br />
</span><br />
or anyways, set that 'user_agent' with ini_set() to something valid.<br />
<br />
thanks, pollita|at|php.net @ <a href="http://bugs.php.net/bug.php?id=22937#c64196 , for the clue to this" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=22937#c64196 , for the clue to this</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94831""></a>
  <div class="note">
   <strong class="user">b dot evieux at gmail dot com</strong>
   <a href="#94831" class="date">27-Nov-2009 03:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello all. I have had trouble getting files through proxy, and the solution posted above only works if the requested file is also hosted on the proxy server (which is quite unlikely). so I've put together the following functions pfopen &amp; preadfile. they quite work like the replaced fopen &amp; readfile, and will resort to them if no proxy is provided :)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">preadfile</span><span class="keyword">(</span><span class="default">$_url</span><span class="keyword">, </span><span class="default">$_proxy_name </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$_proxy_port </span><span class="keyword">= </span><span class="default">4480</span><span class="keyword">){<br />
&nbsp; if(</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$_proxy_name</span><span class="keyword">) || </span><span class="default">LOCAL_TEST</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">readfile</span><span class="keyword">(</span><span class="default">$_url</span><span class="keyword">);<br />
&nbsp; }else{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_fp </span><span class="keyword">= </span><span class="default">pfopen</span><span class="keyword">(</span><span class="default">$_url</span><span class="keyword">, </span><span class="default">$_proxy_name</span><span class="keyword">, </span><span class="default">$_proxy_port</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">)) {</span><span class="default">$proxy_cont </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">);}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">,</span><span class="string">"\r\n\r\n"</span><span class="keyword">)+</span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$proxy_cont</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">count</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
function </span><span class="default">pfopen</span><span class="keyword">(</span><span class="default">$_url</span><span class="keyword">, </span><span class="default">$_proxy_name </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$_proxy_port </span><span class="keyword">= </span><span class="default">4480</span><span class="keyword">) {<br />
&nbsp; if(</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$_proxy_name</span><span class="keyword">) || </span><span class="default">LOCAL_TEST</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$_url</span><span class="keyword">);<br />
&nbsp; }else{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$_proxy_name</span><span class="keyword">, </span><span class="default">$_proxy_port</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$proxy_fp</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$host</span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$_url</span><span class="keyword">, </span><span class="default">7</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$bucket</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$request </span><span class="keyword">= </span><span class="string">"GET </span><span class="default">$_url</span><span class="string"> HTTP/1.0\r\nHost:</span><span class="default">$host</span><span class="string">\r\n\r\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">, </span><span class="default">$request</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$proxy_fp</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94643""></a>
  <div class="note">
   <strong class="user">jbud at jbud dot co dot cc</strong>
   <a href="#94643" class="date">16-Nov-2009 07:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a function for reading or writing to a text file...<br />
The function has three modes, READ, WRITE, and READ/WRITE... READ, returns the text of a file, or returns FALSE if the file isn't found. WRITE creates or overrides a file with the text from the $input string, WRITE returns TRUE or FALSE depending on success or failure. READ/WRITE reads a text file, then writes the string from $input to the end of the file, like WRITE, it returns TRUE or FALSE depending on success or failure.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">openFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$mode </span><span class="keyword">== </span><span class="string">"READ"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$output</span><span class="keyword">; </span><span class="comment">// output file text<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">; </span><span class="comment">// failed.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$mode </span><span class="keyword">== </span><span class="string">"WRITE"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">; </span><span class="comment">// failed.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">; </span><span class="comment">//success.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$mode </span><span class="keyword">== </span><span class="string">"READ/WRITE"</span><span class="keyword">) {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) &amp;&amp; isset(</span><span class="default">$input</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file </span><span class="string">"r+"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$read </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">$read</span><span class="keyword">.</span><span class="default">$input</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">; </span><span class="comment">// failed.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">; </span><span class="comment">// success.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">; </span><span class="comment">// failed.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">; </span><span class="comment">// failed.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">); <br />
}<br />
</span><span class="default">?&gt;<br />
</span>EXAMPLE CALLS:<br />
&lt;php<br />
openFile2("files/text.txt", "WRITE", "Hello World!");<br />
echo openFile2("files/text.txt", "READ"); // OUTPUT &gt; Hello World!<br />
openFile2("files/text.txt", "READ/WRITE", "!!");<br />
echo openFile2("files/text.txt", "READ"); // OUTPUT &gt; Hello World!!!<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94505""></a>
  <div class="note">
   <strong class="user">maxime dot marais at gmail dot com</strong>
   <a href="#94505" class="date">09-Nov-2009 07:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Take great care if you project to use both ftp and<br />
compression wrapper within fopened stream to remotely<br />
write a compressed file built on the fly.<br />
<br />
This code :<br />
<br />
<span class="default">&lt;?php<br />
$resFile </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'compress.bzip2://./test.rnd.bz2'</span><span class="keyword">, </span><span class="string">'wb'</span><span class="keyword">);<br />
for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">1000000 </span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
{<br />
&nbsp;</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$resFile</span><span class="keyword">, </span><span class="default">chr</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">)));<br />
}<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$resFile</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
will produce a well formed bz2 compressed random content file.<br />
<br />
<span class="default">&lt;?php<br />
$resFile </span><span class="keyword">=<br />
</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'compress.bzip2://<a href="ftp://ftp.example.com/test.rnd.bz2" rel="nofollow" target="_blank">ftp://ftp.example.com/test.rnd.bz2</a>'</span><span class="keyword">,<br />
</span><span class="string">'wb'</span><span class="keyword">);<br />
for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">1000000 </span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
{<br />
&nbsp;</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$resFile</span><span class="keyword">, </span><span class="default">chr</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">)));<br />
}<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$resFile</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
will produce a corrupted bz2 compressed random content<br />
file. The file is not really corrupted, it is incomplete. The<br />
tail of the file is not written to the stream, the file is<br />
truncated at the end of complete compressed data block.<br />
<br />
Adding fflush($resFile); before closing the file does not fix<br />
this issue.<br />
<br />
This problem can be reproduced with PHP 5.2.6 (bundled<br />
with Debian 2.6.26-13lenny2) and may be related to<br />
<a href="http://bugs.php.net/bug.php?id=42117." rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=42117.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93272""></a>
  <div class="note">
   <strong class="user">Mikhail Nemtsev</strong>
   <a href="#93272" class="date">31-Aug-2009 04:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As someone has mentioned already, using fopen() in r+ mode overwrites the beginning of the file with new data. So, if you want to append new data to the beginning of the file, do so as follows:<br />
<span class="default">&lt;?php<br />
$filename </span><span class="keyword">= </span><span class="string">"myfile.txt"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//first, obtain the data initially present in the text file<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ini_handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ini_contents </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$ini_handle</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$ini_handle</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//done obtaining initially present data<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; //write new data to the file, along with the old data<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"w+"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$writestring </span><span class="keyword">= </span><span class="string">"text to write to file\n" </span><span class="keyword">. </span><span class="default">$ini_contents</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$writestring</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Cannot write to text file. &lt;br /&gt;"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91363""></a>
  <div class="note">
   <strong class="user">gmdebby at gmail dot com</strong>
   <a href="#91363" class="date">08-Jun-2009 06:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was wondering why was added the "x" mode, it works only if the file do not exists, will create it and open it in read only, it's useless !!<br />
But I found something I could do with that.<br />
<br />
Here is a little mk_file function.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mk_file</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="string">"x"</span><span class="keyword">)); </span><span class="comment">//create the file and close it<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else return </span><span class="default">false</span><span class="keyword">; </span><span class="comment">//file already exists<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
You can improve it, add chmod support etc...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84028""></a>
  <div class="note">
   <strong class="user">php at delhelsa dot com</strong>
   <a href="#84028" class="date">24-Jun-2008 12:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With php 5.2.5 on Apache 2.2.4, accessing files on an ftp server with fopen() or readfile() requires an extra forwardslash if an absolute path is needed.<br />
<br />
i.e., if a file called bullbes.txt is stored under /var/school/ on ftp server example.com and you're trying to access it with user blossom and password buttercup, the url would be:<br />
<br />
<a href="ftp://blossom:buttercup@example.com//var/school/bubbles.txt" rel="nofollow" target="_blank">ftp://blossom:buttercup@example.com//var/school/bubbles.txt</a><br />
<br />
Note the two forwardslashes. It looks like the second one is needed so the server won't interpret the path as relative to blossom's home on townsville.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83138""></a>
  <div class="note">
   <strong class="user">erk_3 at hotmail dot com</strong>
   <a href="#83138" class="date">12-May-2008 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting permission denied trying to write/read to a network resource, you have to change the system account that the apache service is runnning on. <br />
However if you are on a domain, you will need to use the user name as:<br />
user@domain.com<br />
<br />
If you user the format: domain\username&nbsp; the service will successfully start, but you will still receive errors trying to access the network resource.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82805""></a>
  <div class="note">
   <strong class="user">webmaster at myeshop dot fr</strong>
   <a href="#82805" class="date">26-Apr-2008 07:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also a small function useful for backup for example. It's a mixed between the fopen() and the mkdir() functions.<br />
<br />
This function opens a file but also make the path recursively where the file is contained. This is helpful for ending to finish with "No such file or directory in" errors<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">fopen_recursive</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$chmod</span><span class="keyword">=</span><span class="default">0755</span><span class="keyword">){<br />
&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'`^(.+)/([a-zA-Z0-9]+\.[a-z]+)$`i'</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$directory </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
<br />
&nbsp; if (!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">, </span><span class="default">$chmod</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp;return </span><span class="default">fopen </span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81325""></a>
  <div class="note">
   <strong class="user">jphansen at uga dot edu</strong>
   <a href="#81325" class="date">22-Feb-2008 07:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you open a file with r+ and execute an fwrite(), writing less to the file than what it originally was, it will result in the difference being padded with the end of the file from the previous end of the file. Example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Open file for read and string modification<br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="string">"/test"</span><span class="keyword">;<br />
</span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'r+'</span><span class="keyword">);<br />
</span><span class="default">$contents </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />
</span><span class="default">$new_contents </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"hello world"</span><span class="keyword">, </span><span class="string">"hello"</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Open file to write<br />
</span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'r+'</span><span class="keyword">);<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">$new_contents</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
If the end of the file was "abcdefghij", you will notice that the difference in "hello world" and "hello", 6 characters, will be appended to the file, resulting in the new ending: "efghij". To obviate this, fopen() with +w instead, which truncates the file to zero length.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80978""></a>
  <div class="note">
   <strong class="user">sean downey</strong>
   <a href="#80978" class="date">09-Feb-2008 12:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
when using ssl / https on windows i would get the error:<br />
"Warning: fopen(https://example.com): failed to open stream: Invalid argument in someSpecialFile.php on line 4344534"<br />
<br />
This was because I did not have the extension "php_openssl.dll" enabled.<br />
<br />
So if you have the same problem, goto your php.ini file and enable it :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78370""></a>
  <div class="note">
   <strong class="user">info at NOSPAMPLEASE dot c-eagle dot com</strong>
   <a href="#78370" class="date">08-Oct-2007 06:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If there is a file thatå«s excessively being rewritten by many different users, youå«ll note that two almost-simultaneously accesses on that file could interfere with each other. For example if thereå«s a chat history containing only the last 25 chat lines. Now adding a line also means deleting the very first one. So while that whole writing is happening, another user might also add a line, reading the file, which, at this point, is incomplete, because itå«s just being rewritten. The second user would then rewrite an incomplete file and add its line to it, meaning: you just got yourself some data loss!<br />
<br />
If flock() was working at all, that might be the key to not let those interferences happen - but flock() mostly wonå«t work as expected (at least thatå«s my experience on any linux webserver Iå«ve tried), and writing own file-locking-functions comes with a lot of possible issues that would finally result in corrupted files. Even though itå«s very unlikely, itå«s not impossible and has happened to me already.<br />
<br />
So I came up with another solution for the file-interference-problem:<br />
<br />
1. A file thatå«s to be accessed will first be copied to a temp-file directory and its last filemtime() is being stored in a PHP-variable. The temp-file gets a random filename, ensuring no other process is able to interfere with this particular temp-file.<br />
2. When the temp-file has been changed/rewritten/whatever, thereå«ll be a check whether the filemtime() of the original file has been changed since we copied it into our temp-directory.<br />
2.1. If filemtime() is still the same, the temp-file will just be renamed/moved to the original filename, ensuring the original file is never in a temporary state - only the complete previous state or the complete new state.<br />
2.2. But if filemtime() has been changed while our PHP-process wanted to change its file, the temp-file will just be deleted and our new PHP-fileclose-function will return a FALSE, enabling whatever called that function to do it again (ie. upto 5 times, until it returns TRUE).<br />
<br />
These are the functions Iå«ve written for that purpose:<br />
<br />
<span class="default">&lt;?php<br />
$dir_fileopen </span><span class="keyword">= </span><span class="string">"../AN/INTERNAL/DIRECTORY/fileopen"</span><span class="keyword">;<br />
<br />
function </span><span class="default">randomid</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">time</span><span class="keyword">().</span><span class="default">substr</span><span class="keyword">(</span><span class="default">md5</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">()), </span><span class="default">0</span><span class="keyword">, </span><span class="default">rand</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">, </span><span class="default">12</span><span class="keyword">));<br />
}<br />
<br />
function </span><span class="default">cfopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$overwriteanyway </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$dir_fileopen</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">clearstatcache</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; do {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">randomid</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(), </span><span class="default">TRUE</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tempfilename </span><span class="keyword">= </span><span class="default">$dir_fileopen</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } while(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$tempfilename</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newfile </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$tempfilename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newfile </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$tempfilename</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$fp </span><span class="keyword">? array(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$id</span><span class="keyword">, @</span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">), </span><span class="default">$newfile</span><span class="keyword">, </span><span class="default">$overwriteanyway</span><span class="keyword">) : </span><span class="default">false</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">cfwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">) { return </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$string</span><span class="keyword">); }<br />
<br />
function </span><span class="default">cfclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$debug </span><span class="keyword">= </span><span class="string">"off"</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$dir_fileopen</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$success </span><span class="keyword">= </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">clearstatcache</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tempfilename </span><span class="keyword">= </span><span class="default">$dir_fileopen</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">].</span><span class="default">md5</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; if ((@</span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) == </span><span class="default">$fp</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]) or (</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]==</span><span class="default">true </span><span class="keyword">and !</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) or </span><span class="default">$fp</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]==</span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rename</span><span class="keyword">(</span><span class="default">$tempfilename</span><span class="keyword">, </span><span class="default">$fp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$tempfilename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$debug </span><span class="keyword">!= </span><span class="string">"off"</span><span class="keyword">) echo </span><span class="string">"While writing, another process accessed </span><span class="default">$fp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]</span><span class="string">. To ensure file-integrity, your changes were rejected."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$success </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$success</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
$overwriteanyway, one of the parameters for cfopen(), means: If cfclose() is used and the original file has changed, this script wonå«t care and still overwrite the original file with the new temp file. Anyway there wonå«t be any writing-interference between two PHP processes, assuming there can be no absolute simultaneousness between two (or more) processes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78308""></a>
  <div class="note">
   <strong class="user">misc at n4te dot com</strong>
   <a href="#78308" class="date">05-Oct-2007 06:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The UTF-8 BOM is optional. PHP does not ignore it if it is present when reading UTF-8 encoded data. Here is a function that skips the BOM, if it exists.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Reads past the UTF-8 bom if it is there.<br />
</span><span class="keyword">function </span><span class="default">fopen_utf8 </span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bom </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$bom </span><span class="keyword">!= </span><span class="string">b"\xEF\xBB\xBF"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rewind</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"bom found!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$file</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74398""></a>
  <div class="note">
   <strong class="user">simon dot allen at swerve dot co dot nz</strong>
   <a href="#74398" class="date">09-Apr-2007 07:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
using fopen to upload a file through ftp cannot overwrite that file - use curl instead</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74182""></a>
  <div class="note">
   <strong class="user">naidim at gmail dot com</strong>
   <a href="#74182" class="date">28-Mar-2007 02:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While PHP does not have a function to insert text into the middle of a file, it is not that complicated to do.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">addRSSItem</span><span class="keyword">(</span><span class="default">$rssFile</span><span class="keyword">, </span><span class="default">$firstItem</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Backup file<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(!</span><span class="default">copy</span><span class="keyword">(</span><span class="default">$rssFile</span><span class="keyword">, </span><span class="string">'backup.rss'</span><span class="keyword">)) die(</span><span class="string">'Backup failed!'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Store file contents in array<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arrFile </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$rssFile</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Open file for output<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if((</span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$rssFile</span><span class="keyword">,</span><span class="string">'w'</span><span class="keyword">)) === </span><span class="default">FALSE</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">'Failed to open file for writing!'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Set counters<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$currentLine </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cntFile </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$arrFile</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Write contents, inserting $item as first item<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while( </span><span class="default">$currentLine </span><span class="keyword">&lt;= </span><span class="default">$cntFile </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$currentLine </span><span class="keyword">== </span><span class="default">$firstItem</span><span class="keyword">) </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">$arrFile</span><span class="keyword">[</span><span class="default">$currentLine</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$currentLine</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Delete backup<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="string">'backup.rss'</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="string">"&nbsp; &nbsp; &lt;item&gt;\n&lt;title&gt;</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'title]&lt;/title&gt;\n"</span><span class="keyword">.<br />
&nbsp; </span><span class="string">"&nbsp; &nbsp; &nbsp; &nbsp; &lt;description&gt;</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'description']&lt;/description&gt;\n"</span><span class="keyword">.<br />
&nbsp; </span><span class="string">"&nbsp; &nbsp; &nbsp; &nbsp; &lt;pubDate&gt;</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'date']&lt;/pubDate&gt;\n"</span><span class="keyword">.<br />
&nbsp; </span><span class="string">"&nbsp; &nbsp; &nbsp; &nbsp; &lt;link&gt;<a href="http://www.site.com/mp3s/" rel="nofollow" target="_blank">http://www.site.com/mp3s/</a>"</span><span class="keyword">.<br />
&nbsp; </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'fullPath'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]).</span><span class="string">"&lt;/link&gt;"</span><span class="keyword">.<br />
&nbsp; </span><span class="string">"&nbsp; &nbsp; &nbsp; &nbsp; &lt;enclosure url=\"<a href="http://www.site.com/mp3s/" rel="nofollow" target="_blank">http://www.site.com/mp3s/</a>"</span><span class="keyword">.<br />
&nbsp; </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'fullPath'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]).<br />
&nbsp; </span><span class="string">"\" length=\"</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">fullPath</span><span class="keyword">]</span><span class="string">[size]\" type=\"audio/mpeg\" /&gt;"</span><span class="keyword">.<br />
&nbsp; </span><span class="string">"&nbsp; &nbsp; &lt;/item&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">addRSSItem</span><span class="keyword">(</span><span class="string">'/var/www/html/rss/podcast.rss'</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73132""></a>
  <div class="note">
   <strong class="user">andrew at NOSPAM dot neonsurge dot com</strong>
   <a href="#73132" class="date">09-Feb-2007 06:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My recent findings on high-performance fopen/fsockopen usage.<br />
<br />
Note #1: The performance comparison below regarding curl is obsolete when utilizing certain things in this comment.&nbsp; My performance tests download and upload about 97% as fast as curl with a custom non-socket blocking HTTP Transport class written for a high performance system in PHP5.<br />
<br />
Note #2: fopen and fsockopen have a "feature' that always forces DNS resolution.&nbsp; Check this code...<br />
<br />
<span class="default">&lt;?php </span><span class="keyword">for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">50</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errno </span><span class="keyword">= </span><span class="default">$errstr </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//$ip = gethostbyname("php.net");&nbsp; $a = fsockopen($ip,22,$errno,$errstr,10);&nbsp; //FAST way<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"php.net"</span><span class="keyword">,</span><span class="default">22</span><span class="keyword">,</span><span class="default">$errno</span><span class="keyword">,</span><span class="default">$errstr</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">); </span><span class="comment">//SLOW way<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ab </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">); unset(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$ab</span><span class="keyword">);<br />
} </span><span class="default">?&gt;<br />
</span><br />
fsockopen() and fopen() always force php.net to be resolved every time and in this example above it resolves the name 50 seperate times and does not use the local cache.&nbsp; To get around this, gethostbyname() does use your local DNS cache properly, it will not try to get the IP from your DNS server 50 times.&nbsp; The above code for me to a personal server took 87 seconds the fast way, and 5.74 seconds the slow way, a 650% increase.&nbsp; And this is single-threaded!&nbsp; ;)<br />
<br />
Note #3: I see a lot of notes and people mentioning non-blocking sockets, especially for HTTP transport.&nbsp; I thought I would share a little from my experience.&nbsp; First, the above command fsockopen() allows you to specify a timeout, after you check if it's&nbsp; opened properly (as you should _always_) you just need to...<br />
<br />
<span class="default">&lt;?php stream_set_blocking</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);</span><span class="default">?&gt;<br />
</span><br />
From this point on certain considerations must be taken.&nbsp; Remember you are not blocking anymore, so when you want to write or read a lot of data it will always return to you instantly.&nbsp; Which is important since you need to check the return value of your writes and reads against how much you expect to read/write.&nbsp; For reading if you do not know how long it is, checking for EOF works also.<br />
<br />
This is in fact a neat feature and state, since you can now make a read/write loop to send/receive a lot of data and check the time/timeout value(s) constantly.&nbsp; If that timeout is hit you can throw back errors properly to whatever function/method/code called your transport function/class.&nbsp; The graceful failure with custom shorter failure times allows your application to continue, especially web-based applications where fopen alone and even curl under certain circumstances does not follow your requested timeouts, it will wait a full 60-90 seconds, depending on your OS.<br />
<br />
Good ways to test a custom non-blocking timeout supported transport method described above is to make one first, and then transfer a large file with it, and halfway through unplug your network cable.&nbsp; Curl or fopen/fread/fwrite alone will croak and make your applications wait a full 60-90 seconds, whereas a nice custom class will check if no data has been transferred for 15 seconds (or less!) and will fail gracefully with a error.<br />
<br />
If anyone is interested in chatting about this feel free to contact me or add to this comment.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72497""></a>
  <div class="note">
   <strong class="user">perrog at gmail dot com</strong>
   <a href="#72497" class="date">21-Jan-2007 04:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note: If you have opened the file in append mode ("a" or "a+"), any data you write to the file will always be appended, regardless of the file position. But PHP distinguish between read and write position, and you may freely read at any position, but when you write it will always append at the end.<br />
<br />
If you don't want that write restriction, open the file in read-write mode ("r+") and then start by moving the file pointer to the end.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if ((</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"r+"</span><span class="keyword">) === </span><span class="default">FALSE</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// handle error<br />
&nbsp; </span><span class="keyword">exit;<br />
}<br />
<br />
if (</span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">) === -</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// handle error<br />
&nbsp; </span><span class="keyword">exit;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69776""></a>
  <div class="note">
   <strong class="user">patryk dot szczyglowski at gmail dot com</strong>
   <a href="#69776" class="date">20-Sep-2006 07:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Watch out not to specify empty string as filename. It seems PHP is trying to get data from stdin which may end up in script timeout. It may not be trivial to find.<br />
<br />
<span class="default">&lt;?php<br />
$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">); </span><span class="comment">// wrong<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64262""></a>
  <div class="note">
   <strong class="user">ceo at l-i-e dot com</strong>
   <a href="#64262" class="date">10-Apr-2006 08:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need fopen() on a URL to timeout, you can do like:<br />
<span class="default">&lt;?php<br />
&nbsp; $timeout </span><span class="keyword">= </span><span class="default">3</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$old </span><span class="keyword">= </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'default_socket_timeout'</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'<a href="http://example.com" rel="nofollow" target="_blank">http://example.com</a>'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'default_socket_timeout'</span><span class="keyword">, </span><span class="default">$old</span><span class="keyword">);<br />
&nbsp; </span><span class="default">stream_set_timeout</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);<br />
&nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp; </span><span class="comment">//the rest is standard<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60718""></a>
  <div class="note">
   <strong class="user">flobee</strong>
   <a href="#60718" class="date">14-Jan-2006 07:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
download: i need a function to simulate a "wget url" and do not buffer the data in the memory to avoid thouse problems on large files:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">download</span><span class="keyword">(</span><span class="default">$file_source</span><span class="keyword">, </span><span class="default">$file_target</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file_source</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$wh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file_target</span><span class="keyword">, </span><span class="string">'wb'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$rh</span><span class="keyword">===</span><span class="default">false </span><span class="keyword">|| </span><span class="default">$wh</span><span class="keyword">===</span><span class="default">false</span><span class="keyword">) {<br />
</span><span class="comment">// error reading or opening file<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$rh</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$wh</span><span class="keyword">, </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$rh</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">)) === </span><span class="default">FALSE</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// 'Download error: Cannot write to file ('.$file_target.')';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$rh</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$wh</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// No error<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58099""></a>
  <div class="note">
   <strong class="user">info at b1g dot de</strong>
   <a href="#58099" class="date">24-Oct-2005 04:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Simple class to fetch a HTTP URL. Supports "Location:"-redirections. Useful for servers with allow_url_fopen=false. Works with SSL-secured hosts.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">#usage:<br />
</span><span class="default">$r </span><span class="keyword">= new </span><span class="default">HTTPRequest</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>'</span><span class="keyword">);<br />
echo </span><span class="default">$r</span><span class="keyword">-&gt;</span><span class="default">DownloadToString</span><span class="keyword">();<br />
<br />
class </span><span class="default">HTTPRequest<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$_fp</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// HTTP socket<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$_url</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// full URL<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$_host</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// HTTP host<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$_protocol</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// protocol (HTTP/HTTPS)<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$_uri</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// request URI<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$_port</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// port<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // scan url<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">_scan_url</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_url</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">, </span><span class="string">'://'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_protocol </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">+</span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$pos </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="string">':'</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_host</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_port</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_host </span><span class="keyword">= </span><span class="default">$host</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_port </span><span class="keyword">= (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_protocol </span><span class="keyword">== </span><span class="string">'https'</span><span class="keyword">) ? </span><span class="default">443 </span><span class="keyword">: </span><span class="default">80</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_uri </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_uri </span><span class="keyword">== </span><span class="string">''</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_uri </span><span class="keyword">= </span><span class="string">'/'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// constructor<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">HTTPRequest</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_scan_url</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// download URL to string<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">DownloadToString</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$crlf </span><span class="keyword">= </span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// generate request<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">= </span><span class="string">'GET ' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_uri </span><span class="keyword">. </span><span class="string">' HTTP/1.0' </span><span class="keyword">. </span><span class="default">$crlf<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">.&nbsp; &nbsp; </span><span class="string">'Host: ' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_host </span><span class="keyword">. </span><span class="default">$crlf<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">.&nbsp; &nbsp; </span><span class="default">$crlf</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// fetch<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">((</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_protocol </span><span class="keyword">== </span><span class="string">'https' </span><span class="keyword">? </span><span class="string">'ssl://' </span><span class="keyword">: </span><span class="string">''</span><span class="keyword">) . </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_host</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_port</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp</span><span class="keyword">, </span><span class="default">$req</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp</span><span class="keyword">) &amp;&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp </span><span class="keyword">&amp;&amp; !</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$response </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// split header and body<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="default">$crlf </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$pos </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">$response</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">2 </span><span class="keyword">* </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$crlf</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// parse headers<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$crlf</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$lines </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="string">':'</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers</span><span class="keyword">[</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">)))] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// redirection?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(isset(</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'location'</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$http </span><span class="keyword">= new </span><span class="default">HTTPRequest</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'location'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">$http</span><span class="keyword">-&gt;</span><span class="default">DownloadToString</span><span class="keyword">(</span><span class="default">$http</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">$body</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57871""></a>
  <div class="note">
   <strong class="user">admin at sellchain dot com</strong>
   <a href="#57871" class="date">17-Oct-2005 07:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
TIP: If you are using fopen and fread to read HTTP or FTP or Remote Files, and experiencing some performance issues such as stalling, slowing down and otherwise, then it's time you learned a thing called cURL.<br />
<br />
Performance Comparison:<br />
<br />
10 per minute for fopen/fread for 100 HTTP files<br />
2000 per minute for cURL for 2000 HTTP files<br />
<br />
cURL should be used for opening HTTP and FTP files, it is EXTREMELY reliable, even when it comes to performance.<br />
<br />
I noticed when using too many scripts at the same time to download the data from the site I was harvesting from, fopen and fread would go into deadlock. When using cURL i can open 50 windows, running 10 URL's from each window, and getting the best performance possible. <br />
<br />
Just a Tip :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56963""></a>
  <div class="note">
   <strong class="user">nefertari at nefertari dot be</strong>
   <a href="#56963" class="date">20-Sep-2005 05:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Important note:<br />
<br />
You have always to use the real path name for a file with the command fopen [for example: fopen($filename, 'w')], never use a symbolic link, it will not work (unable to open $filename).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56551""></a>
  <div class="note">
   <strong class="user">durwood at speakeasy dot NOSPAM dot net</strong>
   <a href="#56551" class="date">06-Sep-2005 11:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I couldn't for the life of me get a certain php script working when i moved my server to a new Fedora 4 installation. The problem was that fopen() was failing when trying to access a file as a URL through apache -- even though it worked fine when run from the shell and even though the file was readily readable from any browser.&nbsp; After trying to place blame on Apache, RedHat, and even my cat and dog, I finally ran across this bug report on Redhat's website:<br />
<br />
https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=164700<br />
<br />
Basically the problem was SELinux (which I knew nothing about) -- you have to run the following command in order for SELinux to allow php to open a web file:<br />
<br />
/usr/sbin/setsebool httpd_can_network_connect=1<br />
<br />
To make the change permanent, run it with the -P option:<br />
<br />
/usr/sbin/setsebool -P httpd_can_network_connect=1<br />
<br />
Hope this helps others out -- it sure took me a long time to track down the problem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55922""></a>
  <div class="note">
   <strong class="user">Luiz Miguel Axcar (lmaxcar at yahoo dot com dot br)</strong>
   <a href="#55922" class="date">17-Aug-2005 01:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting message "Warning: fopen(): URL file-access is disabled in the server configuration", you can use function below to get the content from a local or remote file.<br />
<br />
Function uses CURL lib, follow the link to get help: <a href="http://www.php.net/curl" rel="nofollow" target="_blank">http://www.php.net/curl</a><br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
&nbsp;&nbsp; * @return string<br />
&nbsp;&nbsp; * @param string $url<br />
&nbsp;&nbsp; * @desc Return string content from a remote file<br />
&nbsp;&nbsp; * @author Luiz Miguel Axcar (lmaxcar@yahoo.com.br)<br />
*/<br />
<br />
</span><span class="keyword">function </span><span class="default">get_content</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;&nbsp; &nbsp;&nbsp; <br />
}<br />
<br />
</span><span class="comment">#usage:<br />
</span><span class="default">$content </span><span class="keyword">= </span><span class="default">get_content </span><span class="keyword">(</span><span class="string">"<a href="http://www.php.net" rel="nofollow" target="_blank">http://www.php.net</a>"</span><span class="keyword">);<br />
</span><span class="default">var_dump </span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55434""></a>
  <div class="note">
   <strong class="user">ideacode</strong>
   <a href="#55434" class="date">03-Aug-2005 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that whether you may open directories is operating system dependent. The following lines:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Windows ($fh === false)<br />
</span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'c:\\Temp'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// UNIX (is_resource($fh) === true)<br />
</span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'/tmp'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
demonstrate that on Windows (2000, probably XP) you may not open a directory (the error is "Permission Denied"), regardless of the security permissions on that directory.<br />
<br />
On UNIX, you may happily read the directory format for the native filesystem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51592""></a>
  <div class="note">
   <strong class="user">abesharp at yahoo dot co dot uk</strong>
   <a href="#51592" class="date">05-Apr-2005 04:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function has a basic implementation of HTTP Digest Authentication (as per RFC 2617) to get a file from a web server which requires digest authentication (as opposed to basic authentication - the difference being that, with basic, your password is sent to the server as plain text, whereas with digest, it is hashed with a server-supplied nonce to protect against sniffing and replay attacks). <br />
<br />
You just supply the host (e.g www.example.com), the name of the file you want (e.g protected_page.html), and the necessary username and password, and the function returns the contents of the protected file (or the error message that the server sends, if you supplied the wrong credentials).<br />
<br />
If the server only supports a QOP of auth-int (rather then auth) this function won't work, but can be easily modified with reference to the RFC at <a href="http://www.ietf.org/rfc/rfc2617.txt" rel="nofollow" target="_blank">http://www.ietf.org/rfc/rfc2617.txt</a><br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">readHTTPDigestAuthenticatedFile</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">,</span><span class="default">$username</span><span class="keyword">,</span><span class="default">$password</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">15</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//first do the non-authenticated header so that the server<br />
&nbsp;&nbsp;&nbsp; //sends back a 401 error containing its nonce and opaque<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">"GET /</span><span class="default">$file</span><span class="string"> HTTP/1.1\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Host: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//read the reply and look for the WWW-Authenticate element<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">512</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="string">"WWW-Authenticate:"</span><span class="keyword">)!==</span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$authline</span><span class="keyword">=</span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="default">18</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//split up the WWW-Authenticate string to find digest-realm,nonce and opaque values<br />
&nbsp;&nbsp;&nbsp; //if qop value is presented as a comma-seperated list (e.g auth,auth-int) then it won't be retrieved correctly<br />
&nbsp;&nbsp;&nbsp; //but that doesn't matter because going to use 'auth' anyway<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$authlinearr</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">,</span><span class="default">$authline</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$autharr</span><span class="keyword">=array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$authlinearr </span><span class="keyword">as </span><span class="default">$el</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elarr</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"="</span><span class="keyword">,</span><span class="default">$el</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//the substr here is used to remove the double quotes from the values<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$autharr</span><span class="keyword">[</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$elarr</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])]=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$elarr</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">1</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$elarr</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])-</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$autharr </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo(</span><span class="string">"</span><span class="default">$k</span><span class="string"> ==&gt; </span><span class="default">$v</span><span class="string">\r\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//these are all the vals required from the server<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nonce</span><span class="keyword">=</span><span class="default">$autharr</span><span class="keyword">[</span><span class="string">'nonce'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$opaque</span><span class="keyword">=</span><span class="default">$autharr</span><span class="keyword">[</span><span class="string">'opaque'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$drealm</span><span class="keyword">=</span><span class="default">$autharr</span><span class="keyword">[</span><span class="string">'Digest realm'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//client nonce can be anything since this authentication session is not going to be persistent<br />
&nbsp;&nbsp;&nbsp; //likewise for the cookie - just call it MyCookie<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cnonce</span><span class="keyword">=</span><span class="string">"sausages"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//calculate the hashes of A1 and A2 as described in RFC 2617<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a1</span><span class="keyword">=</span><span class="string">"</span><span class="default">$username</span><span class="string">:</span><span class="default">$drealm</span><span class="string">:</span><span class="default">$password</span><span class="string">"</span><span class="keyword">;</span><span class="default">$a2</span><span class="keyword">=</span><span class="string">"GET:/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ha1</span><span class="keyword">=</span><span class="default">md5</span><span class="keyword">(</span><span class="default">$a1</span><span class="keyword">);</span><span class="default">$ha2</span><span class="keyword">=</span><span class="default">md5</span><span class="keyword">(</span><span class="default">$a2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//calculate the response hash as described in RFC 2617<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$concat </span><span class="keyword">= </span><span class="default">$ha1</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$nonce</span><span class="keyword">.</span><span class="string">':00000001:'</span><span class="keyword">.</span><span class="default">$cnonce</span><span class="keyword">.</span><span class="string">':auth:'</span><span class="keyword">.</span><span class="default">$ha2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$response</span><span class="keyword">=</span><span class="default">md5</span><span class="keyword">(</span><span class="default">$concat</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//put together the Authorization Request Header<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">"GET /</span><span class="default">$file</span><span class="string"> HTTP/1.1\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Host: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Cookie: cookie=MyCookie\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Authorization: Digest username=\"</span><span class="default">$username</span><span class="string">\", realm=\"</span><span class="default">$drealm</span><span class="string">\", qop=\"auth\", algorithm=\"MD5\", uri=\"/</span><span class="default">$file</span><span class="string">\", nonce=\"</span><span class="default">$nonce</span><span class="string">\", nc=00000001, cnonce=\"</span><span class="default">$cnonce</span><span class="string">\", opaque=\"</span><span class="default">$opaque</span><span class="string">\", response=\"</span><span class="default">$response</span><span class="string">\"\r\n\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">15</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//read in a string which is the contents of the required file<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str</span><span class="keyword">.=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">512</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50601""></a>
  <div class="note">
   <strong class="user">nuno at ideianet dot pt</strong>
   <a href="#50601" class="date">04-Mar-2005 05:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In IIS you must add the group Authenticated Users with write and modify permissions in the file where you want to write if you are in a Protected directory (Basic or Digest authentication) and want to write to a file in a Unprotected directory (Anonymous Access) in order to get permission to do that. Otherwise you will get the message: PHP Warning: fopen(x.txt): failed to open stream: Permission denied in c:\web\x\x.php on line 3 PHP Warning: fwrite(): supplied argument is not a valid stream resource in c:\web\x\x.php on line 10</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47344""></a>
  <div class="note">
   <strong class="user">Thomas Candrian tc_ at gmx dot ch</strong>
   <a href="#47344" class="date">11-Nov-2004 07:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With this it isn't possible to get data from another port than 80 (and 443) - at least for me. Because of that I've made this function who gets data from every port you want using HTTP:<br />
<br />
&lt;?php;<br />
function getcontent($server, $port, $file)<br />
{<br />
&nbsp;&nbsp;&nbsp; $cont = "";<br />
&nbsp;&nbsp;&nbsp; $ip = gethostbyname($server);<br />
&nbsp;&nbsp;&nbsp; $fp = fsockopen($ip, $port);<br />
&nbsp;&nbsp;&nbsp; if (!$fp)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return "Unknown";<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $com = "GET $file HTTP/1.1\r\nAccept: */*\r\nAccept-Language: de-ch\r\nAccept-Encoding: gzip, deflate\r\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)\r\nHost: $server:$port\r\nConnection: Keep-Alive\r\n\r\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fputs($fp, $com);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!feof($fp))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $cont .= fread($fp, 500);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fclose($fp);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $cont = substr($cont, strpos($cont, "\r\n\r\n") + 4);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $cont;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
echo getcontent("www.myhost.com", "81", "/"));<br />
?&gt;<br />
<br />
Works fine for me. Had to do this especially for a shoutcast server, which only delivered the HTML-file if the user-agent was given.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47224""></a>
  <div class="note">
   <strong class="user">pflaume dot NOSPAM at NOSPAM dot gmx dot de</strong>
   <a href="#47224" class="date">07-Nov-2004 02:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
fopen() and PROXY<br />
<br />
I wondered why there is no possibility to use fopen() through a proxy in php. The solution posted above did not work for me.<br />
<br />
This little function gets http through a given proxy:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">proxy_url</span><span class="keyword">(</span><span class="default">$proxy_url</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_name </span><span class="keyword">= </span><span class="string">'127.0.0.1'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_port </span><span class="keyword">= </span><span class="default">4001</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$proxy_name</span><span class="keyword">, </span><span class="default">$proxy_port</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$proxy_fp</span><span class="keyword">)&nbsp; &nbsp; {return </span><span class="default">false</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">, </span><span class="string">"GET </span><span class="default">$proxy_url</span><span class="string"> HTTP/1.0\r\nHost: </span><span class="default">$proxy_name</span><span class="string">\r\n\r\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">)) {</span><span class="default">$proxy_cont </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">);}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">,</span><span class="string">"\r\n\r\n"</span><span class="keyword">)+</span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$proxy_cont</span><span class="keyword">;<br />
} <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44076""></a>
  <div class="note">
   <strong class="user">justin at redwiredesign dot com</strong>
   <a href="#44076" class="date">14-Jul-2004 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One thing worth noting is that if you use the fopen command to open an HTTP stream, and the URL you're trying to access is invalid or generates an error response, (i.e. 404 Not found), the fopen call will return false.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41532""></a>
  <div class="note">
   <strong class="user">Jem Tallon</strong>
   <a href="#41532" class="date">13-Apr-2004 03:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're using fopen to open a URL that requires authorization, you might need to force a HTTP/1.0 request for it since fopen won't support HTTP/1.1 requests. You can do that by setting your user_agent to one that is known only to support HTTP/1.0 (most webservers will be configured to force HTTP/1.0 for some browsers). Here's what worked for me:<br />
<br />
<span class="default">&lt;?php<br />
$returned</span><span class="keyword">=</span><span class="default">URLopen</span><span class="keyword">(</span><span class="string">"<a href="http://" rel="nofollow" target="_blank">http://</a></span><span class="default">$username</span><span class="string">:</span><span class="default">$password</span><span class="string">@example.com"</span><span class="keyword">);<br />
<br />
function </span><span class="default">URLopen</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Fake the browser type<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'user_agent'</span><span class="keyword">,</span><span class="string">'MSIE 4\.0b2;'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"</span><span class="default">$url</span><span class="string">"</span><span class="keyword">,</span><span class="string">'r'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41243""></a>
  <div class="note">
   <strong class="user">php at gotdoof dot com</strong>
   <a href="#41243" class="date">03-Apr-2004 08:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that opening a fifo with fopen() will block the php process until data is sent to it. That means any function you have registered as a shutdown function (register_shutdown_function()) will not be called when the user disconnects, and the process will keep running in the background, waiting for input. I know of no way around this, besides using some other means of IPC.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39605""></a>
  <div class="note">
   <strong class="user">richard dot quadling at carval dot co dot uk</strong>
   <a href="#39605" class="date">04-Feb-2004 05:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The issue involving some sites requiring a valid user-agent string when using fopen can easily be resolved by setting the user_agent string in the PHP.INI file.<br />
<br />
If you do not have access to the PHP.INI file, then the use of <br />
<br />
ini_set('user_agent','Mozilla: (compatible; Windows XP)');<br />
<br />
should also work.<br />
<br />
The actual agent string is up to you. If you want to identify to the sites that you are using PHP ...<br />
<br />
ini_set('user_agent','PHP');<br />
<br />
would do.<br />
<br />
Regards,<br />
<br />
Richard Quadling.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39448""></a>
  <div class="note">
   
   <a href="#39448" class="date">28-Jan-2004 11:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are connecting to your ftp server through a router doing NAT (such as the Zyxel 128L prestige router/bridge we are using) by doing say an <span class="default">&lt;?php fopen</span><span class="keyword">(</span><span class="string">"<a href="ftp://ftpusername:ftppassword@example.com/" rel="nofollow" target="_blank">ftp://ftpusername:ftppassword@example.com/</a>"</span><span class="keyword">.</span><span class="default">$file_name</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">) </span><span class="default">?&gt;</span>, then this could fail. You will get php_hostconnect connection failed error. This is because fopen() function uses a passive ftp connection which the Zyxel router does not support, even though your ftp server may be configured to allow the passive connections which php fopen() function is using. Note that $file_name is the file we want to ftp to the remote server eg could be file.txt.<br />
<br />
Thus an alternative would be to do create the file you want in a local directory of your machine or in the webserver where your php files reside eg use fwrite() as documented in the manual. Once you have the $file_name you want to ftp created, do the following:<br />
<br />
<span class="default">&lt;?php<br />
ftp_connect</span><span class="keyword">(</span><span class="default">$ftp_server</span><span class="keyword">);<br />
</span><span class="comment">//which can connect to the ftp server using an active connection. <br />
</span><span class="default">ftp_login </span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$ftp_username</span><span class="keyword">.</span><span class="string">"@"</span><span class="keyword">.</span><span class="default">$ftp_server</span><span class="keyword">, </span><span class="default">$ftp_password</span><span class="keyword">);<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$PATH</span><span class="keyword">.</span><span class="string">""</span><span class="keyword">.</span><span class="default">$file_name</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
</span><span class="comment">// eg. $fp = fopen("<a href="http://www.yourwebsite.com/" rel="nofollow" target="_blank">http://www.yourwebsite.com/</a>".$file_name, 'r');<br />
//turn off passive mode transfers<br />
</span><span class="default">ftp_pasv </span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="comment">//now upload $file_name<br />
</span><span class="default">ftp_fput</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$file_name</span><span class="keyword">, </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">FTP_ASCII</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Your file should now be in your ftp server, having used an active connection.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37791""></a>
  <div class="note">
   <strong class="user">sergiopaternoster at tiscali dot it</strong>
   <a href="#37791" class="date">27-Nov-2003 05:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to open large files (more than 2GB) that's what I did and it works: you should recompile your php with the CFLAGS="-D_FILE_OFFSET_BITS=64" ./configure etc... This tells to your compiler (I tested only gcc on PHP-4.3.4 binary on Linux and Solaris) to make the PHP parser binary large file aware. This way fopen() will not give you the "Value too large for defined data type" error message.<br />
God bless PHP<br />
ciao<br />
Sergio Paternoster</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37761""></a>
  <div class="note">
   <strong class="user">ken dot gregg at rwre dot com</strong>
   <a href="#37761" class="date">25-Nov-2003 03:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP will open a directory if a path with no file name is supplied. This just bit me. I was not checking the filename part of a concatenated string.<br />
<br />
For example:<br />
<br />
<span class="default">&lt;?php<br />
$fd </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'/home/mydir/' </span><span class="keyword">. </span><span class="default">$somefile</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Will open the directory if $somefile = ''<br />
<br />
If you attempt to read using the file handle you will get the binary directory contents. I tried append mode and it errors out so does not seem to be dangerous.<br />
<br />
This is with FreeBSD 4.5 and PHP 4.3.1. Behaves the same on 4.1.1 and PHP 4.1.2. I have not tested other version/os combinations.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37553""></a>
  <div class="note">
   <strong class="user">dan at cleandns dot com</strong>
   <a href="#37553" class="date">19-Nov-2003 11:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">#going to update last users counter script since<br />
#aborting a write because a file is locked is not correct.<br />
<br />
</span><span class="default">$counter_file </span><span class="keyword">= </span><span class="string">'/tmp/counter.txt'</span><span class="keyword">;<br />
</span><span class="default">clearstatcache</span><span class="keyword">();<br />
</span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">## prevent refresh from aborting file operations and hosing file<br />
</span><span class="keyword">if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$counter_file</span><span class="keyword">)) {<br />
&nbsp;&nbsp; </span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$counter_file</span><span class="keyword">, </span><span class="string">'r+'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">flock</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">LOCK_EX</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">#$buffer = chop(fgets($fh, 2));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">chop</span><span class="keyword">(</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$counter_file</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$buffer</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">rewind</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fflush</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ftruncate</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">));&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">flock</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">LOCK_UN</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; }<br />
}<br />
else {<br />
&nbsp;&nbsp; </span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$counter_file</span><span class="keyword">, </span><span class="string">'w+'</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="string">"1"</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$buffer</span><span class="keyword">=</span><span class="string">"1"</span><span class="keyword">;<br />
}<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
<br />
print </span><span class="string">"Count is </span><span class="default">$buffer</span><span class="string">"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34575""></a>
  <div class="note">
   <strong class="user">phpNO at SPAMperfectweb dot com</strong>
   <a href="#34575" class="date">31-Jul-2003 01:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I offer the following script for updating a counter, using methods gleaned from various posts on file operations...<br />
<br />
<span class="default">&lt;?php<br />
$counter_file </span><span class="keyword">= </span><span class="string">'somefile.txt'</span><span class="keyword">;<br />
</span><span class="default">clearstatcache</span><span class="keyword">();<br />
</span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">## prevent refresh from aborting file operations and hosing file<br />
</span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$counter_file</span><span class="keyword">, </span><span class="string">'r+b'</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">## use 'r+b' so file can be read and written<br />
</span><span class="keyword">if (</span><span class="default">$fh</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; if (</span><span class="default">flock</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">LOCK_EX</span><span class="keyword">))&nbsp; &nbsp;&nbsp; </span><span class="comment">## don't do anything unless lock is successful<br />
&nbsp;&nbsp; &nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$counter_file</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rewind</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">$count</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fflush</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ftruncate</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">));&nbsp; &nbsp;&nbsp; </span><span class="comment">## better than truncating to 0 before writing, per 04-Mar-2003 comment below<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">flock</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">LOCK_UN</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; } else echo </span><span class="string">"Could not lock counter file '</span><span class="default">$counter_file</span><span class="string">'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
} else&nbsp; echo </span><span class="string">"Could not open counter file '</span><span class="default">$counter_file</span><span class="string">'"</span><span class="keyword">;<br />
</span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">## put things back to normal<br />
<br />
</span><span class="keyword">echo </span><span class="string">"counter is at </span><span class="default">$count</span><span class="string">"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33611""></a>
  <div class="note">
   <strong class="user">unshift at yahoo dot com</strong>
   <a href="#33611" class="date">01-Jul-2003 04:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that fopen() errors when you attempt opening a url starting with HTTP:// as opposed to <a href="http:// - it is case sensitive.&nbsp; In 4.3.1 anyway..." rel="nofollow" target="_blank">http:// - it is case sensitive.&nbsp; In 4.3.1 anyway...</a>"HTTP://", by not matching "<a href="http://" rel="nofollow" target="_blank">http://</a>" will tell the wrapper to look locally.&nbsp; From the looks of the source, the same goes for HTTPS vs https, etc.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33228""></a>
  <div class="note">
   <strong class="user">simon at gornall dot net</strong>
   <a href="#33228" class="date">19-Jun-2003 12:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're having problems with fopen("url...") but you can run 'host url' in a shell window and get the correct lookup, here's why...<br />
<br />
This has had me banging my head against it all day - finally I found the answer buried in the bug reports, but figured it should really be more prominent!<br />
<br />
The problem happens when you're on an ADSL line with DHCP (like our office)... When the ADSL modem renews the DHCP lease, you can also switch DNS servers, which confuses apache (and hence PHP) - meaning that you can't look up hosts from within PHP, even though you *can* from the commandline.... The short-term solution is to restart apache.<br />
<br />
You'll get "php_network_getaddresses: getaddrinfo failed: Temporary failure in name resolution in ..." messages as symptoms. Restart apache, and they're gone :-)<br />
<br />
Simon</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33127""></a>
  <div class="note">
   <strong class="user">RobNar</strong>
   <a href="#33127" class="date">17-Jun-2003 08:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is an addendum to ibetyouare at home dot com's note about Apache directory permissions.&nbsp; If you are on a shared host and cannot tweak Apache's permissions directives then you might try setting the same thing in a .htaccess file.&nbsp; Failing that, if you are having trouble just creating files then&nbsp; set the directory permissions to allow writing (for whatever directory the file is supposed to be in) and include the following before fopen():<br />
<br />
`touch /path/to/myfile/myfile.txt`;<br />
<br />
That will usually create a new empty file that you can write to even when fopen fails. - PHP 4.3.0</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32741""></a>
  <div class="note">
   <strong class="user">Jhilton a at t nurv dot us</strong>
   <a href="#32741" class="date">05-Jun-2003 12:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Quick tip. If using fopen to make http requests that contain a querystring, it is advised that you urlencode() your values, else characters like @ can make fopen (or whatever wrapper it is using) throw an error.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30024""></a>
  <div class="note">
   
   <a href="#30024" class="date">04-Mar-2003 08:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To overwrite a file with a new content without deleting it, and without changing the owner or access rights, it's best to not use:<br />
<br />
<span class="default">&lt;?php<br />
$file </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'r+b'</span><span class="keyword">); </span><span class="comment">// binary update mode<br />
//...<br />
</span><span class="default">ftruncate</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$my_stuff</span><span class="keyword">);<br />
</span><span class="comment">//...<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
but instead the faster one:<br />
<br />
<span class="default">&lt;?php<br />
$file </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'r+b); // binary update mode<br />
//...<br />
rewind($file);<br />
fwrite($file, $my_stuff);<br />
fflush($file);<br />
ftruncate($file, ftell($file));<br />
//...<br />
fclose($file);<br />
?&gt;<br />
<br />
The reason is that truncating a file at size 0 forces the OS to deallocate all storage clusters used by the file, before you write your content which will be reallocated on disk.<br />
<br />
The second code simply overwrites the existing content where it is already located on disk, and truncates any remaining bytes that may exist (if the new content is shorter than the old content). The "r+b" mode allows access for both read and write: the file can be kept opened after reading it and before rewriting the modified content.<br />
<br />
It'</span><span class="default">s particularly useful </span><span class="keyword">for </span><span class="default">files that are accessed often </span><span class="keyword">or </span><span class="default">have a size larger than a few kilobytes</span><span class="keyword">, as </span><span class="default">it saves lots of system I</span><span class="keyword">/</span><span class="default">O</span><span class="keyword">, and </span><span class="default">also limits the filesystem fragmentation </span><span class="keyword">if </span><span class="default">the updated file is quite large</span><span class="keyword">.<br />
<br />
And </span><span class="default">this method also works </span><span class="keyword">if </span><span class="default">the file is locked exclusively once opened </span><span class="keyword">(</span><span class="default">but I would rather recommend using another </span><span class="keyword">empty </span><span class="default">file </span><span class="keyword">for </span><span class="default">locking purpose</span><span class="keyword">, </span><span class="default">opened with </span><span class="string">"a+" </span><span class="default">access mode</span><span class="keyword">, </span><span class="default">in </span><span class="string">"/var/lock/yourapp/*" </span><span class="keyword">or </span><span class="default">other fast filesystems where filelocks are easily monitored </span><span class="keyword">and </span><span class="default">where the webserver running PHP is allowed to create </span><span class="keyword">and </span><span class="default">update lock files</span><span class="keyword">, and </span><span class="default">not forgetting to close the lock file after closing the content file</span><span class="keyword">).</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27470""></a>
  <div class="note">
   <strong class="user">draconumpb at hotmail dot com</strong>
   <a href="#27470" class="date">06-Dec-2002 03:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just used explode() as an alternative to fscanf, since my only delimiter was | (pipe). I was having problems with it, since I use it in my news-management script. I found that it cut the last variable I was using, $body, a bit short when I posted a long news post. This would've been a real problem for anybody trying to make news posts longer than a paragraph or so.<br />
<br />
However, I found that when I used: <br />
<span class="default">&lt;?php </span><span class="keyword">list(</span><span class="default">$variable1</span><span class="keyword">, </span><span class="default">$variable2</span><span class="keyword">, </span><span class="default">etc</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"|"</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span>it didn't cut any variables short, so.. what I'm really trying to say here is that for people who are experiencing problems with parsing simple files (i.e with only a single, simple delimiter such as : or |) using the unecessarily complex fscanf() and sscanf() functions, explode() is definately the way to go.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">get_news</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">, </span><span class="default">$newsid</span><span class="keyword">)<br />
{<br />
</span><span class="default">$datafile </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"</span><span class="default">$filepath</span><span class="string">/news/</span><span class="default">$newsid</span><span class="string">.txt"</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$datafile</span><span class="keyword">, </span><span class="default">1000000</span><span class="keyword">);<br />
list(</span><span class="default">$author</span><span class="keyword">, </span><span class="default">$email</span><span class="keyword">, </span><span class="default">$date</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$body</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"|"</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">);<br />
</span><span class="default">$body </span><span class="keyword">= </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="string">"</span><span class="default">$body</span><span class="string">"</span><span class="keyword">);<br />
</span><span class="default">$subject </span><span class="keyword">= </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="string">"</span><span class="default">$subject</span><span class="string">"</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;a href=\"<a href="mailto:" rel="nofollow" target="_blank">mailto:</a></span><span class="default">$email</span><span class="string">\"&gt;</span><span class="default">$author</span><span class="string">&lt;/a&gt; -- </span><span class="default">$date</span><span class="string"> -- </span><span class="default">$subject</span><span class="string">&lt;hr&gt;</span><span class="default">$body</span><span class="string">&lt;p&gt;"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
sample file:<br />
<br />
AdministratorMax|admin@example.com|Tuesday, March 5th @ 5:45 PM EST|Site Going Down Tomarrow|Well, folks, I\'m sorry to say that the site will indeed be down tomarrow for most of the day. Hang in there.<br />
<br />
Output:<br />
<br />
&lt;a href="<a href="mailto:admin@example.com" rel="nofollow" target="_blank">mailto:admin@example.com</a>"&gt;AdministratorMax&lt;/a&gt; -- Tuesday, March 5th -- Site Going Down Tomarrow&lt;hr&gt;Well, folks, I'm sorry to say that the site will indeed be down tomarrow for most of the day. Hang in there.<br />
<br />
Thought that might be useful for anybody making a simple news-management script, ;)<br />
<br />
By the way, feel free to correct me if I made any mistakes - I'm at my dad's work where I don't really have a way to check to see if it works or not. However, I use a more complex version of this on my portal project, and it works beautifully.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22822""></a>
  <div class="note">
   
   <a href="#22822" class="date">01-Jul-2002 09:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if specifying the optional 'b' (binary) mode, it appears that it cannot be the first letter for some unaccountable reason. In other words, "br" doesn't work, while "rb" is ok!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20935""></a>
  <div class="note">
   <strong class="user">jared at dctkc dot com</strong>
   <a href="#20935" class="date">22-Apr-2002 01:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">// HOW TO USE PHP TO WRITE TO YOUR SERIAL PORT: TWO METHODS<br />
</span><span class="default">$serproxy</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br />
if (</span><span class="default">$serproxy</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Use this code in conjunction with SERPROXY.EXE <br />
&nbsp;&nbsp;&nbsp; // (<a href="http://www.lspace.nildram.co.uk/freeware.html" rel="nofollow" target="_blank">http://www.lspace.nildram.co.uk/freeware.html</a>)<br />
&nbsp;&nbsp;&nbsp; // which converts a Serial stream to a TCP/IP stream<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen </span><span class="keyword">(</span><span class="string">"localhost"</span><span class="keyword">, </span><span class="default">5331</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$fp</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$errstr</span><span class="string"> (</span><span class="default">$errno</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$e </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">27</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string&nbsp; </span><span class="keyword">= </span><span class="default">$e </span><span class="keyword">. </span><span class="string">"A" </span><span class="keyword">. </span><span class="default">$e </span><span class="keyword">. </span><span class="string">"H300"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">.= </span><span class="default">$e </span><span class="keyword">. </span><span class="string">"V100" </span><span class="keyword">. </span><span class="default">$e </span><span class="keyword">. </span><span class="string">"XL1SATO"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">.= </span><span class="default">$e </span><span class="keyword">. </span><span class="string">"Q1" </span><span class="keyword">. </span><span class="default">$e </span><span class="keyword">. </span><span class="string">"Z"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$string</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$string </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
} elseif (</span><span class="default">$com1</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Use this code to write directly to the COM1 serial port<br />
&nbsp;&nbsp;&nbsp; // First, you want to set the mode of the port. You need to set<br />
&nbsp;&nbsp;&nbsp; // it only once; it will remain the same until you reboot.<br />
&nbsp;&nbsp;&nbsp; // Note: the backticks on the following line will execute the <br />
&nbsp;&nbsp;&nbsp; // DOS 'mode' command from within PHP<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">`</span><span class="string">mode com1: BAUD=9600 PARITY=N data=8 stop=1 xon=off</span><span class="keyword">`;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen </span><span class="keyword">(</span><span class="string">"COM1:"</span><span class="keyword">, </span><span class="string">"w+"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$fp</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Uh-oh. Port not opened."</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$e </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">27</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string&nbsp; </span><span class="keyword">= </span><span class="default">$e </span><span class="keyword">. </span><span class="string">"A" </span><span class="keyword">. </span><span class="default">$e </span><span class="keyword">. </span><span class="string">"H300"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">.= </span><span class="default">$e </span><span class="keyword">. </span><span class="string">"V100" </span><span class="keyword">. </span><span class="default">$e </span><span class="keyword">. </span><span class="string">"XL1SATO"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">.= </span><span class="default">$e </span><span class="keyword">. </span><span class="string">"Q1" </span><span class="keyword">. </span><span class="default">$e </span><span class="keyword">. </span><span class="string">"Z"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$string</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$string </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19945""></a>
  <div class="note">
   
   <a href="#19945" class="date">15-Mar-2002 06:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also if you're server is useing htaccess to authticate users make sure to add the username and password to the http link you're trying to open. I forgot about this and took a while to find.<br />
ie:<br />
<br />
fopen("<a href="http://user:pass@www.example.com/mypage.php" rel="nofollow" target="_blank">http://user:pass@www.example.com/mypage.php</a>");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="16296""></a>
  <div class="note">
   <strong class="user">php at themastermind1 dot com</strong>
   <a href="#16296" class="date">23-Oct-2001 10:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have found that I can do fopen("COM1:", "r+"); to open the comport in windows. You have to make sure the comport isn't already open or you will get a permission denied. <br />
<br />
I am still playing around with this but you have to somehow flush what you send to the comport if you are trying to communicate realtime with a device.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="14426""></a>
  <div class="note">
   <strong class="user">keithm at aoeex dot NOSPAM dot com</strong>
   <a href="#14426" class="date">31-Jul-2001 05:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was working on a consol script for win32 and noticed a few things about it.&nbsp; On win32 it appears that you can't re-open the input stream for reading, but rather you have to open it once, and read from there on.&nbsp; Also, i don't know if this is a bug or what but it appears that fgets() reads until the new line anyway.&nbsp; The number of characters returned is ok, but it will not halt reading and return to the script.&nbsp; I don't know of a work around for this right now, but i'll keep working on it.<br />
<br />
This is some code to work around the close and re-open of stdin.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">read</span><span class="keyword">(</span><span class="default">$length</span><span class="keyword">=</span><span class="string">'255'</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if (!isset(</span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'StdinPointer'</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'StdinPointer'</span><span class="keyword">]=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"php://stdin"</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'StdinPointer'</span><span class="keyword">],</span><span class="default">$length</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">);<br />
}<br />
echo </span><span class="string">"Enter your name: "</span><span class="keyword">;<br />
</span><span class="default">$name</span><span class="keyword">=</span><span class="default">read</span><span class="keyword">();<br />
echo </span><span class="string">"Enter your age: "</span><span class="keyword">;<br />
</span><span class="default">$age</span><span class="keyword">=</span><span class="default">read</span><span class="keyword">();<br />
echo </span><span class="string">"Hi </span><span class="default">$name</span><span class="string">, Isn't it Great to be </span><span class="default">$age</span><span class="string"> years old?"</span><span class="keyword">;<br />
@</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$StdinPointer</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="2224""></a>
  <div class="note">
   <strong class="user">icon at mricon dot com</strong>
   <a href="#2224" class="date">09-Nov-1999 02:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're running PHP as apache module, it will always write files as "nobody", "www", "httpd", (or whatever user your webserver runs as) unless you specify a different user/group in httpd.conf, or compile apache with suexec support.<br />
However, if you run PHP as a CGI wrapper, you may setuid the PHP executable to whatever user you wish (*severe* security issues apply). If you really want to be able to su to other user, I recommend compiling with suexec support.<br />
AFAIK, PHP can't NOT use SuEXEC if apache does. If PHP is configured as an apache module it will act as whatever user the apache is. If apache SuEXEC's to otheruser:othergroup (e.g. root:root), that's what PHP will write files as, because it acts as a part of apache code. I suggest you double-check your SuEXEC configuration and settings. Note: you can't su to another user within the PHP code -- it has to be an apache directive, either through &lt;VirtualHost&gt;, or through .htaccess. Also note: I'm not sure how it all works (if it works at all) on Win32 platforms.<br />
Check www.apache.org to see how it's done.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.fnmatch.html">fnmatch</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.fpassthru.html">fpassthru</a></div>
 <div class="up"><a href="ref.filesystem.html">Filesystem Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
