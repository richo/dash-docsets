<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>HTTP authentication with PHP</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="features.html">Features</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="features.cookies.html">Cookies</a></div>
 <div class="up"><a href="features.html">Features</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="features.http-auth" class="chapter">
  <h1>HTTP authentication with PHP</h1>


  <p class="simpara">
   It is possible to use the 
   <span class="function"><a href="function.header.html" class="function">header()</a></span> function to send an <i>&quot;Authentication Required&quot;</i> 
   message to the client browser causing it to pop up a Username/Password 
   input window.  Once the user has filled in a username and a password, 
   the URL containing the PHP script will be called again with the 
   <a href="reserved.variables.html" class="link">predefined variables</a> 
   <var class="varname"><var class="varname">PHP_AUTH_USER</var></var>, <var class="varname"><var class="varname">PHP_AUTH_PW</var></var>, 
   and <var class="varname"><var class="varname">AUTH_TYPE</var></var> set to the user name, password and 
   authentication type respectively.  These predefined variables are found 
   in the <var class="varname"><var class="varname"><a href="reserved.variables.server.html" class="classname">$_SERVER</a></var></var> and 
   <var class="varname"><var class="varname">$HTTP_SERVER_VARS</var></var> arrays. Both &quot;Basic&quot; and &quot;Digest&quot;
   (since PHP 5.1.0) authentication methods are supported. See the
   <span class="function"><a href="function.header.html" class="function">header()</a></span> function for more information.
  </p>

  <blockquote class="note"><p><b class="note">Note</b>: 
   <b>PHP Version Note</b><br />
   <p class="para">
    <a href="language.variables.superglobals.html" class="link">Superglobals</a>, 
    such as <var class="varname"><var class="varname"><a href="reserved.variables.server.html" class="classname">$_SERVER</a></var></var>, became 
    available in PHP <a href="http://www.php.net/releases/4_1_0.php" class="link external" title="Link : http://www.php.net/releases/4_1_0.php">&raquo;&nbsp;4.1.0</a>. 
   </p>
  </p></blockquote>

  <p class="para">
   An example script fragment which would force client authentication
   on a page is as follows:
  </p>
  <p class="para">
   <div class="example" id="example-329">
    <p><b>Example #1 Basic HTTP Authentication example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">if&nbsp;(!isset(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'WWW-Authenticate:&nbsp;Basic&nbsp;realm="My&nbsp;Realm"'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'HTTP/1.0&nbsp;401&nbsp;Unauthorized'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Text&nbsp;to&nbsp;send&nbsp;if&nbsp;user&nbsp;hits&nbsp;Cancel&nbsp;button'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;exit;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;p&gt;Hello&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">]}</span><span style="color: #DD0000">.&lt;/p&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;p&gt;You&nbsp;entered&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_PW'</span><span style="color: #007700">]}</span><span style="color: #DD0000">&nbsp;as&nbsp;your&nbsp;password.&lt;/p&gt;"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-330">
    <p><b>Example #2 Digest HTTP Authentication example</b></p>
    <div class="example-contents"><p>
     This example shows you how to implement a simple Digest HTTP
     authentication script. For more information read the <a href="http://www.faqs.org/rfcs/rfc2617" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2617">&raquo;&nbsp;RFC 2617</a>.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$realm&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Restricted&nbsp;area'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//user&nbsp;=&gt;&nbsp;password<br /></span><span style="color: #0000BB">$users&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'admin'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'mypass'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'guest'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'guest'</span><span style="color: #007700">);<br /><br /><br />if&nbsp;(empty(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_DIGEST'</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'HTTP/1.1&nbsp;401&nbsp;Unauthorized'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'WWW-Authenticate:&nbsp;Digest&nbsp;realm="'</span><span style="color: #007700">.</span><span style="color: #0000BB">$realm</span><span style="color: #007700">.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'",qop="auth",nonce="'</span><span style="color: #007700">.</span><span style="color: #0000BB">uniqid</span><span style="color: #007700">().</span><span style="color: #DD0000">'",opaque="'</span><span style="color: #007700">.</span><span style="color: #0000BB">md5</span><span style="color: #007700">(</span><span style="color: #0000BB">$realm</span><span style="color: #007700">).</span><span style="color: #DD0000">'"'</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Text&nbsp;to&nbsp;send&nbsp;if&nbsp;user&nbsp;hits&nbsp;Cancel&nbsp;button'</span><span style="color: #007700">);<br />}<br /><br /><br /></span><span style="color: #FF8000">//&nbsp;analyze&nbsp;the&nbsp;PHP_AUTH_DIGEST&nbsp;variable<br /></span><span style="color: #007700">if&nbsp;(!(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">http_digest_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_DIGEST'</span><span style="color: #007700">]))&nbsp;||<br />&nbsp;&nbsp;&nbsp;&nbsp;!isset(</span><span style="color: #0000BB">$users</span><span style="color: #007700">[</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">]]))<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Wrong&nbsp;Credentials!'</span><span style="color: #007700">);<br /><br /><br /></span><span style="color: #FF8000">//&nbsp;generate&nbsp;the&nbsp;valid&nbsp;response<br /></span><span style="color: #0000BB">$A1&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">md5</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">':'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$realm&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">':'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$users</span><span style="color: #007700">[</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">]]);<br /></span><span style="color: #0000BB">$A2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">md5</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REQUEST_METHOD'</span><span style="color: #007700">].</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'uri'</span><span style="color: #007700">]);<br /></span><span style="color: #0000BB">$valid_response&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">md5</span><span style="color: #007700">(</span><span style="color: #0000BB">$A1</span><span style="color: #007700">.</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'nonce'</span><span style="color: #007700">].</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'nc'</span><span style="color: #007700">].</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'cnonce'</span><span style="color: #007700">].</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'qop'</span><span style="color: #007700">].</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$A2</span><span style="color: #007700">);<br /><br />if&nbsp;(</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'response'</span><span style="color: #007700">]&nbsp;!=&nbsp;</span><span style="color: #0000BB">$valid_response</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Wrong&nbsp;Credentials!'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;ok,&nbsp;valid&nbsp;username&nbsp;&amp;&nbsp;password<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">'You&nbsp;are&nbsp;logged&nbsp;in&nbsp;as:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">];<br /><br /><br /></span><span style="color: #FF8000">//&nbsp;function&nbsp;to&nbsp;parse&nbsp;the&nbsp;http&nbsp;auth&nbsp;header<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">http_digest_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$txt</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;protect&nbsp;against&nbsp;missing&nbsp;data<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$needed_parts&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'nonce'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'nc'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'cnonce'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'qop'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'username'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'uri'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'response'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$keys&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">'|'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">array_keys</span><span style="color: #007700">(</span><span style="color: #0000BB">$needed_parts</span><span style="color: #007700">));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">preg_match_all</span><span style="color: #007700">(</span><span style="color: #DD0000">'@('&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$keys&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">')=(?:([\'"])([^\2]+?)\2|([^\s,]+))@'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$txt</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$matches</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PREG_SET_ORDER</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$matches&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$m</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]]&nbsp;=&nbsp;</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #0000BB">3</span><span style="color: #007700">]&nbsp;?&nbsp;</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #0000BB">3</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #0000BB">4</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unset(</span><span style="color: #0000BB">$needed_parts</span><span style="color: #007700">[</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$needed_parts&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <blockquote class="note"><p><b class="note">Note</b>: 
   <b>Compatibility Note</b><br />
   <p class="para">
    Please be careful when coding the HTTP header lines. In order to guarantee maximum
    compatibility with all clients, the keyword &quot;Basic&quot; should be written with an
    uppercase &quot;B&quot;, the realm string must be enclosed in double (not single) quotes,
    and exactly one space should precede the <em class="emphasis">401</em> code in the 
    <em class="emphasis">HTTP/1.0 401</em> header line. Authentication parameters have
    to be comma-separated as seen in the digest example above.
   </p>
  </p></blockquote>

  <p class="para">
   Instead of simply printing out <var class="varname"><var class="varname">PHP_AUTH_USER</var></var> 
   and <var class="varname"><var class="varname">PHP_AUTH_PW</var></var>, as done in the above example, 
   you may want to check the username and password for validity.  
   Perhaps by sending a query to a database, or by looking up the 
   user in a dbm file.
  </p>

  <p class="para">
   Watch out for buggy Internet Explorer browsers out there.  They
   seem very picky about the order of the headers.  Sending the
   <em class="emphasis">WWW-Authenticate</em> header before the
   <i>HTTP/1.0 401</i> header seems to do the trick
   for now.
  </p>

  <p class="simpara">
   As of PHP 4.3.0, in order to prevent someone from writing a script which
   reveals the password for a page that was authenticated through a
   traditional external mechanism, the PHP_AUTH variables will not be 
   set if external authentication is enabled for that particular
   page and <a href="ini.sect.safe-mode.html#ini.safe-mode" class="link">safe mode</a> is enabled.  Regardless, 
   <var class="varname"><var class="varname">REMOTE_USER</var></var> can be used 
   to identify the externally-authenticated user.  So, you can use  
   <var class="varname"><var class="varname"><a href="reserved.variables.server.html" class="classname">$_SERVER['REMOTE_USER']</a></var></var>.
  </p>

  <blockquote class="note"><p><b class="note">Note</b>: 
   <b>Configuration Note</b><br />
   <p class="para">
    PHP uses the presence of an <i>AuthType</i> directive
    to determine whether external authentication is in effect.
   </p>
  </p></blockquote>

  <p class="simpara">
   Note, however, that the above does not prevent someone who
   controls a non-authenticated URL from stealing passwords from
   authenticated URLs on the same server.
  </p>
  <p class="simpara">
   Both Netscape Navigator and Internet Explorer will clear the local browser
   window&#039;s authentication cache for the realm upon receiving a
   server response of 401. This can effectively &quot;log out&quot; a user,
   forcing them to re-enter their username and password. Some people
   use this to &quot;time out&quot; logins, or provide a &quot;log-out&quot; button.
  </p>
  <p class="para">
   <div class="example" id="example-331">
    <p><b>Example #3 HTTP Authentication example forcing a new name/password</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">authenticate</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'WWW-Authenticate:&nbsp;Basic&nbsp;realm="Test&nbsp;Authentication&nbsp;System"'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'HTTP/1.0&nbsp;401&nbsp;Unauthorized'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"You&nbsp;must&nbsp;enter&nbsp;a&nbsp;valid&nbsp;login&nbsp;ID&nbsp;and&nbsp;password&nbsp;to&nbsp;access&nbsp;this&nbsp;resource\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;exit;<br />}<br />&nbsp;<br />if&nbsp;(!isset(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">])&nbsp;||<br />&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'SeenBefore'</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'OldAuth'</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">authenticate</span><span style="color: #007700">();<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;p&gt;Welcome:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">])&nbsp;.&nbsp;</span><span style="color: #DD0000">"&lt;br&nbsp;/&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Old:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$_REQUEST</span><span style="color: #007700">[</span><span style="color: #DD0000">'OldAuth'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;form&nbsp;action=''&nbsp;method='post'&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;type='hidden'&nbsp;name='SeenBefore'&nbsp;value='1'&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;type='hidden'&nbsp;name='OldAuth'&nbsp;value=\""&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">])&nbsp;.&nbsp;</span><span style="color: #DD0000">"\"&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;type='submit'&nbsp;value='Re&nbsp;Authenticate'&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;/form&gt;&lt;/p&gt;\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="simpara">
   This behavior is not required by the <i>HTTP Basic</i>
   authentication standard, so you should never depend on this. Testing with
   <i>Lynx</i> has shown that <i>Lynx</i> does not clear
   the authentication credentials with a 401 server response, so pressing back
   and then forward again will open the resource as long as the credential
   requirements haven&#039;t changed. The user can press the
   <i>&#039;_&#039;</i> key to clear their authentication information, however.
  </p>
  <p class="simpara">
   Also note that until PHP 4.3.3, HTTP Authentication did not work
   using Microsoft&#039;s IIS server with the CGI version of PHP due to a
   limitation of IIS.  In order to get it to work in PHP 4.3.3+, 
   you must edit your IIS configuration &quot;<i>Directory Security</i>&quot;.
   Click on &quot;<i>Edit</i>&quot; and only check
   &quot;<i>Anonymous Access</i>&quot;, all other fields
   should be left unchecked.
  </p>
  <p class="simpara">
   Another limitation is if you&#039;re using the IIS module (ISAPI) and PHP 4, you
   may not use the <i>PHP_AUTH_*</i> variables but instead, the
   variable <i>HTTP_AUTHORIZATION</i> is available.  For example,
   consider the following code: <i>list($user, $pw) = explode(&#039;:&#039;,
    base64_decode(substr($_SERVER[&#039;HTTP_AUTHORIZATION&#039;], 6)));</i>
  </p>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <b>IIS Note:</b><br />
   <span class="simpara">
    For HTTP Authentication to work with IIS, the PHP directive
    <a href="ini.core.html#ini.cgi.rfc2616-headers" class="link">cgi.rfc2616_headers</a> must
    be set to <i>0</i> (the default value).
   </span>
  </p></blockquote>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    If <a href="ini.sect.safe-mode.html#ini.safe-mode" class="link">safe mode</a> is enabled, the
    uid of the script is added to the <i>realm</i> part of
    the <i>WWW-Authenticate</i> header.
   </p>
  </p></blockquote>

 </div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="106285""></a>
  <div class="note">
   <strong class="user">h3ndrik</strong>
   <a href="#106285" class="date">24-Oct-2011 05:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On my configuration with php-cgi - after setting the RewriteRule - the correct variable would be: $_SERVER['REDIRECT_HTTP_AUTHORIZATION']<br />
<br />
So the workaround for PhpCGI is:<br />
Set in your .htaccess:<br />
<br />
RewriteEngine on<br />
RewriteRule .* - [env=HTTP_AUTHORIZATION:%{HTTP:Authorization},last]<br />
<br />
Php workaround:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//set http auth headers for apache+php-cgi work around<br />
</span><span class="keyword">if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_AUTHORIZATION'</span><span class="keyword">]) &amp;&amp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Basic\s+(.*)$/i'</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_AUTHORIZATION'</span><span class="keyword">], </span><span class="default">$matches</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">] = </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">] = </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">//set http auth headers for apache+php-cgi work around if variable gets renamed by apache<br />
</span><span class="keyword">if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REDIRECT_HTTP_AUTHORIZATION'</span><span class="keyword">]) &amp;&amp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Basic\s+(.*)$/i'</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REDIRECT_HTTP_AUTHORIZATION'</span><span class="keyword">], </span><span class="default">$matches</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">] = </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">] = </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105379""></a>
  <div class="note">
   <strong class="user">luismontreal at gmail dot com</strong>
   <a href="#105379" class="date">12-Aug-2011 02:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using sessions like this makes the enter auth values at each request<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'http_logged'</span><span class="keyword">] != </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">] = </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">] = </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">] != </span><span class="default">$your_username </span><span class="keyword">|| </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">] != </span><span class="default">$your_password </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'http_logged'</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic realm="realm"'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'http_logged'</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102782""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#102782" class="date">06-Mar-2011 06:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Quickly and without combining, for example, we do a new folder LOGOUT and throw to him .htaccess files with some virtual user:<br />
<br />
AuthName "protected area"<br />
Access allow all users Logout<br />
<br />
set the error page 401<br />
<br />
ErrorDoc 401 "protected area"<br />
<br />
and set a link to our new folder &lt;a href="./logout/"&gt;logout&lt;/ a&gt;<br />
... when I click on enter into a virtual folder with a security dialog to confirm the login without supplying a user name and password and are logged off. Works on FF, IE, Opera ...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100396""></a>
  <div class="note">
   <strong class="user">ceo at l-i-e dot com</strong>
   <a href="#100396" class="date">13-Oct-2010 03:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To force a logout with Basic Auth, you can change the Realm out from under them to a different Realm.<br />
<br />
This forces a new set of credentials for a new "Realm" on your server.<br />
<br />
You just need to track the Realm name with the user/pass and change it around to something new/random as they log in and out.<br />
<br />
I believe that this is the only 100% guaranteed way to get a logout in HTTP Basic Auth, and if it were part of the docs a whole lot of BAD user-contributed comments here could be deleted.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100101""></a>
  <div class="note">
   <strong class="user">Ollie L</strong>
   <a href="#100101" class="date">24-Sep-2010 04:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I tried example 7, and at first I couldn't get it to work. It took me a while to spot that somewhere along the line, probably by the server, a seemingly random number was being added to the realm - so the valid_result variable wasn't calculated using the correct realm.<br />
<br />
To get around this, or any similar problems, make the following changes to the example:<br />
<br />
Around line 43 (44 if after next step ;) ):<br />
$needed_parts = array('nonce'=&gt;1, 'nc'=&gt;1, 'cnonce'=&gt;1, 'qop'=&gt;1, 'username'=&gt;1, 'uri'=&gt;1, 'response'=&gt;1, 'realm'=&gt;1);<br />
<br />
Before line 24:<br />
$realm = $data['realm'];<br />
<br />
These two steps get the real realm used for the authentication request, and substitute it into the "valid_response" query.<br />
<br />
Hope this helps :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99348""></a>
  <div class="note">
   <strong class="user">idbobby at rambler dot ru</strong>
   <a href="#99348" class="date">12-Aug-2010 02:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
First of all, sorry for my English.<br />
One more authorization script with logout solution.<br />
In script given by meint_at_meint_dot_net (<a href="http://www.php.net/manual/en/features.http-auth.php#93859" rel="nofollow" target="_blank">http://www.php.net/manual/en/features.http-auth.php#93859</a>) rewrite_module is used. If there are any problems with that module and possibilities of administration of the web-server are restricted (including restrictions for use of .htaccess) then you can use this solution.<br />
<br />
index.php<br />
---------<br />
<br />
<span class="default">&lt;?php<br />
<br />
$auth_realm </span><span class="keyword">= </span><span class="string">'My realm'</span><span class="keyword">;<br />
<br />
require_once </span><span class="string">'auth.php'</span><span class="keyword">;<br />
<br />
echo </span><span class="string">"You've logged in as </span><span class="keyword">{</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">]}</span><span class="string">&lt;br&gt;"</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;p&gt;&lt;a href="?action=logOut"&gt;LogOut&lt;/a&gt;&lt;/p&gt;'<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
auth.php<br />
--------<br />
<br />
<span class="default">&lt;?php<br />
<br />
$_user_ </span><span class="keyword">= </span><span class="string">'test'</span><span class="keyword">;<br />
</span><span class="default">$_password_ </span><span class="keyword">= </span><span class="string">'test'</span><span class="keyword">;<br />
<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
<br />
</span><span class="default">$url_action </span><span class="keyword">= (empty(</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'action'</span><span class="keyword">])) ? </span><span class="string">'logIn' </span><span class="keyword">: </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'action'</span><span class="keyword">];<br />
</span><span class="default">$auth_realm </span><span class="keyword">= (isset(</span><span class="default">$auth_realm</span><span class="keyword">)) ? </span><span class="default">$auth_realm </span><span class="keyword">: </span><span class="string">''</span><span class="keyword">;<br />
<br />
if (isset(</span><span class="default">$url_action</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$url_action</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$url_action</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'Function does not exist, request terminated'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; };<br />
};<br />
<br />
function </span><span class="default">logIn</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$auth_realm</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if (!isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'login'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'login'</span><span class="keyword">] = </span><span class="default">TRUE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic realm="'</span><span class="keyword">.</span><span class="default">$auth_realm</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'You must enter a valid login and password'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;p&gt;&lt;a href="?action=logOut"&gt;Try again&lt;/a&gt;&lt;/p&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$user </span><span class="keyword">= isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) ? </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">] : </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$password </span><span class="keyword">= isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">]) ? </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">] : </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">authenticate</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$result </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">] = </span><span class="default">$user</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_unset</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'login'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">errMes</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;p&gt;&lt;a href=""&gt;Try again&lt;/a&gt;&lt;/p&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; };<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; };<br />
&nbsp;&nbsp;&nbsp; };<br />
}<br />
<br />
function </span><span class="default">authenticate</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$_user_</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$_password_</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if ((</span><span class="default">$user </span><span class="keyword">== </span><span class="default">$_user_</span><span class="keyword">)&amp;&amp;(</span><span class="default">$password </span><span class="keyword">== </span><span class="default">$_password_</span><span class="keyword">)) { return </span><span class="default">0</span><span class="keyword">; }<br />
&nbsp;&nbsp;&nbsp; else { return </span><span class="default">1</span><span class="keyword">; };<br />
}<br />
<br />
function </span><span class="default">errMes</span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">$errno</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">0</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'The username or password you entered is incorrect'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'Unknown error'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; };<br />
}<br />
<br />
function </span><span class="default">logOut</span><span class="keyword">() {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_destroy</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; if (isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_unset</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"You've successfully logged out&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;p&gt;&lt;a href="?action=logIn"&gt;LogIn&lt;/a&gt;&lt;/p&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Location: ?action=logIn"</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">, </span><span class="default">301</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; };<br />
&nbsp;&nbsp;&nbsp; if (isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'login'</span><span class="keyword">])) { </span><span class="default">session_unset</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'login'</span><span class="keyword">]); };<br />
&nbsp;&nbsp;&nbsp; exit;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96970""></a>
  <div class="note">
   <strong class="user">Ome Ko</strong>
   <a href="#96970" class="date">25-Mar-2010 03:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a link to <a href="http://logout:logout@&lt;?=$_SERVER[" rel="nofollow" target="_blank">http://logout:logout@&lt;?=$_SERVER[</a>'HTTP_HOST'];?&gt;/SECRET/ would force a fresh login for the /SECRET directory if no user logout with password logout exists.<br />
<br />
<br />
[NOTE BY danbrown AT php DOT net: The following note was added by "Anonymous" on 01-APR-2010 (though we presume it's not an April Fool's Day joke).]<br />
<br />
this logout method does not work 100% anymore, because of another bulls**t from M$:<br />
<a href="http://support.microsoft.com/kb/834489" rel="nofollow" target="_blank">http://support.microsoft.com/kb/834489</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94349""></a>
  <div class="note">
   <strong class="user">admin at torrentsbook dot com</strong>
   <a href="#94349" class="date">29-Oct-2009 10:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP-CGI auth fix:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_AUTHORIZATION'</span><span class="keyword">])) {<br />
&nbsp; </span><span class="default">$auth_params </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">":" </span><span class="keyword">, </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_AUTHORIZATION'</span><span class="keyword">], </span><span class="default">6</span><span class="keyword">)));<br />
&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">] = </span><span class="default">$auth_params</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp; unset(</span><span class="default">$auth_params</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">] = </span><span class="default">implode</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">,</span><span class="default">$auth_params</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Fixes autorization with passwords, containing ":" symbol</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94164""></a>
  <div class="note">
   <strong class="user">ale (at) tana (dot) it</strong>
   <a href="#94164" class="date">20-Oct-2009 10:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After we do auth with PHP in Apache, we miss the userid in the access.log file, unless we redefine the LogFormat to be "%{REMOTE_USER}e" rather than "%u", and upon successful authentication we do<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; apache_setenv</span><span class="keyword">(</span><span class="string">'REMOTE_USER'</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93859""></a>
  <div class="note">
   <strong class="user">meint at meint dot net</strong>
   <a href="#93859" class="date">03-Oct-2009 11:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The definitive "logout" solution for Basic Authentication<br />
<br />
As asserted by many on this page "Basic Authentication" has nog "logout" feature. There is however a standards based method (RFC2617) by which you can make the basic authentication session unique and therefore can emulate a log out function. This function works in all situations and across all browsers which is not the case for most solutions on this page.<br />
<br />
The RFC2617 HTTP Authentication standard states that two elements determine the protection space:<br />
- realm, a self chosen, server provided string identifier<br />
- abs_path (i.e. the url)<br />
<br />
By making both elements unique and changing them at the log out you will break (and "logout") the basic authentication.<br />
<br />
The solution requires the use of mod_rewrite to direct traffic for non-existent resources to the index.php file. Please place a .htaccess file with the following contents in the folder that you wish to protect:<br />
<br />
.htaccess:<br />
RewriteEngine On<br />
RewriteCond %{REQUEST_URI} !^$<br />
RewriteCond %{REQUEST_FILENAME} !-f<br />
RewriteCond %{REQUEST_FILENAME} !-d<br />
RewriteRule . index.php [NC,L]<br />
<br />
Please place an index.php file in the same folder (/auth in this example) with the following content:<br />
<span class="default">&lt;?php<br />
<br />
session_start</span><span class="keyword">();<br />
<br />
if (empty(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'session_id'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_regenerate_id</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'session_id'</span><span class="keyword">] = </span><span class="default">session_id</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Location: /auth/" </span><span class="keyword">. </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'session_id'</span><span class="keyword">] . </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">, </span><span class="default">301</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$url_action </span><span class="keyword">= (empty(</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'action'</span><span class="keyword">])) ? </span><span class="string">'HomePage' </span><span class="keyword">: </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'action'</span><span class="keyword">];<br />
if (isset(</span><span class="default">$url_action</span><span class="keyword">)) {&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$url_action</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$url_action</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">'Function does not exist, request terminated'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function </span><span class="default">HomePage</span><span class="keyword">() {&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">'&lt;h1&gt;Homepage&lt;/h1&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">'&lt;p&gt;&lt;a href="?action=LogIn"&gt;LogIn&lt;/a&gt;&lt;/p&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">'&lt;p&gt;&lt;a href="?action=LogOut"&gt;LogOut&lt;/a&gt;&lt;/p&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">'&lt;p&gt;&lt;a href="?action=SecureContent"&gt;Secure Content&lt;/a&gt;&lt;/p&gt;'</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">LogIn</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$session_id </span><span class="keyword">= </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'session_id'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; while (!</span><span class="default">IsAuthenticated</span><span class="keyword">()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic realm="' </span><span class="keyword">. </span><span class="default">$session_id </span><span class="keyword">. </span><span class="string">'"'</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.1 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">'Authorization Required'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; if (!empty(</span><span class="default">$url</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">TRUE</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Location: /auth/" </span><span class="keyword">. </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'session_id'</span><span class="keyword">] . </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">, </span><span class="default">301</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
}&nbsp; &nbsp; <br />
<br />
function </span><span class="default">LogOut</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_destroy</span><span class="keyword">(); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_unset</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'session_id'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Location: /auth/"</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">, </span><span class="default">301</span><span class="keyword">);&nbsp; &nbsp; <br />
}<br />
<br />
function </span><span class="default">SecureContent</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">LogIn</span><span class="keyword">(</span><span class="string">"SecureContent"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">'&lt;h1&gt;Secure Content&lt;/h1&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">'&lt;p&gt;This is secure content&lt;/p&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">'&lt;p&gt;&lt;a href="/auth/' </span><span class="keyword">. </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'session_id'</span><span class="keyword">] . </span><span class="string">'/?action=HomePage"&gt;Home Page&lt;/a&gt;&lt;/p&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">'&lt;h1&gt;Not Authorized&lt;/h1&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function </span><span class="default">IsAuthenticated</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) &amp;&amp; isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$httpd_username </span><span class="keyword">= </span><span class="default">filter_var</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">], </span><span class="default">FILTER_SANITIZE_STRING</span><span class="keyword">, </span><span class="default">FILTER_FLAG_ENCODE_HIGH</span><span class="keyword">|</span><span class="default">FILTER_FLAG_ENCODE_LOW</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$httpd_password </span><span class="keyword">= </span><span class="default">filter_var</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">], </span><span class="default">FILTER_SANITIZE_STRING</span><span class="keyword">, </span><span class="default">FILTER_FLAG_ENCODE_HIGH</span><span class="keyword">|</span><span class="default">FILTER_FLAG_ENCODE_LOW</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$httpd_username </span><span class="keyword">== </span><span class="string">"test" </span><span class="keyword">&amp;&amp; </span><span class="default">$httpd_password </span><span class="keyword">== </span><span class="string">"test"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">TRUE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Both files need to be put in a folder named /auth for these examples to work. You can change the folder name in the index.php example to suit your own environment.<br />
<br />
A the start of the script a unique id is generated through PHP session mechanism and this session id is inserted into the url (hence the requirement for mod_rewrite to catch these urls). A redirect takes place to this new url and the homepage is shown. If you click on login a 401 header is generated using a realm that uses the same session id. If you click logout the current session id is destroyed and you are redirected to the start of the script where a new session id is generated. If you click on a protected item without a login the login function is called.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93427""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#93427" class="date">09-Sep-2009 10:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The regex in http_digest_parse from Example #2 does not work for me (PHP 5.2.6), because back references are not allowed in a character class.&nbsp; This worked for me:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// function to parse the http auth header<br />
</span><span class="keyword">function </span><span class="default">http_digest_parse</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; </span><span class="comment">// protect against missing data<br />
&nbsp;&nbsp; </span><span class="default">$needed_parts </span><span class="keyword">= array(</span><span class="string">'nonce'</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">, </span><span class="string">'nc'</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">, </span><span class="string">'cnonce'</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">, </span><span class="string">'qop'</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">, </span><span class="string">'username'</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">, </span><span class="string">'uri'</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">, </span><span class="string">'response'</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'@(\w+)=(?:(?:\'([^\']+)\'|"([^"]+)")|([^\s,]+))@'</span><span class="keyword">, </span><span class="default">$txt</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">, </span><span class="default">PREG_SET_ORDER</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; foreach (</span><span class="default">$matches </span><span class="keyword">as </span><span class="default">$m</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$data</span><span class="keyword">[</span><span class="default">$m</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]] = </span><span class="default">$m</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] ? </span><span class="default">$m</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] : (</span><span class="default">$m</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] ? </span><span class="default">$m</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] : </span><span class="default">$m</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; unset(</span><span class="default">$needed_parts</span><span class="keyword">[</span><span class="default">$m</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]]);<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; return </span><span class="default">$needed_parts </span><span class="keyword">? </span><span class="default">false </span><span class="keyword">: </span><span class="default">$data</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93376""></a>
  <div class="note">
   <strong class="user">s dot i dot g at gmx dot com</strong>
   <a href="#93376" class="date">06-Sep-2009 12:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// try to mimic cpanel logout style<br />
// only diff is usr &amp; pwd field is cleared when re-login<br />
// tested with ff2 &amp; ie8<br />
<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
<br />
</span><span class="default">$username </span><span class="keyword">= </span><span class="string">"test"</span><span class="keyword">;<br />
</span><span class="default">$password </span><span class="keyword">= </span><span class="string">"test"</span><span class="keyword">;<br />
<br />
if(isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'logout'</span><span class="keyword">]))<br />
{<br />
&nbsp; unset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">"login"</span><span class="keyword">]);<br />
&nbsp; echo </span><span class="string">"You have logout ... "</span><span class="keyword">;<br />
&nbsp; echo </span><span class="string">"[&lt;a href='" </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">] . </span><span class="string">"'&gt;Login&lt;/a&gt;]"</span><span class="keyword">;<br />
&nbsp; exit;<br />
}<br />
<br />
if (!isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) || !isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">]) || !isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">"login"</span><span class="keyword">]))<br />
{<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"WWW-Authenticate: Basic realm=\"Test\""</span><span class="keyword">);<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"HTTP/1.0 401 Unauthorized"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">"login"</span><span class="keyword">] = </span><span class="default">true</span><span class="keyword">;<br />
&nbsp; echo </span><span class="string">"You are unauthorized ... "</span><span class="keyword">;<br />
&nbsp; echo </span><span class="string">"[&lt;a href='" </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">] . </span><span class="string">"'&gt;Login&lt;/a&gt;]"</span><span class="keyword">;<br />
&nbsp; exit;<br />
}<br />
else<br />
{<br />
&nbsp; if(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">] == </span><span class="default">$username </span><span class="keyword">&amp;&amp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">] == </span><span class="default">$password</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"You have logged in ... "</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"[&lt;a href='" </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">] . </span><span class="string">"?logout'&gt;Logout&lt;/a&gt;]"</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; else<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">"login"</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Location: " </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">]);<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// content here<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91770""></a>
  <div class="note">
   <strong class="user">norther</strong>
   <a href="#91770" class="date">25-Jun-2009 12:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using PHP + IIS, make sure to set HTTP Error 401;5 to Default in IIS directory config. Otherwise it won't prompt for username and password but just show an error message.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90324""></a>
  <div class="note">
   <strong class="user">jon at toolz4schoolz dot com</strong>
   <a href="#90324" class="date">16-Apr-2009 06:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I can't get the second example to work. The regular expression is beyond the scope of this programmer so I rewrote it as seven easy-to-read regular expressions and it works.<br />
<br />
Here's the whole function http_digest_parse() that works for me:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// function to parse the http auth header<br />
</span><span class="keyword">function </span><span class="default">http_digest_parse</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">) {<br />
<br />
</span><span class="comment">// protect against missing data<br />
/*<br />
$needed_parts = array('nonce'=&gt;1, 'nc'=&gt;1, 'cnonce'=&gt;1, 'qop'=&gt;1, 'username'=&gt;1, 'uri'=&gt;1, 'response'=&gt;1);<br />
$data = array();<br />
<br />
preg_match_all('@(\w+)=(?:([\'"])([^\2]+)\2|([^\s,]+))@', $txt, $matches, PREG_SET_ORDER);<br />
<br />
foreach ($matches as $m) {<br />
&nbsp;&nbsp;&nbsp; $data[$m[1]] = $m[3] ? $m[3] : $m[4];<br />
&nbsp;&nbsp;&nbsp; unset($needed_parts[$m[1]]);<br />
}<br />
*/<br />
<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/username=\"([^\"]+)\"/i"</span><span class="keyword">, </span><span class="default">$txt</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">] = </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/nonce=\"([^\"]+)\"/i'</span><span class="keyword">, </span><span class="default">$txt</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="string">'nonce'</span><span class="keyword">] = </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/nc=([0-9]+)/i'</span><span class="keyword">, </span><span class="default">$txt</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="string">'nc'</span><span class="keyword">] = </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/cnonce=\"([^\"]+)\"/i'</span><span class="keyword">, </span><span class="default">$txt</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="string">'cnonce'</span><span class="keyword">] = </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/qop=([^,]+)/i'</span><span class="keyword">, </span><span class="default">$txt</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="string">'qop'</span><span class="keyword">] = </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/uri=\"([^\"]+)\"/i'</span><span class="keyword">, </span><span class="default">$txt</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="string">'uri'</span><span class="keyword">] = </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/response=\"([^\"]+)\"/i'</span><span class="keyword">, </span><span class="default">$txt</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="string">'response'</span><span class="keyword">] = </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
<br />
</span><span class="comment">//return $needed_parts ? false : $data;<br />
</span><span class="keyword">return </span><span class="default">$data</span><span class="keyword">;<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88957""></a>
  <div class="note">
   <strong class="user">Yuriy</strong>
   <a href="#88957" class="date">15-Feb-2009 06:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Good day.<br />
Sorry for my english.<br />
This example shows programming "LOGIN", "LOGOUT" and "RE-LOGIN".<br />
This script must use in the protected pages.<br />
For work this script the browser address string must be following:<br />
"<a href="http://localhost/admin/?login" rel="nofollow" target="_blank">http://localhost/admin/?login</a>" - for Login,<br />
"<a href="http://localhost/admin/?logout" rel="nofollow" target="_blank">http://localhost/admin/?logout</a>" - for Logout,<br />
"<a href="http://localhost/admin/?logout&amp;login" rel="nofollow" target="_blank">http://localhost/admin/?logout&amp;login</a>" - for Re-Login.<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
<br />
</span><span class="default">$authorized </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
</span><span class="comment"># LOGOUT<br />
</span><span class="keyword">if (isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'logout'</span><span class="keyword">]) &amp;&amp; !isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"login"</span><span class="keyword">]) &amp;&amp; isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'auth'</span><span class="keyword">]))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">session_name</span><span class="keyword">()]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_destroy</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"logging out..."</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment"># checkup login and password<br />
</span><span class="keyword">if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) &amp;&amp; isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">]))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$user </span><span class="keyword">= </span><span class="string">'test'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pass </span><span class="keyword">= </span><span class="string">'test'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if ((</span><span class="default">$user </span><span class="keyword">== </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) &amp;&amp; (</span><span class="default">$pass </span><span class="keyword">== (</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">])) &amp;&amp; isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'auth'</span><span class="keyword">]))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$authorized </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment"># login<br />
</span><span class="keyword">if (isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"login"</span><span class="keyword">]) &amp;&amp; !</span><span class="default">$authorized </span><span class="keyword">||<br />
</span><span class="comment"># relogin<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"login"</span><span class="keyword">]) &amp;&amp; isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"logout"</span><span class="keyword">]) &amp;&amp; !isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'reauth'</span><span class="keyword">]))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic Realm="Login please"'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'auth'</span><span class="keyword">] = </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'reauth'</span><span class="keyword">] = </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Login now or forever hold your clicks..."</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; exit;<br />
}<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'reauth'</span><span class="keyword">] = </span><span class="default">null</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>&lt;h1&gt;you have &lt;? echo ($authorized) ? (isset($_GET["login"]) &amp;&amp; isset($_GET["logout"]) ? 're' : '') : 'not '; ?&gt;logged!&lt;/h1&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87685""></a>
  <div class="note">
   <strong class="user">byoung at bigbluehat dot com</strong>
   <a href="#87685" class="date">16-Dec-2008 12:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The sample from danja at k0a1a dot net is great for getting started. However, it has some typos. Below is a slightly revised version that should work "out of the box":<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
<br />
</span><span class="default">$authorized </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
if(isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'logout'</span><span class="keyword">]) &amp;&amp; (</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'auth'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'auth'</span><span class="keyword">] = </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_destroy</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"logging out..."</span><span class="keyword">;<br />
}<br />
<br />
if(isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) &amp;&amp; isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$user </span><span class="keyword">= </span><span class="string">'test'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pass </span><span class="keyword">= </span><span class="string">'test'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if ((</span><span class="default">$user </span><span class="keyword">== </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) &amp;&amp; (</span><span class="default">$pass </span><span class="keyword">== (</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">])) &amp;&amp; (!empty(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'auth'</span><span class="keyword">]))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$authorized </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
if (isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"login"</span><span class="keyword">]) &amp;&amp; (! </span><span class="default">$authorized</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic Realm="Login please"'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'auth'</span><span class="keyword">] = </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">'Login now or forever hold your clicks...'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; exit;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
&lt;h1&gt;you have &lt;? echo ($authorized) ? '' : 'not'; ?&gt; logged!&lt;/h1&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85793""></a>
  <div class="note">
   <strong class="user">danja at k0a1a dot net</strong>
   <a href="#85793" class="date">17-Sep-2008 09:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a simplistic login/logout script, mainly for development of user-customizable pages.<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
<br />
</span><span class="default">$autorized </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
if(isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'logout'</span><span class="keyword">]) &amp;&amp; (</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'auth'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'auth'</span><span class="keyword">] = </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_destroy</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"logging out..."</span><span class="keyword">;<br />
}<br />
<br />
if(isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) &amp;&amp; isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$user </span><span class="keyword">= </span><span class="default">test</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pass </span><span class="keyword">= </span><span class="default">test</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if ((</span><span class="default">$user </span><span class="keyword">== </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) &amp;&amp; (</span><span class="default">$pass </span><span class="keyword">== (</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">])) &amp;&amp; (</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'auth'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$authorized </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
if (isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"login"</span><span class="keyword">]) &amp;&amp; (! </span><span class="default">$authorized</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic Realm="Login please"'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'auth'</span><span class="keyword">] = </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">'Login now or forever hold your clicks...'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; exit;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
&lt;h1&gt;you have &lt;? echo ($authorized) ? '' : 'not'; ?&gt; logged!&lt;/h1&gt;<br />
<br />
&lt;?<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85485""></a>
  <div class="note">
   <strong class="user">fakeraol at hotmail dot com</strong>
   <a href="#85485" class="date">02-Sep-2008 02:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
please remove my other posting, it was just a quickfix.<br />
here is a real solution for both auth-digest-example and the contribution of AlexTM, witch does not work with Internet Explorer:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">http_digest_parse</span><span class="keyword">(</span><span class="default">$digest</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment"># edit needed parts, as you&nbsp; want<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'@(username|nonce|uri|nc|cnonce|qop|response)'</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'=[\'"]?([^\'",]+)@'</span><span class="keyword">, </span><span class="default">$digest</span><span class="keyword">, </span><span class="default">$t</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">array_combine</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$t</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment"># all parts found?<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)==</span><span class="default">7</span><span class="keyword">) ? </span><span class="default">$data </span><span class="keyword">: </span><span class="default">false</span><span class="keyword">; <br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84593""></a>
  <div class="note">
   <strong class="user">yaqy at qq dot com</strong>
   <a href="#84593" class="date">20-Jul-2008 10:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
* qq: 290359552<br />
* return string : "error" or array("user","pass");<br />
*/<br />
</span><span class="keyword">function </span><span class="default">auth</span><span class="keyword">()<br />
{<br />
&nbsp;&nbsp;&nbsp; if (!isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic realm="My Realm"'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"error"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array( </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">] , </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">] );<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="comment">// test:<br />
</span><span class="default">$au</span><span class="keyword">= </span><span class="default">auth</span><span class="keyword">();<br />
</span><span class="default">print_r</span><span class="keyword">( </span><span class="default">$au </span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82565""></a>
  <div class="note">
   <strong class="user">silkensedai at online dot fr</strong>
   <a href="#82565" class="date">16-Apr-2008 09:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is my code for basic authentification login/logout.<br />
<br />
Include that code before any of your files:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">redirect_back</span><span class="keyword">(</span><span class="default">$http</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">, </span><span class="default">$html</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">, </span><span class="default">$back</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$back</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'referer'</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$back </span><span class="keyword">= </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'referer'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//}elseif(isset($_SERVER['HTTP_REFERER'])){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //&nbsp; &nbsp; $back = isset($_SERVER['HTTP_REFERER']);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$back </span><span class="keyword">= </span><span class="string">"index.html"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$http</span><span class="keyword">) </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Location: </span><span class="default">$back</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$html</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$back </span><span class="keyword">= </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$back</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print &lt;&lt;&lt;EOF<br />
</span><span class="string">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "<a href="http://www.w3.org/TR/html4/strict.dtd" rel="nofollow" target="_blank">http://www.w3.org/TR/html4/strict.dtd</a>"&gt;<br />
&lt;html&gt;<br />
&nbsp; &lt;head&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;meta http-equiv="refresh" content="0; url=</span><span class="default">$back</span><span class="string">"&gt;<br />
&nbsp; &lt;/head&gt;<br />
&nbsp; &lt;body&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;h1&gt;HTTP/1.0 401 Unauthorized&lt;/h1&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;p&gt;&lt;a href="</span><span class="default">$back</span><span class="string">"&gt;Go back&lt;/a&gt;&lt;/p&gt;<br />
&nbsp; &lt;/body&gt;<br />
&lt;/html&gt;<br />
</span><span class="keyword">EOF;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">$userid </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$username </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
if(isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) and </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$username </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$userid </span><span class="keyword">= </span><span class="default">authenticate</span><span class="keyword">(</span><span class="default">$username</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$userid</span><span class="keyword">===</span><span class="default">false</span><span class="keyword">) </span><span class="default">$username</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">; </span><span class="comment">// login failed<br />
</span><span class="keyword">}<br />
</span><span class="comment">// If login succeeded (we have a username) or logout succeeded (no username)<br />
</span><span class="keyword">if(isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'login'</span><span class="keyword">]) &amp;&amp; </span><span class="default">$username </span><span class="keyword">|| isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'logout'</span><span class="keyword">]) &amp;&amp; !</span><span class="default">$username</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Go back<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">redirect_back</span><span class="keyword">();<br />
}elseif(isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'login'</span><span class="keyword">]) || isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'logout'</span><span class="keyword">])){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Ask for password<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic realm=""'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">redirect_back</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
You have to test of $username is not false if you want to be sure the user is authenticated.<br />
<br />
Example of use in HTML code:<br />
<br />
<span class="default">&lt;?php </span><span class="keyword">if(</span><span class="default">$username</span><span class="keyword">){ </span><span class="default">?&gt;<br />
</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p&gt;You are logged in with username <span class="default">&lt;?php </span><span class="keyword">print </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$username</span><span class="keyword">); </span><span class="default">?&gt;</span>.&lt;/p&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;ul&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;li&gt;&lt;a href="?logout&amp;amp;referer=<span class="default">&lt;?php </span><span class="keyword">print </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">])); </span><span class="default">?&gt;</span>"&gt;logout&lt;/a&gt;&lt;/li&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/ul&gt;<br />
<span class="default">&lt;?php </span><span class="keyword">}else{ </span><span class="default">?&gt;<br />
</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p&gt;You are anonymous.&lt;/p&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;ul&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;li&gt;&lt;a href="?login&amp;amp;referer=<span class="default">&lt;?php </span><span class="keyword">print </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">])); </span><span class="default">?&gt;</span>"&gt;login&lt;/a&gt;&lt;/li&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/ul&gt;<br />
<span class="default">&lt;?php </span><span class="keyword">} </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81769""></a>
  <div class="note">
   <strong class="user">AlexTM - alextm84 at gmail dot com</strong>
   <a href="#81769" class="date">12-Mar-2008 04:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
/* Bug fix of my previous note: a dot was missing */<br />
<br />
I have written this code to use the Digest<br />
authentication with PHP on both APACHE<br />
and IIS_ISAPI.<br />
This code fixes the differences between<br />
the two modules.<br />
<br />
I hope this will help.<br />
<br />
AlexTM - Alessandro Cosci <br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; session_start</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$realm </span><span class="keyword">= </span><span class="string">'My Realm'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$logged </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//user =&gt; password<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$users </span><span class="keyword">= array(</span><span class="string">'user1' </span><span class="keyword">=&gt; </span><span class="string">'psw1'</span><span class="keyword">, </span><span class="string">'user2' </span><span class="keyword">=&gt; </span><span class="string">'psw2'</span><span class="keyword">); </span><span class="comment">// ...<br />
<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // We need to test which server authentication variable to use<br />
&nbsp;&nbsp;&nbsp; // because the PHP ISAPI module in IIS acts different from CGI<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_DIGEST'</span><span class="keyword">]))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$auth_data </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_DIGEST'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$isapi </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; elseif(isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_AUTHORIZATION'</span><span class="keyword">]))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$auth_data </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_AUTHORIZATION'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$isapi </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$auth_data </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* The $_SESSION['error_prompted'] variabile is used to ask<br />
&nbsp;&nbsp; &nbsp; &nbsp; the password again if none given or if the user enters<br />
&nbsp;&nbsp; &nbsp; &nbsp; a wrong auth. informations. */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (</span><span class="default">$auth_data </span><span class="keyword">== </span><span class="string">""</span><span class="keyword">) ||<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'error_prompted'</span><span class="keyword">]) &amp;&amp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'error_prompted'</span><span class="keyword">]==</span><span class="default">true</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$uniqid </span><span class="keyword">= </span><span class="default">uniqid</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">); </span><span class="comment">// Empty argument for backward compatibility<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'error_prompted'</span><span class="keyword">] = </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.1 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Digest realm="'</span><span class="keyword">.</span><span class="default">$realm</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'" qop="auth" nonce="'</span><span class="keyword">.</span><span class="default">$uniqid</span><span class="keyword">.</span><span class="string">'" opaque="'</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">$realm</span><span class="keyword">).</span><span class="string">'"'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"You're not allowed to access this page."</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// We need to retrieve authentication informations from the $auth_data variable<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(!</span><span class="default">$isapi</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// CGI doesn't add backslashes to the authentication informations<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // and doesn't prepend the "Digest " string before username.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Furthermore it doesn't enclose the "qop" field between double quotes<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/username="(?P&lt;username&gt;.*)"' </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*realm="(?P&lt;realm&gt;.*)"' </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*nonce="(?P&lt;nonce&gt;.*)"' </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*uri="(?P&lt;uri&gt;.*)"' </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*response="(?P&lt;response&gt;.*)"' </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*opaque="(?P&lt;opaque&gt;.*)"' </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*qop=(?P&lt;qop&gt;.*)' </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*nc=(?P&lt;nc&gt;.*)' </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*cnonce="(?P&lt;cnonce&gt;.*)"/i'</span><span class="keyword">, </span><span class="default">$auth_data</span><span class="keyword">, </span><span class="default">$digest</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ISAP adds backslashes to the authentication informations<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // and prependa the "Digest " string before username.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Furthermore it encloses the "qop" field between double quotes<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/digest\susername="(?P&lt;username&gt;.*)"' </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*realm="(?P&lt;realm&gt;.*)"' </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*nonce="(?P&lt;nonce&gt;.*)"' </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*uri="(?P&lt;uri&gt;.*)"' </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*response="(?P&lt;response&gt;.*)"' </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*opaque="(?P&lt;opaque&gt;.*)"' </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*qop=(?P&lt;qop&gt;.*)' </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*nc=(?P&lt;nc&gt;.*)' </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">',\s*cnonce="(?P&lt;cnonce&gt;.*)"/i'</span><span class="keyword">, </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$auth_data</span><span class="keyword">), </span><span class="default">$digest</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Sometimes ISAPI uses qop="auth", and sometimes it uses qop=auth<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$digest</span><span class="keyword">[</span><span class="string">'qop'</span><span class="keyword">] = </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\""</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$digest</span><span class="keyword">[</span><span class="string">'qop'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">$users</span><span class="keyword">[</span><span class="default">$digest</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">]]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'error_prompted'</span><span class="keyword">] = </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">'Username not valid!'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// This is the valid response expected<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$A1 </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">$digest</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">] . </span><span class="string">':' </span><span class="keyword">. </span><span class="default">$realm </span><span class="keyword">. </span><span class="string">':' </span><span class="keyword">. </span><span class="default">$users</span><span class="keyword">[</span><span class="default">$digest</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">]]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$A2 </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_METHOD'</span><span class="keyword">].</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$digest</span><span class="keyword">[</span><span class="string">'uri'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$valid_response </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">$A1</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$digest</span><span class="keyword">[</span><span class="string">'nonce'</span><span class="keyword">].</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$digest</span><span class="keyword">[</span><span class="string">'nc'</span><span class="keyword">].</span><span class="string">':'</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$digest</span><span class="keyword">[</span><span class="string">'cnonce'</span><span class="keyword">].</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$digest</span><span class="keyword">[</span><span class="string">'qop'</span><span class="keyword">].</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$A2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$digest</span><span class="keyword">[</span><span class="string">'response'</span><span class="keyword">] != </span><span class="default">$valid_response</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$error_message </span><span class="keyword">= </span><span class="string">'Wrong Credentials!'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'error_prompted'</span><span class="keyword">] = </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Ok, valid user/password<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">'You are logged in as: ' </span><span class="keyword">. </span><span class="default">$digest</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$logged </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81676""></a>
  <div class="note">
   <strong class="user">yuriry at gmail dot com</strong>
   <a href="#81676" class="date">09-Mar-2008 08:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This example did not work for me too.&nbsp; The problem is only the second branch matches.&nbsp; This is why the trimming was required in the previous post.&nbsp; In addition, if there are spaces in the realm name, the second branch truncates the name.<br />
<br />
I started from a simple regular expression to at least get the right number of matches:<br />
<br />
&nbsp; preg_match_all('@(\w+)=[^,]+,?@', <br />
&nbsp;&nbsp;&nbsp; $txt, $matches, PREG_SET_ORDER);<br />
<br />
The next step was to replace [^,]+ with the right sub-patterns to distinguish between quoted and non-quoted values:<br />
<br />
&nbsp; preg_match_all('@(\w+)=(?:([\'"])([^\'"]+)(?:\2)|(\w+)),?@', <br />
&nbsp;&nbsp;&nbsp; $txt, $matches, PREG_SET_ORDER);<br />
<br />
Branch ([\'"])([^\'"]+)(?:\2) matches quoted values and branch (\w+) matches non-quoted values.<br />
<br />
The problem with the first branch is that the middle sub-pattern ([^\'"]+) matches both single and double quotes, and the author definitely intended to use back-references to solve it.&nbsp; Unfortunately, I could not figure out how to use back-references inside a character class.&nbsp; From the documentation it does not seem possible and I ended up duplicating ([\'"])([^\'"]+)(?:\2) branch to deal with single and double quotes separately:<br />
<br />
&nbsp; preg_match_all(<br />
&nbsp;&nbsp;&nbsp; '@(\w+)=(?:([\'])([^\']+)(?:\2)|(["])([^"]+)(?:\4)|(\w+)),?@', <br />
&nbsp;&nbsp;&nbsp; $txt, $matches, PREG_SET_ORDER);<br />
<br />
The assignment to the $data array in the foreach loop needs to be changed to reflect different number of sub-patterns:<br />
<br />
&nbsp; $data[$m[1]] = $m[6] ? $m[6] : ($m[5] ? $m[5] : $m[3]);<br />
<br />
Note that no trimming is required and the expression handles spaces in quoted values.&nbsp; It would also be interesting to know if it is possible to use back-references inside a character class.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81049""></a>
  <div class="note">
   <strong class="user">Lars Stecken</strong>
   <a href="#81049" class="date">12-Feb-2008 10:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To anybody who tried the digest example above and didn't get it to work.<br />
<br />
For me the problem seemed to be the deprecated use of '\' (backslash) in the regex instead of the '$' (Dollar) to indicate a backreference. Also the results have to be trimmed off the remaining double and single quotes. <br />
<br />
Here's the working example:<br />
<br />
// function to parse the http auth header<br />
function http_digest_parse($txt)<br />
{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // protect against missing data<br />
&nbsp;&nbsp;&nbsp; $needed_parts = array('nonce'=&gt;1, 'nc'=&gt;1, 'cnonce'=&gt;1, 'qop'=&gt;1, 'username'=&gt;1, 'uri'=&gt;1, 'response'=&gt;1);<br />
&nbsp;&nbsp;&nbsp; $data = array();<br />
<br />
&nbsp;&nbsp;&nbsp; preg_match_all('@(\w+)=(?:([\'"])([^$2]+)$2|([^\s,]+))@', $txt, $matches, PREG_SET_ORDER);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach ($matches as $m) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $data[$m[1]] = $m[3] ? trim($m[3],"\",'") : trim($m[4],"\",'"); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset($needed_parts[$m[1]]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return $needed_parts ? false : $data;<br />
}<br />
<br />
Probably there's a more sophisticated way to trim the quotes within the regex, but I couldn't be bothered :-)<br />
<br />
Greets, Lars</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78444""></a>
  <div class="note">
   <strong class="user">mt at shrewsbury dot org dot uk</strong>
   <a href="#78444" class="date">12-Oct-2007 02:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On my servers here, the standard rewrite spell<br />
<br />
RewriteRule .* - [E=REMOTE_USER:%{HTTP:Authorization},L]<br />
<br />
to set $_SERVER[REMOTE_USER] with digest authentication results in the entire digest being bundled into $_SERVER[REMOTE_USER]<br />
<br />
I have used this :<br />
<br />
RewriteCond %{HTTP:Authorization} username=\"([^\"]+)\"<br />
RewriteRule .* - [E=REMOTE_USER:%1,L]<br />
<br />
And it seems to work successfully.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76708""></a>
  <div class="note">
   <strong class="user">gbelyh at gmail dot com</strong>
   <a href="#76708" class="date">26-Jul-2007 11:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Back to the autherisation in CGI mode. this is the full working example:<br />
<br />
#&nbsp; Create the .htaccess file with following contents:<br />
# also you can use the condition (search at this page)<br />
RewriteEngine on<br />
RewriteRule .* - [E=REMOTE_USER:%{HTTP:Authorization},L]<br />
<br />
# In the beginning the script checking the authorization place the code:<br />
<br />
$userpass = base64_decode(substr($_SERVER["REDIRECT_REMOTE_USER"],6)) ;<br />
<br />
$userpass = explode(":", $userpass);<br />
<br />
if (&nbsp; count($userpass) == 2&nbsp; ){<br />
&nbsp;&nbsp; &nbsp; #this part work not for all.<br />
&nbsp;&nbsp; &nbsp; #print_r($userpass);die; #&lt;- this can help find out right username and password<br />
&nbsp;&nbsp; &nbsp; list($name, $password) = explode(':', $userpass);<br />
&nbsp;&nbsp; &nbsp; $_SERVER['PHP_AUTH_USER'] = $name;<br />
&nbsp;&nbsp; &nbsp; $_SERVER['PHP_AUTH_PW'] = $password;<br />
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76652""></a>
  <div class="note">
   <strong class="user">tonwyatt at yahoo dot com</strong>
   <a href="#76652" class="date">24-Jul-2007 01:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is my attempt to create a digest authentication class that will log the user in and out without using a cookie,session,db,or file. At the core is this simple code to parse the digest string into variables works for several browsers.<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// explode the digest with multibrowser support by Tony Wyatt 21jun07<br />
</span><span class="keyword">public function </span><span class="default">explodethedigest</span><span class="keyword">(</span><span class="default">$instring</span><span class="keyword">) {<br />
</span><span class="default">$quote </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">;<br />
</span><span class="default">$equal </span><span class="keyword">= </span><span class="string">'='</span><span class="keyword">;<br />
</span><span class="default">$comma </span><span class="keyword">= </span><span class="string">','</span><span class="keyword">;<br />
</span><span class="default">$space </span><span class="keyword">= </span><span class="string">' '</span><span class="keyword">;<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="default">$comma</span><span class="keyword">, </span><span class="default">$instring</span><span class="keyword">);<br />
</span><span class="default">$ax </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$space</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="default">$equal</span><span class="keyword">, </span><span class="default">$ax</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$c </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="default">$equal</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$d </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="default">$equal</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$e </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="default">$equal</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">], </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$f </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="default">$equal</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">], </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$g </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="default">$equal</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">], </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$h </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="default">$equal</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">], </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="default">$equal</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">], </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$j </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="default">$equal</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">8</span><span class="keyword">], </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$k </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="default">$equal</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">9</span><span class="keyword">], </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$l </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="default">$equal</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">10</span><span class="keyword">], </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$parts </span><span class="keyword">= array(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])=&gt;</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">'"'</span><span class="keyword">), </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])=&gt;</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">'"'</span><span class="keyword">), </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$d</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])=&gt;</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$d</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">'"'</span><span class="keyword">), </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])=&gt;</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">'"'</span><span class="keyword">), </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])=&gt;</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">'"'</span><span class="keyword">), </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$g</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])=&gt;</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$g</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">'"'</span><span class="keyword">), </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])=&gt;</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">'"'</span><span class="keyword">), </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])=&gt;</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">'"'</span><span class="keyword">), </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$j</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])=&gt;</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$j</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">'"'</span><span class="keyword">), </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])=&gt;</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">'"'</span><span class="keyword">), </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$l</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])=&gt;</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$l</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">'"'</span><span class="keyword">));<br />
<br />
return </span><span class="default">$parts</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span>Give it a try at <a href="http://tokko.kicks-ass.net/tests/ta1.php Log in with user test password pass or user guest password guest. Go to page two for links to the code. Comments, ideas, suggestions, or critique welcome." rel="nofollow" target="_blank">http://tokko.kicks-ass.net/tests/ta1.php Log in with user test password pass or user guest password guest. Go to page two for links to the code. Comments, ideas, suggestions, or critique welcome.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76511""></a>
  <div class="note">
   <strong class="user">Jack Bates</strong>
   <a href="#76511" class="date">18-Jul-2007 01:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In writing the HTTP auth module for the Gallery project, we discovered the following tricks for logging out with HTTP authentication:<br />
<br />
Because most web browsers cache HTTP auth credentials, the Gallery logout link didn't work as expected after logging in with HTTP auth. Gallery correctly logged out the active user but the web browser simply logged in again with the next request.<br />
<br />
To work around this, the HTTP auth module listens for the Gallery::Logout event and delegates to the httpauth.TryLogout page if necessary: <a href="http://gallery.svn.sourceforge.net/viewvc/gallery" rel="nofollow" target="_blank">http://gallery.svn.sourceforge.net/viewvc/gallery</a><br />
/trunk/gallery2/modules/httpauth/TryLogout.inc?view=markup<br />
<br />
The TryLogout page tries clearing the browser's authentication cache by as many tricks possible:<br />
<br />
&nbsp;&nbsp;&nbsp; * Ask browser to authenticate with bogus authtype: <br />
<br />
GalleryUtilities::setResponseHeader('HTTP/1.0 401 Unauthorized', false);<br />
GalleryUtilities::setResponseHeader('WWW-Authenticate: Bogus', false);<br />
<br />
&nbsp;&nbsp;&nbsp; * Redirect with random username and password. This won't actually clear the browser's authentication cache but will replace it with an invalid username and password. Since Gallery ignores invalid HTTP auth credentials, this effectively logs the user out. <br />
<br />
&nbsp;&nbsp;&nbsp; * Clear Internet Explorer's authentication cache with JavaScript:<br />
<br />
&nbsp;try {ldelim}<br />
&nbsp;&nbsp; {* <a href="http://msdn.microsoft.com/workshop/author" rel="nofollow" target="_blank">http://msdn.microsoft.com/workshop/author</a><br />
/dhtml/reference/constants/clearauthenticationcache.asp *}<br />
&nbsp;&nbsp; document.execCommand("ClearAuthenticationCache");<br />
&nbsp;{rdelim} catch (exception) {ldelim}<br />
&nbsp;{rdelim}<br />
<br />
The TryLogout page redirects to the FinishLogout page for two resons:<br />
<br />
&nbsp;&nbsp; 1. To replace the browser's authentication cache with an invalid username and password<br />
&nbsp;&nbsp; 2. To check that the user was indeed logged out. If the user was logged out, the FinishLogout page redirects back to the Gallery application. Otherwise it displays a warning advising the user to manually clear their authentication cache (Clear Private Data in Firefox).<br />
<br />
The TryLogout page redirects to the FinishLogout page using JavaScript and falls back on a manual link. It can't use a 302 Found status because the page needs to load for the Internet Explorer JavaScript to execute and because we can't put an invalid username and password in a Location: header.<br />
<br />
<a href="http://codex.gallery2.org/Gallery2:Modules:httpauth" rel="nofollow" target="_blank">http://codex.gallery2.org/Gallery2:Modules:httpauth</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74271""></a>
  <div class="note">
   <strong class="user">rovok at web dot de</strong>
   <a href="#74271" class="date">03-Apr-2007 12:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
People are encouraged NOT to use register_globals, but Example 34.2. of german PHP documentation (<a href="http://de.php.net/manual/de/features.http-auth.php" rel="nofollow" target="_blank">http://de.php.net/manual/de/features.http-auth.php</a>) uses register_globals in their example, assumed that the example is the whole script.<br />
<br />
There is a &lt;form&gt; which has an &lt;input&gt; with type = "hidden", a name = "SeenBefore" and a value = "1". The Form is submitted by POST, so $SeenBefore should better be accessed by $_POST['SeenBefore'] instead of $SeenBefore.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73942""></a>
  <div class="note">
   <strong class="user">Dutchdavey</strong>
   <a href="#73942" class="date">16-Mar-2007 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My sincere thanks to: webmaster at kratia dot com 21-Feb-2007 01:53<br />
<br />
The principle is to not allow an invalid PHP_AUTH_USER to exist.<br />
<br />
The following easy peasy example using Oracle is based on his simple genius:<br />
<br />
///////////////////////////////////////////////////////////////<br />
//<br />
// do_html_header<br />
//<br />
// This function outputs the html header for the page.<br />
//<br />
//////////////////////////////////////////////////////////////////<br />
function initialize_session()<br />
{<br />
&nbsp;&nbsp; $err=error_reporting(0);<br />
&nbsp;&nbsp; $connection=oci_connect($_SERVER['PHP_AUTH_USER'],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $_SERVER['PHP_AUTH_PW'],$databasename) ;<br />
&nbsp;&nbsp; error_reporting($err);<br />
&nbsp;&nbsp; if (!$connection)<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; header('WWW-Authenticate: Basic Realm="ZEIP1"');<br />
&nbsp;&nbsp; &nbsp;&nbsp; header('HTTP/1.0 401 Unauthorized');<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo "Login Cancelled';<br />
&nbsp;&nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; ..<br />
&nbsp;&nbsp; Normal Code..<br />
&nbsp;&nbsp; ..<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73642""></a>
  <div class="note">
   <strong class="user">Nicolas Merlet - admin(at)merletn.org</strong>
   <a href="#73642" class="date">05-Mar-2007 09:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful using http digest authentication (see above, example 34.2) if you have to use the 'setlocale' function *before* validating response with the 'http_digest_parse' function, because there's a conflict with \w in the pattern of 'preg_match_all' function :<br />
<br />
In fact, as \w is supposed to be any letter or digit or the underscore character, you must not forgot that this may vary depending on your locale configuration (eg. it accepts accented letters in french)...<br />
<br />
Due to this different pattern interpretation by the 'preg_match_all' function, the 'http_digest_parse' function will always return a false result if you have modified your locale (I mean if your locale accepts some extended characters, see <a href="http://fr.php.net/manual/en/reference.pcre.pattern.syntax.php for further information" rel="nofollow" target="_blank">http://fr.php.net/manual/en/reference.pcre.pattern.syntax.php for further information</a>).<br />
<br />
IMHO, I suggest you not to use setlocale before having your authentication completed...<br />
<br />
PS : Here's a non-compatible setlocale declaration...<br />
setlocale ( LC_ALL, 'fr_FR', 'fr', 'FR', 'french', 'fra', 'france', 'French', 'fr_FR.ISO8859-1' ) ;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73386""></a>
  <div class="note">
   <strong class="user">webmaster at kratia dot com</strong>
   <a href="#73386" class="date">20-Feb-2007 04:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is the simplest form I found to do a Basic authorization with retries.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$valid_passwords </span><span class="keyword">= array (</span><span class="string">"mario" </span><span class="keyword">=&gt; </span><span class="string">"carbonell"</span><span class="keyword">);<br />
</span><span class="default">$valid_users </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$valid_passwords</span><span class="keyword">);<br />
<br />
</span><span class="default">$user </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">];<br />
</span><span class="default">$pass </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">];<br />
<br />
</span><span class="default">$validated </span><span class="keyword">= (</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">, </span><span class="default">$valid_users</span><span class="keyword">)) &amp;&amp; (</span><span class="default">$pass </span><span class="keyword">== </span><span class="default">$valid_passwords</span><span class="keyword">[</span><span class="default">$user</span><span class="keyword">]);<br />
<br />
if (!</span><span class="default">$validated</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic realm="My Realm"'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp; die (</span><span class="string">"Not authorized"</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// If arrives here, is a valid user.<br />
</span><span class="keyword">echo </span><span class="string">"&lt;p&gt;Welcome </span><span class="default">$user</span><span class="string">.&lt;/p&gt;"</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;p&gt;Congratulation, you are into the system.&lt;/p&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72973""></a>
  <div class="note">
   <strong class="user">mg at evolution515 dot net</strong>
   <a href="#72973" class="date">06-Feb-2007 04:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Example for digest doesn't work (at least for me):<br />
<br />
use this fix:<br />
--------------<br />
preg_match_all('@(\w+)=(?:(([\'"])(.+?)\3|([A-Za-z0-9/]+)))@', $txt, $matches, PREG_SET_ORDER);<br />
<br />
foreach ($matches as $m) {<br />
&nbsp;&nbsp;&nbsp; $data[$m[1]] = $m[4] ? $m[4] : $m[5];<br />
&nbsp;&nbsp;&nbsp; unset($needed_parts[$m[1]]);<br />
}<br />
<br />
It's also better to but to put the Auth-Digest-Header in a function and call it on unsuccessful authentification again. Otherwise users only have the chance to submit their username/password just one time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72020""></a>
  <div class="note">
   <strong class="user">bleuciell at aol dot com</strong>
   <a href="#72020" class="date">29-Dec-2006 12:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For admin , i repair a fault , all is good now<br />
Sorry for my english <br />
<br />
It's a piece of code , to give a piece of reflexion about simple auth , we can also cryp login and pass in db , time is here for non-replay , the code isn't finish , but it work , only for reflexion about auth mechanism<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ky</span><span class="keyword">( </span><span class="default">$txt</span><span class="keyword">,</span><span class="default">$crypt</span><span class="keyword">) { </span><span class="default">$key </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">$crypt</span><span class="keyword">); </span><span class="default">$cpt </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$var </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
for ( </span><span class="default">$Ctr </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$Ctr </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">); </span><span class="default">$Ctr</span><span class="keyword">++) { if (</span><span class="default">$cpt </span><span class="keyword">== </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$crypt</span><span class="keyword">)) </span><span class="default">$cpt </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$var</span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">,</span><span class="default">$Ctr</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">) ^ </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$crypt</span><span class="keyword">,</span><span class="default">$cpt</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">); </span><span class="default">$cpt</span><span class="keyword">++; } return </span><span class="default">$var</span><span class="keyword">; }<br />
<br />
</span><span class="default">$key </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;</span><span class="default">$list </span><span class="keyword">= </span><span class="string">'abcdefghijklmnopqrstuvwxyz0123456789'</span><span class="keyword">;<br />
for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt; </span><span class="default">200</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {&nbsp; </span><span class="default">$key </span><span class="keyword">.= </span><span class="default">$list</span><span class="keyword">{</span><span class="default">mt_rand</span><span class="keyword">() % </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">)}; }<br />
<br />
function </span><span class="default">cryp</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">){ </span><span class="default">srand</span><span class="keyword">((double)</span><span class="default">microtime</span><span class="keyword">()*</span><span class="default">735412</span><span class="keyword">);&nbsp; </span><span class="default">$crypt </span><span class="keyword">= </span><span class="default">crypt</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">3895234</span><span class="keyword">));</span><span class="default">$cpt </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$var</span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
for ( </span><span class="default">$Ctr</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$Ctr </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">); </span><span class="default">$Ctr</span><span class="keyword">++ ) { if (</span><span class="default">$cpt </span><span class="keyword">== </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$crypt</span><span class="keyword">))</span><span class="default">$cpt </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$var</span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$crypt</span><span class="keyword">,</span><span class="default">$cpt</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">).( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">,</span><span class="default">$Ctr</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">) ^ </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$crypt</span><span class="keyword">,</span><span class="default">$cpt</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">) ); </span><span class="default">$cpt</span><span class="keyword">++; } return </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">ky</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">) ); }<br />
<br />
function </span><span class="default">dcryp</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">){ </span><span class="default">$txt</span><span class="keyword">=</span><span class="default">ky</span><span class="keyword">(</span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">),</span><span class="default">$key</span><span class="keyword">);</span><span class="default">$var</span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
for ( </span><span class="default">$Ctr </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$Ctr </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">); </span><span class="default">$Ctr</span><span class="keyword">++ ) { </span><span class="default">$md5 </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">,</span><span class="default">$Ctr</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);</span><span class="default">$Ctr</span><span class="keyword">++; </span><span class="default">$var</span><span class="keyword">.= (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">,</span><span class="default">$Ctr</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">) ^ </span><span class="default">$md5</span><span class="keyword">); }return </span><span class="default">$var</span><span class="keyword">;}<br />
<br />
</span><span class="default">$time</span><span class="keyword">= </span><span class="default">time</span><span class="keyword">(); </span><span class="default">$user </span><span class="keyword">= </span><span class="default">cryp</span><span class="keyword">(</span><span class="string">'bubu'</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">); </span><span class="default">$pwd </span><span class="keyword">= </span><span class="default">cryp</span><span class="keyword">(</span><span class="string">'bubu-'</span><span class="keyword">.</span><span class="default">$time</span><span class="keyword">.</span><span class="string">''</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">);<br />
<br />
function </span><span class="default">pwd</span><span class="keyword">(</span><span class="default">$j</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">){ </span><span class="default">$x </span><span class="keyword">= </span><span class="default">dcryp</span><span class="keyword">(</span><span class="default">$j</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">); </span><span class="default">$x </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'-'</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">); return </span><span class="default">$x</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];}<br />
function </span><span class="default">pwd2</span><span class="keyword">(</span><span class="default">$j</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">){ </span><span class="default">$x </span><span class="keyword">= </span><span class="default">dcryp</span><span class="keyword">(</span><span class="default">$j</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">); </span><span class="default">$x </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'-'</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">); return </span><span class="default">$x</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];}<br />
<br />
function </span><span class="default">auth</span><span class="keyword">(){</span><span class="default">$realm</span><span class="keyword">=</span><span class="string">"Authentification PHPindex"</span><span class="keyword">;<br />
</span><span class="default">Header</span><span class="keyword">(</span><span class="string">"WWW-Authenticate: Basic realm='"</span><span class="keyword">.</span><span class="default">$realm</span><span class="keyword">.</span><span class="string">"'"</span><span class="keyword">);</span><span class="default">Header</span><span class="keyword">(</span><span class="string">"HTTP/1.0&nbsp; 401&nbsp; Unauthorized"</span><span class="keyword">);<br />
echo </span><span class="string">"Vous ne pouvez accder  cette page"</span><span class="keyword">; }<br />
<br />
if( !isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) &amp;&amp; !isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">]) ) {</span><span class="default">auth</span><span class="keyword">();<br />
} else {<br />
if( </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">] == </span><span class="default">dcryp</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">) &amp;&amp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">] == </span><span class="default">pwd</span><span class="keyword">(</span><span class="default">$pwd</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">) &amp;&amp; </span><span class="default">$time </span><span class="keyword">== </span><span class="default">pwd2</span><span class="keyword">(</span><span class="default">$pwd</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">)) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">''</span><span class="keyword">;<br />
<br />
} else{ </span><span class="default">auth</span><span class="keyword">();}}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71069""></a>
  <div class="note">
   <strong class="user">Whatabrain</strong>
   <a href="#71069" class="date">10-Nov-2006 07:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Back to the problem of authenticating in CGI mode... mcbethh suggested using this to set a local variable in php:<br />
RewriteRule .* - [E=REMOTE_USER:%{HTTP:Authorization},L]<br />
<br />
It didn't work. I couldn't see the variable. My solution is pretty round-about, but it works:<br />
<br />
RewriteEngine on <br />
RewriteCond %{HTTP:Authorization} !^$ <br />
RewriteCond %{REQUEST_METHOD} =GET <br />
RewriteCond %{QUERY_STRING} ="" <br />
RewriteRule ^page.php$ page.php?login=%{HTTP:Authorization}$1 <br />
<br />
This causes the Auth string to be added to the URL if there are no parameters and it's a GET request. This prevents POSTs and parameter lists from being corrupted. <br />
<br />
Then, in the PHP script, I store the Auth string as a session cookie.<br />
<br />
So the only way to log in to my script is to go to the url with no parameters.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70864""></a>
  <div class="note">
   <strong class="user">admin at isprohosting dot com</strong>
   <a href="#70864" class="date">01-Nov-2006 06:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There are .htaccess which actually works for us (cPanel + phpsuexec) unless others failed. Perhaps it may help someone.<br />
<br />
# PHP (CGI mode) HTTP Authorization with ModRewrite:<br />
RewriteEngine on<br />
RewriteCond %{HTTP:Authorization} ^(.*)<br />
RewriteRule ^(.*) - [E=HTTP_AUTHORIZATION:%1]<br />
<br />
Then you need small piece of php code to parse this line and then everything will work like with mod_php:<br />
<br />
if (isset($_SERVER['HTTP_AUTHORIZATION']))<br />
{<br />
$ha = base64_decode( substr($_SERVER['HTTP_AUTHORIZATION'],6) );<br />
list($_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW']) = explode(':', $ha);<br />
unset $ha;<br />
}<br />
<br />
Enjoy!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70693""></a>
  <div class="note">
   <strong class="user">SlamJam</strong>
   <a href="#70693" class="date">23-Oct-2006 11:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I used Louis example (03-Jun-2006) and it works well for me (thanks).<br />
<br />
However, I added some lines, to make sure, the user does only get the Authentification-Window a few times:<br />
<br />
<span class="default">&lt;?php<br />
$realm </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">( </span><span class="default">1</span><span class="keyword">, </span><span class="default">1000000000</span><span class="keyword">).</span><span class="string">"@YourCompany"</span><span class="keyword">;<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'realm'</span><span class="keyword">] = </span><span class="default">$realm</span><span class="keyword">;<br />
<br />
</span><span class="comment">// In the beginning, when the realm ist defined:<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'CountTrials'</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
And then when it comes to check the authentification (ZEND-Tutorial):<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Not more than 3 Trials<br />
</span><span class="keyword">if (!</span><span class="default">$auth</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'CountTrials'</span><span class="keyword">]++;<br />
&nbsp;&nbsp; if (</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'CountTrials'</span><span class="keyword">] == </span><span class="default">4</span><span class="keyword">) {&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">session_destroy</span><span class="keyword">() ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Location: noentry.php'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; exit ;&nbsp;&nbsp; <br />
&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"WWW-Authenticate: Basic realm="</span><span class="keyword">.</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'realm'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"HTTP/1.0 401 Unauthorized"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="string">'Authorization Required.'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; exit;<br />
&nbsp;&nbsp; }<br />
} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;P&gt;You are authorized!&lt;/P&gt;'</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
noentry.php is slightely different from comeagain.php.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70305""></a>
  <div class="note">
   <strong class="user">roychri at php dot net</strong>
   <a href="#70305" class="date">10-Oct-2006 08:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For PHP with CGI, make sure you put the rewrite rule above any other rewrite rule you might have.<br />
<br />
In my case, I put this at the top of the .htaccess (below RewriteEngine On):<br />
RewriteRule .* - [E=REMOTE_USER:%{HTTP:Authorization}]<br />
<br />
My symptom was that the REMOTE_USER (or REDIRECT_REMOTE_USER in my case) was not being set at all.<br />
The cause: I had some other RewriteRule that was kickin in and was set as LAST rule.<br />
I hope this helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68464""></a>
  <div class="note">
   <strong class="user">blah at blah dot com</strong>
   <a href="#68464" class="date">27-Jul-2006 12:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Getting PHP Authentication to work with CGI-bin.<br />
<br />
You must have mod_rewrite installed for this to work. In the directory (of the file) you want to protect, for the .htaccess file:<br />
<br />
# PHP (CGI mode) HTTP Authorization with ModRewrite:<br />
# most right example with header check for non empty:<br />
RewriteEngine on <br />
RewriteCond %{HTTP:Authorization}&nbsp; !^$<br />
RewriteRule ^test.php$ test.php?login=%{HTTP:Authorization} <br />
<br />
Change the Rewrite rule to whatever you want it to be. For simplicity, this example only applies to one file, test.php and only if the HTTP Authorization needs to take place.<br />
<br />
In the php file:<br />
&lt;?<br />
if (isset($_GET['login'])) {<br />
&nbsp;&nbsp;&nbsp; $d = base64_decode( substr($_GET['login'],6) );<br />
&nbsp;&nbsp;&nbsp; list($name, $password) = explode(':', $d);<br />
&nbsp;&nbsp;&nbsp; echo 'Name:' . $name . "&lt;br&gt;\n";<br />
&nbsp;&nbsp;&nbsp; echo 'Password:' . $password . "&lt;br&gt;\n";<br />
} else {<br />
&nbsp;&nbsp; header('WWW-Authenticate: Basic realm="My Realm"');<br />
&nbsp;&nbsp; header('HTTP/1.0 401 Unauthorized');<br />
&nbsp;&nbsp; echo 'You are not authorized. Bad user, bad!';<br />
&nbsp;&nbsp; exit;<br />
}<br />
?&gt;<br />
<br />
You need to get rid of the first 6 characters for some reason, then decode the Auth data from its base64 format. Then it's a simple matter of extracting the data. You can even pass the data to the $_SERVER variables $_SERVER['PHP_AUTH_USER'] and $_SERVER['PHP_AUTH_PW']. These are the variables that get the login data if you have PHP running as an Apache module. This is useful for mods or plugins.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68088""></a>
  <div class="note">
   <strong class="user">web at kwi dot dk</strong>
   <a href="#68088" class="date">12-Jul-2006 10:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While Digest authentication is still far superior to Basic authentication, there are a number of security issues that one must keep in mind.<br />
<br />
In this respect, the Digest example given above is somewhat flawed, because the nonce never times out or otherwise become invalid. It thus becomes a password-equivalent (although to that specific URL only) and can be used by an eavesdropper to fetch the page at any time in the future, thus allowing the attacker to always access the latest version of the page, or (much worse) repeatedly invoke a CGI script -- for instance, if the user requests the URL "/filemanager?delete=somefile", the attacker can repeat this deletion at any point in the future, possibly after the file has been recreated.<br />
<br />
And while it might not be possible to change GET data without reauthentication, cookies and POST data *can* be changed.<br />
<br />
To protect against the first problem, the nonce can be made to include a timestamp, and a check added to ensure that nonces older than e.g. 30 minutes result in a new authentication request. <br />
<br />
To solve the second problem, a one-time only nonce needs to be generated -- that is, all further requests using a particular nonce must be refused.<br />
<br />
One way to do this: When the user requests an action such as "deletefile", store a randomly generated nonce in a session variable, issue a 401 authentication challenge with that nonce, and then check against the stored value when receiving the authentication (and clear the session variable).<br />
<br />
This way, although a possible eavesdropper receives the nonce and thus gains the ability to perform the action, he can only perform it once -- and the user was going to perform it anyway. (Only the user or the attacker, but not both, gets to perform the action, so it's safe.)<br />
<br />
Of course, at some point, the security can only be improved by switching to HTTPS / SSL / TLS (this is for instance the only way to defend against man-in-the-middle attacks). You decide the level of security.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67146""></a>
  <div class="note">
   <strong class="user">Louis</strong>
   <a href="#67146" class="date">03-Jun-2006 03:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I couldn't get authentication to work properly with any of the examples. Finally, I started from ZEND's tutorial example at:<br />
<a href="http://www.zend.com/zend/tut/authentication.php?article=authentication (validate using .htpasswd" rel="nofollow" target="_blank">http://www.zend.com/zend/tut/authentication.php?article=authentication (validate using .htpasswd</a>) and tried to deal with the additional cases. My general conclusion is that changing the realm is the only reliable way to cause the browser to ask again, and I like to thank the person who put that example in the manual, as it got me on the right path. No matter what, the browser refuses to discard the values that it already has in mind otherwise. The problem with changing the realm, of course, is that you don't want to do it within a given session, else it causes a new request for a password. So, here goes, hopefully the spacing isn't too messed up by the cut'n'paste.<br />
<br />
I spent the better part of a day getting this to work right. I had a very hard time thinking through what the browser does when it encounters an authentication request: seems to me that it tries to get the password, then reloads the page... so the HTML doesn't get run. At least, this was the case with IE, I haven't tested it with anything else.<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">() ;<br />
if (!isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'realm'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'realm'</span><span class="keyword">] = </span><span class="default">mt_rand</span><span class="keyword">( </span><span class="default">1</span><span class="keyword">, </span><span class="default">1000000000 </span><span class="keyword">).<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">" SECOND level: Enter your !!!COMPANY!!! password."</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">"WWW-Authenticate: Basic realm="</span><span class="keyword">.</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'realm'</span><span class="keyword">] );<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//&nbsp; Below here runs HTML-wise only if there isn't a $_SESSION,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // and the browser *can't* set $PHP_AUTH_USER... normally<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // the browser, having gotten the auth info, runs the page<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // again without getting here.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //&nbsp; What I'm basically getting to is that the way to get<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // here is to escape past the login screen. I tried<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // putting a session_destroy() here originally, but the<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // problem is that the PHP runs regardless, so the<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // REFRESH seems like the best way to deal with it.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"&lt;meta http-equiv=\"REFRESH\"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; content=\"0;url=index.php\"&gt;" </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
if (</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'logout'</span><span class="keyword">] == </span><span class="string">"logout"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_destroy</span><span class="keyword">() ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Location: comeagain.php'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
</span><span class="comment">// "standard" authentication code here, from the ZEND tutorial above.<br />
<br />
</span><span class="default">comeagain</span><span class="keyword">.</span><span class="default">php is </span><span class="keyword">as </span><span class="default">follows</span><span class="keyword">:<br />
<br />
&lt;?<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
unset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'realm'</span><span class="keyword">]);<br />
</span><span class="default">session_destroy</span><span class="keyword">();<br />
echo </span><span class="string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;Logged Out&lt;/title&gt;&lt;h1&gt;Logout Page&lt;/h1&gt;&lt;body&gt;" </span><span class="keyword">;<br />
echo </span><span class="string">"You have successfully logged out of TOGEN"</span><span class="keyword">;<br />
echo </span><span class="string">" at "</span><span class="keyword">.</span><span class="default">date</span><span class="keyword">(</span><span class="string">"h:m:s"</span><span class="keyword">).</span><span class="string">" on "</span><span class="keyword">.</span><span class="default">date</span><span class="keyword">(</span><span class="string">"d F Y"</span><span class="keyword">) ;<br />
echo </span><span class="string">"&lt;p&gt;&lt;a href=\"index.php\"&gt;Login Again&lt;/a&gt;" </span><span class="keyword">;<br />
echo </span><span class="string">"&lt;/body&gt;&lt;/html&gt;" </span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
The idea is to be able to trash the session (and thus reset the realm) without prompting the browser to ask again... because it has been redirected to logout.php.<br />
<br />
With this combination, I get things to work. Just make sure not to have apache run htpasswd authentication at the same time, then things get really weird :-).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66920""></a>
  <div class="note">
   <strong class="user">henrik at laurells dot net</strong>
   <a href="#66920" class="date">31-May-2006 11:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Above top example for digest mode dosn't work if you have safemode on. You need to add a dash and UID to the compare string to make it work. Something like this;;<br />
<br />
$A1 = md5($data['username'].':'. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $realm.'-'.getmyuid().':'. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $users[$data['username']]);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66468""></a>
  <div class="note">
   <strong class="user">kembl at example dot com</strong>
   <a href="#66468" class="date">23-May-2006 08:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
# PHP (CGI mode) HTTP Authorization with ModRewrite: <br />
# most right example with header check for non empty:<br />
&nbsp;RewriteEngine on<br />
&nbsp;RewriteCond %{HTTP:Authorization}&nbsp; !^$<br />
&nbsp;RewriteRule .* - [E=REMOTE_USER:%{HTTP:Authorization}, \<br />
E=PHP_AUTH_USER:%{HTTP:Authorization},L]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65801""></a>
  <div class="note">
   <strong class="user">cyberscribe at php dot net</strong>
   <a href="#65801" class="date">07-May-2006 11:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To implement the Digest authentication mentioned above in PHP &lt; 5.1, try prepending the following:<br />
<br />
<span class="default">&lt;?php<br />
$headers </span><span class="keyword">= </span><span class="default">apache_request_headers</span><span class="keyword">();<br />
</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_DIGEST'</span><span class="keyword">] = </span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'Authorization'</span><span class="keyword">];<br />
</span><span class="default">?&gt;<br />
</span><br />
or, if you don't like the idea of modifying the global $_SERVER variable directly, just use the first line and then substitute $_SERVER['PHP_AUTH_DIGEST'] in the sample code with $headers['Authorization']. Works great.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62597""></a>
  <div class="note">
   <strong class="user">ZyX</strong>
   <a href="#62597" class="date">04-Mar-2006 04:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Simple PHP Script to login on a Basic Authentication page.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/* Access Configuration */<br />
</span><span class="default">define </span><span class="keyword">(</span><span class="string">'x401_host'</span><span class="keyword">, </span><span class="string">'www.example.com'</span><span class="keyword">);<br />
</span><span class="default">define </span><span class="keyword">(</span><span class="string">'x401_port'</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">);<br />
</span><span class="default">define </span><span class="keyword">(</span><span class="string">'x401_user'</span><span class="keyword">, </span><span class="string">'your_username'</span><span class="keyword">);<br />
</span><span class="default">define </span><span class="keyword">(</span><span class="string">'x401_pass'</span><span class="keyword">, </span><span class="string">'your_password'</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* Function */<br />
</span><span class="keyword">function </span><span class="default">get401Page</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$out&nbsp; </span><span class="keyword">= </span><span class="string">"GET </span><span class="default">$file</span><span class="string"> HTTP/1.1\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Host: "</span><span class="keyword">.</span><span class="default">x401_host</span><span class="keyword">.</span><span class="string">"t\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Authorization: Basic "</span><span class="keyword">.</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">x401_user</span><span class="keyword">.</span><span class="string">":"</span><span class="keyword">.</span><span class="default">x401_pass</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; if (!</span><span class="default">$conex </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">x401_host</span><span class="keyword">, </span><span class="default">x401_port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$conex</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$conex</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$conex</span><span class="keyword">, </span><span class="default">512</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$conex</span><span class="keyword">);<br />
&nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">/* Code */<br />
</span><span class="keyword">if (</span><span class="default">$source </span><span class="keyword">= </span><span class="default">get401Page</span><span class="keyword">(</span><span class="string">'/absolute/path/file.php?get=value'</span><span class="keyword">)) {<br />
&nbsp; echo </span><span class="default">$source</span><span class="keyword">;<br />
} else {<br />
&nbsp; echo </span><span class="string">"I can't connect!"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61922""></a>
  <div class="note">
   <strong class="user">djreficul at yahoo dot com</strong>
   <a href="#61922" class="date">15-Feb-2006 02:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well, I think it's easy to make authentification works correctly. I use a session var to force authentication everytime a user visit the logging area.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!isset (</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'firstauthenticate'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_start</span><span class="keyword">();<br />
}<br />
&nbsp; function </span><span class="default">authenticate</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic realm="Sistema autentificacin UnoAutoSur"'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1_0 401 Unauthorized'</span><span class="keyword">);<br />
</span><span class="comment">//&nbsp; &nbsp; header("Status: 401 Access Denied"); <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"Unauthorized\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; exit;<br />
&nbsp; }<br />
&nbsp;if (!isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) || </span><span class="default">strcmp </span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">],</span><span class="default">$user</span><span class="keyword">)!=</span><span class="default">0 </span><span class="keyword">|| <br />
&nbsp;&nbsp; &nbsp;&nbsp; !isset (</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">]) || </span><span class="default">strcmp</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">],</span><span class="default">$pass</span><span class="keyword">)!=</span><span class="default">0 </span><span class="keyword">|| !isset (</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'firstauthenticate'</span><span class="keyword">]) || !</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'firstauthenticate'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'firstauthenticate'</span><span class="keyword">]=</span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">authenticate</span><span class="keyword">();<br />
&nbsp;} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//I destroy the session var now<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_unset</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Your code below<br />
&nbsp;</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60623""></a>
  <div class="note">
   <strong class="user">notter at thisaddress dot com</strong>
   <a href="#60623" class="date">12-Jan-2006 07:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A better example of the solution Brian was suggesting [admins: please delete my previous post]<br />
<br />
logout.php:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'quit'</span><span class="keyword">])) { </span><span class="default">?&gt;<br />
</span>&nbsp; &nbsp; &nbsp; &nbsp; &lt;h4&gt;To complete your log out, please click "OK" then "Cancel" in<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; this &lt;a href="logout.php?quit=y"&gt;log in box&lt;/a&gt;. Do not fill in a<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; password. This should clear your ID and password from the cache of your<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; browser.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;blockquote&gt;Note: Logging in from this particular box is&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; disabled!&lt;/blockquote&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;p&gt;Go &lt;a href="/"&gt;back to the site&lt;/a&gt;.&lt;/h4&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="default">&lt;?php<br />
</span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic realm="This Realm"'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// if a session was running, clear and destroy it<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_start</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_unset</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_destroy</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;h3&gt;Logged out!&lt;/h3&gt;&lt;h4&gt;Go &lt;a href=\"/\"&gt;back to the site&lt;/a&gt;.&lt;/h4&gt;"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Note: "This Realm" should be changed to precisely match the name of your realm in your main login.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60503""></a>
  <div class="note">
   <strong class="user">marco dot moser at oltrefersina dot it</strong>
   <a href="#60503" class="date">09-Jan-2006 06:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I suggest to demand user's authentication and management to the web server (by .htaccess, ...):<br />
<br />
1. configure a global /logon/ directory with a .htaccess file restricted access<br />
<br />
2. use fopen wrapper:<br />
<br />
&nbsp; $hh = @fopen("<a href="http://{$_SERVER[" rel="nofollow" target="_blank">http://{$_SERVER[</a>'PHP_AUTH_USER']}:{$_SERVER['PHP_AUTH_PW']}".<br />
&nbsp;&nbsp;&nbsp; @{$_SERVER['SERVER_NAME']}/logon/", "r");<br />
&nbsp; if (!$hh) authenticate(); // usual header WWW-Authenticate ...<br />
&nbsp; fclose($hh);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59834""></a>
  <div class="note">
   <strong class="user">sezer yalcin</strong>
   <a href="#59834" class="date">17-Dec-2005 01:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
none of those 'logout' methods would work well.<br />
<br />
Even tricky ones like using cookie to reset cache.<br />
<br />
Do not waste your time on this. <br />
<br />
Browsers want to keep username and password to help user anyway. Try closing the window, or telling user to restart browser.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57922""></a>
  <div class="note">
   <strong class="user">oaev at mail dot ru</strong>
   <a href="#57922" class="date">19-Oct-2005 01:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Once more time about PHP through CGI.<br />
<br />
Sometimes by some reasons (settings) web-server does not allow to set any environment variables through .htaccess file, so method offered by bernard dot paques at bigfoot dot com will not work.<br />
<br />
Another way to solve this is to set some GET variable:<br />
<br />
file .htaccess (it's just my example, maybe you can find better way):<br />
<br />
&lt;IfModule mod_rewrite.c&gt;<br />
&nbsp;&nbsp; RewriteEngine on<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; RewriteCond %{QUERY_STRING} ^$<br />
&nbsp;&nbsp; RewriteRule ([^\s]+).php$ $1.php?BAD_HOSTING=%{HTTP:Authorization}<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; RewriteCond %{QUERY_STRING} ^(.+)$<br />
&nbsp;&nbsp; RewriteRule ([^\s]+).php $1.php?%1&amp;BAD_HOSTING=%{HTTP:Authorization}<br />
&lt;/IfModule&gt;<br />
<br />
a part of php file:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if((empty(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) or empty(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">])) and isset(</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'BAD_HOSTING'</span><span class="keyword">]) and </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Basic\s+(.*)$/i'</span><span class="keyword">, </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'BAD_HOSTING'</span><span class="keyword">], </span><span class="default">$matc</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">], </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">]) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$matc</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]));<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57896""></a>
  <div class="note">
   <strong class="user">somebody</strong>
   <a href="#57896" class="date">18-Oct-2005 07:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In the previous example it will not work in IE. In order to have a single script work on both IE and FireFox (and handle the cache problem), you need to use the $_SERVER['HTTP_USER_AGENT'] variable to know which logout version to present to the user.<br />
<br />
An full example can be seen in the url (could not post it here due to size restrictions):<br />
<br />
<a href="http://www.free-php.org/index.php?" rel="nofollow" target="_blank">http://www.free-php.org/index.php?</a><br />
cat_select=HTTP&amp;show=HTTP_Authentication<br />
<br />
(URL split also due to size restrictions)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57556""></a>
  <div class="note">
   <strong class="user">niklas[dot]westerberg[at]sizeit[dot]se</strong>
   <a href="#57556" class="date">07-Oct-2005 03:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To reset the credentials stored by the browser and effectivly force reauthentication of the user, make a logout link on your page pointing to <a href="http://logout:logout@{$_SERVER[" rel="nofollow" target="_blank">http://logout:logout@{$_SERVER[</a>'SERVER_NAME']}/nice_logout_page.php , presuming that there is no user logout with password logout.<br />
<br />
Very simple!<br />
<br />
Got it from <a href="http://www.webmasterworld.com/forum13/3147.htm" rel="nofollow" target="_blank">http://www.webmasterworld.com/forum13/3147.htm</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56134""></a>
  <div class="note">
   <strong class="user">siberion at hotmail dot com</strong>
   <a href="#56134" class="date">24-Aug-2005 09:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I came up with another approach to work around the problem of browsers caching WWW authentication credentials and creating logout problems. While most browsers have some kind of way to wipe this information, I prefer having my website to take care of the task instead of relying on the user's sanity.<br />
<br />
Even with Lalit's method of creating a random realm name, it was still possible to get back into the protected area using the back button in Firefox, so that didn't work. Here's my solution:<br />
<br />
Since browsers attach the credentials to specific URLs, use virtual paths where a component of the path is actually a PHP script, and everything following it is part of the URI, such as:<br />
<br />
<a href="http://www.example.com/some_dir/login.php/auth/8f631b92/" rel="nofollow" target="_blank">http://www.example.com/some_dir/login.php/auth/8f631b92/</a><br />
<br />
By choosing a different number for the last component of the URL, browsers can be tricked into thinking that they are dealing with a completely different website, and thus prompting the user for credentials again.<br />
<br />
Note that using a random, unrestricted number will still allow the user to hit the back button to get back into the page. You should keep track of this number in a server-side file or database and regenerate it upon each successful login, so that the last number(s) become invalid. Using an invalid number might result in a 403 response or, depending on how you feel that day, a 302 to a nasty website.<br />
<br />
Care should be taken when linking from the page generated in this case, since relative links will be relative to the virtual and non-existant directory rather than the true script directory.<br />
<br />
Hope this helps somebody.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54330""></a>
  <div class="note">
   <strong class="user">me at lalit dot org</strong>
   <a href="#54330" class="date">30-Jun-2005 08:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A very simple HTTP Authentication script that solves the logout problem. I wasted a lot of time figuring out a way to logout. This one works perfectly fine.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">auth_user</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$realm </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">( </span><span class="default">1</span><span class="keyword">, </span><span class="default">1000000000 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic realm="Realm ID='</span><span class="keyword">.</span><span class="default">$realm</span><span class="keyword">.</span><span class="string">']"'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; die(</span><span class="string">"Unauthorized access forbidden!"</span><span class="keyword">);<br />
}<br />
<br />
if (!isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">auth_user</span><span class="keyword">();<br />
} else if (!isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">auth_user</span><span class="keyword">();<br />
} else if (</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">] != </span><span class="default">$auser </span><span class="keyword">|| </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">] != </span><span class="default">$apass</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">auth_user</span><span class="keyword">();<br />
} else if (isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'action'</span><span class="keyword">]) &amp;&amp; </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'action'</span><span class="keyword">] == </span><span class="string">"logout"</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">auth_user</span><span class="keyword">();<br />
}<br />
<br />
</span><span class="comment">// Normal Page Code Here<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps,<br />
Lalit</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53962""></a>
  <div class="note">
   <strong class="user">snagnever at gmail dot com</strong>
   <a href="#53962" class="date">18-Jun-2005 03:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It forces a auth each time the page is accessed:<br />
(maybe can save someone)<br />
<br />
&lt;?<br />
header("Expires: Sat, 01 Jan 2000 00:00:00 GMT");<br />
header("Last-Modified: ".gmdate("D, d M Y H:i:s")." GMT");<br />
header("Cache-Control: post-check=0, pre-check=0",false);<br />
header("Pragma: no-cache");<br />
session_cache_limiter("public, no-store");<br />
session_start();<br />
<br />
function http_auth()<br />
{<br />
&nbsp;&nbsp;&nbsp; $_SESSION['AUTH'] = 1;<br />
&nbsp;&nbsp;&nbsp; header('HTTP/1.0 401 Unauthorized');<br />
&nbsp;&nbsp;&nbsp; header('WWW-Authenticate: Basic realm="sn4g auth system"');<br />
&nbsp;&nbsp;&nbsp; // The actions to be done when the user clicks on 'cancel'<br />
&nbsp;&nbsp;&nbsp; exit();<br />
}<br />
<br />
if( !isset($_SERVER['PHP_AUTH_USER']) or @$_SESSION['AUTH'] != 1 )<br />
{<br />
&nbsp;&nbsp;&nbsp; http_auth();<br />
&nbsp;&nbsp;&nbsp; exit();<br />
}<br />
<br />
// Actions do be done when the user has logged<br />
<br />
// rest, must clean the session array<br />
$_SESSION = array();<br />
session_destroy();<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53216""></a>
  <div class="note">
   <strong class="user">aplanefan at mail dot com</strong>
   <a href="#53216" class="date">25-May-2005 06:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found a way to log out easily<br />
<span class="default">&lt;?php<br />
ob_start</span><span class="keyword">();<br />
if (!isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) || </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'isin'</span><span class="keyword">] != </span><span class="string">"1"</span><span class="keyword">) {<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic realm="My Realm"'</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
</span><span class="default">setcookie </span><span class="keyword">(</span><span class="string">"isin"</span><span class="keyword">, </span><span class="string">"1"</span><span class="keyword">);<br />
die(</span><span class="string">'&lt;a href="orderhan.php"&gt;Login&lt;/a&gt;'</span><span class="keyword">);<br />
} <br />
else {<br />
if(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">] == </span><span class="string">"USER" </span><span class="keyword">&amp;&amp;&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">]== </span><span class="string">"PASSWORD"</span><span class="keyword">) {<br />
echo </span><span class="string">"you got in"</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;a href='"</span><span class="keyword">.</span><span class="default">$_SEVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">].</span><span class="string">"?action=logout'&gt;logout&lt;/a&gt;"</span><span class="keyword">;<br />
}<br />
else {<br />
</span><span class="default">setcookie </span><span class="keyword">(</span><span class="string">"isin"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">() - </span><span class="default">3600</span><span class="keyword">);<br />
</span><span class="default">$url</span><span class="keyword">=</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">];<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"location: </span><span class="default">$url</span><span class="string">"</span><span class="keyword">);<br />
}<br />
if(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'action'</span><span class="keyword">] == </span><span class="string">"logout"</span><span class="keyword">) {<br />
</span><span class="default">setcookie </span><span class="keyword">(</span><span class="string">"isin"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">() - </span><span class="default">3600</span><span class="keyword">);<br />
</span><span class="default">$url</span><span class="keyword">=</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">];<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"location: </span><span class="default">$url</span><span class="string">"</span><span class="keyword">);<br />
}<br />
}<br />
</span><span class="default">ob_end_flush</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52405""></a>
  <div class="note">
   <strong class="user">charly at towebs dot com</strong>
   <a href="#52405" class="date">29-Apr-2005 10:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simpler approach on the post of:<br />
bernard dot paques at bigfoot dot com<br />
24-Sep-2004 01:42<br />
<br />
This is another "patch" to the PHP_AUTH_USER and PHP_AUTH_PW server variables problem running PHP as a CGI.<br />
<br />
First of all don't forget this fragment of code in your .htaccess (it's the only thing you need to make it work with mod_rewrite):<br />
<br />
&lt;IfModule mod_rewrite.c&gt;<br />
&nbsp;&nbsp; RewriteEngine on<br />
&nbsp;&nbsp; RewriteRule .* - [E=REMOTE_USER:%{HTTP:Authorization},L]<br />
&lt;/IfModule&gt;<br />
<br />
Then login.php<br />
<br />
<span class="default">&lt;?php<br />
$a </span><span class="keyword">= </span><span class="default">base64_decode</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"REMOTE_USER"</span><span class="keyword">],</span><span class="default">6</span><span class="keyword">)) ;<br />
if ( (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) || ( </span><span class="default">strcasecmp</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="string">":" </span><span class="keyword">)&nbsp; == </span><span class="default">0 </span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">'WWW-Authenticate: Basic realm="Private"' </span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">'HTTP/1.0 401 Unauthorized' </span><span class="keyword">);<br />
}<br />
else<br />
{<br />
&nbsp;&nbsp; list(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">] = </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">]&nbsp; &nbsp; = </span><span class="default">$password</span><span class="keyword">;<br />
<br />
}<br />
<br />
echo </span><span class="string">'PHP_AUTH_USER =' </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">] . </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
echo </span><span class="string">'PHP_AUTH_PW =' </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">] . </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
echo </span><span class="string">'REMOTE_USER =' </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REMOTE_USER'</span><span class="keyword">] . </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
First, we decode the base64 encoded string discarding the first 6 characters of "Basic " and then we do a regular validation.<br />
At the end of the script we print the variables to verify it's working. This should be ommited in the production version.<br />
<br />
It's a variation of the script by Bernard Paques.<br />
Thanks to him for that snippet.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51259""></a>
  <div class="note">
   <strong class="user">sl at netcentrex dot net</strong>
   <a href="#51259" class="date">24-Mar-2005 02:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This forces an instant re-authentication:<br />
<br />
// Force a logout.<br />
function imt_logout()<br />
{<br />
&nbsp;&nbsp;&nbsp; global $_SESSION;<br />
&nbsp;&nbsp;&nbsp; global $HTTP_SERVER_VARS;<br />
&nbsp;&nbsp;&nbsp; global $PHP_SELF;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // We mark the session as requiring a re-auth<br />
&nbsp;&nbsp;&nbsp; $_SESSION['reauth-in-progress'] = 1;<br />
<br />
&nbsp;&nbsp;&nbsp; // This forces the authentication cache clearing<br />
&nbsp;&nbsp;&nbsp; header("WWW-Authenticate: Basic realm=\"My Realm\"");<br />
&nbsp;&nbsp;&nbsp; header("HTTP/1.0 401 Unauthorized");<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // In case of the user clicks "cancel" in the dialog box<br />
&nbsp;&nbsp;&nbsp; print '&lt;a href="<a href="http://" rel="nofollow" target="_blank">http://</a>'.$HTTP_SERVER_VARS['HTTP_HOST'].$PHP_SELF.'"&gt;click me&lt;/a&gt;';<br />
&nbsp;&nbsp;&nbsp; exit();<br />
}<br />
<br />
// Check login<br />
function imt_login()<br />
{<br />
&nbsp;&nbsp;&nbsp; global $_SERVER;<br />
&nbsp;&nbsp;&nbsp; global $_SESSION;<br />
&nbsp;&nbsp;&nbsp; global $REGISTERED_USERS;<br />
<br />
&nbsp;&nbsp;&nbsp; // the valid_user checks the user/password (very primitive test in this example)<br />
&nbsp;&nbsp;&nbsp; if (!valid_user($_SERVER['PHP_AUTH_USER'], $REGISTERED_USERS))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; session_destroy();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; header("WWW-Authenticate: Basic realm=\"My Realm\"");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; header("HTTP/1.0 401 Unauthorized");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; // OK, the user is authenticated<br />
&nbsp;&nbsp;&nbsp; $_SESSION['user'] = $_SERVER['PHP_AUTH_USER'];<br />
}<br />
<br />
Assuming that your page.php?action=logout forces a reauth on the same page, start your page with:<br />
<br />
session_start()<br />
if ($_REQUEST["action"] == "logout")<br />
{<br />
&nbsp;&nbsp;&nbsp; if (isset($_SESSION['reauth-in-progress']))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; session_destroy();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; header("Location: <a href="http://" rel="nofollow" target="_blank">http://</a>".$HTTP_SERVER_VARS['HTTP_HOST'].$PHP_SELF);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imt_logout();<br />
}<br />
&nbsp;&nbsp;&nbsp; <br />
imt_login();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51104""></a>
  <div class="note">
   <strong class="user">brian at nerdlife dot net</strong>
   <a href="#51104" class="date">19-Mar-2005 07:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My solution to the logout conondrum:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="default">op</span><span class="keyword">] == </span><span class="string">'logout'</span><span class="keyword">)<br />
{<br />
&nbsp;</span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic realm="Click \'Ok\' then \'Cancel\' to Log Out"'</span><span class="keyword">);<br />
&nbsp;</span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp; echo </span><span class="string">'You have been successfully logged out. Click &lt;a href="index.php"&gt;here&lt;/a&gt; to log back in.'</span><span class="keyword">);<br />
&nbsp; die();<br />
}<br />
if(!isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="default">PHP_AUTH_USER</span><span class="keyword">]))<br />
{<br />
&nbsp;</span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic realm="Site Login"'</span><span class="keyword">);<br />
&nbsp;</span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp; echo </span><span class="string">'You must enter a valid username and password to access this resource.'</span><span class="keyword">;<br />
&nbsp; die();<br />
}<br />
else<br />
{<br />
&nbsp;</span><span class="comment">//Validate User<br />
&nbsp;//If Validated:<br />
&nbsp;</span><span class="keyword">echo </span><span class="string">"Welcome. &lt;a href='index.php?op=logout'&gt;Logout?&lt;/a&gt;"<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span>I assume that if the user is reliable enough to even bother logging out, they are reliable enough to click "ok" then "cancel", thereby logging out and displaying the "logged out" message.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47271""></a>
  <div class="note">
   <strong class="user">ernstp at winzerware dot de</strong>
   <a href="#47271" class="date">09-Nov-2004 11:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't like passwords at home or simply don't want access with passwords maybe told form one to another...<br />
<br />
You make a configuration file like that:<br />
<br />
# Passwort for special IP-Range<br />
IP 192.168.0.<br />
axel:PGWAiIeUxcHOg<br />
sven:ADD1IDbsVHSEo<br />
<br />
# Following IP works without password (Keyword 'ALL')<br />
IP 192.168.0.4<br />
ALL<br />
<br />
# Passwords for the rest of the world<br />
IP<br />
ernst:INo9dSzfU5sRU<br />
sven:ADD1IDbsVHSEo<br />
<br />
&lt;?<br />
$path_log = "/home/ernst/.htmyway";<br />
<br />
// Konfigurationsfile einlesen:<br />
$file = file($path_log);<br />
<br />
$login = FALSE;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Gets TRUE, when login is valid<br />
$ip = 'world';&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // This is the currend IP while reading the configuration<br />
$access = 'world';&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // IP from configuration fitting into $_SERVER['REMOTE_ADDR']<br />
<br />
foreach ($file as $zeile)<br />
{<br />
&nbsp;&nbsp;&nbsp; $zeile = trim($zeile);<br />
<br />
&nbsp;&nbsp;&nbsp; switch(true)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case ( strlen($zeile) == 0 ):&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // break for empty lines<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case ( substr($zeile, 0, 1) == '#' ):&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // break for Komments<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case ( substr($zeile, 0, 2) == 'IP' ):&nbsp; &nbsp; &nbsp; &nbsp; // change IP range<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ip = substr($zeile, 3);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($ip == '')<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ip = 'world';<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( ereg("^$ip", $_SERVER['REMOTE_ADDR']) )&nbsp; &nbsp; // fitting IP<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $access = $ip;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case ( ereg("(.+):(.*)", $zeile, $reg) ):&nbsp; &nbsp; &nbsp; &nbsp; // scan passwords<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $logray[$ip][$reg[1]] = $reg[2];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case ( $zeile == 'ALL' ):&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // if no login is needet<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $logray[$ip]['all'] = 1;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
// &lt;for testing&gt;<br />
if ( isset($_GET['logout']) )<br />
{<br />
&nbsp;&nbsp;&nbsp; unset($_SERVER['PHP_AUTH_USER']);<br />
&nbsp;&nbsp;&nbsp; unset($_SERVER['PHP_AUTH_PW']);<br />
}<br />
//&nbsp;&nbsp; &lt;/for testing&gt;<br />
<br />
// authorisation test<br />
if ( isset($_SERVER['PHP_AUTH_USER']) AND isset($_SERVER['PHP_AUTH_PW']) )<br />
&nbsp;&nbsp;&nbsp; if( isset($logray[$access][$_SERVER['PHP_AUTH_USER']]) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( $logray[$access][$_SERVER['PHP_AUTH_USER']] == crypt($_SERVER['PHP_AUTH_PW'], (substr($logray[$access][$_SERVER['PHP_AUTH_USER']], 0, 2))) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $login = TRUE;<br />
<br />
if ( isset($logray[$access]['all']) )<br />
&nbsp;&nbsp;&nbsp; $login = TRUE;<br />
<br />
// send login-form if needet<br />
if ( !$login )<br />
{<br />
&nbsp;&nbsp;&nbsp; Header("WWW-Authenticate: Basic realm=\"Test Authentication System\"");<br />
&nbsp;&nbsp;&nbsp; Header("HTTP/1.0 401 Unauthorized");<br />
&nbsp;&nbsp;&nbsp; echo "You must enter a valid login ID and password to access this resource\n";<br />
&nbsp;&nbsp;&nbsp; exit;<br />
}<br />
<br />
// Your running programm...<br />
if ( $login )<br />
{<br />
&nbsp;&nbsp;&nbsp; echo "Hello " . $_SERVER['PHP_AUTH_USER'];<br />
<br />
?&gt;<br />
&lt;BR&gt;<br />
&lt;form&gt;<br />
&lt;input type='submit' name='logout' value='logout'&gt;<br />
&lt;/form&gt;<br />
&lt;?<br />
<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44745""></a>
  <div class="note">
   <strong class="user">jason</strong>
   <a href="#44745" class="date">14-Aug-2004 10:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
on the php+mysql auth code by tigran at freenet dot am<br />
<br />
There are some security weaknesses.<br />
<br />
First<br />
$user <br />
&nbsp; and <br />
$pass<br />
<br />
are both insecure, they could leave this code open to SQL injection, you should always remove invalid characters in both, or at least encode them.<br />
<br />
Actually storing passwords as MD5 hashes leaves you less work to secure.<br />
<br />
Second security risks<br />
The same mysql user has rights to both update and select, and possibly even insert and on your auth database no less.<br />
Again the SQL inject attack may occur with this., and the end user could then change the users username, password, or anything else in relation to this.<br />
<br />
Third items is more of a performance issue,<br />
&nbsp; <br />
Do you really need to update the database, as updates are slower then selects, and if you do them every time they access the page, you are costing some speed penalty.&nbsp; <br />
<br />
One option, if you want to use sql (I think mysql has it) is memory only databases, and create a table within memory, the stores a unique session identifier for each user, that is logged in, or alternatively if it's a single front end system, you could use db files.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44686""></a>
  <div class="note">
   <strong class="user">php at cscott dot net</strong>
   <a href="#44686" class="date">12-Aug-2004 04:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that Microsoft has released a 'security update' which disables the use of username:password@host in http urls.<br />
<br />
&nbsp;&nbsp; <a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;834489" rel="nofollow" target="_blank">http://support.microsoft.com/default.aspx?scid=kb;en-us;834489</a><br />
<br />
The methods described above which rely on this will no longer work in Microsoft browsers, sadly.<br />
<br />
You can re-enable this functionality as described at<br />
<br />
&nbsp;&nbsp; <a href="http://weblogs.asp.net/cumpsd/archive/2004/02/07/69366.aspx" rel="nofollow" target="_blank">http://weblogs.asp.net/cumpsd/archive/2004/02/07/69366.aspx</a><br />
<br />
but your users will probably be unwilling to do this.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43322""></a>
  <div class="note">
   <strong class="user">chris at schaake dot nu</strong>
   <a href="#43322" class="date">17-Jun-2004 09:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple script for SSL Client Certificate authentication with a basic authentication fall-back. I use this on my site using LDAP server to check username/passwords and client certificate to user mapping.<br />
<br />
&lt;? <br />
// Check if and how we are authenticated<br />
if ($_SERVER['SSL_CLIENT_VERIFY'] != "SUCCESS") { // Not using a client certificate<br />
&nbsp;&nbsp;&nbsp; if ((!$_SERVER['PHP_AUTH_USER']) &amp;&amp; (!$_SERVER['PHP_AUTH_PW'])) { // Not logged in using basic authentication<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; authenticate(); // Send basic authentication headers<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
if ($_SERVER['SSL_CLIENT_S_DN_CN'] != "chris") { // Check CN name of cert<br />
<br />
&nbsp;&nbsp;&nbsp; if (!(($_SERVER['PHP_AUTH_USER'] == "test") &amp;&amp; ($_SERVER['PHP_AUTH_PW'] == "123"))) { // Check username and password<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; authenticate(); // Send basic authentication headers because username and/or password didnot match<br />
&nbsp;&nbsp;&nbsp; } <br />
} <br />
<br />
phpinfo();<br />
<br />
// Call authentication display<br />
function authenticate() {<br />
&nbsp;&nbsp;&nbsp; Header("WWW-Authenticate: Basic realm=Website");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Header("HTTP/1.0 401 Unauthorized");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; error401();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
}<br />
?&gt;<br />
<br />
See my website (<a href="http://www.schaake.nu/index.php?page=/manuals/sslmanual.xml" rel="nofollow" target="_blank">http://www.schaake.nu/index.php?page=/manuals/sslmanual.xml</a>) for more details on client certificate with Apache and PHP.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43000""></a>
  <div class="note">
   <strong class="user">mcbethh ( at ) [no spam] op.pl</strong>
   <a href="#43000" class="date">06-Jun-2004 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a nice way to 'fix' missing REMOTE_USER env variable when using PHP as CGI, using mod_rewrite rule like this:<br />
<br />
RewriteRule .* - [E=REMOTE_USER:%{HTTP:Authorization},L]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42372""></a>
  <div class="note">
   <strong class="user">nuno at mail dot ideianet dot pt</strong>
   <a href="#42372" class="date">13-May-2004 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In Windows 2003 Server/IIS6 with the php4+ cgi I only get HTTP authentication working with:<br />
<span class="default">&lt;?php header</span><span class="keyword">(</span><span class="string">"Status: 401 Access Denied"</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span>with<br />
<span class="default">&lt;?php header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span>doesn't work !<br />
I also need in "Custom Errors" to select the range of "401;1" through "401;5" and click the "Set to Default" button.<br />
Thanks rob at theblip dot com</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42198""></a>
  <div class="note">
   <strong class="user">steuber at aego dot de</strong>
   <a href="#42198" class="date">07-May-2004 04:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Quite a good solution for the logout problem:<br />
<br />
Just tell browser that it is successfully logged in!<br />
This works as follows:<br />
1. User clicks logout button<br />
2. Script sends 401 Header<br />
3. User does NOT enter a password<br />
4. If no password is entered, script sends 200 Header<br />
<br />
So the browser remembers no password as a valid password.<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (<br />
&nbsp;&nbsp; &nbsp; &nbsp; (!isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]))<br />
&nbsp;&nbsp;&nbsp; ||(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"login"</span><span class="keyword">]==</span><span class="string">"login"</span><span class="keyword">) <br />
&nbsp;&nbsp;&nbsp; &amp;&amp; !(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]==</span><span class="string">"validuser"</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; (</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">]==</span><span class="string">"validpass"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp;&nbsp; ||(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"logout"</span><span class="keyword">]==</span><span class="string">"logout"</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &amp;&amp; !(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">]==</span><span class="string">""</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp; ) {<br />
</span><span class="default">Header</span><span class="keyword">(</span><span class="string">"WWW-Authenticate: Basic realm=\"Realm\""</span><span class="keyword">);<br />
</span><span class="default">Header</span><span class="keyword">(</span><span class="string">"HTTP/1.0 401 Unauthorized"</span><span class="keyword">);<br />
echo </span><span class="string">"Not logged out...&lt;br&gt;\n"</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;a href=\"index.php?login=login\"&gt;Login&lt;/a&gt;"</span><span class="keyword">;<br />
exit;<br />
} else if (</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">]==</span><span class="string">""</span><span class="keyword">) {<br />
echo </span><span class="string">"Logged out...&lt;br&gt;\n"</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;a href=\"index.php?login=login\"&gt;Login&lt;/a&gt;"</span><span class="keyword">;<br />
exit;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41941""></a>
  <div class="note">
   <strong class="user">najprogramato at post dot sk</strong>
   <a href="#41941" class="date">27-Apr-2004 05:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't use apache authentification in plain text. Is more better to use own script to generete new ID which is relevant to password. Apache auth data are sent to every page, so the posible mistake are known.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40489""></a>
  <div class="note">
   <strong class="user">ian AT iyates DOT co DOR uk</strong>
   <a href="#40489" class="date">05-Mar-2004 05:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In my use of HTTP Authentication, I've found that some Apache setups swap around the usual variables.<br />
Here's the fix I made so that you can still use PHP_AUTH_USER and PHP_AUTH_PW. Hope it helps someone<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">## Apache server fix ##<br />
</span><span class="keyword">if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]) &amp;&amp; !isset(</span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">'REMOTE_USER'</span><span class="keyword">]))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">'REMOTE_USER'</span><span class="keyword">] = </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">];<br />
if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'AUTH_PASSWORD'</span><span class="keyword">]) &amp;&amp; !isset(</span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">]))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">] = </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'AUTH_PASSWORD'</span><span class="keyword">];<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40445""></a>
  <div class="note">
   <strong class="user">rob at theblip dot com</strong>
   <a href="#40445" class="date">03-Mar-2004 08:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding HTTP authentication in IIS with the php cgi 4.3.4, there's one more step. I searched mightily and didn't find this information anywhere else, so here goes. When using HTTP auth with the php CGI, you need to do the following things:<br />
<br />
1. In your php.ini file, set "cgi.rfc2616_headers = 0"<br />
<br />
2. In Web Site Properties -&gt; File/Directory Security -&gt; Anonymous Access dialog box, check the "Anonymous access" checkbox and uncheck any other checkboxes (i.e. uncheck "Basic authentication," "Integrated Windows authentication," and "Digest" if it's enabled.) Click OK.<br />
<br />
3. In "Custom Errors", select the range of "401;1" through "401;5" and click the "Set to Default" button.<br />
<br />
It's this last step that is crucial, yet not documented anywhere. If you don't, instead of the headers asking for credentials, IIS will return its own fancy but useless 'you are not authenticated' page. But if you do, then the browser will properly ask for credentials, and supply them in the $_SERVER['PHP_AUTH_*'] elements.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38517""></a>
  <div class="note">
   <strong class="user">ken_php_net at wolfpackinteractive dot com</strong>
   <a href="#38517" class="date">25-Dec-2003 01:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Say you have password and groups files in standard Apache format (htpasswd etc.), but you want to apply authorization based on something other than filename, ie something you can't catch in .htaccess.&nbsp; You want to emulate the server behavior in PHP -- the equivalent of:<br />
<br />
AuthType Basic<br />
AuthName "Members"<br />
AuthUserFile /path/to/.htpasswd<br />
AuthGroupFile /path/to/.groups<br />
require group Members<br />
<br />
Here's what I came up with:<br />
<br />
<span class="default">&lt;?PHP<br />
<br />
$AuthUserFile </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="string">"/path/to/.htpasswd"</span><span class="keyword">);<br />
</span><span class="default">$AuthGroupFile </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="string">"/path/to/.groups"</span><span class="keyword">);<br />
</span><span class="default">$group </span><span class="keyword">= </span><span class="string">"Members"</span><span class="keyword">;<br />
</span><span class="default">$realm </span><span class="keyword">= </span><span class="string">"Members"</span><span class="keyword">;<br />
<br />
function </span><span class="default">authenticate</span><span class="keyword">(){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"WWW-Authenticate: Basic realm=\"</span><span class="default">$realm</span><span class="string">\""</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"You must enter a valid user name and password to access the requested resource."</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; exit;<br />
}<br />
<br />
for(; </span><span class="default">1</span><span class="keyword">; </span><span class="default">authenticate</span><span class="keyword">()){<br />
&nbsp;&nbsp;&nbsp; if (!isset(</span><span class="default">$HTTP_SERVER_VARS</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$user </span><span class="keyword">= </span><span class="default">$HTTP_SERVER_VARS</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">preg_grep</span><span class="keyword">(</span><span class="string">"/</span><span class="default">$group</span><span class="string">: </span><span class="default">$user</span><span class="string">$/"</span><span class="keyword">, </span><span class="default">$AuthGroupFile</span><span class="keyword">))&nbsp; </span><span class="comment"># (format assumptions)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">continue;<br />
<br />
&nbsp;&nbsp;&nbsp; if(!(</span><span class="default">$authUserLine </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">preg_grep</span><span class="keyword">(</span><span class="string">"/</span><span class="default">$user</span><span class="string">:.*$/"</span><span class="keyword">, </span><span class="default">$AuthUserFile</span><span class="keyword">))))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/</span><span class="default">$user</span><span class="string">:((..).*)$/"</span><span class="keyword">, </span><span class="default">$authUserLine</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$authPW </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$salt </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$submittedPW </span><span class="keyword">= </span><span class="default">crypt</span><span class="keyword">(</span><span class="default">$HTTP_SERVER_VARS</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">], </span><span class="default">$salt</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$submittedPW </span><span class="keyword">!= </span><span class="default">$authPW</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
<br />
&nbsp;&nbsp;&nbsp; break;<br />
}<br />
<br />
echo </span><span class="string">"You got in!"<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37280""></a>
  <div class="note">
   <strong class="user">Paul</strong>
   <a href="#37280" class="date">08-Nov-2003 03:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a extremely easy way to successfully logout.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if ( </span><span class="default">$realm </span><span class="keyword">== </span><span class="string">'' </span><span class="keyword">)<br />
</span><span class="default">$realm </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">( </span><span class="default">1</span><span class="keyword">, </span><span class="default">1000000000 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">'WWW-Authenticate: Basic realm='</span><span class="keyword">.</span><span class="default">$realm </span><span class="keyword">); <br />
</span><span class="default">?&gt;<br />
</span><br />
To log the user out simply change the value of $realm</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36731""></a>
  <div class="note">
   <strong class="user">bela - iandistudio</strong>
   <a href="#36731" class="date">20-Oct-2003 10:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi there. Thought long and hard to come up with a logout mechanism that erases the variables $PHP_AUTH_USER and $PHP_AUTH_PW. Finally came up with something, it is better than nothing, hope somebody will find it usefull:<br />
<br />
logout.php:<br />
<br />
&lt;?<br />
header("Location: <a href="http://EnterYourUserName:YourPassword@ServerRoot" rel="nofollow" target="_blank">http://EnterYourUserName:YourPassword@ServerRoot</a>".$PHP_SELF);<br />
exit;<br />
?&gt;<br />
<br />
"EnterYourUserName" and "YourPassword" will be the two variables new value, while "ServerRoot" is your server's domainname (like www.somedomain.com).<br />
You should ensure, that nobody will use "EnterYourUserName" as it's login name.<br />
<br />
Happy coding.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35530""></a>
  <div class="note">
   <strong class="user">ad_ver at inbox dot ru</strong>
   <a href="#35530" class="date">04-Sep-2003 07:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Modified script from "jonhaynes at bigfoot dot com" using Oracle logon<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">function </span><span class="default">authenticate</span><span class="keyword">() {<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"WWW-Authenticate: Basic realm=\"My Realm\""</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"HTTP/1.0 401 Unauthorized"</span><span class="keyword">);<br />
print(</span><span class="string">"You must enter a valid login username and password <br />
to access this resource.\n"</span><span class="keyword">);<br />
exit;<br />
}<br />
<br />
if(!isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">])){ </span><span class="default">authenticate</span><span class="keyword">(); }<br />
else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$conn </span><span class="keyword">= @ </span><span class="default">OCILogon</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_USER'</span><span class="keyword">], </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">], </span><span class="string">"orcl92"</span><span class="keyword">) ;<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$conn</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { </span><span class="default">authenticate</span><span class="keyword">(); } <br />
&nbsp;&nbsp;&nbsp; else {</span><span class="default">OCILogoff</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);};<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33094""></a>
  <div class="note">
   <strong class="user">steve at topozone dot com</strong>
   <a href="#33094" class="date">16-Jun-2003 12:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The method described in the text does not appear to work with PHP in cgi mode and Apache-2.x. I seems that Apache has gotten stricter or introduced a bug such that you can initiate the authentication, but Apache seems to try to&nbsp; authenticate the browser response which always fails because it does not know what to authenticate against and the headers never get passed back to the PHP script.<br />
<br />
I didn't try it with PHP as a module.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29462""></a>
  <div class="note">
   <strong class="user">JKi</strong>
   <a href="#29462" class="date">14-Feb-2003 03:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To clear HTTP authentication cache in Internet Explorer (6 SP1 and later), use "ClearAuthenticationCache" command.<br />
<br />
document.execCommand("ClearAuthenticationCache");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28491""></a>
  <div class="note">
   <strong class="user">emmanuel dot keller at net2000 dot ch</strong>
   <a href="#28491" class="date">14-Jan-2003 02:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some servers won't support the HTTP1.0 specification and will give an error 500 (for instance). This happened with a server where I uploaded an authentication script.<br />
<br />
If it happens, you can try the HTTP1.1 header syntax :<br />
<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">"WWW-Authenticate: Basic realm=\"My Realm\""</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'status: 401 Unauthorized'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28411""></a>
  <div class="note">
   <strong class="user">yaroukh at email dot cz</strong>
   <a href="#28411" class="date">12-Jan-2003 04:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is my solution - works in MSIE and Mozilla.<br />
<br />
I use http-authentication only for the first time user accesses his<br />
private page; after valid username and password are provided, he is<br />
recognized using his sessionID and ip ...<br />
the reasons are following:<br />
1) when users changes his password it is not required instantly<br />
&nbsp;&nbsp; (I find this quite comfortable)<br />
2) auto-login function works fine (unless user click logout)<br />
<br />
And here's how i works ...<br />
<br />
The "trick" is to pass a temporary username+password to the browser.<br />
(I call it "temporary" because no user account matching these<br />
parameters is neccessary.)<br />
<br />
The most essential thing is the following link on user's private page:<br />
<br />
===<br />
&lt;?&nbsp; $url = "<a href="http://" rel="nofollow" target="_blank">http://</a>".<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $username.&nbsp; &nbsp;&nbsp; // see note 1<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ":".<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Session_ID().&nbsp; // see note 2<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "@localhost/".PROJECT_NAME."/logout.phtml";<br />
?&gt;<br />
&lt;a href="&lt;?=$url?&gt;"&gt;logout&lt;/a&gt;<br />
===<br />
<br />
1) we pass the actual username because MSIE uses this username as<br />
&nbsp;&nbsp; a "default pre-fill" for the login-window and some hash-string<br />
&nbsp;&nbsp; would confuse the users.<br />
2) the temporary password is not too important, but there are<br />
&nbsp;&nbsp; two things we expect from it:<br />
&nbsp;&nbsp; a) we need to know this string in the logout.phtml script<br />
&nbsp;&nbsp; b) the string definetely should not match the user's password<br />
&nbsp;&nbsp; &nbsp;&nbsp; (otherwise user gets logged back instantly); using current<br />
&nbsp;&nbsp; &nbsp;&nbsp; Session_ID() we are pretty sure this won't happen<br />
<br />
This link causes that the temporary login-params are available in<br />
the logout.phtml script.<br />
Using "www-authenticate" header in the logout.phtml script we force<br />
the browser to accept our temporary login-params. (I suppose browser<br />
actually repeats the request and the next time it checks<br />
the login-params sent in the URL; but this is only my guess and<br />
it is not important.)<br />
<br />
The logout.phtml code:<br />
===<br />
&lt;?&nbsp; $query = "UPDATE users SET sessionID = NULL ".<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "WHERE sessionID = '".Session_ID()."'";<br />
&nbsp;&nbsp; &nbsp; $mysql-&gt;query($query);<br />
&nbsp;&nbsp; &nbsp; // because we (me :o) use the sessionID and the ip for<br />
&nbsp;&nbsp; &nbsp; // the identification we need to clean the sessionID; (I found it<br />
&nbsp;&nbsp; &nbsp; // a little bit easier to destroy the sessionID in the db than<br />
&nbsp;&nbsp; &nbsp; // unsetting the cookie and/or destroying+restarting<br />
&nbsp;&nbsp; &nbsp; // the current session)<br />
<br />
&nbsp;&nbsp; &nbsp; if($PHP_AUTH_PW != Session_ID()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // keep asking for the login-params untill PHP_AUTH_PW returned<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // by the browser matches the current Session_ID() (which means<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // that the browser accepted the temporary login-params<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // we sent to it AND FORGOT THE REAL ONES)<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Header("HTTP/1.0 401 Unauthorized");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Header("WWW-Authenticate: Basic realm=\"".PROJECT_NAME."\"");<br />
&nbsp;&nbsp;&nbsp; }<br />
?&gt;<br />
&lt;html&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;head&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;meta http-equiv="author" content="yaroukh at email dot cz"&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;title&gt;&lt;?=PROJECT_NAME?&gt;&lt;/title&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;link rel="stylesheet" href="style.css" type="text/css"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/head&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;body&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &lt;a href="<a href="http://localhost/&lt;?=PROJECT_NAME?&gt;/main.phtml" rel="nofollow" target="_blank">http://localhost/&lt;?=PROJECT_NAME?&gt;/main.phtml</a>"&gt;continue&lt;/a&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/body&gt;<br />
&lt;/html&gt;<br />
===<br />
<br />
About the "continue" link: the link is not too important, but using it<br />
we can get rid off the temporary login-params which wouldn't look<br />
too aesthetically in the address-bar. :o)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22057""></a>
  <div class="note">
   
   <a href="#22057" class="date">05-Jun-2002 02:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A more elegant way to force a new name/password, cf. example 17-2 (if you don't mind passing the old user in the query string):<br />
<br />
&lt;?<br />
if (isset($PHP_AUTH_USER))<br />
{<br />
&nbsp;&nbsp;&nbsp; if (!isset($prev_user))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; header("Location: <a href="http://$HTTP_HOST$PHP_SELF?prev_user=$PHP_AUTH_USER" rel="nofollow" target="_blank">http://$HTTP_HOST$PHP_SELF?prev_user=$PHP_AUTH_USER</a>");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($PHP_AUTH_USER == $prev_user)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; header('WWW-Authenticate: Basic realm="Secure"');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; header('HTTP/1.0 401 Unauthorized');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
else<br />
{<br />
&nbsp;&nbsp;&nbsp; header('WWW-Authenticate: Basic realm="Secure"');<br />
&nbsp;&nbsp;&nbsp; header('HTTP/1.0 401 Unauthorized');<br />
&nbsp;&nbsp;&nbsp; exit;<br />
}<br />
?&gt;<br />
<br />
The final set of headers is necessary because some browsers seem to unset $PHP_AUTH_USER when the location header is sent.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21714""></a>
  <div class="note">
   <strong class="user">louis dot carlier at ngroups dot com</strong>
   <a href="#21714" class="date">23-May-2002 08:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The definitive HTTP authorization code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">login_error</span><span class="keyword">()<br />
{<br />
&nbsp;echo </span><span class="string">"error - login process failed."<br />
</span><span class="keyword">}<br />
<br />
if (!isset(</span><span class="default">$PHP_AUTH_USER</span><span class="keyword">))<br />
{<br />
&nbsp;</span><span class="default">header</span><span class="keyword">(</span><span class="string">"WWW-Authenticate: Basic realm=\"Mosaic Authorization process\""</span><span class="keyword">);<br />
&nbsp;</span><span class="default">header</span><span class="keyword">(</span><span class="string">"HTTP/1.0 401 Unauthorized"</span><span class="keyword">);<br />
<br />
&nbsp;</span><span class="comment">//Result if user hits cancel button<br />
&nbsp;</span><span class="default">login_error</span><span class="keyword">();<br />
}<br />
else<br />
{<br />
<br />
&nbsp;</span><span class="comment">//check the login and password<br />
&nbsp;</span><span class="keyword">if(</span><span class="string">'=&gt;test on login and password&lt;='</span><span class="keyword">)<br />
&nbsp;{<br />
&nbsp; </span><span class="comment">//User is logged<br />
&nbsp; </span><span class="keyword">...<br />
&nbsp; ...<br />
&nbsp;}<br />
&nbsp;else<br />
&nbsp;{<br />
&nbsp; </span><span class="comment">//This re-asks three times the login and password.<br />
&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">"WWW-Authenticate: Basic realm=\"Test Authentication System\""</span><span class="keyword">);<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"HTTP/1.0 401 Unauthorized"</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">//Result if user does not give good login and pass<br />
&nbsp; </span><span class="default">login_error</span><span class="keyword">();<br />
&nbsp;}<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="18618""></a>
  <div class="note">
   <strong class="user">sjeffrey at inquesis dot com</strong>
   <a href="#18618" class="date">29-Jan-2002 03:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get it to work with IIS try using this code before setting your "$auth = 0" and the "if (isset($PHP_AUTH_USER) &amp;&amp; isset($PHP_AUTH_PW))"<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//////////////////////////////////////////<br />
<br />
</span><span class="keyword">if (</span><span class="default">$PHP_AUTH_USER </span><span class="keyword">== </span><span class="string">"" </span><span class="keyword">&amp;&amp; </span><span class="default">$PHP_AUTH_PW </span><span class="keyword">== </span><span class="string">"" </span><span class="keyword">&amp;&amp; </span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"^Basic "</span><span class="keyword">, </span><span class="default">$HTTP_AUTHORIZATION</span><span class="keyword">)) <br />
{ <br />
&nbsp; list(</span><span class="default">$PHP_AUTH_USER</span><span class="keyword">, </span><span class="default">$PHP_AUTH_PW</span><span class="keyword">) = <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">explode</span><span class="keyword">(</span><span class="string">":"</span><span class="keyword">, </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$HTTP_AUTHORIZATION</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">))); <br />
}<br />
<br />
</span><span class="comment">//////////////////////////////////////////<br />
</span><span class="default">?&gt;<br />
</span><br />
It worked for me on IIS 5 and PHP 4 in ISAPI</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="8198""></a>
  <div class="note">
   <strong class="user">owld at mail dot ru</strong>
   <a href="#8198" class="date">30-Aug-2000 03:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Good day.I've solved a problem where IE4 asks for the age one more time after a 401, defeating sending a 401 once to force a user to log on again.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function&nbsp; </span><span class="default">authenticate</span><span class="keyword">()&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">"noauth"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">Header</span><span class="keyword">( </span><span class="string">"WWW-authenticate:&nbsp; Basic realm=\"test\""</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">Header</span><span class="keyword">( </span><span class="string">"HTTP/1.0&nbsp; 401&nbsp; Unauthorized"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"You must enter user name"</span><span class="keyword">;<br />
&nbsp;&nbsp; exit ;<br />
&nbsp; }<br />
&nbsp; if&nbsp; (&nbsp;&nbsp; !isset(</span><span class="default">$PHP_AUTH_USER</span><span class="keyword">) ||&nbsp; (</span><span class="default">$logoff</span><span class="keyword">==</span><span class="default">1</span><span class="keyword">) &amp;&amp; </span><span class="default">$noauth</span><span class="keyword">==</span><span class="string">"yes"&nbsp; </span><span class="keyword">)&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">authenticate</span><span class="keyword">();<br />
&nbsp; }&nbsp; <br />
</span><span class="default">?&gt;<br />
</span><br />
And logoff link -<br />
&nbsp;<br />
&lt;a href="samehtml.phtml?logoff=1"&gt;Logoff&lt;/a&gt;&lt;/td&gt;<br />
<br />
Dmitry Alyekhin</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="5945""></a>
  <div class="note">
   <strong class="user">tigran at freenet dot am</strong>
   <a href="#5945" class="date">19-May-2000 02:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a code for the public sites enabling both logout bottom and timeout using php+mysql. Working for both browsers.<br />
The part "required" for each user protected page:<br />
<br />
&lt;?<br />
function auth () {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Header("WWW-Authenticate: Basic realm=\"ArmFN public site\"");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Header("HTTP/1.0 401 Unauthorized");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo "You have to authentificate yourself first \n";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
}<br />
<br />
mysql_connect("localhost","train","") or die("Unable to connect to SQL server"); <br />
mysql_select_db( "train") or die( "Unable to select database"); <br />
<br />
if(!isset($PHP_AUTH_USER)) {<br />
<br />
$timeout = mktime(date(G),date(i)+10,0,date("m"),date("d"),date("Y"));<br />
mysql_query("update users set login='$timeout' where id='$user' and pasw='$pass'") or die("k");<br />
<br />
&nbsp;&nbsp;&nbsp; auth();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
<br />
&nbsp;&nbsp;&nbsp; $pass = $PHP_AUTH_PW;<br />
&nbsp;&nbsp;&nbsp; $user = $PHP_AUTH_USER;<br />
<br />
$nowtime = mktime(date(G),date(i),0,date("m"),date("d"),date("Y"));<br />
$quer2 = mysql_query("select * from users where id='$user' and pasw='$pass' and login &gt; '$nowtime'") or die("kuk2");<br />
<br />
&nbsp;&nbsp;&nbsp; if (mysql_num_rows($quer2) == "0") {<br />
$timeout = mktime(date(G),date(i)+10,0,date("m"),date("d"),date("Y"));<br />
mysql_query("update users set login='$timeout' where id='$user' and pasw='$pass'") or die("k");<br />
<br />
auth();<br />
}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
?&gt;<br />
<br />
You can have a "logout" bottom with hidden $go="logout" form element and then have somewhere this part:<br />
<br />
if ($do == "logout") {<br />
mysql_connect("localhost","train","") or die("Unable to connect to SQL server"); <br />
mysql_select_db( "train") or die( "Unable to select database"); <br />
mysql_query("update users set login=0 where id='$PHP_AUTH_USER' and pasw='$PHP_AUTH_PW'") or die("k");<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="3653""></a>
  <div class="note">
   <strong class="user">rratboy at pobox dot com</strong>
   <a href="#3653" class="date">09-Feb-2000 11:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had the same problem as above (that is, with apache I can't get the auth info). The solution I found goes like this:<br />
<br />
<span class="default">&lt;?php<br />
$headers </span><span class="keyword">= </span><span class="default">getallheaders</span><span class="keyword">();<br />
</span><span class="default">$auth</span><span class="keyword">=</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'authorization'</span><span class="keyword">];<br />
if (</span><span class="default">$auth</span><span class="keyword">==</span><span class="string">''</span><span class="keyword">) { </span><span class="default">$auth</span><span class="keyword">=</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'Authorization'</span><span class="keyword">]; }<br />
<br />
if(</span><span class="default">$auth</span><span class="keyword">==</span><span class="string">''</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">Header</span><span class="keyword">(</span><span class="string">"WWW-Authenticate: Basic realm=\"</span><span class="default">$PROG_NAME</span><span class="string">\""</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">Header</span><span class="keyword">(</span><span class="string">"HTTP/1.0 401 Unauthorized"</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
list($user, $pass) = explode(":", base64_decode(substr($auth, 6)));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="features.html">Features</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="features.cookies.html">Cookies</a></div>
 <div class="up"><a href="features.html">Features</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
