<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <!-- RD version: 0.9.4  -->
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
  <title>Class: Gem::Security::Policy (Ruby 1.9.2) </title>
  <!-- raw_prefix  = '../..'   -->
  <link rel="stylesheet" href="../../css/obf.css" >

  <script src="../../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/rubydoc.js" type="text/javascript" charset="utf-8"></script> 

 
<script src="../../js/highlight.min.js"></script>
<script> 
  hljs.tabReplace = '  ';
  hljs.initHighlightingOnLoad();
  </script> 
</head>

<body id="top" class="class">
<div id="actionbar" style='display:none' >
<div class='wrapper'>
<ul class='grids g0'>
  <li class='grid-2' ><a href='/' target='_top' >Home</a></li>
  <li class='grid-2' ><a href='/core' target='_top' >Core</a></li>
  <li class='grid-2' ><a href='/stdlib' target='_top' >Std-lib</a></li>
  <li class='grid-2' ><a href='/downloads' target='_top' >Downloads</a></li>
  <li class='grid-7 right' id='rd-action-search'><form id="searchbox_011815814100681837392:wnccv6st5qk" action="/search.html"><input type="hidden" name="cx" value="011815814100681837392:wnccv6st5qk" ><input name="q" type="text" size="20" >&#160;&#160;<input type="submit" name="sa" value="Search" ><input type="hidden" name="cof" value="FORID:9" ></form>
</li>
</ul>
</div>
</div> <!-- end action bar -->
          <div class='wrapper'>
  <div id="metadata" style='display:none'>
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../../index.html">Home</a>
          <a href="../../index.html#classes">Classes</a>
          <a href="../../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../../rubygems/security_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="rubygems/security.rb">rubygems/security.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="../../Object.html">Object</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-c-trusted_cert_path">::trusted_cert_path</a></li>
          
          <li><a href="#method-i-verify_gem">#verify_gem</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../../Gem.html">Gem</a></li>
        
          <li><a href="../../Gem/Builder.html">Gem::Builder</a></li>
        
          <li><a href="../../Gem/Command.html">Gem::Command</a></li>
        
          <li><a href="../../Gem/CommandLineError.html">Gem::CommandLineError</a></li>
        
          <li><a href="../../Gem/CommandManager.html">Gem::CommandManager</a></li>
        
          <li><a href="../../Gem/Commands.html">Gem::Commands</a></li>
        
          <li><a href="../../Gem/Commands/BuildCommand.html">Gem::Commands::BuildCommand</a></li>
        
          <li><a href="../../Gem/Commands/CertCommand.html">Gem::Commands::CertCommand</a></li>
        
          <li><a href="../../Gem/Commands/CheckCommand.html">Gem::Commands::CheckCommand</a></li>
        
          <li><a href="../../Gem/Commands/CleanupCommand.html">Gem::Commands::CleanupCommand</a></li>
        
          <li><a href="../../Gem/Commands/ContentsCommand.html">Gem::Commands::ContentsCommand</a></li>
        
          <li><a href="../../Gem/Commands/DependencyCommand.html">Gem::Commands::DependencyCommand</a></li>
        
          <li><a href="../../Gem/Commands/EnvironmentCommand.html">Gem::Commands::EnvironmentCommand</a></li>
        
          <li><a href="../../Gem/Commands/FetchCommand.html">Gem::Commands::FetchCommand</a></li>
        
          <li><a href="../../Gem/Commands/GenerateIndexCommand.html">Gem::Commands::GenerateIndexCommand</a></li>
        
          <li><a href="../../Gem/Commands/HelpCommand.html">Gem::Commands::HelpCommand</a></li>
        
          <li><a href="../../Gem/Commands/InstallCommand.html">Gem::Commands::InstallCommand</a></li>
        
          <li><a href="../../Gem/Commands/ListCommand.html">Gem::Commands::ListCommand</a></li>
        
          <li><a href="../../Gem/Commands/LockCommand.html">Gem::Commands::LockCommand</a></li>
        
          <li><a href="../../Gem/Commands/MirrorCommand.html">Gem::Commands::MirrorCommand</a></li>
        
          <li><a href="../../Gem/Commands/OutdatedCommand.html">Gem::Commands::OutdatedCommand</a></li>
        
          <li><a href="../../Gem/Commands/OwnerCommand.html">Gem::Commands::OwnerCommand</a></li>
        
          <li><a href="../../Gem/Commands/PristineCommand.html">Gem::Commands::PristineCommand</a></li>
        
          <li><a href="../../Gem/Commands/PushCommand.html">Gem::Commands::PushCommand</a></li>
        
          <li><a href="../../Gem/Commands/QueryCommand.html">Gem::Commands::QueryCommand</a></li>
        
          <li><a href="../../Gem/Commands/RdocCommand.html">Gem::Commands::RdocCommand</a></li>
        
          <li><a href="../../Gem/Commands/SearchCommand.html">Gem::Commands::SearchCommand</a></li>
        
          <li><a href="../../Gem/Commands/ServerCommand.html">Gem::Commands::ServerCommand</a></li>
        
          <li><a href="../../Gem/Commands/SetupCommand.html">Gem::Commands::SetupCommand</a></li>
        
          <li><a href="../../Gem/Commands/SourcesCommand.html">Gem::Commands::SourcesCommand</a></li>
        
          <li><a href="../../Gem/Commands/SpecificationCommand.html">Gem::Commands::SpecificationCommand</a></li>
        
          <li><a href="../../Gem/Commands/StaleCommand.html">Gem::Commands::StaleCommand</a></li>
        
          <li><a href="../../Gem/Commands/UninstallCommand.html">Gem::Commands::UninstallCommand</a></li>
        
          <li><a href="../../Gem/Commands/UnpackCommand.html">Gem::Commands::UnpackCommand</a></li>
        
          <li><a href="../../Gem/Commands/UpdateCommand.html">Gem::Commands::UpdateCommand</a></li>
        
          <li><a href="../../Gem/Commands/WhichCommand.html">Gem::Commands::WhichCommand</a></li>
        
          <li><a href="../../Gem/ConfigFile.html">Gem::ConfigFile</a></li>
        
          <li><a href="../../Gem/ConsoleUI.html">Gem::ConsoleUI</a></li>
        
          <li><a href="../../Gem/DefaultUserInteraction.html">Gem::DefaultUserInteraction</a></li>
        
          <li><a href="../../Gem/Dependency.html">Gem::Dependency</a></li>
        
          <li><a href="../../Gem/DependencyError.html">Gem::DependencyError</a></li>
        
          <li><a href="../../Gem/DependencyInstaller.html">Gem::DependencyInstaller</a></li>
        
          <li><a href="../../Gem/DependencyList.html">Gem::DependencyList</a></li>
        
          <li><a href="../../Gem/DependencyRemovalException.html">Gem::DependencyRemovalException</a></li>
        
          <li><a href="../../Gem/DocManager.html">Gem::DocManager</a></li>
        
          <li><a href="../../Gem/DocumentError.html">Gem::DocumentError</a></li>
        
          <li><a href="../../Gem/EndOfYAMLException.html">Gem::EndOfYAMLException</a></li>
        
          <li><a href="../../Gem/ErrorReason.html">Gem::ErrorReason</a></li>
        
          <li><a href="../../Gem/Exception.html">Gem::Exception</a></li>
        
          <li><a href="../../Gem/Ext.html">Gem::Ext</a></li>
        
          <li><a href="../../Gem/Ext/Builder.html">Gem::Ext::Builder</a></li>
        
          <li><a href="../../Gem/Ext/ConfigureBuilder.html">Gem::Ext::ConfigureBuilder</a></li>
        
          <li><a href="../../Gem/Ext/ExtConfBuilder.html">Gem::Ext::ExtConfBuilder</a></li>
        
          <li><a href="../../Gem/Ext/RakeBuilder.html">Gem::Ext::RakeBuilder</a></li>
        
          <li><a href="../../Gem/FakeFetcher.html">Gem::FakeFetcher</a></li>
        
          <li><a href="../../Gem/FileOperations.html">Gem::FileOperations</a></li>
        
          <li><a href="../../Gem/FilePermissionError.html">Gem::FilePermissionError</a></li>
        
          <li><a href="../../Gem/Format.html">Gem::Format</a></li>
        
          <li><a href="../../Gem/FormatException.html">Gem::FormatException</a></li>
        
          <li><a href="../../Gem/GemNotFoundException.html">Gem::GemNotFoundException</a></li>
        
          <li><a href="../../Gem/GemNotInHomeException.html">Gem::GemNotInHomeException</a></li>
        
          <li><a href="../../Gem/GemPathSearcher.html">Gem::GemPathSearcher</a></li>
        
          <li><a href="../../Gem/GemRunner.html">Gem::GemRunner</a></li>
        
          <li><a href="../../Gem/GemcutterUtilities.html">Gem::GemcutterUtilities</a></li>
        
          <li><a href="../../Gem/Indexer.html">Gem::Indexer</a></li>
        
          <li><a href="../../Gem/InstallError.html">Gem::InstallError</a></li>
        
          <li><a href="../../Gem/InstallUpdateOptions.html">Gem::InstallUpdateOptions</a></li>
        
          <li><a href="../../Gem/Installer.html">Gem::Installer</a></li>
        
          <li><a href="../../Gem/Installer/ExtensionBuildError.html">Gem::Installer::ExtensionBuildError</a></li>
        
          <li><a href="../../Gem/InvalidSpecificationException.html">Gem::InvalidSpecificationException</a></li>
        
          <li><a href="../../Gem/LoadError.html">Gem::LoadError</a></li>
        
          <li><a href="../../Gem/LocalRemoteOptions.html">Gem::LocalRemoteOptions</a></li>
        
          <li><a href="../../Gem/OldFormat.html">Gem::OldFormat</a></li>
        
          <li><a href="../../Gem/OperationNotSupportedError.html">Gem::OperationNotSupportedError</a></li>
        
          <li><a href="../../Gem/Package.html">Gem::Package</a></li>
        
          <li><a href="../../Gem/Package/BadCheckSum.html">Gem::Package::BadCheckSum</a></li>
        
          <li><a href="../../Gem/Package/ClosedIO.html">Gem::Package::ClosedIO</a></li>
        
          <li><a href="../../Gem/Package/Error.html">Gem::Package::Error</a></li>
        
          <li><a href="../../Gem/Package/FSyncDir.html">Gem::Package::FSyncDir</a></li>
        
          <li><a href="../../Gem/Package/FormatError.html">Gem::Package::FormatError</a></li>
        
          <li><a href="../../Gem/Package/NonSeekableIO.html">Gem::Package::NonSeekableIO</a></li>
        
          <li><a href="../../Gem/Package/TarHeader.html">Gem::Package::TarHeader</a></li>
        
          <li><a href="../../Gem/Package/TarOutput.html">Gem::Package::TarOutput</a></li>
        
          <li><a href="../../Gem/Package/TarReader.html">Gem::Package::TarReader</a></li>
        
          <li><a href="../../Gem/Package/TarReader/UnexpectedEOF.html">Gem::Package::TarReader::UnexpectedEOF</a></li>
        
          <li><a href="../../Gem/Package/TarWriter.html">Gem::Package::TarWriter</a></li>
        
          <li><a href="../../Gem/Package/TarWriter/BoundedStream.html">Gem::Package::TarWriter::BoundedStream</a></li>
        
          <li><a href="../../Gem/Package/TarWriter/FileOverflow.html">Gem::Package::TarWriter::FileOverflow</a></li>
        
          <li><a href="../../Gem/Package/TarWriter/RestrictedStream.html">Gem::Package::TarWriter::RestrictedStream</a></li>
        
          <li><a href="../../Gem/Package/TooLongFileName.html">Gem::Package::TooLongFileName</a></li>
        
          <li><a href="../../Gem/PackageTask.html">Gem::PackageTask</a></li>
        
          <li><a href="../../Gem/Platform.html">Gem::Platform</a></li>
        
          <li><a href="../../Gem/PlatformMismatch.html">Gem::PlatformMismatch</a></li>
        
          <li><a href="../../Gem/RemoteError.html">Gem::RemoteError</a></li>
        
          <li><a href="../../Gem/RemoteFetcher.html">Gem::RemoteFetcher</a></li>
        
          <li><a href="../../Gem/RemoteFetcher/FetchError.html">Gem::RemoteFetcher::FetchError</a></li>
        
          <li><a href="../../Gem/RemoteInstallationCancelled.html">Gem::RemoteInstallationCancelled</a></li>
        
          <li><a href="../../Gem/RemoteInstallationSkipped.html">Gem::RemoteInstallationSkipped</a></li>
        
          <li><a href="../../Gem/RemoteSourceException.html">Gem::RemoteSourceException</a></li>
        
          <li><a href="../../Gem/RequirePathsBuilder.html">Gem::RequirePathsBuilder</a></li>
        
          <li><a href="../../Gem/Requirement.html">Gem::Requirement</a></li>
        
          <li><a href="../../Gem/Requirement.html">Gem::Requirement</a></li>
        
          <li><a href="../../Gem/Security.html">Gem::Security</a></li>
        
          <li><a href="../../Gem/Security/Exception.html">Gem::Security::Exception</a></li>
        
          <li><a href="../../Gem/Security/Policy.html">Gem::Security::Policy</a></li>
        
          <li><a href="../../Gem/Security/Signer.html">Gem::Security::Signer</a></li>
        
          <li><a href="../../Gem/Server.html">Gem::Server</a></li>
        
          <li><a href="../../Gem/SilentUI.html">Gem::SilentUI</a></li>
        
          <li><a href="../../Gem/SourceIndex.html">Gem::SourceIndex</a></li>
        
          <li><a href="../../Gem/SourceInfoCache.html">Gem::SourceInfoCache</a></li>
        
          <li><a href="../../Gem/SourceInfoCacheEntry.html">Gem::SourceInfoCacheEntry</a></li>
        
          <li><a href="../../Gem/SpecFetcher.html">Gem::SpecFetcher</a></li>
        
          <li><a href="../../Gem/Specification.html">Gem::Specification</a></li>
        
          <li><a href="../../Gem/StreamUI.html">Gem::StreamUI</a></li>
        
          <li><a href="../../Gem/StreamUI/SilentProgressReporter.html">Gem::StreamUI::SilentProgressReporter</a></li>
        
          <li><a href="../../Gem/StreamUI/SimpleProgressReporter.html">Gem::StreamUI::SimpleProgressReporter</a></li>
        
          <li><a href="../../Gem/StreamUI/VerboseProgressReporter.html">Gem::StreamUI::VerboseProgressReporter</a></li>
        
          <li><a href="../../Gem/SystemExitException.html">Gem::SystemExitException</a></li>
        
          <li><a href="../../Gem/Text.html">Gem::Text</a></li>
        
          <li><a href="../../Gem/Uninstaller.html">Gem::Uninstaller</a></li>
        
          <li><a href="../../Gem/UserInteraction.html">Gem::UserInteraction</a></li>
        
          <li><a href="../../Gem/Validator.html">Gem::Validator</a></li>
        
          <li><a href="../../Gem/VerificationError.html">Gem::VerificationError</a></li>
        
          <li><a href="../../Gem/Version.html">Gem::Version</a></li>
        
          <li><a href="../../Gem/VersionOption.html">Gem::VersionOption</a></li>
        
          <li><a href="../../OpenSSL.html">OpenSSL</a></li>
        
          <li><a href="../../OpenSSL/X509.html">OpenSSL::X509</a></li>
        
          <li><a href="../../Date.html">Date</a></li>
        
          <li><a href="../../Kernel.html">Kernel</a></li>
        
          <li><a href="../../Object.html">Object</a></li>
        
          <li><a href="../../RbConfig.html">RbConfig</a></li>
        
          <li><a href="../../TempIO.html">TempIO</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation" style='margin: 10px 10px 10px 10px'>
    <h1 class="class">Gem::Security::Policy</h1>

    <div id="description" class="description">
      
<p>A <a href="Policy.html">Gem::Security::Policy</a> object encapsulates the
settings for verifying signed gem files.  This is the base class.  You can
either declare an instance of this or use one of the preset security
policies below.</p>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      
      <!-- Attributes -->
      <div id="attribute-method-details" class="method-section section">
        <h3 class="section-header">Attributes</h3>

        
        <div id="only_signed-attribute-method" class="method-detail">
          <a name="only_signed"></a>
          
          <a name="only_signed="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">only_signed</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="only_trusted-attribute-method" class="method-detail">
          <a name="only_trusted"></a>
          
          <a name="only_trusted="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">only_trusted</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="verify_chain-attribute-method" class="method-detail">
          <a name="verify_chain"></a>
          
          <a name="verify_chain="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">verify_chain</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="verify_data-attribute-method" class="method-detail">
          <a name="verify_data"></a>
          
          <a name="verify_data="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">verify_data</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="verify_root-attribute-method" class="method-detail">
          <a name="verify_root"></a>
          
          <a name="verify_root="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">verify_root</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="verify_signer-attribute-method" class="method-detail">
          <a name="verify_signer"></a>
          
          <a name="verify_signer="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">verify_signer</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
      </div><!-- attribute-method-details -->
      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">(policy = {}, opt = {})</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Create a new <a href="Policy.html">Gem::Security::Policy</a> object with
the given mode and options.</p>
            

            
            <div class="method-source-code" id="new-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/security.rb, line 381</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">policy</span> = {}, <span class="ruby-identifier">opt</span> = {})
  <span class="ruby-comment"># set options</span>
  <span class="ruby-ivar">@opt</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span><span class="ruby-operator">::</span><span class="ruby-constant">OPT</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opt</span>)

  <span class="ruby-comment"># build policy</span>
  <span class="ruby-identifier">policy</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">key</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:verify_data</span>   <span class="ruby-keyword">then</span> <span class="ruby-ivar">@verify_data</span>   = <span class="ruby-identifier">val</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:verify_signer</span> <span class="ruby-keyword">then</span> <span class="ruby-ivar">@verify_signer</span> = <span class="ruby-identifier">val</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:verify_chain</span>  <span class="ruby-keyword">then</span> <span class="ruby-ivar">@verify_chain</span>  = <span class="ruby-identifier">val</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:verify_root</span>   <span class="ruby-keyword">then</span> <span class="ruby-ivar">@verify_root</span>   = <span class="ruby-identifier">val</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:only_trusted</span>  <span class="ruby-keyword">then</span> <span class="ruby-ivar">@only_trusted</span>  = <span class="ruby-identifier">val</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:only_signed</span>   <span class="ruby-keyword">then</span> <span class="ruby-ivar">@only_signed</span>   = <span class="ruby-identifier">val</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
        <div id="trusted_cert_path-method" class="method-detail ">
          <a name="method-c-trusted_cert_path"></a>

          
          <div class="method-heading">
            <span class="method-name">trusted_cert_path</span><span
              class="method-args">(cert, opt = {})</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Get the path to the file for this cert.</p>
            

            
            <div class="method-source-code" id="trusted_cert_path-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/security.rb, line 401</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">trusted_cert_path</span>(<span class="ruby-identifier">cert</span>, <span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">opt</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span><span class="ruby-operator">::</span><span class="ruby-constant">OPT</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opt</span>)

  <span class="ruby-comment"># get digest algorithm, calculate checksum of root.subject</span>
  <span class="ruby-identifier">algo</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:dgst_algo</span>]
  <span class="ruby-identifier">dgst</span> = <span class="ruby-identifier">algo</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-identifier">cert</span>.<span class="ruby-identifier">subject</span>.<span class="ruby-identifier">to_s</span>)

  <span class="ruby-comment"># build path to trusted cert file</span>
  <span class="ruby-identifier">name</span> = <span class="ruby-node">&quot;cert-#{dgst}.pem&quot;</span>

  <span class="ruby-comment"># join and return path components</span>
  <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-identifier">join</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:trust_dir</span>], <span class="ruby-identifier">name</span>)
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- trusted_cert_path-source -->
            
          </div>

          

          
        </div><!-- trusted_cert_path-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="verify_gem-method" class="method-detail ">
          <a name="method-i-verify_gem"></a>

          
          <div class="method-heading">
            <span class="method-name">verify_gem</span><span
              class="method-args">(signature, data, chain, time = Time.now)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Verify that the gem data with the given signature and signing chain matched
this security policy at the specified time.</p>
            

            
            <div class="method-source-code" id="verify_gem-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/security.rb, line 419</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">verify_gem</span>(<span class="ruby-identifier">signature</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">chain</span>, <span class="ruby-identifier">time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ensure_ssl_available</span>
  <span class="ruby-identifier">cert_class</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>
  <span class="ruby-identifier">exc</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span><span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>
  <span class="ruby-identifier">chain</span> <span class="ruby-operator">||=</span> []

  <span class="ruby-identifier">chain</span> = <span class="ruby-identifier">chain</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">str</span><span class="ruby-operator">|</span> <span class="ruby-identifier">cert_class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">str</span>) }
  <span class="ruby-identifier">signer</span>, <span class="ruby-identifier">ch_len</span> = <span class="ruby-identifier">chain</span>[<span class="ruby-value">-1</span>], <span class="ruby-identifier">chain</span>.<span class="ruby-identifier">size</span>

  <span class="ruby-comment"># make sure signature is valid</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verify_data</span>
    <span class="ruby-comment"># get digest algorithm (TODO: this should be configurable)</span>
    <span class="ruby-identifier">dgst</span> = <span class="ruby-ivar">@opt</span>[<span class="ruby-value">:dgst_algo</span>]

    <span class="ruby-comment"># verify the data signature (this is the most important part, so don't</span>
    <span class="ruby-comment"># screw it up :D)</span>
    <span class="ruby-identifier">v</span> = <span class="ruby-identifier">signer</span>.<span class="ruby-identifier">public_key</span>.<span class="ruby-identifier">verify</span>(<span class="ruby-identifier">dgst</span>.<span class="ruby-identifier">new</span>, <span class="ruby-identifier">signature</span>, <span class="ruby-identifier">data</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-identifier">exc</span>, <span class="ruby-string">&quot;Invalid Gem Signature&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span>

    <span class="ruby-comment"># make sure the signer is valid</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verify_signer</span>
      <span class="ruby-comment"># make sure the signing cert is valid right now</span>
      <span class="ruby-identifier">v</span> = <span class="ruby-identifier">signer</span>.<span class="ruby-identifier">check_validity</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">time</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-identifier">exc</span>, <span class="ruby-node">&quot;Invalid Signature: #{v[:desc]}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">:is_valid</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># make sure the certificate chain is valid</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verify_chain</span>
    <span class="ruby-comment"># iterate down over the chain and verify each certificate against it's</span>
    <span class="ruby-comment"># issuer</span>
    (<span class="ruby-identifier">ch_len</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">downto</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">issuer</span>, <span class="ruby-identifier">cert</span> = <span class="ruby-identifier">chain</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">2</span>]
      <span class="ruby-identifier">v</span> = <span class="ruby-identifier">cert</span>.<span class="ruby-identifier">check_validity</span>(<span class="ruby-identifier">issuer</span>, <span class="ruby-identifier">time</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-identifier">exc</span>, <span class="ruby-string">&quot;%s: cert = '%s', error = '%s'&quot;</span> <span class="ruby-operator">%</span> [
          <span class="ruby-string">'Invalid Signing Chain'</span>, <span class="ruby-identifier">cert</span>.<span class="ruby-identifier">subject</span>, <span class="ruby-identifier">v</span>[<span class="ruby-value">:desc</span>]
      ] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">:is_valid</span>]
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># verify root of chain</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verify_root</span>
      <span class="ruby-comment"># make sure root is self-signed</span>
      <span class="ruby-identifier">root</span> = <span class="ruby-identifier">chain</span>[<span class="ruby-value">0</span>]
      <span class="ruby-identifier">raise</span> <span class="ruby-identifier">exc</span>, <span class="ruby-string">&quot;%s: %s (subject = '%s', issuer = '%s')&quot;</span> <span class="ruby-operator">%</span> [
          <span class="ruby-string">'Invalid Signing Chain Root'</span>,
          <span class="ruby-string">'Subject does not match Issuer for Gem Signing Chain'</span>,
          <span class="ruby-identifier">root</span>.<span class="ruby-identifier">subject</span>.<span class="ruby-identifier">to_s</span>,
          <span class="ruby-identifier">root</span>.<span class="ruby-identifier">issuer</span>.<span class="ruby-identifier">to_s</span>,
      ] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">issuer</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">subject</span>.<span class="ruby-identifier">to_s</span>

      <span class="ruby-comment"># make sure root is valid</span>
      <span class="ruby-identifier">v</span> = <span class="ruby-identifier">root</span>.<span class="ruby-identifier">check_validity</span>(<span class="ruby-identifier">root</span>, <span class="ruby-identifier">time</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-identifier">exc</span>, <span class="ruby-string">&quot;%s: cert = '%s', error = '%s'&quot;</span> <span class="ruby-operator">%</span> [
          <span class="ruby-string">'Invalid Signing Chain Root'</span>, <span class="ruby-identifier">root</span>.<span class="ruby-identifier">subject</span>, <span class="ruby-identifier">v</span>[<span class="ruby-value">:desc</span>]
      ] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">:is_valid</span>]

      <span class="ruby-comment"># verify that the chain root is trusted</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@only_trusted</span>
        <span class="ruby-comment"># get digest algorithm, calculate checksum of root.subject</span>
        <span class="ruby-identifier">algo</span> = <span class="ruby-ivar">@opt</span>[<span class="ruby-value">:dgst_algo</span>]
        <span class="ruby-identifier">path</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span><span class="ruby-operator">::</span><span class="ruby-constant">Policy</span>.<span class="ruby-identifier">trusted_cert_path</span>(<span class="ruby-identifier">root</span>, <span class="ruby-ivar">@opt</span>)

        <span class="ruby-comment"># check to make sure trusted path exists</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-identifier">exc</span>, <span class="ruby-string">&quot;%s: cert = '%s', error = '%s'&quot;</span> <span class="ruby-operator">%</span> [
            <span class="ruby-string">'Untrusted Signing Chain Root'</span>,
            <span class="ruby-identifier">root</span>.<span class="ruby-identifier">subject</span>.<span class="ruby-identifier">to_s</span>,
            <span class="ruby-node">&quot;path \&quot;#{path}\&quot; does not exist&quot;</span>,
        ] <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>)

        <span class="ruby-comment"># load calculate digest from saved cert file</span>
        <span class="ruby-identifier">save_cert</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">path</span>))
        <span class="ruby-identifier">save_dgst</span> = <span class="ruby-identifier">algo</span>.<span class="ruby-identifier">digest</span>(<span class="ruby-identifier">save_cert</span>.<span class="ruby-identifier">public_key</span>.<span class="ruby-identifier">to_s</span>)

        <span class="ruby-comment"># create digest of public key</span>
        <span class="ruby-identifier">pkey_str</span> = <span class="ruby-identifier">root</span>.<span class="ruby-identifier">public_key</span>.<span class="ruby-identifier">to_s</span>
        <span class="ruby-identifier">cert_dgst</span> = <span class="ruby-identifier">algo</span>.<span class="ruby-identifier">digest</span>(<span class="ruby-identifier">pkey_str</span>)

        <span class="ruby-comment"># now compare the two digests, raise exception</span>
        <span class="ruby-comment"># if they don't match</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-identifier">exc</span>, <span class="ruby-string">&quot;%s: %s (saved = '%s', root = '%s')&quot;</span> <span class="ruby-operator">%</span> [
            <span class="ruby-string">'Invalid Signing Chain Root'</span>,
            <span class="ruby-string">&quot;Saved checksum doesn't match root checksum&quot;</span>,
            <span class="ruby-identifier">save_dgst</span>, <span class="ruby-identifier">cert_dgst</span>,
        ] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">save_dgst</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">cert_dgst</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># return the signing chain</span>
    <span class="ruby-identifier">chain</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cert</span><span class="ruby-operator">|</span> <span class="ruby-identifier">cert</span>.<span class="ruby-identifier">subject</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- verify_gem-source -->
            
          </div>

          

          
        </div><!-- verify_gem-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->
<div id="disqus_thread" style='display:none'></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    // var disqus_shortname = 'rubydocbeta'; // required 
    var disqus_shortname = 'ruby-doc'; // required 
    
    var disqus_developer = true; // DEBUGGERY
    


    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink" style='display:none'>blog comments powered by <span class="logo-disqus">Disqus</span></a>

<div class='grids wrapper' id="footer">
  <p><small>This page was generated for Ruby 1.9.2</small></p> 
  
   <p> <a href="http://www.ruby-doc.org">Ruby-doc.org</a> is managed by <a href="http://www.jamesbritt.com">James Britt</a> and <a href="http://www.neurogami.com">Neurogami</a>. <a href="http://www.neurogami.com">Live curious.</a> </p>
 
    <p><small>Generated with the <a href="http://neurogami.com/code/">Rubydoc Rdoc Generator</a> 0.9.4</small>.</p>
  </div>

</div>

<script type="text/javascript">
var _uacct = "UA-335317-2";
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{ 
var pageTracker = _gat._getTracker(_uacct);
pageTracker._trackPageview();
} catch(err) {} 
</script>
</body>
</html>

