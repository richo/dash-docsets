<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <!-- RD version: 0.9.4  -->
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
  <title>Class: Gem::Indexer (Ruby 1.9.2) </title>
  <!-- raw_prefix  = '..'   -->
  <link rel="stylesheet" href="../css/obf.css" >

  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/rubydoc.js" type="text/javascript" charset="utf-8"></script> 

 
<script src="../js/highlight.min.js"></script>
<script> 
  hljs.tabReplace = '  ';
  hljs.initHighlightingOnLoad();
  </script> 
</head>

<body id="top" class="class">
<div id="actionbar" style='display:none' >
<div class='wrapper'>
<ul class='grids g0'>
  <li class='grid-2' ><a href='/' target='_top' >Home</a></li>
  <li class='grid-2' ><a href='/core' target='_top' >Core</a></li>
  <li class='grid-2' ><a href='/stdlib' target='_top' >Std-lib</a></li>
  <li class='grid-2' ><a href='/downloads' target='_top' >Downloads</a></li>
  <li class='grid-7 right' id='rd-action-search'><form id="searchbox_011815814100681837392:wnccv6st5qk" action="/search.html"><input type="hidden" name="cx" value="011815814100681837392:wnccv6st5qk" ><input name="q" type="text" size="20" >&#160;&#160;<input type="submit" name="sa" value="Search" ><input type="hidden" name="cof" value="FORID:9" ></form>
</li>
</ul>
</div>
</div> <!-- end action bar -->
          <div class='wrapper'>
  <div id="metadata" style='display:none'>
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../rubygems/indexer_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="rubygems/indexer.rb">rubygems/indexer.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="../Object.html">Object</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-i-abbreviate">#abbreviate</a></li>
          
          <li><a href="#method-i-build_indicies">#build_indicies</a></li>
          
          <li><a href="#method-i-build_legacy_indicies">#build_legacy_indicies</a></li>
          
          <li><a href="#method-i-build_marshal_gemspecs">#build_marshal_gemspecs</a></li>
          
          <li><a href="#method-i-build_modern_index">#build_modern_index</a></li>
          
          <li><a href="#method-i-build_modern_indicies">#build_modern_indicies</a></li>
          
          <li><a href="#method-i-build_rss">#build_rss</a></li>
          
          <li><a href="#method-i-collect_specs">#collect_specs</a></li>
          
          <li><a href="#method-i-compact_specs">#compact_specs</a></li>
          
          <li><a href="#method-i-compress">#compress</a></li>
          
          <li><a href="#method-i-compress_indicies">#compress_indicies</a></li>
          
          <li><a href="#method-i-gem_file_list">#gem_file_list</a></li>
          
          <li><a href="#method-i-generate_index">#generate_index</a></li>
          
          <li><a href="#method-i-gzip">#gzip</a></li>
          
          <li><a href="#method-i-install_indicies">#install_indicies</a></li>
          
          <li><a href="#method-i-make_temp_directories">#make_temp_directories</a></li>
          
          <li><a href="#method-i-paranoid">#paranoid</a></li>
          
          <li><a href="#method-i-sanitize">#sanitize</a></li>
          
          <li><a href="#method-i-sanitize_string">#sanitize_string</a></li>
          
          <li><a href="#method-i-update_index">#update_index</a></li>
          
          <li><a href="#method-i-update_specs_index">#update_specs_index</a></li>
          
        </ul>
      </div>
      

      
      <!-- Included Modules -->
      <div id="includes-section" class="section">
        <h3 class="section-header">Included Modules</h3>
        <ul class="link-list">
        
        
          <li><a class="include" href="UserInteraction.html">Gem::UserInteraction</a></li>
        
        
        </ul>
      </div>
      
    </div>

    <div id="project-metadata">
      
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../Gem.html">Gem</a></li>
        
          <li><a href="../Gem/Builder.html">Gem::Builder</a></li>
        
          <li><a href="../Gem/Command.html">Gem::Command</a></li>
        
          <li><a href="../Gem/CommandLineError.html">Gem::CommandLineError</a></li>
        
          <li><a href="../Gem/CommandManager.html">Gem::CommandManager</a></li>
        
          <li><a href="../Gem/Commands.html">Gem::Commands</a></li>
        
          <li><a href="../Gem/Commands/BuildCommand.html">Gem::Commands::BuildCommand</a></li>
        
          <li><a href="../Gem/Commands/CertCommand.html">Gem::Commands::CertCommand</a></li>
        
          <li><a href="../Gem/Commands/CheckCommand.html">Gem::Commands::CheckCommand</a></li>
        
          <li><a href="../Gem/Commands/CleanupCommand.html">Gem::Commands::CleanupCommand</a></li>
        
          <li><a href="../Gem/Commands/ContentsCommand.html">Gem::Commands::ContentsCommand</a></li>
        
          <li><a href="../Gem/Commands/DependencyCommand.html">Gem::Commands::DependencyCommand</a></li>
        
          <li><a href="../Gem/Commands/EnvironmentCommand.html">Gem::Commands::EnvironmentCommand</a></li>
        
          <li><a href="../Gem/Commands/FetchCommand.html">Gem::Commands::FetchCommand</a></li>
        
          <li><a href="../Gem/Commands/GenerateIndexCommand.html">Gem::Commands::GenerateIndexCommand</a></li>
        
          <li><a href="../Gem/Commands/HelpCommand.html">Gem::Commands::HelpCommand</a></li>
        
          <li><a href="../Gem/Commands/InstallCommand.html">Gem::Commands::InstallCommand</a></li>
        
          <li><a href="../Gem/Commands/ListCommand.html">Gem::Commands::ListCommand</a></li>
        
          <li><a href="../Gem/Commands/LockCommand.html">Gem::Commands::LockCommand</a></li>
        
          <li><a href="../Gem/Commands/MirrorCommand.html">Gem::Commands::MirrorCommand</a></li>
        
          <li><a href="../Gem/Commands/OutdatedCommand.html">Gem::Commands::OutdatedCommand</a></li>
        
          <li><a href="../Gem/Commands/OwnerCommand.html">Gem::Commands::OwnerCommand</a></li>
        
          <li><a href="../Gem/Commands/PristineCommand.html">Gem::Commands::PristineCommand</a></li>
        
          <li><a href="../Gem/Commands/PushCommand.html">Gem::Commands::PushCommand</a></li>
        
          <li><a href="../Gem/Commands/QueryCommand.html">Gem::Commands::QueryCommand</a></li>
        
          <li><a href="../Gem/Commands/RdocCommand.html">Gem::Commands::RdocCommand</a></li>
        
          <li><a href="../Gem/Commands/SearchCommand.html">Gem::Commands::SearchCommand</a></li>
        
          <li><a href="../Gem/Commands/ServerCommand.html">Gem::Commands::ServerCommand</a></li>
        
          <li><a href="../Gem/Commands/SetupCommand.html">Gem::Commands::SetupCommand</a></li>
        
          <li><a href="../Gem/Commands/SourcesCommand.html">Gem::Commands::SourcesCommand</a></li>
        
          <li><a href="../Gem/Commands/SpecificationCommand.html">Gem::Commands::SpecificationCommand</a></li>
        
          <li><a href="../Gem/Commands/StaleCommand.html">Gem::Commands::StaleCommand</a></li>
        
          <li><a href="../Gem/Commands/UninstallCommand.html">Gem::Commands::UninstallCommand</a></li>
        
          <li><a href="../Gem/Commands/UnpackCommand.html">Gem::Commands::UnpackCommand</a></li>
        
          <li><a href="../Gem/Commands/UpdateCommand.html">Gem::Commands::UpdateCommand</a></li>
        
          <li><a href="../Gem/Commands/WhichCommand.html">Gem::Commands::WhichCommand</a></li>
        
          <li><a href="../Gem/ConfigFile.html">Gem::ConfigFile</a></li>
        
          <li><a href="../Gem/ConsoleUI.html">Gem::ConsoleUI</a></li>
        
          <li><a href="../Gem/DefaultUserInteraction.html">Gem::DefaultUserInteraction</a></li>
        
          <li><a href="../Gem/Dependency.html">Gem::Dependency</a></li>
        
          <li><a href="../Gem/DependencyError.html">Gem::DependencyError</a></li>
        
          <li><a href="../Gem/DependencyInstaller.html">Gem::DependencyInstaller</a></li>
        
          <li><a href="../Gem/DependencyList.html">Gem::DependencyList</a></li>
        
          <li><a href="../Gem/DependencyRemovalException.html">Gem::DependencyRemovalException</a></li>
        
          <li><a href="../Gem/DocManager.html">Gem::DocManager</a></li>
        
          <li><a href="../Gem/DocumentError.html">Gem::DocumentError</a></li>
        
          <li><a href="../Gem/EndOfYAMLException.html">Gem::EndOfYAMLException</a></li>
        
          <li><a href="../Gem/ErrorReason.html">Gem::ErrorReason</a></li>
        
          <li><a href="../Gem/Exception.html">Gem::Exception</a></li>
        
          <li><a href="../Gem/Ext.html">Gem::Ext</a></li>
        
          <li><a href="../Gem/Ext/Builder.html">Gem::Ext::Builder</a></li>
        
          <li><a href="../Gem/Ext/ConfigureBuilder.html">Gem::Ext::ConfigureBuilder</a></li>
        
          <li><a href="../Gem/Ext/ExtConfBuilder.html">Gem::Ext::ExtConfBuilder</a></li>
        
          <li><a href="../Gem/Ext/RakeBuilder.html">Gem::Ext::RakeBuilder</a></li>
        
          <li><a href="../Gem/FakeFetcher.html">Gem::FakeFetcher</a></li>
        
          <li><a href="../Gem/FileOperations.html">Gem::FileOperations</a></li>
        
          <li><a href="../Gem/FilePermissionError.html">Gem::FilePermissionError</a></li>
        
          <li><a href="../Gem/Format.html">Gem::Format</a></li>
        
          <li><a href="../Gem/FormatException.html">Gem::FormatException</a></li>
        
          <li><a href="../Gem/GemNotFoundException.html">Gem::GemNotFoundException</a></li>
        
          <li><a href="../Gem/GemNotInHomeException.html">Gem::GemNotInHomeException</a></li>
        
          <li><a href="../Gem/GemPathSearcher.html">Gem::GemPathSearcher</a></li>
        
          <li><a href="../Gem/GemRunner.html">Gem::GemRunner</a></li>
        
          <li><a href="../Gem/GemcutterUtilities.html">Gem::GemcutterUtilities</a></li>
        
          <li><a href="../Gem/Indexer.html">Gem::Indexer</a></li>
        
          <li><a href="../Gem/InstallError.html">Gem::InstallError</a></li>
        
          <li><a href="../Gem/InstallUpdateOptions.html">Gem::InstallUpdateOptions</a></li>
        
          <li><a href="../Gem/Installer.html">Gem::Installer</a></li>
        
          <li><a href="../Gem/Installer/ExtensionBuildError.html">Gem::Installer::ExtensionBuildError</a></li>
        
          <li><a href="../Gem/InvalidSpecificationException.html">Gem::InvalidSpecificationException</a></li>
        
          <li><a href="../Gem/LoadError.html">Gem::LoadError</a></li>
        
          <li><a href="../Gem/LocalRemoteOptions.html">Gem::LocalRemoteOptions</a></li>
        
          <li><a href="../Gem/OldFormat.html">Gem::OldFormat</a></li>
        
          <li><a href="../Gem/OperationNotSupportedError.html">Gem::OperationNotSupportedError</a></li>
        
          <li><a href="../Gem/Package.html">Gem::Package</a></li>
        
          <li><a href="../Gem/Package/BadCheckSum.html">Gem::Package::BadCheckSum</a></li>
        
          <li><a href="../Gem/Package/ClosedIO.html">Gem::Package::ClosedIO</a></li>
        
          <li><a href="../Gem/Package/Error.html">Gem::Package::Error</a></li>
        
          <li><a href="../Gem/Package/FSyncDir.html">Gem::Package::FSyncDir</a></li>
        
          <li><a href="../Gem/Package/FormatError.html">Gem::Package::FormatError</a></li>
        
          <li><a href="../Gem/Package/NonSeekableIO.html">Gem::Package::NonSeekableIO</a></li>
        
          <li><a href="../Gem/Package/TarHeader.html">Gem::Package::TarHeader</a></li>
        
          <li><a href="../Gem/Package/TarOutput.html">Gem::Package::TarOutput</a></li>
        
          <li><a href="../Gem/Package/TarReader.html">Gem::Package::TarReader</a></li>
        
          <li><a href="../Gem/Package/TarReader/UnexpectedEOF.html">Gem::Package::TarReader::UnexpectedEOF</a></li>
        
          <li><a href="../Gem/Package/TarWriter.html">Gem::Package::TarWriter</a></li>
        
          <li><a href="../Gem/Package/TarWriter/BoundedStream.html">Gem::Package::TarWriter::BoundedStream</a></li>
        
          <li><a href="../Gem/Package/TarWriter/FileOverflow.html">Gem::Package::TarWriter::FileOverflow</a></li>
        
          <li><a href="../Gem/Package/TarWriter/RestrictedStream.html">Gem::Package::TarWriter::RestrictedStream</a></li>
        
          <li><a href="../Gem/Package/TooLongFileName.html">Gem::Package::TooLongFileName</a></li>
        
          <li><a href="../Gem/PackageTask.html">Gem::PackageTask</a></li>
        
          <li><a href="../Gem/Platform.html">Gem::Platform</a></li>
        
          <li><a href="../Gem/PlatformMismatch.html">Gem::PlatformMismatch</a></li>
        
          <li><a href="../Gem/RemoteError.html">Gem::RemoteError</a></li>
        
          <li><a href="../Gem/RemoteFetcher.html">Gem::RemoteFetcher</a></li>
        
          <li><a href="../Gem/RemoteFetcher/FetchError.html">Gem::RemoteFetcher::FetchError</a></li>
        
          <li><a href="../Gem/RemoteInstallationCancelled.html">Gem::RemoteInstallationCancelled</a></li>
        
          <li><a href="../Gem/RemoteInstallationSkipped.html">Gem::RemoteInstallationSkipped</a></li>
        
          <li><a href="../Gem/RemoteSourceException.html">Gem::RemoteSourceException</a></li>
        
          <li><a href="../Gem/RequirePathsBuilder.html">Gem::RequirePathsBuilder</a></li>
        
          <li><a href="../Gem/Requirement.html">Gem::Requirement</a></li>
        
          <li><a href="../Gem/Requirement.html">Gem::Requirement</a></li>
        
          <li><a href="../Gem/Security.html">Gem::Security</a></li>
        
          <li><a href="../Gem/Security/Exception.html">Gem::Security::Exception</a></li>
        
          <li><a href="../Gem/Security/Policy.html">Gem::Security::Policy</a></li>
        
          <li><a href="../Gem/Security/Signer.html">Gem::Security::Signer</a></li>
        
          <li><a href="../Gem/Server.html">Gem::Server</a></li>
        
          <li><a href="../Gem/SilentUI.html">Gem::SilentUI</a></li>
        
          <li><a href="../Gem/SourceIndex.html">Gem::SourceIndex</a></li>
        
          <li><a href="../Gem/SourceInfoCache.html">Gem::SourceInfoCache</a></li>
        
          <li><a href="../Gem/SourceInfoCacheEntry.html">Gem::SourceInfoCacheEntry</a></li>
        
          <li><a href="../Gem/SpecFetcher.html">Gem::SpecFetcher</a></li>
        
          <li><a href="../Gem/Specification.html">Gem::Specification</a></li>
        
          <li><a href="../Gem/StreamUI.html">Gem::StreamUI</a></li>
        
          <li><a href="../Gem/StreamUI/SilentProgressReporter.html">Gem::StreamUI::SilentProgressReporter</a></li>
        
          <li><a href="../Gem/StreamUI/SimpleProgressReporter.html">Gem::StreamUI::SimpleProgressReporter</a></li>
        
          <li><a href="../Gem/StreamUI/VerboseProgressReporter.html">Gem::StreamUI::VerboseProgressReporter</a></li>
        
          <li><a href="../Gem/SystemExitException.html">Gem::SystemExitException</a></li>
        
          <li><a href="../Gem/Text.html">Gem::Text</a></li>
        
          <li><a href="../Gem/Uninstaller.html">Gem::Uninstaller</a></li>
        
          <li><a href="../Gem/UserInteraction.html">Gem::UserInteraction</a></li>
        
          <li><a href="../Gem/Validator.html">Gem::Validator</a></li>
        
          <li><a href="../Gem/VerificationError.html">Gem::VerificationError</a></li>
        
          <li><a href="../Gem/Version.html">Gem::Version</a></li>
        
          <li><a href="../Gem/VersionOption.html">Gem::VersionOption</a></li>
        
          <li><a href="../OpenSSL.html">OpenSSL</a></li>
        
          <li><a href="../OpenSSL/X509.html">OpenSSL::X509</a></li>
        
          <li><a href="../Date.html">Date</a></li>
        
          <li><a href="../Kernel.html">Kernel</a></li>
        
          <li><a href="../Object.html">Object</a></li>
        
          <li><a href="../RbConfig.html">RbConfig</a></li>
        
          <li><a href="../TempIO.html">TempIO</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation" style='margin: 10px 10px 10px 10px'>
    <h1 class="class">Gem::Indexer</h1>

    <div id="description" class="description">
      
<p>Top level class for building the gem repository index.</p>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      
      <!-- Attributes -->
      <div id="attribute-method-details" class="method-section section">
        <h3 class="section-header">Attributes</h3>

        
        <div id="build_legacy-attribute-method" class="method-detail">
          <a name="build_legacy"></a>
          
          <a name="build_legacy="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">build_legacy</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          <p>Build indexes for RubyGems older than 1.2.0 when true</p>
          
          </div>
        </div>
        
        <div id="build_modern-attribute-method" class="method-detail">
          <a name="build_modern"></a>
          
          <a name="build_modern="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">build_modern</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          <p>Build indexes for RubyGems 1.2.0 and newer when true</p>
          
          </div>
        </div>
        
        <div id="dest_directory-attribute-method" class="method-detail">
          <a name="dest_directory"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">dest_directory</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          <p>Index install location</p>
          
          </div>
        </div>
        
        <div id="dest_latest_specs_index-attribute-method" class="method-detail">
          <a name="dest_latest_specs_index"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">dest_latest_specs_index</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          <p>Latest specs index install location</p>
          
          </div>
        </div>
        
        <div id="dest_prerelease_specs_index-attribute-method" class="method-detail">
          <a name="dest_prerelease_specs_index"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">dest_prerelease_specs_index</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          <p>Prerelease specs index install location</p>
          
          </div>
        </div>
        
        <div id="dest_specs_index-attribute-method" class="method-detail">
          <a name="dest_specs_index"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">dest_specs_index</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          <p>Specs index install location</p>
          
          </div>
        </div>
        
        <div id="directory-attribute-method" class="method-detail">
          <a name="directory"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">directory</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          <p>Index build directory</p>
          
          </div>
        </div>
        
      </div><!-- attribute-method-details -->
      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">(directory, options = {})</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Create an indexer that will index the gems in <tt>directory</tt>.</p>
            

            
            <div class="method-source-code" id="new-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 59</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">directory</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-keyword">unless</span> <span class="ruby-string">''</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:to_xs</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Gem::Indexer requires that the XML Builder library be installed:&quot;</span>             <span class="ruby-string">&quot;\n\tgem install builder&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">options</span> = { <span class="ruby-value">:build_legacy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:build_modern</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> }.<span class="ruby-identifier">merge</span> <span class="ruby-identifier">options</span>

  <span class="ruby-ivar">@build_legacy</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:build_legacy</span>]
  <span class="ruby-ivar">@build_modern</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:build_modern</span>]

  <span class="ruby-ivar">@rss_title</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:rss_title</span>]
  <span class="ruby-ivar">@rss_host</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:rss_host</span>]
  <span class="ruby-ivar">@rss_gems_host</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:rss_gems_host</span>]

  <span class="ruby-ivar">@dest_directory</span> = <span class="ruby-identifier">directory</span>
  <span class="ruby-ivar">@directory</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">tmpdir</span>, <span class="ruby-node">&quot;gem_generate_index_#{$$}&quot;</span>

  <span class="ruby-identifier">marshal_name</span> = <span class="ruby-node">&quot;Marshal.#{Gem.marshal_version}&quot;</span>

  <span class="ruby-ivar">@master_index</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@directory</span>, <span class="ruby-string">'yaml'</span>
  <span class="ruby-ivar">@marshal_index</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@directory</span>, <span class="ruby-identifier">marshal_name</span>

  <span class="ruby-ivar">@quick_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@directory</span>, <span class="ruby-string">'quick'</span>

  <span class="ruby-ivar">@quick_marshal_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@quick_dir</span>, <span class="ruby-identifier">marshal_name</span>

  <span class="ruby-ivar">@quick_index</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@quick_dir</span>, <span class="ruby-string">'index'</span>
  <span class="ruby-ivar">@latest_index</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@quick_dir</span>, <span class="ruby-string">'latest_index'</span>

  <span class="ruby-ivar">@specs_index</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@directory</span>, <span class="ruby-node">&quot;specs.#{Gem.marshal_version}&quot;</span>
  <span class="ruby-ivar">@latest_specs_index</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@directory</span>,
                                  <span class="ruby-node">&quot;latest_specs.#{Gem.marshal_version}&quot;</span>
  <span class="ruby-ivar">@prerelease_specs_index</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@directory</span>,
                                      <span class="ruby-node">&quot;prerelease_specs.#{Gem.marshal_version}&quot;</span>)

  <span class="ruby-ivar">@dest_specs_index</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@dest_directory</span>,
                                <span class="ruby-node">&quot;specs.#{Gem.marshal_version}&quot;</span>
  <span class="ruby-ivar">@dest_latest_specs_index</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@dest_directory</span>,
                                       <span class="ruby-node">&quot;latest_specs.#{Gem.marshal_version}&quot;</span>
  <span class="ruby-ivar">@dest_prerelease_specs_index</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@dest_directory</span>,
                                          <span class="ruby-node">&quot;prerelease_specs.#{Gem.marshal_version}&quot;</span>

  <span class="ruby-ivar">@rss_index</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@directory</span>, <span class="ruby-string">'index.rss'</span>

  <span class="ruby-ivar">@files</span> = []
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="abbreviate-method" class="method-detail ">
          <a name="method-i-abbreviate"></a>

          
          <div class="method-heading">
            <span class="method-name">abbreviate</span><span
              class="method-args">(spec)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Abbreviate the spec for downloading.  Abbreviated specs are only used for
searching, downloading and related activities and do not need deployment
specific information (e.g. list of files).  So we abbreviate the spec,
making it much smaller for quicker downloads.</p>
            

            
            <div class="method-source-code" id="abbreviate-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 113</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">abbreviate</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">files</span> = []
  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">test_files</span> = []
  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">rdoc_options</span> = []
  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">extra_rdoc_files</span> = []
  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cert_chain</span> = []
  <span class="ruby-identifier">spec</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- abbreviate-source -->
            
          </div>

          

          
        </div><!-- abbreviate-method -->

      
        <div id="build_indicies-method" class="method-detail ">
          <a name="method-i-build_indicies"></a>

          
          <div class="method-heading">
            <span class="method-name">build_indicies</span><span
              class="method-args">(index)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Build various indicies</p>
            

            
            <div class="method-source-code" id="build_indicies-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 125</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_indicies</span>(<span class="ruby-identifier">index</span>)
  <span class="ruby-comment"># Marshal gemspecs are used by both modern and legacy RubyGems</span>
  <span class="ruby-identifier">build_marshal_gemspecs</span> <span class="ruby-identifier">index</span>
  <span class="ruby-identifier">build_legacy_indicies</span> <span class="ruby-identifier">index</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@build_legacy</span>
  <span class="ruby-identifier">build_modern_indicies</span> <span class="ruby-identifier">index</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@build_modern</span>
  <span class="ruby-identifier">build_rss</span> <span class="ruby-identifier">index</span>

  <span class="ruby-identifier">compress_indicies</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- build_indicies-source -->
            
          </div>

          

          
        </div><!-- build_indicies-method -->

      
        <div id="build_legacy_indicies-method" class="method-detail ">
          <a name="method-i-build_legacy_indicies"></a>

          
          <div class="method-heading">
            <span class="method-name">build_legacy_indicies</span><span
              class="method-args">(index)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Builds indicies for RubyGems older than 1.2.x</p>
            

            
            <div class="method-source-code" id="build_legacy_indicies-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_legacy_indicies</span>(<span class="ruby-identifier">index</span>)
  <span class="ruby-identifier">progress</span> = <span class="ruby-identifier">ui</span>.<span class="ruby-identifier">progress_reporter</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">size</span>,
                                  <span class="ruby-node">&quot;Generating YAML quick index gemspecs for #{index.size} gems&quot;</span>,
                                  <span class="ruby-string">&quot;Complete&quot;</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">time</span> <span class="ruby-string">'Generated YAML quick index gemspecs'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">index</span>.<span class="ruby-identifier">released_gems</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">original_name</span>, <span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">spec_file_name</span> = <span class="ruby-node">&quot;#{original_name}.gemspec.rz&quot;</span>
      <span class="ruby-identifier">yaml_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@quick_dir</span>, <span class="ruby-identifier">spec_file_name</span>

      <span class="ruby-identifier">yaml_zipped</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">deflate</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">to_yaml</span>
      <span class="ruby-identifier">open</span> <span class="ruby-identifier">yaml_name</span>, <span class="ruby-string">'wb'</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">yaml_zipped</span> <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">updated</span> <span class="ruby-identifier">original_name</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">done</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">say</span> <span class="ruby-string">&quot;Generating quick index&quot;</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">time</span> <span class="ruby-string">'Generated quick index'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">open</span> <span class="ruby-ivar">@quick_index</span>, <span class="ruby-string">'wb'</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">io</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">spec</span><span class="ruby-operator">|</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">original_name</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">say</span> <span class="ruby-string">&quot;Generating latest index&quot;</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">time</span> <span class="ruby-string">'Generated latest index'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">open</span> <span class="ruby-ivar">@latest_index</span>, <span class="ruby-string">'wb'</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">io</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">latest_specs</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">original_name</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Don't need prerelease legacy index</span>

  <span class="ruby-identifier">say</span> <span class="ruby-string">&quot;Generating Marshal master index&quot;</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">time</span> <span class="ruby-string">'Generated Marshal master index'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">open</span> <span class="ruby-ivar">@marshal_index</span>, <span class="ruby-string">'wb'</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">dump</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">progress</span> = <span class="ruby-identifier">ui</span>.<span class="ruby-identifier">progress_reporter</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">size</span>,
                                  <span class="ruby-node">&quot;Generating YAML master index for #{index.size} gems (this may take a while)&quot;</span>,
                                  <span class="ruby-string">&quot;Complete&quot;</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">time</span> <span class="ruby-string">'Generated YAML master index'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">open</span> <span class="ruby-ivar">@master_index</span>, <span class="ruby-string">'wb'</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">io</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;--- !ruby/object:#{index.class}&quot;</span>
      <span class="ruby-identifier">io</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;gems:&quot;</span>

      <span class="ruby-identifier">gems</span> = <span class="ruby-identifier">index</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">gemspec</span><span class="ruby-operator">|</span> <span class="ruby-identifier">gemspec</span>.<span class="ruby-identifier">sort_obj</span> }
      <span class="ruby-identifier">gems</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">original_name</span>, <span class="ruby-identifier">gemspec</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">yaml</span> = <span class="ruby-identifier">gemspec</span>.<span class="ruby-identifier">to_yaml</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/^/</span>, <span class="ruby-string">'    '</span>)
        <span class="ruby-identifier">yaml</span> = <span class="ruby-identifier">yaml</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/\A    ---/</span>, <span class="ruby-string">''</span>) <span class="ruby-comment"># there's a needed extra ' ' here</span>
        <span class="ruby-identifier">io</span>.<span class="ruby-identifier">print</span> <span class="ruby-node">&quot;  #{original_name}:&quot;</span>
        <span class="ruby-identifier">io</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">yaml</span>

        <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">updated</span> <span class="ruby-identifier">original_name</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">done</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@quick_dir</span>
  <span class="ruby-ivar">@files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@master_index</span>
  <span class="ruby-ivar">@files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{@master_index}.Z&quot;</span>
  <span class="ruby-ivar">@files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@marshal_index</span>
  <span class="ruby-ivar">@files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{@marshal_index}.Z&quot;</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- build_legacy_indicies-source -->
            
          </div>

          

          
        </div><!-- build_legacy_indicies-method -->

      
        <div id="build_marshal_gemspecs-method" class="method-detail ">
          <a name="method-i-build_marshal_gemspecs"></a>

          
          <div class="method-heading">
            <span class="method-name">build_marshal_gemspecs</span><span
              class="method-args">(index)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Builds Marshal quick index gemspecs.</p>
            

            
            <div class="method-source-code" id="build_marshal_gemspecs-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 216</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_marshal_gemspecs</span>(<span class="ruby-identifier">index</span>)
  <span class="ruby-identifier">progress</span> = <span class="ruby-identifier">ui</span>.<span class="ruby-identifier">progress_reporter</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">size</span>,
                                  <span class="ruby-node">&quot;Generating Marshal quick index gemspecs for #{index.size} gems&quot;</span>,
                                  <span class="ruby-string">&quot;Complete&quot;</span>

  <span class="ruby-identifier">files</span> = []

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">time</span> <span class="ruby-string">'Generated Marshal quick index gemspecs'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">index</span>.<span class="ruby-identifier">gems</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">original_name</span>, <span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">spec_file_name</span> = <span class="ruby-node">&quot;#{original_name}.gemspec.rz&quot;</span>
      <span class="ruby-identifier">marshal_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@quick_marshal_dir</span>, <span class="ruby-identifier">spec_file_name</span>

      <span class="ruby-identifier">marshal_zipped</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">deflate</span> <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-identifier">spec</span>)
      <span class="ruby-identifier">open</span> <span class="ruby-identifier">marshal_name</span>, <span class="ruby-string">'wb'</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">marshal_zipped</span> <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">marshal_name</span>

      <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">updated</span> <span class="ruby-identifier">original_name</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">done</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@quick_marshal_dir</span>

  <span class="ruby-identifier">files</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- build_marshal_gemspecs-source -->
            
          </div>

          

          
        </div><!-- build_marshal_gemspecs-method -->

      
        <div id="build_modern_index-method" class="method-detail ">
          <a name="method-i-build_modern_index"></a>

          
          <div class="method-heading">
            <span class="method-name">build_modern_index</span><span
              class="method-args">(index, file, name)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Build a single index for RubyGems 1.2 and newer</p>
            

            
            <div class="method-source-code" id="build_modern_index-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 247</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_modern_index</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">file</span>, <span class="ruby-identifier">name</span>)
  <span class="ruby-identifier">say</span> <span class="ruby-node">&quot;Generating #{name} index&quot;</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">time</span> <span class="ruby-node">&quot;Generated #{name} index&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>, <span class="ruby-string">'wb'</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">specs</span> = <span class="ruby-identifier">index</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span>*<span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
        <span class="ruby-comment"># We have to splat here because latest_specs is an array,</span>
        <span class="ruby-comment"># while the others are hashes. See the TODO in source_index.rb</span>
        <span class="ruby-identifier">spec</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">last</span>
        <span class="ruby-identifier">platform</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">original_platform</span>

        <span class="ruby-comment"># win32-api-1.0.4-x86-mswin32-60</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-constant">String</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">platform</span> <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">alert_warning</span> <span class="ruby-node">&quot;Skipping invalid platform in gem: #{spec.full_name}&quot;</span>
          <span class="ruby-keyword">next</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">platform</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span><span class="ruby-operator">::</span><span class="ruby-constant">RUBY</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">platform</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">platform</span>.<span class="ruby-identifier">empty?</span>
        [<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">version</span>, <span class="ruby-identifier">platform</span>]
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">specs</span> = <span class="ruby-identifier">compact_specs</span>(<span class="ruby-identifier">specs</span>)
      <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-identifier">specs</span>, <span class="ruby-identifier">io</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- build_modern_index-source -->
            
          </div>

          

          
        </div><!-- build_modern_index-method -->

      
        <div id="build_modern_indicies-method" class="method-detail ">
          <a name="method-i-build_modern_indicies"></a>

          
          <div class="method-heading">
            <span class="method-name">build_modern_indicies</span><span
              class="method-args">(index)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Builds indicies for RubyGems 1.2 and newer. Handles full, latest,
prerelease</p>
            

            
            <div class="method-source-code" id="build_modern_indicies-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 277</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_modern_indicies</span>(<span class="ruby-identifier">index</span>)
  <span class="ruby-identifier">build_modern_index</span>(<span class="ruby-identifier">index</span>.<span class="ruby-identifier">released_specs</span>.<span class="ruby-identifier">sort</span>, <span class="ruby-ivar">@specs_index</span>, <span class="ruby-string">'specs'</span>)
  <span class="ruby-identifier">build_modern_index</span>(<span class="ruby-identifier">index</span>.<span class="ruby-identifier">latest_specs</span>.<span class="ruby-identifier">sort</span>,
                     <span class="ruby-ivar">@latest_specs_index</span>,
                     <span class="ruby-string">'latest specs'</span>)
  <span class="ruby-identifier">build_modern_index</span>(<span class="ruby-identifier">index</span>.<span class="ruby-identifier">prerelease_specs</span>.<span class="ruby-identifier">sort</span>,
                     <span class="ruby-ivar">@prerelease_specs_index</span>,
                     <span class="ruby-string">'prerelease specs'</span>)

  <span class="ruby-ivar">@files</span> <span class="ruby-operator">+=</span> [<span class="ruby-ivar">@specs_index</span>,
             <span class="ruby-node">&quot;#{@specs_index}.gz&quot;</span>,
             <span class="ruby-ivar">@latest_specs_index</span>,
             <span class="ruby-node">&quot;#{@latest_specs_index}.gz&quot;</span>,
             <span class="ruby-ivar">@prerelease_specs_index</span>,
             <span class="ruby-node">&quot;#{@prerelease_specs_index}.gz&quot;</span>]
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- build_modern_indicies-source -->
            
          </div>

          

          
        </div><!-- build_modern_indicies-method -->

      
        <div id="build_rss-method" class="method-detail ">
          <a name="method-i-build_rss"></a>

          
          <div class="method-heading">
            <span class="method-name">build_rss</span><span
              class="method-args">(index)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Builds an RSS feed for past two days gem releases according to the gems
date.</p>
            

            
            <div class="method-source-code" id="build_rss-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 298</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_rss</span>(<span class="ruby-identifier">index</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rss_host</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-ivar">@rss_gems_host</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">really_verbose</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">alert_warning</span> <span class="ruby-string">&quot;no --rss-host or --rss-gems-host, RSS generation disabled&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">require</span> <span class="ruby-string">'cgi'</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">'rubygems/text'</span>

  <span class="ruby-identifier">extend</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Text</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">time</span> <span class="ruby-string">'Generated rss'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">open</span> <span class="ruby-ivar">@rss_index</span>, <span class="ruby-string">'wb'</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">rss_host</span> = <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">escapeHTML</span> <span class="ruby-ivar">@rss_host</span>
      <span class="ruby-identifier">rss_title</span> = <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">escapeHTML</span>(<span class="ruby-ivar">@rss_title</span> <span class="ruby-operator">||</span> <span class="ruby-string">'gems'</span>)

      <span class="ruby-identifier">io</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&lt;?xml version=&quot;1.0&quot;?&gt;&lt;rss version=&quot;2.0&quot;&gt;  &lt;channel&gt;    &lt;title&gt;#{rss_title}&lt;/title&gt;    &lt;link&gt;http://#{rss_host}&lt;/link&gt;    &lt;description&gt;Recently released gems from http://#{rss_host}&lt;/description&gt;    &lt;generator&gt;RubyGems v#{Gem::VERSION}&lt;/generator&gt;    &lt;docs&gt;http://cyber.law.harvard.edu/rss/rss.html&lt;/docs&gt;</span>

      <span class="ruby-identifier">today</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span><span class="ruby-operator">::</span><span class="ruby-constant">TODAY</span>
      <span class="ruby-identifier">yesterday</span> = <span class="ruby-identifier">today</span> <span class="ruby-operator">-</span> <span class="ruby-value">86400</span>

      <span class="ruby-identifier">index</span> = <span class="ruby-identifier">index</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">spec_date</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">date</span>

        <span class="ruby-keyword">case</span> <span class="ruby-identifier">spec_date</span>
        <span class="ruby-keyword">when</span> <span class="ruby-constant">Date</span>
          <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">spec_date</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">yesterday</span>
        <span class="ruby-keyword">when</span> <span class="ruby-constant">Time</span>
          <span class="ruby-identifier">spec_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">yesterday</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">index</span> = <span class="ruby-identifier">index</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">spec_date</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">date</span>

        <span class="ruby-keyword">case</span> <span class="ruby-identifier">spec_date</span>
        <span class="ruby-keyword">when</span> <span class="ruby-constant">Date</span>
          <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">spec_date</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">today</span>
        <span class="ruby-keyword">when</span> <span class="ruby-constant">Time</span>
          <span class="ruby-identifier">spec_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">today</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">index</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">spec</span><span class="ruby-operator">|</span> [<span class="ruby-operator">-</span><span class="ruby-identifier">spec</span>.<span class="ruby-identifier">date</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">spec</span>] }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">gem_path</span> = <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">escapeHTML</span> <span class="ruby-node">&quot;http://#{@rss_gems_host}/gems/#{spec.file_name}&quot;</span>
        <span class="ruby-identifier">size</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span>).<span class="ruby-identifier">size</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">next</span>

        <span class="ruby-identifier">description</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">description</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">summary</span> <span class="ruby-operator">||</span> <span class="ruby-string">''</span>
        <span class="ruby-identifier">authors</span> = <span class="ruby-constant">Array</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">authors</span>
        <span class="ruby-identifier">emails</span> = <span class="ruby-constant">Array</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">email</span>
        <span class="ruby-identifier">authors</span> = <span class="ruby-identifier">emails</span>.<span class="ruby-identifier">zip</span>(<span class="ruby-identifier">authors</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">email</span>, <span class="ruby-identifier">author</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">email</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; (#{author})&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">author</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">author</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-keyword">end</span>.<span class="ruby-identifier">join</span> <span class="ruby-string">', '</span>

        <span class="ruby-identifier">description</span> = <span class="ruby-identifier">description</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\n\n+/</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">chunk</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">format_text</span> <span class="ruby-identifier">chunk</span>, <span class="ruby-value">78</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">description</span> = <span class="ruby-identifier">description</span>.<span class="ruby-identifier">join</span> <span class="ruby-string">&quot;\n\n&quot;</span>

        <span class="ruby-identifier">item</span> = <span class="ruby-string">''</span>

        <span class="ruby-identifier">item</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">    &lt;item&gt;      &lt;title&gt;#{CGI.escapeHTML spec.full_name}&lt;/title&gt;      &lt;description&gt;&amp;lt;pre&amp;gt;#{CGI.escapeHTML description.chomp}&amp;lt;/pre&amp;gt;      &lt;/description&gt;      &lt;author&gt;#{CGI.escapeHTML authors}&lt;/author&gt;      &lt;guid&gt;#{CGI.escapeHTML spec.full_name}&lt;/guid&gt;      &lt;enclosure url=\&quot;#{gem_path}\&quot;                 length=\&quot;#{size}\&quot; type=\&quot;application/octet-stream\&quot; /&gt;      &lt;pubDate&gt;#{spec.date.rfc2822}&lt;/pubDate&gt;</span>

        <span class="ruby-identifier">item</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">      &lt;link&gt;#{CGI.escapeHTML spec.homepage}&lt;/link&gt;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">homepage</span>

        <span class="ruby-identifier">item</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">    &lt;/item&gt;</span>

        <span class="ruby-identifier">io</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">item</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">io</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">  &lt;/channel&gt;&lt;/rss&gt;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@rss_index</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- build_rss-source -->
            
          </div>

          

          
        </div><!-- build_rss-method -->

      
        <div id="collect_specs-method" class="method-detail ">
          <a name="method-i-collect_specs"></a>

          
          <div class="method-heading">
            <span class="method-name">collect_specs</span><span
              class="method-args">(gems = gem_file_list)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Collect specifications from .gem files from the gem directory.</p>
            

            
            <div class="method-source-code" id="collect_specs-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 408</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">collect_specs</span>(<span class="ruby-identifier">gems</span> = <span class="ruby-identifier">gem_file_list</span>)
  <span class="ruby-identifier">index</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SourceIndex</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-identifier">progress</span> = <span class="ruby-identifier">ui</span>.<span class="ruby-identifier">progress_reporter</span> <span class="ruby-identifier">gems</span>.<span class="ruby-identifier">size</span>,
                                  <span class="ruby-node">&quot;Loading #{gems.size} gems from #{@dest_directory}&quot;</span>,
                                  <span class="ruby-string">&quot;Loaded all gems&quot;</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">time</span> <span class="ruby-string">'loaded'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">gems</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gemfile</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">size</span>(<span class="ruby-identifier">gemfile</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">alert_warning</span> <span class="ruby-node">&quot;Skipping zero-length gem: #{gemfile}&quot;</span>
        <span class="ruby-keyword">next</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">begin</span>
        <span class="ruby-identifier">spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Format</span>.<span class="ruby-identifier">from_file_by_path</span>(<span class="ruby-identifier">gemfile</span>).<span class="ruby-identifier">spec</span>
        <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-identifier">gemfile</span>

        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">gemfile</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/\/#{Regexp.escape spec.original_name}.*\.gem\z/</span> <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">expected_name</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">full_name</span>
          <span class="ruby-identifier">expected_name</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; (#{spec.original_name})&quot;</span> <span class="ruby-keyword">if</span>
            <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">original_name</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">full_name</span>
          <span class="ruby-identifier">alert_warning</span> <span class="ruby-node">&quot;Skipping misnamed gem: #{gemfile} should be named #{expected_name}&quot;</span>
          <span class="ruby-keyword">next</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">abbreviate</span> <span class="ruby-identifier">spec</span>
        <span class="ruby-identifier">sanitize</span> <span class="ruby-identifier">spec</span>

        <span class="ruby-identifier">index</span>.<span class="ruby-identifier">add_spec</span> <span class="ruby-identifier">spec</span>, <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">original_name</span>

        <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">updated</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">original_name</span>

      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">SignalException</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
        <span class="ruby-identifier">alert_error</span> <span class="ruby-string">&quot;Received signal, exiting&quot;</span>
        <span class="ruby-identifier">raise</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
        <span class="ruby-identifier">alert_error</span> <span class="ruby-node">&quot;Unable to process #{gemfile}\n#{e.message} (#{e.class})\n\t#{e.backtrace.join &quot;\n\t&quot;}&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">done</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- collect_specs-source -->
            
          </div>

          

          
        </div><!-- collect_specs-method -->

      
        <div id="compact_specs-method" class="method-detail ">
          <a name="method-i-compact_specs"></a>

          
          <div class="method-heading">
            <span class="method-name">compact_specs</span><span
              class="method-args">(specs)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Compacts Marshal output for the specs index data source by using identical
objects as much as possible.</p>
            

            
            <div class="method-source-code" id="compact_specs-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 490</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">compact_specs</span>(<span class="ruby-identifier">specs</span>)
  <span class="ruby-identifier">names</span> = {}
  <span class="ruby-identifier">versions</span> = {}
  <span class="ruby-identifier">platforms</span> = {}

  <span class="ruby-identifier">specs</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">platform</span>)<span class="ruby-operator">|</span>
    <span class="ruby-identifier">names</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">name</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">names</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">name</span>
    <span class="ruby-identifier">versions</span>[<span class="ruby-identifier">version</span>] = <span class="ruby-identifier">version</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">versions</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">version</span>
    <span class="ruby-identifier">platforms</span>[<span class="ruby-identifier">platform</span>] = <span class="ruby-identifier">platform</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">platforms</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">platform</span>

    [<span class="ruby-identifier">names</span>[<span class="ruby-identifier">name</span>], <span class="ruby-identifier">versions</span>[<span class="ruby-identifier">version</span>], <span class="ruby-identifier">platforms</span>[<span class="ruby-identifier">platform</span>]]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- compact_specs-source -->
            
          </div>

          

          
        </div><!-- compact_specs-method -->

      
        <div id="compress-method" class="method-detail ">
          <a name="method-i-compress"></a>

          
          <div class="method-heading">
            <span class="method-name">compress</span><span
              class="method-args">(filename, extension)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Compress <tt>filename</tt> with <tt>extension</tt>.</p>
            

            
            <div class="method-source-code" id="compress-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 507</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">compress</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">extension</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">read_binary</span> <span class="ruby-identifier">filename</span>

  <span class="ruby-identifier">zipped</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">deflate</span> <span class="ruby-identifier">data</span>

  <span class="ruby-identifier">open</span> <span class="ruby-node">&quot;#{filename}.#{extension}&quot;</span>, <span class="ruby-string">'wb'</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">zipped</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- compress-source -->
            
          </div>

          

          
        </div><!-- compress-method -->

      
        <div id="compress_indicies-method" class="method-detail ">
          <a name="method-i-compress_indicies"></a>

          
          <div class="method-heading">
            <span class="method-name">compress_indicies</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Compresses indicies on disk</p>
            

            
            <div class="method-source-code" id="compress_indicies-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 460</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">compress_indicies</span>
  <span class="ruby-identifier">say</span> <span class="ruby-string">&quot;Compressing indicies&quot;</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">time</span> <span class="ruby-string">'Compressed indicies'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@build_legacy</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">compress</span> <span class="ruby-ivar">@quick_index</span>, <span class="ruby-string">'rz'</span>
      <span class="ruby-identifier">paranoid</span> <span class="ruby-ivar">@quick_index</span>, <span class="ruby-string">'rz'</span>

      <span class="ruby-identifier">compress</span> <span class="ruby-ivar">@latest_index</span>, <span class="ruby-string">'rz'</span>
      <span class="ruby-identifier">paranoid</span> <span class="ruby-ivar">@latest_index</span>, <span class="ruby-string">'rz'</span>

      <span class="ruby-identifier">compress</span> <span class="ruby-ivar">@marshal_index</span>, <span class="ruby-string">'Z'</span>
      <span class="ruby-identifier">paranoid</span> <span class="ruby-ivar">@marshal_index</span>, <span class="ruby-string">'Z'</span>

      <span class="ruby-identifier">compress</span> <span class="ruby-ivar">@master_index</span>, <span class="ruby-string">'Z'</span>
      <span class="ruby-identifier">paranoid</span> <span class="ruby-ivar">@master_index</span>, <span class="ruby-string">'Z'</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@build_modern</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">gzip</span> <span class="ruby-ivar">@specs_index</span>
      <span class="ruby-identifier">gzip</span> <span class="ruby-ivar">@latest_specs_index</span>
      <span class="ruby-identifier">gzip</span> <span class="ruby-ivar">@prerelease_specs_index</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- compress_indicies-source -->
            
          </div>

          

          
        </div><!-- compress_indicies-method -->

      
        <div id="gem_file_list-method" class="method-detail ">
          <a name="method-i-gem_file_list"></a>

          
          <div class="method-heading">
            <span class="method-name">gem_file_list</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>List of gem file names to index.</p>
            

            
            <div class="method-source-code" id="gem_file_list-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 520</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_file_list</span>
  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@dest_directory</span>, <span class="ruby-string">&quot;gems&quot;</span>, <span class="ruby-string">&quot;*.gem&quot;</span>))
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- gem_file_list-source -->
            
          </div>

          

          
        </div><!-- gem_file_list-method -->

      
        <div id="generate_index-method" class="method-detail ">
          <a name="method-i-generate_index"></a>

          
          <div class="method-heading">
            <span class="method-name">generate_index</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Builds and installs indicies.</p>
            

            
            <div class="method-source-code" id="generate_index-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 527</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">generate_index</span>
  <span class="ruby-identifier">make_temp_directories</span>
  <span class="ruby-identifier">index</span> = <span class="ruby-identifier">collect_specs</span>
  <span class="ruby-identifier">build_indicies</span> <span class="ruby-identifier">index</span>
  <span class="ruby-identifier">install_indicies</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">SignalException</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-ivar">@directory</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- generate_index-source -->
            
          </div>

          

          
        </div><!-- generate_index-method -->

      
        <div id="gzip-method" class="method-detail ">
          <a name="method-i-gzip"></a>

          
          <div class="method-heading">
            <span class="method-name">gzip</span><span
              class="method-args">(filename)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Zlib::GzipWriter wrapper that gzips <tt>filename</tt> on disk.</p>
            

            
            <div class="method-source-code" id="gzip-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 540</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gzip</span>(<span class="ruby-identifier">filename</span>)
  <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipWriter</span>.<span class="ruby-identifier">open</span> <span class="ruby-node">&quot;#{filename}.gz&quot;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">read_binary</span>(<span class="ruby-identifier">filename</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- gzip-source -->
            
          </div>

          

          
        </div><!-- gzip-method -->

      
        <div id="install_indicies-method" class="method-detail ">
          <a name="method-i-install_indicies"></a>

          
          <div class="method-heading">
            <span class="method-name">install_indicies</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Install generated indicies into the destination directory.</p>
            

            
            <div class="method-source-code" id="install_indicies-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 549</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">install_indicies</span>
  <span class="ruby-identifier">verbose</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">really_verbose</span>

  <span class="ruby-identifier">say</span> <span class="ruby-node">&quot;Moving index into production dir #{@dest_directory}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span>

  <span class="ruby-identifier">files</span> = <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-identifier">files</span>.<span class="ruby-identifier">delete</span> <span class="ruby-ivar">@quick_marshal_dir</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">include?</span> <span class="ruby-ivar">@quick_dir</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">include?</span> <span class="ruby-ivar">@quick_marshal_dir</span> <span class="ruby-keyword">and</span>
     <span class="ruby-keyword">not</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">include?</span> <span class="ruby-ivar">@quick_dir</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">files</span>.<span class="ruby-identifier">delete</span> <span class="ruby-ivar">@quick_marshal_dir</span>
    <span class="ruby-identifier">quick_marshal_dir</span> = <span class="ruby-ivar">@quick_marshal_dir</span>.<span class="ruby-identifier">sub</span> <span class="ruby-ivar">@directory</span>, <span class="ruby-string">''</span>

    <span class="ruby-identifier">dst_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@dest_directory</span>, <span class="ruby-identifier">quick_marshal_dir</span>

    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">dst_name</span>), <span class="ruby-value">:verbose</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">verbose</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-identifier">dst_name</span>, <span class="ruby-value">:verbose</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">verbose</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-ivar">@quick_marshal_dir</span>, <span class="ruby-identifier">dst_name</span>, <span class="ruby-value">:verbose</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">verbose</span>,
                 <span class="ruby-value">:force</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">path</span>.<span class="ruby-identifier">sub</span> <span class="ruby-ivar">@directory</span>, <span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">src_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@directory</span>, <span class="ruby-identifier">file</span>
    <span class="ruby-identifier">dst_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@dest_directory</span>, <span class="ruby-identifier">file</span>

    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-identifier">dst_name</span>, <span class="ruby-value">:verbose</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">verbose</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-identifier">src_name</span>, <span class="ruby-ivar">@dest_directory</span>, <span class="ruby-value">:verbose</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">verbose</span>,
                 <span class="ruby-value">:force</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- install_indicies-source -->
            
          </div>

          

          
        </div><!-- install_indicies-method -->

      
        <div id="make_temp_directories-method" class="method-detail ">
          <a name="method-i-make_temp_directories"></a>

          
          <div class="method-heading">
            <span class="method-name">make_temp_directories</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Make directories for index generation</p>
            

            
            <div class="method-source-code" id="make_temp_directories-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 587</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">make_temp_directories</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-ivar">@directory</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@directory</span>, <span class="ruby-value">:mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0700</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@quick_marshal_dir</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- make_temp_directories-source -->
            
          </div>

          

          
        </div><!-- make_temp_directories-method -->

      
        <div id="paranoid-method" class="method-detail ">
          <a name="method-i-paranoid"></a>

          
          <div class="method-heading">
            <span class="method-name">paranoid</span><span
              class="method-args">(path, extension)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Ensure <tt>path</tt> and path with <tt>extension</tt> are identical.</p>
            

            
            <div class="method-source-code" id="paranoid-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 596</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">paranoid</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">extension</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">read_binary</span> <span class="ruby-identifier">path</span>
  <span class="ruby-identifier">compressed_data</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">read_binary</span> <span class="ruby-node">&quot;#{path}.#{extension}&quot;</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">data</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">inflate</span>(<span class="ruby-identifier">compressed_data</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Compressed file #{compressed_path} does not match uncompressed file #{path}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- paranoid-source -->
            
          </div>

          

          
        </div><!-- paranoid-method -->

      
        <div id="sanitize-method" class="method-detail ">
          <a name="method-i-sanitize"></a>

          
          <div class="method-heading">
            <span class="method-name">sanitize</span><span
              class="method-args">(spec)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Sanitize the descriptive fields in the spec.  Sometimes non-ASCII
characters will garble the site index.  Non-ASCII characters will be
replaced by their XML entity equivalent.</p>
            

            
            <div class="method-source-code" id="sanitize-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 610</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sanitize</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">summary</span> = <span class="ruby-identifier">sanitize_string</span>(<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">summary</span>)
  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">sanitize_string</span>(<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">description</span>)
  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">post_install_message</span> = <span class="ruby-identifier">sanitize_string</span>(<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">post_install_message</span>)
  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">authors</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">authors</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sanitize_string</span>(<span class="ruby-identifier">a</span>) }

  <span class="ruby-identifier">spec</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- sanitize-source -->
            
          </div>

          

          
        </div><!-- sanitize-method -->

      
        <div id="sanitize_string-method" class="method-detail ">
          <a name="method-i-sanitize_string"></a>

          
          <div class="method-heading">
            <span class="method-name">sanitize_string</span><span
              class="method-args">(string)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Sanitize a single string.</p>
            

            
            <div class="method-source-code" id="sanitize_string-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 622</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sanitize_string</span>(<span class="ruby-identifier">string</span>)
  <span class="ruby-comment"># HACK the #to_s is in here because RSpec has an Array of Arrays of</span>
  <span class="ruby-comment"># Strings for authors.  Need a way to disallow bad values on gempsec</span>
  <span class="ruby-comment"># generation.  (Probably won't happen.)</span>
  <span class="ruby-identifier">string</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">to_xs</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">string</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- sanitize_string-source -->
            
          </div>

          

          
        </div><!-- sanitize_string-method -->

      
        <div id="update_index-method" class="method-detail ">
          <a name="method-i-update_index"></a>

          
          <div class="method-heading">
            <span class="method-name">update_index</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Perform an in-place update of the repository from newly added gems.  Only
works for modern indicies, and sets <a
href="Indexer.html#attribute-i-build_legacy">build_legacy</a> to false when
run.</p>
            

            
            <div class="method-source-code" id="update_index-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 633</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_index</span>
  <span class="ruby-ivar">@build_legacy</span> = <span class="ruby-keyword">false</span>

  <span class="ruby-identifier">make_temp_directories</span>

  <span class="ruby-identifier">specs_mtime</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-ivar">@dest_specs_index</span>).<span class="ruby-identifier">mtime</span>
  <span class="ruby-identifier">newest_mtime</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span> <span class="ruby-value">0</span>

  <span class="ruby-identifier">updated_gems</span> = <span class="ruby-identifier">gem_file_list</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gem</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">gem_mtime</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">gem</span>).<span class="ruby-identifier">mtime</span>
    <span class="ruby-identifier">newest_mtime</span> = <span class="ruby-identifier">gem_mtime</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">gem_mtime</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">newest_mtime</span>
    <span class="ruby-identifier">gem_mtime</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">specs_mtime</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">updated_gems</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">say</span> <span class="ruby-string">'No new gems'</span>
    <span class="ruby-identifier">terminate_interaction</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">index</span> = <span class="ruby-identifier">collect_specs</span> <span class="ruby-identifier">updated_gems</span>

  <span class="ruby-identifier">files</span> = <span class="ruby-identifier">build_marshal_gemspecs</span> <span class="ruby-identifier">index</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">time</span> <span class="ruby-string">'Updated indexes'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">update_specs_index</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">released_gems</span>, <span class="ruby-ivar">@dest_specs_index</span>, <span class="ruby-ivar">@specs_index</span>
    <span class="ruby-identifier">update_specs_index</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">released_gems</span>, <span class="ruby-ivar">@dest_latest_specs_index</span>, <span class="ruby-ivar">@latest_specs_index</span>
    <span class="ruby-identifier">update_specs_index</span>(<span class="ruby-identifier">index</span>.<span class="ruby-identifier">prerelease_gems</span>, <span class="ruby-ivar">@dest_prerelease_specs_index</span>,
                       <span class="ruby-ivar">@prerelease_specs_index</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">compress_indicies</span>

  <span class="ruby-identifier">verbose</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">really_verbose</span>

  <span class="ruby-identifier">say</span> <span class="ruby-node">&quot;Updating production dir #{@dest_directory}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span>

  <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@specs_index</span>
  <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{@specs_index}.gz&quot;</span>
  <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@latest_specs_index</span>
  <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{@latest_specs_index}.gz&quot;</span>
  <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@prerelease_specs_index</span>
  <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{@prerelease_specs_index}.gz&quot;</span>

  <span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">path</span>.<span class="ruby-identifier">sub</span> <span class="ruby-ivar">@directory</span>, <span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">src_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@directory</span>, <span class="ruby-identifier">file</span>
    <span class="ruby-identifier">dst_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@dest_directory</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">file</span>)

    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-identifier">src_name</span>, <span class="ruby-identifier">dst_name</span>, <span class="ruby-value">:verbose</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">verbose</span>,
                 <span class="ruby-value">:force</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>

    <span class="ruby-constant">File</span>.<span class="ruby-identifier">utime</span> <span class="ruby-identifier">newest_mtime</span>, <span class="ruby-identifier">newest_mtime</span>, <span class="ruby-identifier">dst_name</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- update_index-source -->
            
          </div>

          

          
        </div><!-- update_index-method -->

      
        <div id="update_specs_index-method" class="method-detail ">
          <a name="method-i-update_specs_index"></a>

          
          <div class="method-heading">
            <span class="method-name">update_specs_index</span><span
              class="method-args">(index, source, dest)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Combines specs in <tt>index</tt> and <tt>source</tt> then writes out a new
copy to <tt>dest</tt>.  For a latest index, does not ensure the new file is
minimal.</p>
            

            
            <div class="method-source-code" id="update_specs_index-source">
              <pre>
              <code class='cpp'> <!-- How can we tell the language? Can we grab the file extension of the parsed source file? --> 
<span class="ruby-comment"># File rubygems/indexer.rb, line 695</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_specs_index</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">source</span>, <span class="ruby-identifier">dest</span>)
  <span class="ruby-identifier">specs_index</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">read_binary</span>(<span class="ruby-identifier">source</span>)

  <span class="ruby-identifier">index</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">platform</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">original_platform</span>
    <span class="ruby-identifier">platform</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span><span class="ruby-operator">::</span><span class="ruby-constant">RUBY</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">platform</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">platform</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">specs_index</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">version</span>, <span class="ruby-identifier">platform</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">specs_index</span> = <span class="ruby-identifier">compact_specs</span> <span class="ruby-identifier">specs_index</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">sort</span>

  <span class="ruby-identifier">open</span> <span class="ruby-identifier">dest</span>, <span class="ruby-string">'wb'</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-identifier">specs_index</span>, <span class="ruby-identifier">io</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code>
</pre> 
            </div><!-- update_specs_index-source -->
            
          </div>

          

          
        </div><!-- update_specs_index-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->
<div id="disqus_thread" style='display:none'></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    // var disqus_shortname = 'rubydocbeta'; // required 
    var disqus_shortname = 'ruby-doc'; // required 
    
    var disqus_developer = true; // DEBUGGERY
    


    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink" style='display:none'>blog comments powered by <span class="logo-disqus">Disqus</span></a>

<div class='grids wrapper' id="footer">
  <p><small>This page was generated for Ruby 1.9.2</small></p> 
  
   <p> <a href="http://www.ruby-doc.org">Ruby-doc.org</a> is managed by <a href="http://www.jamesbritt.com">James Britt</a> and <a href="http://www.neurogami.com">Neurogami</a>. <a href="http://www.neurogami.com">Live curious.</a> </p>
 
    <p><small>Generated with the <a href="http://neurogami.com/code/">Rubydoc Rdoc Generator</a> 0.9.4</small>.</p>
  </div>

</div>

<script type="text/javascript">
var _uacct = "UA-335317-2";
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{ 
var pageTracker = _gat._getTracker(_uacct);
pageTracker._trackPageview();
} catch(err) {} 
</script>
</body>
</html>

